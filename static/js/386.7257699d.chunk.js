"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[386],{3478:(t,e,s)=>{s.d(e,{N:()=>c});var n=s(864),i=s(6845),r=s(2869);const a={Enter:128,Backspace:129,ArrowLeft:130,ArrowUp:131,ArrowRight:132,ArrowDown:133,Home:134,End:135,PageUp:136,PageDown:137,Insert:138,Delete:139,Escape:140,F1:141,F2:142,F3:143,F4:144,F5:145,F6:146,F7:147,F8:148,F9:149,F10:150,F11:151,F12:152},o={ArrowLeft:"L-arrow",ArrowUp:"U-arrow",ArrowRight:"R-arrow",ArrowDown:"D-arrow"};const c=t=>{let{keyboard:e,update:s}=t;const[c,l]=(0,i.useState)(!1),[u,d]=(0,i.useState)(""),[h,p]=(0,i.useState)(e.getKey());let m=0;const g=t=>{if(!c)return;d(function(t){return o[t]||t}(t.key));const e=function(t){const e=a[t.key];if(void 0!==e)return e;if(1===t.key.length){const e=t.key.charCodeAt(0);if(e>=32&&e<=126)return e}return 0}(t);e!==m&&(x(e),s?.())},f=t=>{c&&(m=0,e.clearKey(),s?.(),p(e.getKey()),d(""))},x=t=>{0!==t&&(e.setKey(t),p(e.getKey()),m=t)};return(0,i.useEffect)((()=>(window.addEventListener("keydown",g),window.addEventListener("keyup",f),()=>{window.removeEventListener("keydown",g),window.removeEventListener("keyup",f)}))),(0,n.jsxs)("div",{className:"flex row align-baseline",children:[(0,n.jsx)("div",{className:"flex-2",children:(0,n.jsx)(r.y,{name:"Key",bits:h})}),(0,n.jsx)("div",{className:"flex-2",children:`Char: ${u}`}),(0,n.jsx)("div",{className:"flex-3",children:(0,n.jsx)("button",{onClick:()=>{l(!c)},children:(c?"Disable":"Enable")+" Keyboard"})})]})}},1062:(t,e,s)=>{s.d(e,{zp:()=>k,ZP:()=>w});var n=s(864),i=s(4089),r=s(6845),a=s(2201),o=s(6699),c=s(6871),l=s(5150),u=s(5554),d=s(5251);var h=s(6604);const p=0,m=1,g=t=>{const[e,s]=(0,r.useState)(t.mode??p),[i,a]=(0,h.i)(t.value),o=()=>{return(0,n.jsx)("span",{style:{cursor:"text",...(t="full",e="inline",void 0===t&&void 0!==d.BM[e]&&(t=e),{..."inline"===e?{display:"inline-block"}:{},width:d.BM[t]??"0"})},onClick:()=>{s(m)},children:i});var t,e},c=(0,r.useCallback)((t=>t?.select()),[]),l=(0,r.useCallback)((e=>{s(p),a(e.value??""),t.onChange(e.value??"")}),[t,s,a]),u=()=>(0,n.jsx)("span",{style:{display:"block",position:"relative"},children:(0,n.jsx)("input",{ref:c,style:{zIndex:"10",position:"absolute",left:"0",marginTop:"-0.375rem",color:"black"},onFocus:t.onFocus,onBlur:t=>{let{target:e}=t;return l(e)},onKeyPress:t=>{let{key:e,target:s}=t;"Enter"===e&&l(s)},type:"text",defaultValue:i})});return(()=>{switch(e){case m:return u();case p:return o();default:return(0,n.jsx)("span",{})}})()};var f=s(5692);function x(t,e,s){const{totalHeight:n,toleranceHeight:i,bufferedItems:r,settings:{itemHeight:a,minIndex:o,maxIndex:c}}=e,l=o+Math.floor((t-i)/a),u=function(t,e,s,n,i){const r=Math.max(0,t,s);return[...i(r,Math.min(e,s+n-1)-r)]}(o,c,l,r,s),d=Math.max((l-o)*a,0);return{scrollTop:t,topPaddingHeight:d,bottomPaddingHeight:Math.max(n-(d+u.length*a),0),data:u}}const v=t=>{const e=(0,r.useRef)(null),{settings:s,startState:i,reducer:a}=(0,r.useMemo)((()=>{const e=function(t){const{minIndex:e=0,maxIndex:s=Number.MAX_SAFE_INTEGER,startIndex:n=0,itemHeight:i=20,count:r=Math.max(s-e,1),tolerance:a=r}=t;return{minIndex:e,maxIndex:s,startIndex:n,itemHeight:i,count:r,tolerance:a}}(t.settings??{}),s=function(t,e){const{minIndex:s,maxIndex:n,startIndex:i,itemHeight:r,count:a,tolerance:o}=t,c=a+2*o,l=Math.max(0,i-o-s),u=a*r,d=Math.max(n-s,1)*r,h=o*r,p=l*r,m={scrollTop:0,settings:t,viewportHeight:u,totalHeight:d,toleranceHeight:h,bufferedItems:c,topPaddingHeight:p,bottomPaddingHeight:d-(p+(u+2*h)),data:[]};return{...m,...x(p+h,m,e)}}(e,t.get),n=(i=t.get,(t,e)=>({...t,...x(e,t,i)}));var i;return{settings:e,reducer:n,startState:s}}),[t.settings,t.get]),[o,c]=(0,r.useReducer)(a,i);(0,r.useEffect)((()=>{null!==e.current&&c(e.current.scrollTop)}),[s,t.row]);const l=(0,r.useCallback)((t=>{t&&(t.scrollTop=e.current?e.current.scrollTop:s.startIndex*s.itemHeight),e.current=t}),[e,s.startIndex,s.itemHeight]),u=o.data.map((e=>(0,n.jsx)("div",{style:{height:`${s.itemHeight}px`},children:t.row(e)},t.rowKey(e))));return(0,n.jsxs)("div",{ref:l,style:{height:`${o.viewportHeight}px`,overflowY:"scroll",overflowAnchor:"none"},className:t.className??"",onScroll:t=>c(t.target.scrollTop),children:[(0,n.jsx)("div",{style:{height:`${o.topPaddingHeight}px`}}),u,(0,n.jsx)("div",{style:{height:`${o.bottomPaddingHeight}px`}})]})},b=t=>{let{memory:e,jmp:s={value:0},highlight:i=-1,editable:a=!1,justifyLeft:o=!1,format:c=l.E_,onChange:u=(()=>{}),onFocus:d=(()=>{})}=t;const h=(0,r.useMemo)((()=>({count:Math.min(e.size,25),maxIndex:e.size,itemHeight:34,startIndex:s.value})),[e.size,s]),p=(0,r.useCallback)(((t,s)=>e.range(t,t+s).map(((e,s)=>[s+t,e]))),[e]),m=(0,r.useCallback)((t=>{let[s,r]=t;return(0,n.jsx)(y,{index:s,value:c(r),size:e.size,editable:a,justifyLeft:o,highlight:s===i,onChange:u,onFocus:d})}),[c,a,i,u]);return(0,n.jsx)(v,{settings:h,get:p,row:m,rowKey:t=>{let[e]=t;return e}})},y=t=>{let{index:e,value:s,size:r,highlight:a=!1,editable:o=!1,justifyLeft:c=!1,onChange:u=(()=>{}),onFocus:d=(()=>{})}=t;return(0,n.jsxs)("div",{style:{display:"flex",height:"100%"},children:[(0,n.jsx)("code",{style:{...(0,i.eP)("none"),...a?{background:"var(--mark-background-color)"}:{},whiteSpace:"pre"},children:r?(0,l.E_)(e).padStart(Math.ceil(Math.log10(r))," "):(0,l.E_)(e)}),(0,n.jsx)("code",{style:{flex:"1",textAlign:c?"left":"right",color:"black",...(0,i.eP)("none"),...a?{background:"var(--mark-background-color)"}:{}},children:o?(0,n.jsx)(g,{value:s,highlight:a,onChange:t=>u(e,t,Number(s)),onFocus:()=>d(e)}):(0,n.jsx)("span",{style:{color:"black"},children:s})})]})},k=t=>{let{name:e="Memory",displayEnabled:s=!0,highlight:i=-1,editable:d=!0,memory:p,format:m="dec",onUpload:g,onChange:x}=t;const[v,y]=(0,h.i)(m),[k,w]=(0,r.useState)(""),[j,S]=(0,r.useState)({value:0}),[C,O]=(0,h.i)(i),[A,T]=(0,r.useState)(0),M=()=>{const t=!isNaN(parseInt(k))&&isFinite(parseInt(k))?Number(k):0;O(t),S({value:t})},I=(0,r.useRef)(null),P=(0,r.useCallback)((()=>{x?.(),I.current?.click()}),[I]),{setStatus:R}=(0,r.useContext)(f.r),_=(0,r.useCallback)((async t=>{if(!t.target.files?.length)return void R("No file selected");const e=t.target.files[0];g?.(e.name);const s=await e.text(),n=e.name.endsWith("hack")?o.$W:e.name.endsWith("asm")?o.eC:o.uC,i=await n(s);p.loadBytes(i),t.target.value="",y(e.name.endsWith("hack")?"bin":e.name.endsWith("asm")?"asm":v),M()}),[]),E=()=>{T(A+1)};return(0,u._W)((()=>{w(""),S({value:0})})),(0,n.jsxs)("article",{className:`panel memory ${e}`,children:[(0,n.jsxs)("header",{children:[(0,n.jsx)("div",{children:e}),(0,n.jsxs)("fieldset",{role:"group",children:[(0,n.jsx)("input",{type:"file",style:{display:"none"},ref:I,onChange:_}),(0,n.jsx)("button",{onClick:P,className:"flex-0","data-tooltip":"Load file","data-placement":"bottom",children:"\ud83d\udcc2"}),(0,n.jsx)("button",{onClick:()=>{p.reset(),x?.(),E()},className:"flex-0","data-tooltip":"Clear","data-placement":"bottom",children:"\ud83c\udd91"}),(0,n.jsx)("input",{style:{width:"4em",height:"100%"},placeholder:"Addr",value:k,onKeyDown:t=>{let{key:e}=t;return"Enter"===e&&M()},onChange:t=>{let{target:{value:e}}=t;return w(e)}}),(0,n.jsx)("button",{onClick:M,className:"flex-0","data-tooltip":"Scroll to address","data-placement":"bottom",children:"\u2935\ufe0f"}),(0,n.jsx)("select",{value:v,onChange:t=>y(t.target.value),children:a.I2.map((t=>(0,n.jsx)("option",{children:t},t)))})]})]}),s?(0,n.jsx)(b,{jmp:j,memory:p,highlight:C,editable:d,justifyLeft:"asm"==v,format:t=>function(t,e){switch(t){case"bin":return(0,l.Ly)(e);case"hex":return(0,l.$v)(e);case"asm":return(0,c.a)(e);default:return(0,l.E_)(e)}}(v,t),onChange:(t,e)=>{p.update(t,e,v??"dec"),x?.(),E()},onFocus:t=>O(t)},A):"Memory display is disabled"]})},w=k},2869:(t,e,s)=>{s.d(e,{y:()=>r});var n=s(864),i=s(5150);const r=t=>{let{name:e,bits:s}=t;return(0,n.jsxs)("div",{children:[e,": ",(0,i.E_)(s)]})}},8963:(t,e,s)=>{s.d(e,{l:()=>l});var n=s(864),i=s(7239),r=s(6845),a=s(5554);const o="white";function c(t,e,s,n){const i=4*(512*s+e),r=n===o?255:0;t[i]=r,t[i+1]=r,t[i+2]=r,t[i+3]=255}const l=t=>{let{memory:e}=t;const s=(0,r.useRef)(),l=(0,r.useCallback)((()=>{const t=s.current?.getContext("2d")??void 0;t&&function(t,e){const s=(0,i.kP)(t.getImageData(0,0,512,256),"Failed to create Context2d");for(let i=0;i<512;i++)for(let t=0;t<256;t++){const a=(n=i,r=t,0===(e.get(32*r+(n/16|0))&1<<n%16)?o:"black");c(s.data,i,t,a)}var n,r;t.putImageData(s,0,0)}(t,e)}),[e]),u=(0,r.useCallback)((t=>{s.current=t??void 0,l()}),[s,l]);return(0,a.RC)(l),(0,a._W)((()=>{s.current?.getContext("2d")?.clearRect(0,0,s.current.width,s.current.height)})),(0,n.jsxs)("article",{className:"panel",children:[(0,n.jsx)("header",{children:"Screen"}),(0,n.jsx)("main",{style:{backgroundColor:"var(--code-background-color)"},children:(0,n.jsx)("figure",{style:{width:"100%",maxWidth:"512px",boxSizing:"content-box",marginInline:"auto",margin:"auto",borderTop:"2px solid gray",borderLeft:"2px solid gray",borderBottom:"2px solid lightgray",borderRight:"2px solid lightgray"},children:(0,n.jsx)("canvas",{ref:u,width:512,height:256})})})]})}},5554:(t,e,s)=>{s.d(e,{RC:()=>o,_W:()=>c,uY:()=>u});var n=s(864),i=s(6845),r=s(554),a=s(5424);function o(t){(0,i.useEffect)((()=>{const e=a.S.get().frame$.subscribe((()=>{t()}));return()=>e.unsubscribe()}),[t])}function c(t){(0,i.useEffect)((()=>{const e=a.S.get().reset$.subscribe((()=>{t()}));return()=>e.unsubscribe()}),[t])}function l(){return(0,r.j)(a.S.get())}const u=()=>{const t=function(){const[t,e]=(0,i.useState)(l());return(0,i.useEffect)((()=>{const t=a.S.get().$.subscribe((()=>{e(l())}));return()=>t.unsubscribe()}),[]),t}();return(0,n.jsx)("span",{style:{whiteSpace:"nowrap"},children:t})}},4913:(t,e,s)=>{s.d(e,{q:()=>r});var n=s(7054),i=s(7880);const r=(t,e)=>{const s=i.lA.parse(t),r=i.lA.parse(e);if((0,n.dZ)(s)||(0,n.dZ)(r))return!1;const a=(0,n.Ok)(s),o=(0,n.Ok)(r);for(let n=0;n<Math.min(a.length,o.length);n++){const t=a[n]??[],e=o[n]??[];for(let s=0;s<Math.max(t.length,e.length);s++){const n=t[s]??"",i=e[s]??"";if(null===n?.trim().match(/^\*+$/)&&i?.trim()!==n?.trim())return!1}}return!0}},1965:(t,e,s)=>{s.d(e,{M:()=>c});var n=s(864),i=s(7880),r=s(554),a=s(8177),o=s(7054);const c=t=>{let{className:e="",out:s,cmp:c,zeroState:u}=t;const d=i.lA.parse(s),h=i.lA.parse(c);if((0,o.dZ)(d))return(0,n.jsxs)("details",{children:[(0,n.jsx)("summary",{children:"Failed to parse output"}),(0,n.jsx)("pre",{children:(0,r.j)((0,o.UG)(d))}),(0,n.jsx)("code",{children:(0,n.jsx)("pre",{children:s})})]});if((0,o.dZ)(h))return(0,n.jsxs)("details",{children:[(0,n.jsx)("summary",{children:"Failed to parse compare"}),(0,n.jsxs)("code",{children:[(0,n.jsx)("pre",{children:(0,r.j)((0,o.UG)(h))}),(0,n.jsx)("pre",{children:c})]})]});const p=(0,o.Ok)(h),m=(0,o.Ok)(d);let g=0;const f=(0,a.w)(0,Math.min(p.length,m.length)).map((t=>{const e=p[t]??[],s=m[t]??[];return(0,a.w)(0,Math.max(e.length,s.length)).map(((t,n)=>[e[n]??"",s[n]??""])).map((t=>{let[e,s]=t;const n={cmp:e??'"',out:s??'"',pass:null!==e?.trim().match(/^\*+$/)||s?.trim()===e?.trim()};return n.pass||(g+=1),n}))}));return(0,n.jsxs)("div",{className:"scroll-x "+e,children:[g>0&&(0,n.jsxs)("p",{children:[g," failure",1===g?"":"s"]}),f.length>0?(0,n.jsx)("table",{style:{fontFamily:"var(--font-family-monospace)",marginBottom:"none"},children:(0,n.jsx)("tbody",{children:f.map(((t,e)=>(0,n.jsx)("tr",{children:t.map(((t,e)=>{let{cmp:s,out:i,pass:r}=t;return(0,n.jsx)(l,{cmp:s,out:i,pass:r},e)}))},e)))})}):u??(0,n.jsx)("p",{children:"Execute test script to compare output."})]})},l=t=>{let{cmp:e,out:s,pass:i}=t;return i?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("td",{children:e})}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("td",{children:[(0,n.jsx)("ins",{children:e}),(0,n.jsx)("br",{}),(0,n.jsx)("del",{children:s})]})})}},554:(t,e,s)=>{s.d(e,{j:()=>n});const n=t=>{if((t=>"function"===typeof t?.toString||"string"===typeof t)(t)){const e=t.toString();return"[object Object]"===e?JSON.stringify(t):e}return JSON.stringify(t)}},2369:(t,e,s)=>{s.d(e,{Ff:()=>b,Jx:()=>x,Z9:()=>y,Zu:()=>r,aL:()=>v});var n=s(137),i=s(2201);function r(){return{A:0,D:0,PC:0,ALU:0,flag:n.vU.Zero}}const a=32768,o=36864,c=36864,l=36864,u=4032,d=32800,h=32784,p=32776,m=32769,g=32770,f=32772;function x(t){function e(e){return(t&e)===e}return{c:e(a),x1:e(o),x2:e(c),am:e(l),op:(t&u)>>6,d1:e(d),d2:e(h),d3:e(p),j1:e(m),j2:e(g),j3:e(f)}}function v(t,e){let{inM:s,instruction:i}=t,{A:r,D:a,PC:o}=e;const c=x(i),l=c.am?s:r,[u,d]=(0,n.Bb)(c.op,a,l);return[{A:r,D:a,PC:o+1,ALU:u,flag:d},c.d3]}function b(t,e){let{inM:s,instruction:i,reset:r}=t,{A:a,D:o,PC:c,ALU:l,flag:u}=e;const d=x(i),h=d.j1&&u===n.vU.Positive,p=d.j2&&u===n.vU.Zero,m=d.j3&&u===n.vU.Negative;c=r?0:h||p||m?a:c,d.d2&&(o=l);const g=a;d.c?d.d1&&(a=l):a=32767&i;const f=d.am?s:a,v=(0,n.Bb)(d.op,o,f);l=v[0],u=v[1];return[{addressM:d.d3?g:a,outM:l,writeM:d.d3},{A:a,D:o,ALU:l,flag:u,PC:c}]}class y{RAM;ROM;Screen;Keyboard;#t=0;#e=0;#s=0;#n={A:0,D:0,PC:0,ALU:0,flag:n.vU.Zero};get state(){return this.#n}get PC(){return this.#t}get A(){return this.#e}get D(){return this.#s}setA(t){this.#e=t}setD(t){this.#s=t}setPC(t){this.#t=t}constructor(t){let{RAM:e=new i.FH,ROM:s}=t;this.RAM=e,this.ROM=s,this.Screen=new i.kG(this.RAM,i.yJ,i.GD),this.Keyboard=new i.qT(this.RAM)}reset(){this.#t=0,this.#e=0,this.#s=0}tick(){const[{addressM:t,outM:e,writeM:s},{A:i,D:r,PC:a}]=function(t,e){const[s,n]=v(t,e);return b(t,s)}({inM:this.RAM.get(this.#e),instruction:this.ROM.get(this.#t),reset:!1},{A:this.#e,D:this.#s,PC:this.#t,ALU:this.#s,flag:n.vU.Zero});this.#e=i,this.#s=r,this.#t=a,s&&this.RAM.set(t,e)}}},7880:(t,e,s)=>{s.d(e,{lA:()=>c});var n=s(9814),i=s(3484);const r="\nCmp <: Base {\n  Root := line*\n  line = bar cell+ newline?\n  cell = cellvalue bar\n  cellvalue = (~(bar|newline) any)*\n}",a=n.Z.grammar(r,i.y1),o=a.extendSemantics(i.rJ);o.addAttribute("cell",{cell:(t,e)=>t.sourceString}),o.addAttribute("line",{line:(t,e,s)=>e.children.map((t=>t.cell))}),o.addAttribute("root",{Root:t=>t.children.map((t=>t.line))});const c={grammar:r,semantics:o,parser:a,parse:(0,i.Pz)(a,o)}},4430:(t,e,s)=>{s.d(e,{qH:()=>c});var n=s(9814),i=s(3484);const r='\nTst <: Base {\n  Root := Tst\n  Tst = (TstStatement | TstRepeat | TstWhile)+\n\n  TstRepeat = Repeat Number? OpenBrace TstStatement+ CloseBrace\n  TstWhile = While Condition OpenBrace TstStatement+ CloseBrace\n  TstStatement = List<TstOperation, ","> (Semi | Bang)\n\n  TstOperation =\n    | TstFileOperation\n    | TstOutputListOperation\n    | TstEvalOperation\n    | TstSetOperation\n    | TstOutputOperation\n    | TstEchoOperation\n    | TstClearEchoOperation\n    | TstLoadROMOperation\n\n  TstLoadROMOperation = ROM32K Load FileName\n  TstFileOperation = FileOperation FileName\n  TstOutputListOperation = "output-list" OutputFormat+\n  OutputFormat = Name Index? percent FormatStyle wholeDec dot wholeDec dot wholeDec\n  TstSetOperation = Set Name Index? Number\n  Index = OpenSquare wholeDec? CloseSquare\n  Condition = Value CompareOp Value\n  TstEvalOperation = Eval | TickTock| Tick | Tock\n  TstOutputOperation = Output\n  TstEchoOperation = Echo String\n  TstClearEchoOperation = ClearEcho\n\n  FileName = Name\n  FileOperation = "load" | "output-file" | "compare-to"\n\n  Set = "set"\n  Eval = "eval"\n  Tick = "tick"\n  Tock = "tock"\n  TickTock = "ticktock"\n  Echo = "echo"\n  Repeat = "repeat"\n  ClearEcho = "clear-echo"\n  Output = "output"\n  OutputList = "output-list"\n  FormatStyle = "B"|"D"|"S"|"X"\n  ROM32K = "ROM32K"\n  Load = "load"\n  While = "while"\n\n  CompareOp = "<>" | "<=" | ">=" | "=" | "<" | ">"\n}',a=n.Z.grammar(r,i.y1),o=a.extendSemantics(i.rJ);o.extendAttribute("value",{Index:(t,e,s)=>e?.child(0)?.value??-1}),o.extendAttribute("name",{FileName(t){let{name:e}=t;return e}}),o.addAttribute("index",{Index:(t,e,s)=>e.child(0)?.value??0}),o.addAttribute("format",{OutputFormat(t,e,s,n,i,r,a,o,c){let{name:l}=t,{sourceString:u}=n,{value:d}=i,{value:h}=a,{value:p}=c;return{id:l,builtin:void 0!==e?.child(0),address:e?.child(0)?.value??-1,style:u,width:h,lpad:d,rpad:p}}}),o.addAttribute("operation",{TstEvalOperation:t=>({op:t.sourceString}),TstOutputOperation:t=>({op:"output"}),TstOutputListOperation:(t,e)=>({op:"output-list",spec:e.children.map((t=>t.format))}),TstSetOperation(t,e,s,n){let{name:i}=e,{value:r}=n;const a={op:"set",id:i,value:r},o=s.child(0)?.child(1)?.child(0);return o&&(a.index=o.value),a},TstEchoOperation:(t,e)=>({op:"echo",message:e.String}),TstClearEchoOperation:t=>({op:"clear-echo"}),TstLoadROMOperation(t,e,s){let{name:n}=s;return{op:"loadRom",file:n}},TstFileOperation:(t,e)=>({op:t.sourceString,file:e.sourceString})}),o.addAttribute("condition",{Condition(t,e,s){let{value:n}=t,{sourceString:i}=e,{value:r}=s;return{left:n,right:r,op:i}}}),o.addAttribute("statement",{TstWhile:(t,e,s,n,i)=>({statements:n.children.map((t=>{let{statement:e}=t;return e})),condition:e.condition,span:{start:t.source.startIdx,end:e.source.endIdx}}),TstRepeat:(t,e,s,n,i)=>({statements:n.children.map((t=>{let{statement:e}=t;return e})),count:e.child(0)?.value??-1,span:{start:t.source.startIdx,end:e.source.endIdx}}),TstStatement(t,e){const s={ops:t.asIteration().children.map((t=>t.operation)),span:{start:this.source.startIdx,end:this.source.endIdx}};return"!"===e.sourceString&&(s.break=!0),s}}),o.addAttribute("tst",{Tst:t=>({lines:t.children.map((t=>t.statement))})}),o.addAttribute("root",{Root(t){let{tst:e}=t;return e}});const c={grammar:r,semantics:o,parser:a,parse:(0,i.Pz)(a,o)}},9632:(t,e,s)=>{s.d(e,{o6:()=>v,l1:()=>x});var n=s(7239),i=s(2608),r=s(5524),a=s(5424),o=s(5150);class c{variable;fmt;lPad;rPad;len;index;builtin;constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"%B1.1.1",s=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;if(this.variable=t,e.startsWith("%")&&void 0===s&&void 0===i&&void 0===r){const{fmt:t,lPad:s,rPad:n,len:i}=e.match(/^%(?<fmt>[BDXS])(?<lPad>\d+)\.(?<len>\d+)\.(?<rPad>\d+)$/)?.groups;this.fmt=t,this.lPad=parseInt(s),this.rPad=parseInt(n),this.len=parseInt(i),this.builtin=!1,this.index=-1}else(0,n.hu)(["B","X","D","S"].includes(e[0])),this.fmt=e[0],this.len=s??3,this.lPad=i??1,this.rPad=r??1,this.builtin=a??!1,this.index=o??-1}header(t){let e=`${this.variable}`;if(this.builtin){e=`${e}[${this.index>=0?this.index:""}]`}return e.length>this.len+this.lPad+this.rPad?e.substring(0,this.len+this.lPad+this.rPad):this.padCenter(e)}print(t){const e=t.getVar(this.variable,this.index);if("S"===this.fmt)return this.padLeft(e);const s=(0,{B:o.Ly,D:o.E_,X:o.$v}[this.fmt])(e);return"D"===this.fmt?this.padRight(s):this.padCenter(s.slice(s.length-this.len))}padCenter(t){const e=this.lPad+this.len+this.rPad,s=Math.floor((e-t.length)/2),n=e-s-t.length,i=s+t.length,r=i+n;return t=(t=t.padStart(i)).padEnd(r)}padLeft(t){t=t.substring(0,this.len);const e=this.rPad+this.len,s=this.lPad+e;return t=(t=t.padEnd(e)).padStart(s)}padRight(t){t=t.substring(0,this.len);const e=this.lPad+this.len,s=this.rPad+e;return t=(t=t.padStart(e)).padEnd(s)}}var l=s(2201),u=s(2369);class d{instructions=[];_outputList=[];_log="";fs=new i.Wd;setFileSystem(t){return this.fs=t,this}echo(t){}clearEcho(){}async load(t){}async compareTo(t){}outputFile(t){}outputList(t){this._outputList=t}addInstruction(t){this.instructions.push(t)}reset(){return this._steps=function*(t){for(const e of t.instructions)yield*e.steps(t)}(this),this._step=this._steps.next(),this._step,this._log="",this}_steps;_step;get steps(){return void 0===this._steps&&(this.reset(),this._steps=(0,n.kP)(this._steps,"Reset did not initialize steps"),this._step=(0,n.kP)(this._step,"Reset did not find first step")),this._steps}get currentStep(){return this._step?.value}get done(){return this._step?.done??!1}step(){return!!this._step.done||(this._step.value.do(this),this._step=this.steps.next(),!1)}async run(){for(this.reset();!await this.step(););}breakpoints=new Map;addBreakpoint(t,e){this.breakpoints.set(t,e)}clearBreakpoints(){this.breakpoints.clear()}output(){const t=this._outputList.map((t=>t.print(this)));this._log+=`|${t.join("|")}|\n`}header(){const t=this._outputList.map((t=>t.header(this)));this._log+=`|${t.join("|")}|\n`}log(){return this._log}}function h(t){return void 0!==t.ops}function p(t){return void 0!==t.condition}function m(t){const e=new w;e.span=t.span;for(const s of t.ops){const t=g(s);void 0!==t&&e.addInstruction(t)}return e}function g(t){const{op:e}=t;switch(e){case"tick":return new I;case"tock":return new P;case"ticktock":return new R;case"eval":return new M;case"output":return new y;case"set":return new b(t.id,t.value,t.index);case"output-list":return new k(t.spec);case"echo":return new O(t.message);case"clear-echo":return new A;case"loadRom":return new T(t.file);case"load":case"output-file":case"compare-to":return;default:(0,n.qV)(e,`Unknown tst operation ${e}`)}}function f(t,e){for(const s of e.lines)if(h(s))t.addInstruction(m(s));else{const e=p(s)?new C(new S(s.condition.left,s.condition.right,s.condition.op)):new j(s.count);e.span=s.span,t.addInstruction(e);for(const t of s.statements)e.addInstruction(m(t))}return t.reset(),t}class x extends d{chip=new r.P9;get chipId(){return this.chip.id}clock=a.S.get();static from(t){return f(new x,t)}with(t){return this.chip=t,this}hasVar(t){return"time"===t||(t=`${t}`,this.chip.hasIn(t)||this.chip.hasOut(t))}getVar(t,e){if("time"===(t=`${t}`))return this.clock.toString();const s=this.chip.get(t,e);return s?s instanceof r.Gc?s.busVoltage:s.voltage():0}setVar(t,e,s){const n=this.chip.get(t,s);n instanceof r.Gc?n.busVoltage=e:n?.pull(0===e?r.yE:r.lj)}eval(){this.chip.eval()}tick(){this.chip.eval(),this.clock.tick()}tock(){this.chip.eval(),this.clock.tock()}async load(t){await this.chip.load(this.fs,t)}async run(){this.clock.reset(),await super.run()}}class v extends d{cpu;ticks=0;static from(t,e){return f(new v(e),t)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new l.eD(new Int16Array);super(),this.cpu=new u.Z9({ROM:t}),this.reset()}reset(){return super.reset(),this.cpu.reset(),this.ticks=0,this}hasVar(t){return"number"!==typeof t&&!("A"!==t&&"D"!==t&&"PC"!==t&&"time"!==t&&!t.startsWith("RAM"))}getVar(t,e){switch(t){case"A":return this.cpu.A;case"D":return this.cpu.D;case"PC":return this.cpu.PC;case"time":return this.ticks;case"RAM":return void 0===e?0:this.cpu.RAM.get(e)}return 0}setVar(t,e,s){switch(t){case"A":this.cpu.setA(e);break;case"D":this.cpu.setD(e);break;case"PC":this.cpu.setPC(e);break;case"RAM":this.cpu.RAM.set(s??0,e)}}ticktock(){this.ticks+=1,this.cpu.tick()}async load(t){await this.cpu.ROM.load(this.fs,t)}}class b{variable;value;index;constructor(t,e,s){this.variable=t,this.value=e,this.index=s}do(t){t.setVar(this.variable,this.value,this.index)}*steps(){yield this}}class y{do(t){t.output()}*steps(){yield this}}class k{outputs=[];constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const e of t)this.addOutput(e)}addOutput(t){this.outputs.push(new c(t.id,t.style,t.width,t.lpad,t.rpad,t.builtin,t.address))}do(t){t.outputList(this.outputs),t.header()}*steps(){yield this}}class w{instructions=[];span;addInstruction(t){this.instructions.push(t)}do(t){for(const e of this.instructions)e.do(t)}*steps(t){yield this}}class j extends w{repeat;constructor(t){super(),this.repeat=t}do(){}*innerSteps(t){for(const e of this.instructions)yield*e.steps(t)}*steps(t){if(-1===this.repeat)for(yield this;;)yield*this.innerSteps(t);else for(let e=0;e<this.repeat;e++)yield this,yield*this.innerSteps(t)}}class S{x;y;op;constructor(t,e,s){this.x=t,this.y=e,this.op=s}check(t){const e=t.hasVar(this.x)?t.getVar(this.x):this.x,s=t.hasVar(this.y)?t.getVar(this.y):this.y;if("string"===typeof e||"string"===typeof s)switch(this.op){case"=":return`${e}`===`${s}`;case"<>":return`${e}`!==`${s}`}else switch(this.op){case"<":return e<s;case"<=":return e<=s;case">":return e>s;case">=":return e>=s;case"=":return e===s;case"<>":return e!==s}return!1}}class C extends w{condition;constructor(t){super(),this.condition=t}*steps(t){for(;this.condition.check(t);){yield this;for(const e of this.instructions)yield*e.steps(t)}}}class O{content;constructor(t){this.content=t}do(t){t.echo(this.content)}*steps(){yield this}}class A{do(t){t.clearEcho()}*steps(){yield this}}class T{file;constructor(t){this.file=t}async do(t){t.fs.pushd("/test"),await t.load(this.file),t.fs.popd()}*steps(){yield this}}class M{_chipTestInstruction_=!0;do(t){t.eval()}*steps(){yield this}}class I{_chipTestInstruction_=!0;do(t){t.tick()}*steps(){yield this}}class P{_chipTestInstruction_=!0;do(t){t.tock()}*steps(){yield this}}class R{_cpuTestInstruction_=!0;do(t){t.ticktock()}*steps(){yield this}}}}]);