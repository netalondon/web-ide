"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[604],{4604:(e,t,s)=>{s.r(t),s.d(t,{Asm:()=>N,default:()=>M});var n=s(8061),r=s(258),i=s(4625),o=s(5838),a=s(1845),l=s(326),u=s(6167),c=s(7559),d=s(8698);class h{asm=null;current=-1;done=!1;symbols=[];hiddenSymbols=new Map;result="";lineNumbers=[];load(e,t){this.symbols=[["R0","0"],["R1","1"],["R2","2"],["...",""],["R15","15"],["SCREEN",o.GD.toString()],["KBD",o.eu.toString()]],this.hiddenSymbols.clear(),this.asm=e,(0,a.$o)(e,((e,t,s)=>{s?this.hiddenSymbols.set(t,[e,!1]):this.symbols.push([e,t.toString()])})),e.instructions=e.instructions.filter((e=>"L"!==e.type)),this.resolveLineNumbers(t),this.reset()}resolveLineNumbers(e){if(null===this.asm)return;this.lineNumbers=Array(e);let t=0;for(const s of this.asm.instructions)"A"!==s.type&&"C"!==s.type||(this.lineNumbers[s.lineNum]=t,t++)}step(e){if(null===this.asm||this.current>=this.asm.instructions.length-1)return;this.current++;const t=this.asm.instructions[this.current];if("A"===t.type||"C"===t.type){e.sourceHighlight=t.span;const s=(0,a.Y_)(this.asm.instructions[this.current]);if(void 0===s)return;if(this.result+=`${(0,l.Ly)(s)}\n`,e.resultHighlight={start:17*this.current,end:17*(this.current+1)},e.highlightMap.set(t.span,e.resultHighlight),"A"===t.type&&(0,a.w_)(t)){const e=this.hiddenSymbols.get(t.value);void 0==e||e[1]||(this.symbols.push([e[0],t.value.toString()]),this.hiddenSymbols.set(t.value,[e[0],!0]))}this.current===this.asm.instructions.length-1&&(this.done=!0)}}resetSymbols(){const e=new Set;for(const[t,s]of this.hiddenSymbols)e.add(s[0]),this.hiddenSymbols.set(t,[s[0],!1]);this.symbols=this.symbols.filter((t=>!e.has(t[0])))}reset(){this.current=-1,this.result="",this.done=!1,this.resetSymbols()}}function g(){const{setStatus:e}=(0,u.useContext)(d.r),t=(0,u.useRef)((()=>{})),{initialState:s,reducers:n,actions:r}=(0,u.useMemo)((()=>function(e,t){const s=new h,n={resultHighlight:void 0,sourceHighlight:void 0,highlightMap:new Map};let r=!0;const o={setAsm(e,t){let{asm:s}=t;e.asm=s},setCmp(t,s){let{cmp:n}=s;t.compare=n,e("Loaded compare file")},update(e){e.current=s.current,e.result=s.result,e.symbols=Array.from(s.symbols),e.lineNumbers=Array.from(s.lineNumbers),e.sourceHighlight=n.sourceHighlight,e.resultHighlight=n.resultHighlight},compare(t){const s=t.result.split("\n"),n=t.compare.split("\n");if(s.length==n.length){for(let r=0;r<n.length;r++)for(let i=0;i<n[r].length;i++)if(s[r][i]!==n[r][i])return e(`Comparison failed at ${r}:${i}`),void(t.resultHighlight={start:17*r,end:17*(r+1)});e("Comparison successful")}else e("Comparison failed - different lengths")}},l={loadAsm(n){t.current({action:"setAsm",payload:{asm:n}});const r=a.Ww.parse(n);(0,i.dZ)(r)?e(`Error parsing asm file - ${(0,i.UG)(r).message}`):(s.load((0,i.Ok)(r),n.split("\n").length),t.current({action:"update"}),e("Loaded asm file"))},setAnimate(e){r=e},step:()=>(s.step(n),(r||s.done)&&t.current({action:"update"}),s.done&&e("Translation done."),s.done),updateHighlight(e,s){for(const[t,r]of n.highlightMap)(s&&t.start<=e&&e<=t.end||!s&&r.start<=e&&e<=r.end)&&(n.sourceHighlight=t,n.resultHighlight=r);t.current({action:"update"})},resetHighlightInfo(){n.sourceHighlight=void 0,n.resultHighlight=void 0,n.highlightMap.clear()},reset(){e("Reset"),s.reset(),this.resetHighlightInfo(),t.current({action:"update"})}};return{initialState:{asm:"",current:-1,resultHighlight:void 0,sourceHighlight:void 0,symbols:[],result:"",compare:"",lineNumbers:[]},reducers:o,actions:l}}(e,t)),[e,t]),[o,l]=(0,c.C)(n,s);return t.current=l,{state:o,dispatch:t,actions:r}}var m=s(7878),p=s(8039);const f=e=>{let{values:t=[],highlight:s=-1,onClick:n}=e;return(0,m.jsx)("div",{children:t.map(((e,t)=>(0,m.jsx)(v,{identifier:e[0],value:e[1],highlight:t===s,onClick:()=>n?.(e[0],e[1])},t)))})},v=e=>{let{identifier:t,value:s,highlight:n=!1,onClick:r}=e;return(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center"},onClick:r,children:[t.length>0&&(0,m.jsx)("code",{style:{flex:"1",...(0,p.eP)("none"),...n?{background:"var(--mark-background-color)"}:{},whiteSpace:"pre",padding:"3px"},children:t}),s.length>0&&(0,m.jsx)("code",{style:{flex:"1",textAlign:"right",color:"black",padding:"3px",...(0,p.eP)("none"),...n?{background:"var(--mark-background-color)"}:{}},children:s})]})};var x=s(8923),b=s(1539),C=s(1124),y=s(5523),j=s(8016),S=s(2147);const k=s(8).Z[2],N=()=>{const{state:e,actions:t,dispatch:s}=g(),{setTool:i,setCpuProgram:o}=(0,u.useContext)(j.Il),[l,c]=(0,u.useState)(""),[h,p]=(0,u.useState)(""),v=(0,u.useRef)(0),N=(0,u.useRef)(0),M=(0,u.useRef)(),[H,R]=(0,u.useState)(!1),w=(0,S.R)();(0,u.useEffect)((()=>(M.current=new class extends x.B{async tick(){return v.current=0,N.current=0,t.step()}reset(){t.reset()}toggle(){}},R(!0),()=>{var e;null===(e=M.current)||void 0===e||e.stop()})),[t,s]);const L=(0,u.useRef)(null),E=(0,u.useRef)(null),P=(0,u.useRef)(null);let A="asm";const{setStatus:F}=(0,u.useContext)(d.r);return(0,m.jsxs)("div",{className:"AsmPage grid",children:[(0,m.jsx)(C.s,{className:"source",header:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{children:[(0,m.jsx)(n.cC,{id:"Source"}),l&&`: ${l}`]}),(0,m.jsx)("input",{type:"file",style:{display:"none"},ref:L,onChange:async e=>{var n;if(null===(n=e.target.files)||void 0===n||!n.length)return void F("No file selected");F("Loading");const r=e.target.files[0],i=await r.text();if("asm"===A){if(!r.name.endsWith(".asm"))return void F("File must be .asm file");t.loadAsm(i),c(r.name)}else{if(!r.name.endsWith(".hack"))return void F("File must be .hack file");s.current({action:"setCmp",payload:{cmp:i}}),p(r.name)}}}),(0,m.jsx)("div",{className:"flex-1",children:H&&M.current&&(0,m.jsx)(r.D,{runner:M.current,prefix:(0,m.jsx)("button",{className:"flex-0",onClick:()=>{var e;A="asm",null===(e=L.current)||void 0===e||e.click()},"data-tooltip":"Load file","data-placement":"bottom",children:"\ud83d\udcc2"}),overrideTooltips:["Translate","Translate all"],onSpeedChange:e=>{t.setAnimate(e<=2)}})})]}),children:(0,m.jsx)(b.M,{value:e.asm,onChange:e=>{},onCursorPositionChange:e=>{e!=v.current&&(v.current=e,t.updateHighlight(e,!0))},grammar:a.Ww.parser,language:"asm",highlight:e.sourceHighlight,disabled:!0,lineNumberTransform:t=>{const s=e.lineNumbers[t];return(void 0===s?"":s).toString()}})}),(0,m.jsxs)(C.s,{className:"result",header:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{children:(0,m.jsx)(n.cC,{id:"Binary Code"})}),(0,m.jsxs)("div",{children:[(0,m.jsx)("a",{ref:E,style:{display:"none"}}),(0,m.jsx)("fieldset",{role:"group",children:(0,m.jsx)("button",{onClick:w.open,children:"\ud83d\udcc2"})}),(0,m.jsx)("dialog",{open:w.isOpen,children:(0,m.jsxs)("article",{children:[(0,m.jsx)("header",{style:{display:"flex",flexDirection:"row-reverse"},children:(0,m.jsx)("a",{style:{color:"rgba(0, 0, 0, 0)"},className:"close",href:"#root",onClick:e=>{e.preventDefault(),w.close()}})}),(0,m.jsxs)("main",{children:[(0,m.jsx)("button",{onClick:()=>{(()=>{const t=new Blob([e.result],{type:"text/plain"}),s=URL.createObjectURL(t);E.current&&(E.current.href=s,E.current.download=l.replace(".asm",".hack"),E.current.click(),URL.revokeObjectURL(s))})(),w.close()},children:"Download"}),(0,m.jsx)(y.rU,{ref:P,style:{display:"none"},to:k.href}),(0,m.jsx)("button",{onClick:()=>{var t;i("cpu"),o(e.result),null===(t=P.current)||void 0===t||t.click()},children:"Load in CPU Emulator"})]})]})})]})]}),children:[(0,m.jsx)(b.M,{value:e.result,highlight:e.resultHighlight,disabled:!0,onChange:function(e){},onCursorPositionChange:e=>{e!=N.current&&(N.current=e,t.updateHighlight(e,!1))},grammar:void 0,language:"",dynamicHeight:!0,lineNumberTransform:e=>(e-1).toString()}),e.symbols.length>0&&"Symbol Table",(0,m.jsx)(f,{values:e.symbols})]}),(0,m.jsx)(C.s,{className:"compare",header:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{children:[(0,m.jsx)(n.cC,{id:"Compare"}),h&&`: ${h}`]}),(0,m.jsx)("div",{children:(0,m.jsxs)("fieldset",{role:"group",children:[(0,m.jsx)("button",{onClick:()=>{s.current({action:"compare"})},children:"Compare"}),(0,m.jsx)("button",{onClick:()=>{var e;A="cmp",null===(e=L.current)||void 0===e||e.click()},"data-tooltip":"Load file","data-placement":"left",children:"\ud83d\udcc2"})]})})]}),children:(0,m.jsx)(b.M,{value:e.compare,highlight:e.resultHighlight,disabled:!0,onChange:function(e){},onCursorPositionChange:e=>{e!=N.current&&(N.current=e,t.updateHighlight(e,!1))},language:"",lineNumberTransform:e=>(e-1).toString()})})]})},M=N},1539:(e,t,s)=>{s.d(t,{M:()=>g});var n=s(8061),r=s(9659),i=s(7536),o=s(6167),a=s(8016),l=s(1510),u=s(7878);const c=e=>{var t,s;let{error:r}=e;return null!==r&&void 0!==r&&r.failed()?(0,u.jsxs)("details",{className:"ErrorPanel",open:!0,children:[(0,u.jsx)("summary",{role:"button",className:"secondary",children:(0,u.jsx)(n.cC,{id:"Parse Error"})}),(0,u.jsx)("pre",{children:(0,u.jsx)("code",{children:null!==(t=null!==(s=null===r||void 0===r?void 0:r.message)&&void 0!==s?s:null===r||void 0===r?void 0:r.shortMessage)&&void 0!==t?t:l.eP})})]}):(0,u.jsx)(u.Fragment,{})},d=e=>{let{value:t,onChange:s,language:n,disabled:r=!1}=e;const[i,a]=(0,o.useState)(t);return(0,u.jsx)("textarea",{"data-testid":`editor-${n}`,disabled:r,value:i,onChange:e=>{var t;const n=null===(t=e.target)||void 0===t?void 0:t.value;a(n),s(n)}})},h=e=>{let{value:t,onChange:s,onCursorPositionChange:n,language:r,error:l,disabled:c=!1,highlight:d,dynamicHeight:h=!1,lineNumberTransform:g}=e;const{theme:m}=(0,o.useContext)(a.Il),p=(0,i.Ik)(),[f,v]=(0,o.useState)(0),x=(0,o.useRef)(),b=(0,o.useRef)([]),C=(0,o.useRef)(void 0),y=(0,o.useCallback)((()=>("system"===m?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"===m)?"vs-dark":"vs"),[m]),j=(0,o.useCallback)((()=>{var e;b.current=((e,t,s,n)=>{if(!t||!s)return n;const r=t.getModel();if(!r)return n;const i=r.getPositionAt(s.start),o=r.getPositionAt(s.end),a=null===e||void 0===e?void 0:e.Range.fromPositions(i,o),l=[];return a&&(l.push({range:a,options:{inlineClassName:"highlight"}}),t.revealRangeInCenter(a)),t.deltaDecorations(n,l)})(p,x.current,null!==(e=C.current)&&void 0!==e?e:{start:0,end:0},b.current)}),[b,p,x,C]),S=()=>{if(h){var e;const t=null===(e=x.current)||void 0===e?void 0:e.getContentHeight();t&&v(t)}};(0,o.useEffect)((()=>{C.current=d,j()}),[d]);const k=(0,o.useCallback)((e=>{var t,s;x.current=e,null===(t=x.current)||void 0===t||t.updateOptions({fontFamily:'"JetBrains Mono", source-code-pro, Menlo, Monaco,\n      Consolas, "Roboto Mono", "Ubuntu Monospace", "Noto Mono", "Oxygen Mono",\n      "Liberation Mono", monospace, "Apple Color Emoji", "Segoe UI Emoji",\n      "Segoe UI Symbol", "Noto Color Emoji"',fontSize:16,minimap:{enabled:!1},theme:y(),scrollBeyondLastLine:!1,readOnly:c,lineNumbers:null!==g&&void 0!==g?g:"on",folding:!1}),j(),S(),null===(s=x.current)||void 0===s||s.onDidChangeCursorPosition((e=>{var t,s;const r=null===(t=x.current)||void 0===t||null===(s=t.getModel())||void 0===s?void 0:s.getOffsetAt(e.position);void 0!==r&&(null===n||void 0===n||n(r))}))}),[y]);(0,o.useEffect)((()=>{void 0!==x.current&&x.current.updateOptions({lineNumbers:null!==g&&void 0!==g?g:"on"})}),[g]),(0,o.useEffect)((()=>{void 0!==x.current&&x.current.updateOptions({theme:y()})}),[x,y]),(0,o.useEffect)((()=>{void 0!==x.current&&x.current.updateOptions({readOnly:c})}),[x,c]),(0,o.useEffect)((()=>{var e,t,s,n,i;if(void 0===x.current)return;if(null===p)return;const o=x.current.getModel();if(null===o)return;if(void 0===l||l.succeeded())return void p.editor.setModelMarkers(o,r,[]);const{line:a,column:u,message:c}=null!==(e=null===(t=/Line (?<line>\d+), col (?<column>\d+): (?<message>.*)/.exec(null!==(s=l.shortMessage)&&void 0!==s?s:""))||void 0===t?void 0:t.groups)&&void 0!==e?e:{line:1,column:1,message:"could not parse error"},d=Number(a),h=d,g=Number(u);let m=g+(null!==(n=null===(i=o.getLineContent(d).substring(g-1).match(/([^\s]+)/))||void 0===i?void 0:i[0].length)&&void 0!==n?n:1);m<=g&&(m=g+1),p.editor.setModelMarkers(o,r,[{message:c,startColumn:g,startLineNumber:d,endColumn:m,endLineNumber:h,severity:8}])}),[l,x,p,r]);return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(i.ZP,{value:t,onChange:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";S(),s(e)},language:r,onMount:k,height:h?f:void 0})})},g=e=>{let{className:t="",style:s={},disabled:n=!1,value:i,onChange:l,onCursorPositionChange:g,grammar:m,language:p,highlight:f,dynamicHeight:v=!1,lineNumberTransform:x}=e;const[b,C]=(0,o.useState)(),{monaco:y}=(0,o.useContext)(a.Il),j=(0,o.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(m){const t=m.match(e);C(t.failed()?t:void 0)}}),[C,m]);(0,o.useEffect)((()=>j(i)),[j,i]);const S=(0,o.useMemo)((()=>(0,r.D)(j,500)),[j]),k=(0,o.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";l(e),S(e)}),[S,l]);return(0,u.jsx)("div",{className:`Editor ${v?"dynamic-height":""} ${t}`,style:s,children:y.canUse&&y.wants?(0,u.jsx)(h,{value:i,onChange:k,onCursorPositionChange:g,language:p,error:b,disabled:n,highlight:f,dynamicHeight:v,lineNumberTransform:x}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(d,{value:i,onChange:k,language:p,disabled:n}),(0,u.jsx)(c,{error:b})]})})}},1124:(e,t,s)=>{s.d(t,{G:()=>i,s:()=>r});var n=s(7878);const r=e=>{var t;return(0,n.jsxs)("article",{className:["panel",null!==(t=e.className)&&void 0!==t?t:""].join(" "),children:[e.header&&(0,n.jsx)("header",{children:e.header}),(0,n.jsx)("main",{children:e.children}),e.footer&&(0,n.jsx)("footer",{children:e.footer})]})},i=e=>{var t;return(0,n.jsxs)("details",{className:null!==(t=e.className)&&void 0!==t?t:"",open:e.open,style:e.style,children:[(0,n.jsx)("summary",{children:(0,n.jsx)("div",{className:"flex row align-baseline",children:e.summary})}),e.children]})}},7559:(e,t,s)=>{s.d(t,{C:()=>i,i:()=>o});var n=s(1408),r=s(6167);function i(e,t){return(0,r.useReducer)(((t,s)=>(0,n.ZP)(t,(t=>{e[s.action](t,s.payload)}))),t)}function o(e){const[t,s]=(0,r.useState)(e);return(0,r.useEffect)((()=>{s(e)}),[e]),[t,s]}},258:(e,t,s)=>{s.d(t,{D:()=>o});var n=s(7878),r=s(6167),i=s(7559);const o=e=>{const t=function(e){const t=(0,r.useRef)((()=>{})),{initialState:s,reducers:n,actions:o}=(0,r.useMemo)((()=>((e,t)=>{const s={running:e.running,speed:e.speed,steps:e.steps},n=e.finishFrame.bind(e);return e.finishFrame=function(){n(),t.current({action:"update"})},{initialState:s,reducers:{update(t){t.running=e.running,t.speed=e.speed,t.steps=e.steps},setSteps(t,s){t.steps=s,e.steps=s},setSpeed(t,s){t.speed=s,e.speed=s}},actions:{frame(){e.frame()},start(){e.start(),t.current({action:"update"})},stop(){e.stop(),t.current({action:"update"})},reset(){e.reset(),t.current({action:"update"})}}}})(e,t)),[e,t]),[a,l]=(0,i.C)(n,s);return t.current=l,{state:a,dispatch:t.current,actions:o}}(e.runner),[s,o]=(0,r.useState)(0),a={0:[1e3,1],1:[500,1],2:[16,1],3:[16,16666],4:[16,499980]};(0,r.useEffect)((()=>{l()}),[s]);const l=()=>{const[e,n]=a[s];t.dispatch({action:"setSpeed",payload:e}),t.dispatch({action:"setSteps",payload:n})};return(0,n.jsxs)("fieldset",{role:"group",children:[e.prefix,(0,n.jsx)("button",{className:"flex-0",onClick:()=>t.actions.frame(),"data-tooltip":e.overrideTooltips?.[0]??"Step","data-placement":"bottom",children:"\u27a1\ufe0f"}),(0,n.jsx)("button",{className:"flex-0",onClick:()=>t.state.running?t.actions.stop():t.actions.start(),"data-tooltip":t.state.running?e.overrideTooltips?.[2]??"Pause":e.overrideTooltips?.[1]??"Run","data-placement":"bottom",children:t.state.running?"\u23f8":"\ufe0f\u23e9"}),(0,n.jsx)("button",{className:"flex-0",onClick:()=>t.actions.reset(),"data-tooltip":e.overrideTooltips?.[3]??"Reset","data-placement":"bottom",children:"\u23ee"}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:"normal"},children:[(0,n.jsx)("span",{style:{padding:"0.2rem"},children:"Slow"}),(0,n.jsx)("input",{type:"range",min:0,max:4,step:1,value:s,disabled:t.state.running,onChange:t=>{o(Number(t.target.value)),e.onSpeedChange?.(Number(t.target.value))},style:{width:"150px",padding:"0.2rem"},"data-tooltip":"Execution speed","data-placement":"bottom"}),(0,n.jsx)("span",{style:{padding:"0.2rem"},children:"Fast"})]}),e.children]})}},8923:(e,t,s)=>{s.d(t,{B:()=>r});const n=s(6531).S.get();class r{frame(){this.tick(),this.finishFrame()}finishFrame(){n.frame()}steps=1;speed=1e3;get running(){return this.#e}#e=!1;#t=0;#s=0;#n=async()=>{if(!this.#e)return;const e=Date.now(),t=e-this.#s;if(this.#s=e,this.#t+=t,this.#t>this.speed){let e=!1,t=this.steps;const s=`Timing ${t} steps`;for(console.time(s);!e&&t--;)e=await this.tick();console.timeEnd(s),this.finishFrame(),e&&this.stop(),this.#t-=this.speed}requestAnimationFrame(this.#n)};start(){this.#e=!0,this.#s=Date.now()-this.speed,this.#n(),this.toggle()}stop(){this.#e=!1,this.toggle()}}}}]);
//# sourceMappingURL=604.37a42b29.chunk.js.map