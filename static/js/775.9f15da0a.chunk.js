"use strict";(globalThis.webpackChunk_nand2tetris_web=globalThis.webpackChunk_nand2tetris_web||[]).push([[775],{4829:(e,t,s)=>{s.r(t),s.d(t,{Chip:()=>_,default:()=>R});var n=s(6458),i=s(8256),a=s(8878),r=s(782),l=s(7761),o=s(6980),c=s(2331),d=s(836),x=s(9651),h=s(8739),u=s(7721),m=s(3180);const p=({A:e,op:t,D:s,out:n,flag:i})=>(0,r.jsxs)("div",{className:"alu",children:[(0,r.jsx)("span",{children:"ALU"}),(0,r.jsxs)("svg",{width:"250",height:"250",version:"1.1",children:[(0,r.jsx)("defs",{children:(0,r.jsx)("rect",{x:"34.442518",y:"54.335354",width:"0.91770717",height:"20.780869"})}),(0,r.jsxs)("g",{children:[(0,r.jsx)("polygon",{points:"70,10 180,85 180,165 70,240 70,135 90,125 70,115",stroke:"#000",fill:"#6D97AB"}),(0,r.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",y:"61",x:"35",fill:"#000000",children:e}),(0,r.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",y:"176",x:"35",fill:"#000000",children:s}),(0,r.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",y:"121",x:"207",fill:"#000000",children:n}),(0,r.jsx)("text",{xmlSpace:"preserve",y:"130.50002",x:"110.393929",fill:"#ffffff",fontSize:24,children:h._0.op[t]??"(??)"}),(0,r.jsxs)("g",{children:[(0,r.jsx)("path",{stroke:"black",d:"M 6,67.52217 H 68.675994"}),(0,r.jsx)("path",{stroke:"black",d:"M 68.479388,67.746136 60.290279,61.90711"}),(0,r.jsx)("path",{stroke:"black",d:"m 68.479388,67.40711 -8.189109,5.839026"})]}),(0,r.jsxs)("g",{transform:"translate(0,115.5)",children:[(0,r.jsx)("path",{stroke:"black",d:"M 6,67.52217 H 68.675994"}),(0,r.jsx)("path",{d:"M 68.479388,67.746136 60.290279,61.90711",stroke:"black"}),(0,r.jsx)("path",{stroke:"black",d:"m 68.479388,67.40711 -8.189109,5.839026"})]}),(0,r.jsxs)("g",{transform:"translate(176,57.5)",children:[(0,r.jsx)("path",{stroke:"black",d:"M 6,67.52217 H 68.675994"}),(0,r.jsx)("path",{stroke:"black",d:"M 68.479388,67.746136 60.290279,61.90711"}),(0,r.jsx)("path",{stroke:"black",d:"m 68.479388,67.40711 -8.189109,5.839026"})]})]})]})]});var f=s(7437),j=s(64),g=s(6537),b=s(4668);function v(e){return(0,r.jsx)(j.ce,{name:e.name,memory:e.memory,format:e instanceof l.N4?"asm":"dec",highlight:e.address,count:5})}function k(e,t,s){if(e instanceof o.Hs)return(0,r.jsx)(p,{A:e.in("x").busVoltage,op:e.op(),D:e.in("y").busVoltage,out:e.out().busVoltage,flag:e.out("zr").voltage()===x.RY?h.iI.Zero:e.out("ng").voltage()===x.RY?h.iI.Negative:h.iI.Positive});if(e instanceof c.UZ)return(0,r.jsx)(g.d,{name:e.name??`Chip ${e.id}`,bits:e.bits});if(e instanceof c.PC)return(0,r.jsx)(g.d,{name:"PC",bits:e.bits});if(e instanceof l.s3)return(0,r.jsx)(f.s,{keyboard:e,update:t});if(e instanceof l.ff)return(0,r.jsx)(b.f,{memory:e.memory});if(e instanceof d.XK)return v(e);if(e instanceof d.Z4)return(0,r.jsxs)("span",{children:["RAM ",e.width]});if(e instanceof l.Z8){const t=(0,u.D4)(e.in("instruction").busVoltage);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.d,{name:"A",bits:e.state.A}),(0,r.jsx)(g.d,{name:"D",bits:e.state.D}),(0,r.jsx)(g.d,{name:"PC",bits:e.state.PC}),(0,r.jsx)(p,{A:t.am?e.in("inM").busVoltage:e.state.A,D:e.state.D,out:e.state.ALU,op:t.op,flag:e.state.flag})]})}if(e instanceof l.Sc)return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.d,{name:"A",bits:e.cpu.state.A}),(0,r.jsx)(g.d,{name:"D",bits:e.cpu.state.D}),(0,r.jsx)(g.d,{name:"PC",bits:e.cpu.state.PC}),!s?.has(m.XC)&&(0,r.jsx)(b.f,{memory:e.ram.screen.memory}),v(e.rom),v(e.ram.ram)]});const n=[...e.parts].map((e=>k(e,t))).filter((e=>void 0!==e));return n.length>0?(0,r.jsx)(r.Fragment,{children:n}):void 0}var C=s(6513),y=s(7490),w=s(1593),P=s(910),N=s(5005),A=s(1091),B=s(6754),S=s(9267),D=s(8029),F=s(3600),E=s(2675),M=s(5168);const _=()=>{const{setStatus:e}=(0,a.useContext)(P.L),{stores:t,setTool:s}=(0,a.useContext)(F.NQ),{tracking:l,filePicker:o}=(0,a.useContext)(D.BR),{state:c,actions:d,dispatch:x}=t.chip,[h,u]=(0,w.b)(c.files.hdl),[m,p]=(0,w.b)(c.files.tst),[f,j]=(0,w.b)(c.files.cmp),[g,b]=(0,w.b)(c.files.out),[v,_]=(0,a.useState)("/");(0,a.useEffect)((()=>{s("chip")}),[s]),(0,a.useEffect)((()=>{l.trackPage("/chip")}),[l]),(0,a.useEffect)((()=>{l.trackEvent("action","setProject",c.controls.project),l.trackEvent("action","setChip",c.controls.chipName)}),[]);const R=(0,a.useCallback)((()=>{d.eval(),l.trackEvent("action","eval")}),[d,l]),H=(0,a.useRef)((()=>{}));H.current=async(e={})=>{var t,s,n,i;const a=c.controls.usingBuiltin?e.hdl:null!==(t=e.hdl)&&void 0!==t?t:h;await d.updateFiles({hdl:a,tst:null!==(s=e.tst)&&void 0!==s?s:m,cmp:null!==(n=e.cmp)&&void 0!==n?n:f,tstPath:null!==(i=e.tstPath)&&void 0!==i?i:v})},(0,a.useEffect)((()=>{H.current({tst:m,cmp:f}),d.reset()}),[m,f,v]);const T=(0,a.useRef)();(0,a.useEffect)((()=>(T.current=new class extends A.M{async reset(){await H.current(),await d.reset()}finishFrame(){super.finishFrame(),x.current({action:"updateTestStep"})}async tick(){return await d.stepTest()}toggle(){x.current({action:"updateTestStep"})}},()=>{var e;null===(e=T.current)||void 0===e||e.stop()})),[H,d,x]);const Z=(0,a.useMemo)((()=>({toggle(){d.clock(),l.trackEvent("action","toggleClock")},reset(){l.trackEvent("action","resetClock"),d.reset()}})),[d]),I=(0,r.jsx)(M.Z,{className:"_hdl_panel",isEditorPanel:!0,header:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex-1",tabIndex:0,children:"HDL"}),""!=c.controls.chipName&&(0,r.jsxs)("label",{children:[(0,r.jsx)("input",{type:"checkbox",role:"switch",checked:c.controls.usingBuiltin,onChange:()=>{d.toggleBuiltin(),U.reset()}}),(0,r.jsx)(n.x6,{id:"++LBSt"})]}),(0,r.jsx)("fieldset",{role:"group",children:(0,r.jsx)("button",{onClick:async()=>{const e=await o.select({suffix:"hdl"});d.loadChip(e)},children:"\ud83d\udcc2"})})]}),children:(0,r.jsx)(E.K,{className:"flex-1",value:h,error:c.controls.error,onChange:async e=>{u(e),c.controls.usingBuiltin||d.saveChip(e),H.current(c.controls.usingBuiltin?{}:{hdl:e})},grammar:N.xP.parser,language:"hdl",disabled:c.controls.usingBuiltin||""==c.controls.chipName})}),[L,V]=(0,a.useState)(!0),J=()=>{e(i.Ru._({id:"Ow/xRO"}))},K=()=>{c.sim.invalid?J():R()},O=(0,r.jsxs)("fieldset",{role:"group",children:[(0,r.jsx)("button",{onClick:K,onKeyDown:K,disabled:!c.sim.pending||!L,children:(0,r.jsx)(n.x6,{id:"J3L683"})}),(0,r.jsx)("button",{onClick:()=>{c.sim.invalid?J():Z.reset()},style:{maxWidth:"initial"},disabled:!c.sim.clocked,children:(0,r.jsx)(n.x6,{id:"OfhWJH"})}),(0,r.jsxs)("button",{onClick:()=>{c.sim.invalid?J():Z.toggle()},style:{minWidth:"7em",textAlign:"start"},disabled:!c.sim.clocked,children:[(0,r.jsx)(n.x6,{id:"3rHyAJ"}),":","\xa0",(0,r.jsx)(C.wr,{})]})]}),z=function(e,t,s){return[...e.parts].map(((e,n)=>[`${e.id}_${n}`,k(e,t,s)])).filter((([e,t])=>void 0!==t))}({parts:c.sim.chip},(()=>{x.current({action:"updateChip"})}),c.controls.visualizationParameters),U=new y.wG,W=(0,r.jsx)(M.Z,{className:"_parts_panel",header:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(n.x6,{id:"C7rK3y"})," ",c.controls.chipName]}),O]}),children:c.sim.invalid?(0,r.jsx)(n.x6,{id:"RFMyN+"}):""!=c.controls.chipName&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.ZB.Provider,{value:U,children:(0,r.jsx)(y.vl,{sim:c.sim,toggle:d.toggle,setInputValid:V,hideInternal:c.controls.usingBuiltin})}),z.length>0&&(0,r.jsx)(M.p,{summary:(0,r.jsx)(n.x6,{id:"q3JCcX"}),open:!0,children:(0,r.jsx)("main",{children:z.map((([e,t])=>t))})})]})}),X=(0,r.jsx)(S.B,{runner:T,disabled:c.sim.invalid,prefix:c.controls.tests.length>1?(0,r.jsx)("select",{value:c.controls.testName,onChange:({target:{value:e}})=>{d.loadTest(e)},"data-testid":"test-picker",children:c.controls.tests.map((e=>(0,r.jsx)("option",{value:e,children:e},e)))}):(0,r.jsx)(r.Fragment,{}),tst:[m,p,c.controls.span],cmp:[f,j],out:[g,b],setPath:_,speed:c.config.speed,onSpeedChange:e=>{x.current({action:"updateConfig",payload:{speed:e}})}});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"Page ChipPage grid",children:[I,W,X]}),(0,r.jsx)(B.N9,{theme:"colored",className:"toast",position:"bottom-right",closeOnClick:!0,closeButton:!1,autoClose:!1})]})},R=_}}]);