"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[255],{9811:(e,t,s)=>{s.r(t),s.d(t,{CPU:()=>S,default:()=>w});var a=s(8923),r=s(3052),n=s(9613),c=s(2277),i=s(5838);const l=new Int16Array([2,55944,0,64528,15,54018,1,64528,2,61584,54024,0,64648,2,55943,15,55943]);var d=s(3389),u=s(6167),o=s(7559),p=s(8698);class h extends i.kG{dispatch;constructor(e,t){super(e,e.size,0),this.dispatch=t}async load(e,t){await super.load(e,t),this.dispatch.current({action:"update"})}}function x(e,t){const s=new h(e.cpu.RAM,t),a=new h(e.cpu.ROM,t),r=new h(e.cpu.Screen,t),n=new i.qT(new h(e.cpu.RAM,t));return{A:e.cpu.A,D:e.cpu.D,PC:e.cpu.PC,RAM:s,ROM:a,Screen:r,Keyboard:n}}function m(){const{fs:e,setStatus:t,storage:s}=(0,u.useContext)(p.r),a=(0,u.useRef)((()=>{})),{initialState:r,reducers:n,actions:c}=(0,u.useMemo)((()=>function(e,t,s,a){const r=new d.o6(new i.eD(l)),n={update(e){e.sim=x(r,a),e.test.highlight=r.currentStep?.span}},c={tick(){r.cpu.tick()},testStep(){r.step()},resetRAM(){r.cpu.RAM.loadBytes([]),a.current({action:"update"}),t("Reset RAM")},toggleUseTest(){a.current({action:"update"})},resetCPU(){r.reset(),a.current({action:"update"}),t("Reset CPU")},reset(){this.resetRAM(),this.resetCPU(),t("Reset CPU & RAM")}};return{initialState:{sim:x(r,a),test:{highlight:r.currentStep?.span}},reducers:n,actions:c}}(0,t,0,a)),[e,t,s,a]),[h,m]=(0,o.C)(n,r);return a.current=m,{state:h,dispatch:a,actions:c}}var b=s(8061),j=s(8582),g=s(258),v=s(8365),C=s(9647),f=s(8016),k=s(1539),R=s(1124),y=s(7878);const M=e=>{let{runner:t,tst:[s,a,r],cmp:[n,c],out:[i],disabled:l=!1}=e;const{fs:d,setStatus:o}=(0,u.useContext)(p.r),{filePicker:h,tracking:x}=(0,u.useContext)(f.Il),[m,M]=(0,u.useState)("tst"),S=(0,u.useCallback)((e=>{M(e),x.trackEvent("tab","change",e)}),[x]),w=(0,u.useCallback)((async()=>{try{const e=await h.select(),t=await d.readFile(e);a(t)}catch(e){console.error(e),o("Failed to load test")}}),[h,o,d]);return(0,y.jsx)(R.s,{className:"_test_panel",header:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{className:"flex-0",children:(0,y.jsx)(b.cC,{id:"Test"})}),(0,y.jsx)("div",{className:"flex-1",children:t.current&&(0,y.jsx)(g.D,{runner:t.current})}),(0,y.jsx)("div",{children:(0,y.jsx)("fieldset",{role:"group",children:(0,y.jsx)("button",{onClick:w,children:"\ud83d\udcc2"})})})]}),children:(0,y.jsxs)("div",{role:"tablist",style:{"--tab-count":"3"},children:[(0,y.jsx)("div",{role:"tab",id:"test-tab-tst","aria-controls":"test-tabpanel-tst","aria-selected":"tst"===m,children:(0,y.jsxs)("label",{children:[(0,y.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-tst",value:"tst",checked:"tst"===m,onChange:()=>S("tst")}),"Test Script"]})}),(0,y.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-tst",id:"test-tabpanel-tst",children:(0,y.jsx)(k.M,{value:s,onChange:a,grammar:C.qH.parser,language:"tst",highlight:r,disabled:l})}),(0,y.jsx)("div",{role:"tab",id:"test-tab-cmp","aria-controls":"test-tablpanel-cmp","aria-selected":"cmp"===m,children:(0,y.jsxs)("label",{children:[(0,y.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-cmp",value:"cmp",checked:"cmp"===m,onChange:()=>S("cmp")}),"Compare File"]})}),(0,y.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-cmp",id:"test-tabpanel-cmp",style:{position:"relative"},children:(0,y.jsx)(k.M,{value:n,onChange:c,grammar:v.lA.parser,language:"cmp",disabled:l})}),(0,y.jsx)("div",{role:"tab",id:"test-tab-out","aria-controls":"test-tabpanel-out","aria-selected":"out"===m,children:(0,y.jsxs)("label",{children:[(0,y.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-out",value:"out",checked:"out"===m,onChange:()=>S("out")}),"Output File"]})}),(0,y.jsx)("div",{role:"tabpanel",id:"test-tabpanel-out","aria-labelledby":"test-tab-out",children:(0,y.jsx)(j.M,{cmp:n,out:i})})]})})},S=()=>{const{state:e,actions:t,dispatch:s}=m(),[i,l]=(0,u.useState)("repeat {\n\tticktock;\n}"),[d,o]=(0,u.useState)(""),[p,h]=(0,u.useState)(""),[x,b]=(0,u.useState)(null),j=(0,u.useRef)(),v=(0,u.useRef)(),[C,f]=(0,u.useState)(!1);(0,u.useEffect)((()=>(j.current=new class extends a.B{tick(){return t.tick(),!1}finishFrame(){s.current({action:"update"})}reset(){t.reset()}toggle(){s.current({action:"update"})}},v.current=new class extends a.B{tick(){return t.testStep(),!1}finishFrame(){s.current({action:"update"})}reset(){t.reset()}toggle(){s.current({action:"update"})}},f(!0),()=>{var e,t;null===(e=j.current)||void 0===e||e.stop(),null===(t=v.current)||void 0===t||t.stop()})),[t,s]);return(0,y.jsxs)("div",{className:"CpuPage grid",children:[(0,y.jsx)(r.ZP,{name:"ROM",memory:e.sim.ROM,highlight:e.sim.PC,format:"asm",onUpload:e=>{b(e),t.reset()}}),(0,y.jsx)(r.ZP,{name:"RAM",memory:e.sim.RAM,format:"hex"}),(0,y.jsxs)(R.s,{className:"IO",header:(0,y.jsxs)(y.Fragment,{children:[x&&(0,y.jsx)("div",{className:"flex-0",children:x}),(0,y.jsx)("div",{className:"flex-1",children:C&&j.current&&(0,y.jsx)(g.D,{runner:j.current})})]}),children:[(0,y.jsx)(n.l,{memory:e.sim.Screen}),(0,y.jsx)(c.N,{keyboard:e.sim.Keyboard}),(0,y.jsx)("div",{children:(0,y.jsxs)("dl",{children:[(0,y.jsx)("dt",{children:"PC"}),(0,y.jsx)("dd",{children:e.sim.PC}),(0,y.jsx)("dt",{children:"A"}),(0,y.jsx)("dd",{children:e.sim.A}),(0,y.jsx)("dt",{children:"D"}),(0,y.jsx)("dd",{children:e.sim.D})]})})]}),C&&(0,y.jsx)(M,{runner:v,tst:[i,l,e.test.highlight],out:[d,o],cmp:[p,h]})]})},w=S}}]);
//# sourceMappingURL=255.98bb0035.chunk.js.map