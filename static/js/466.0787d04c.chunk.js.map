{"version":3,"file":"static/js/466.0787d04c.chunk.js","mappings":"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","sources":["../../components/src/chips/alu.tsx","../../components/src/chips/screen.tsx","../../components/src/chips/visualizations.tsx","../../components/src/pin_display.ts","../../components/src/pinout.tsx","../../components/src/stores/chip.store.ts","../../components/src/compare.ts","pages/chip.tsx"],"sourcesContent":["import {\n  COMMANDS_ALU,\n  COMMANDS_OP,\n  Flags,\n} from \"@nand2tetris/simulator/cpu/alu.js\";\n\nexport const ALUComponent = ({\n  A,\n  op,\n  D,\n  out,\n  flag,\n}: {\n  A: number;\n  op: COMMANDS_OP;\n  D: number;\n  out: number;\n  flag: keyof typeof Flags;\n}) => (\n  <div>\n    <span>ALU</span>\n    <svg width=\"250\" height=\"250\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g>\n        <rect x=\"1\" y=\"20\" height=\"85\" width=\"70\" fill=\"black\" />\n        <rect x=\"1\" y=\"145\" height=\"85\" width=\"70\" fill=\"black\" />\n        <rect x=\"180\" y=\"95\" height=\"60\" width=\"70\" fill=\"black\" />\n        <polygon\n          points=\"70,10 180,85 180,165 70,240 70,135 90,125 70,115\"\n          stroke=\"#000\"\n          fill=\"#6D97AB\"\n        />\n        <text\n          xmlSpace=\"preserve\"\n          textAnchor=\"middle\"\n          fontFamily=\"Noto Sans JP\"\n          fontSize=\"14\"\n          strokeWidth=\"0\"\n          id=\"svg_9\"\n          y=\"63\"\n          x=\"35\"\n          stroke=\"white\"\n          fill=\"#ffffff\"\n        >\n          {A}\n        </text>\n        <text\n          xmlSpace=\"preserve\"\n          textAnchor=\"middle\"\n          fontFamily=\"Noto Sans JP\"\n          fontSize=\"14\"\n          id=\"svg_10\"\n          y=\"188\"\n          x=\"35\"\n          strokeWidth=\"0\"\n          stroke=\"white\"\n          fill=\"#ffffff\"\n        >\n          {D}\n        </text>\n        <text\n          xmlSpace=\"preserve\"\n          textAnchor=\"middle\"\n          fontFamily=\"Noto Sans JP\"\n          fontSize=\"14\"\n          id=\"svg_11\"\n          y=\"125\"\n          x=\"215\"\n          strokeWidth=\"0\"\n          stroke=\"white\"\n          fill=\"#ffffff\"\n        >\n          {out}\n        </text>\n        <text\n          xmlSpace=\"preserve\"\n          textAnchor=\"middle\"\n          fontFamily=\"Noto Sans JP\"\n          fontSize=\"14\"\n          id=\"svg_13\"\n          y=\"125\"\n          x=\"135\"\n          strokeWidth=\"0\"\n          stroke=\"white\"\n          fill=\"#ffffff\"\n        >\n          {COMMANDS_ALU.op[op] ?? \"(??)\"}\n        </text>\n      </g>\n    </svg>\n  </div>\n);\n","import { Memory } from \"@nand2tetris/simulator/cpu/memory.js\";\nimport { assertExists } from \"@davidsouther/jiffies/lib/esm/assert.js\";\nimport { useCallback, useRef } from \"react\";\nimport { useClockFrame, useClockReset } from \"../clockface.js\";\n\nconst WHITE = \"white\";\nconst BLACK = \"black\";\ntype COLOR = typeof WHITE | typeof BLACK;\n\nexport interface ScreenMemory {\n  get(idx: number): number;\n}\n\nexport function reduceScreen(memory: Memory, offset = 0): ScreenMemory {\n  return {\n    get(idx: number): number {\n      return memory.get(offset + idx);\n    },\n  };\n}\n\nfunction get(mem: ScreenMemory, x: number, y: number): COLOR {\n  const byte = mem.get(32 * y + ((x / 16) | 0));\n  const bit = byte & (1 << x % 16);\n  return bit === 0 ? WHITE : BLACK;\n}\n\nfunction set(data: Uint8ClampedArray, x: number, y: number, value: COLOR) {\n  const pixel = (y * 512 + x) * 4;\n  const color = value === WHITE ? 255 : 0;\n  data[pixel] = color;\n  data[pixel + 1] = color;\n  data[pixel + 2] = color;\n  data[pixel + 3] = 255;\n}\n\nfunction drawImage(ctx: CanvasRenderingContext2D, memory: ScreenMemory) {\n  const image = assertExists(\n    ctx.getImageData(0, 0, 512, 256),\n    \"Failed to create Context2d\"\n  );\n  for (let col = 0; col < 512; col++) {\n    for (let row = 0; row < 256; row++) {\n      const color = get(memory, col, row);\n      set(image.data, col, row, color);\n    }\n  }\n  ctx.putImageData(image, 0, 0);\n}\n\nexport const Screen = ({ memory }: { memory: ScreenMemory }) => {\n  const canvas = useRef<HTMLCanvasElement>();\n\n  const draw = useCallback(() => {\n    const ctx = canvas.current?.getContext(\"2d\") ?? undefined;\n\n    if (ctx) {\n      drawImage(ctx, memory);\n    }\n  }, [memory]);\n\n  const ctxRef = useCallback(\n    (ref: HTMLCanvasElement | null) => {\n      canvas.current = ref ?? undefined;\n      draw();\n    },\n    [canvas, draw]\n  );\n\n  useClockFrame(draw);\n  useClockReset(() => {\n    canvas.current\n      ?.getContext(\"2d\")\n      ?.clearRect(0, 0, canvas.current.width, canvas.current.height);\n  });\n\n  return (\n    <article className=\"panel\">\n      <header>Screen</header>\n      <main style={{ backgroundColor: \"var(--code-background-color)\" }}>\n        <figure\n          style={{\n            width: \"100%\",\n            maxWidth: \"512px\",\n            boxSizing: \"content-box\",\n            marginInline: \"auto\",\n            margin: \"auto\",\n            borderTop: \"2px solid gray\",\n            borderLeft: \"2px solid gray\",\n            borderBottom: \"2px solid lightgray\",\n            borderRight: \"2px solid lightgray\",\n          }}\n        >\n          <canvas ref={ctxRef} width={512} height={256}></canvas>\n        </figure>\n      </main>\n    </article>\n  );\n};\n","import {\n  CPU,\n  Keyboard,\n  ROM32K,\n  Screen,\n} from \"@nand2tetris/simulator/chip/builtins/computer/computer.js\";\nimport { ALU } from \"@nand2tetris/simulator/chip/builtins/index.js\";\nimport {\n  PC,\n  Register,\n} from \"@nand2tetris/simulator/chip/builtins/sequential/bit.js\";\nimport {\n  RAM,\n  RAM8,\n} from \"@nand2tetris/simulator/chip/builtins/sequential/ram.js\";\nimport { Chip, HIGH } from \"@nand2tetris/simulator/chip/chip.js\";\nimport { Flags } from \"@nand2tetris/simulator/cpu/alu.js\";\nimport { decode } from \"@nand2tetris/simulator/cpu/cpu.js\";\nimport { ReactElement } from \"react\";\nimport { ALUComponent } from \"./alu.js\";\nimport { Keyboard as KeyboardComponent } from \"./keyboard.js\";\nimport { Memory as MemoryComponent } from \"./memory.js\";\nimport { RegisterComponent } from \"./register.js\";\nimport { Screen as ScreenComponent } from \"./screen.js\";\n\nexport function getBuiltinVisualization(part: Chip): ReactElement | undefined {\n  switch (part.name) {\n    case \"Register\":\n    case \"ARegister\":\n    case \"DRegister\":\n    case \"PC\":\n    case \"KEYBOARD\":\n    case \"RAM8\":\n    case \"RAM64\":\n    case \"RAM512\":\n    case \"RAM4K\":\n    case \"RAM16K\":\n    case \"ROM32K\":\n    case \"Screen\":\n    case \"Memory\":\n    default:\n      return undefined;\n  }\n}\n\nexport function makeVisualization(\n  chip: Chip,\n  updateAction?: () => void\n): ReactElement | undefined {\n  if (chip instanceof ALU) {\n    return (\n      <ALUComponent\n        A={chip.in(\"x\").busVoltage}\n        op={chip.op()}\n        D={chip.in(\"y\").busVoltage}\n        out={chip.out().busVoltage}\n        flag={\n          (chip.out(\"zr\").voltage() === HIGH\n            ? Flags.Zero\n            : chip.out(\"ng\").voltage() === HIGH\n            ? Flags.Negative\n            : Flags.Positive) as keyof typeof Flags\n        }\n      />\n    );\n  }\n  if (chip instanceof Register) {\n    return (\n      <RegisterComponent\n        name={chip.name ?? `Chip ${chip.id}`}\n        bits={chip.bits}\n      />\n    );\n  }\n  if (chip instanceof PC) {\n    return <RegisterComponent name=\"PC\" bits={chip.bits} />;\n  }\n  if (chip instanceof Keyboard) {\n    return <KeyboardComponent keyboard={chip} update={updateAction} />;\n  }\n  if (chip instanceof Screen) {\n    return <ScreenComponent memory={chip.memory} />;\n  }\n  if (chip instanceof RAM) {\n    return (\n      <MemoryComponent\n        name={chip.name}\n        memory={chip.memory}\n        format={chip instanceof ROM32K ? \"asm\" : \"dec\"}\n        highlight={chip.address}\n      />\n    );\n  }\n  if (chip instanceof RAM8) {\n    return <span>RAM {chip.width}</span>;\n  }\n  if (chip instanceof CPU) {\n    const bits = decode(chip.in(\"instruction\").busVoltage);\n    return (\n      <>\n        <RegisterComponent name={\"A\"} bits={chip.state.A} />\n        <RegisterComponent name={\"D\"} bits={chip.state.D} />\n        <RegisterComponent name={\"PC\"} bits={chip.state.PC} />\n        <ALUComponent\n          A={bits.am ? chip.in(\"inM\").busVoltage : chip.state.A}\n          D={chip.state.D}\n          out={chip.state.ALU}\n          op={bits.op}\n          flag={chip.state.flag as keyof typeof Flags}\n        />\n      </>\n    );\n  }\n\n  const vis = [...chip.parts]\n    .map((chip) => makeVisualization(chip, updateAction))\n    .filter((v) => v !== undefined);\n  return vis.length > 0 ? <>{vis}</> : undefined;\n}\n\nexport function makeVisualizationsWithId(\n  chip: {\n    parts: Chip[];\n  },\n  updateAction?: () => void\n): [string, ReactElement][] {\n  return [...chip.parts]\n    .map((part, i): [string, ReactElement | undefined] => [\n      `${part.id}_${i}`,\n      makeVisualization(part, updateAction),\n    ])\n    .filter(([_, v]) => v !== undefined) as [string, ReactElement][];\n}\n","import { Ok, isOk } from \"@davidsouther/jiffies/lib/esm/result.js\";\nimport {\n  REGISTRY as BUILTIN_REGISTRY,\n  getBuiltinChip,\n} from \"@nand2tetris/simulator/chip/builtins/index.js\";\n\nexport class ChipDisplayInfo {\n  signBehaviors: Map<string, boolean> = new Map();\n\n  public constructor(chipName: string, unsigned?: string[]) {\n    if (BUILTIN_REGISTRY.has(chipName)) {\n      const chip = getBuiltinChip(chipName);\n      if (isOk(chip)) {\n        const pins = Array.from(Ok(chip).ins.entries()).concat(\n          Array.from(Ok(chip).outs.entries())\n        );\n        for (const pin of pins) {\n          this.signBehaviors.set(\n            pin.name,\n            !unsigned || !unsigned.includes(pin.name)\n          );\n        }\n      }\n    }\n  }\n\n  public isSigned(pin: string) {\n    return this.signBehaviors.get(pin);\n  }\n}\n\nconst UNSIGNED_PINS = new Map<string, string[]>([\n  [\"Mux4Way16\", [\"sel\"]],\n  [\"Mux8Way16\", [\"sel\"]],\n  [\"DMux4Way\", [\"sel\"]],\n  [\"DMux8Way\", [\"sel\"]],\n  [\"RAM8\", [\"address\"]],\n  [\"RAM64\", [\"address\"]],\n  [\"RAM512\", [\"address\"]],\n  [\"RAM4K\", [\"address\"]],\n  [\"RAM16K\", [\"address\"]],\n  [\"Screen\", [\"address\"]],\n  [\"Memory\", [\"address\"]],\n  [\"CPU\", [\"addressM\", \"pc\"]],\n]);\n\nexport const getDisplayInfo = (chipName: string) =>\n  new ChipDisplayInfo(chipName, UNSIGNED_PINS.get(chipName));\n","// import { plural, Trans } from \"@lingui/macro\";\nimport {\n  Pin as ChipPin,\n  Pins,\n  Voltage,\n} from \"@nand2tetris/simulator/chip/chip.js\";\nimport { range } from \"@davidsouther/jiffies/lib/esm/range.js\";\nimport { ChipSim } from \"./stores/chip.store.js\";\nimport { createContext, useContext, useEffect, useState } from \"react\";\nimport { ChipDisplayInfo, getDisplayInfo } from \"./pin_display.js\";\n\nexport const PinContext = createContext({});\n\nexport interface ImmPin {\n  bits: [number, Voltage][];\n  pin: ChipPin;\n}\n\nexport function reducePin(pin: ChipPin) {\n  return {\n    pin,\n    bits: range(0, pin.width)\n      .map((i) => [i, pin.voltage(i)] as [number, Voltage])\n      .reverse(),\n  };\n}\n\nexport function reducePins(pins: Pins): ImmPin[] {\n  return [...pins.entries()].map(reducePin);\n}\n\nexport interface PinoutPins {\n  pins: ImmPin[];\n  toggle?: (pin: ChipPin, bit?: number) => void;\n}\n\nexport const FullPinout = (props: {\n  sim: ChipSim;\n  toggle: (pin: ChipPin, i: number | undefined) => void;\n  setInputValid: (pending: boolean) => void;\n  hideInternal?: boolean;\n}) => {\n  const { inPins, outPins, internalPins } = props.sim;\n  const displayInfo = getDisplayInfo(props.sim.chip[0].name ?? \"\");\n  return (\n    <>\n      <style>{`\n        table.pinout th {\n          font-weight: bold;\n        }\n\n        table.pinout tbody td:first-child {\n          text-align: right;\n          --font-size: 1rem;\n          width: 0;\n          white-space: nowrap;\n          border-right: var(--border-width) solid var(--table-border-color);\n        }\n\n        table.pinout tbody button {\n          --font-size: 0.875em;\n          font-family: var(--font-family-monospace);\n          max-width: 2em;\n        }\n        `}</style>\n      <table className=\"pinout\">\n        <tbody>\n          <PinoutBlock\n            pins={inPins}\n            header=\"Input pins\"\n            toggle={props.toggle}\n            setInputValid={props.setInputValid}\n            displayInfo={displayInfo}\n          />\n          <PinoutBlock\n            pins={outPins}\n            header=\"Output pins\"\n            disabled={props.sim.pending}\n            enableEdit={false}\n            displayInfo={displayInfo}\n          />\n          {!props.hideInternal && (\n            <PinoutBlock\n              pins={internalPins}\n              header=\"Internal pins\"\n              disabled={props.sim.pending}\n              enableEdit={false}\n              displayInfo={displayInfo}\n            />\n          )}\n        </tbody>\n      </table>\n    </>\n  );\n};\n\nexport const PinoutBlock = (\n  props: PinoutPins & {\n    header: string;\n    disabled?: boolean;\n    enableEdit?: boolean;\n    setInputValid?: (valid: boolean) => void;\n    displayInfo: ChipDisplayInfo;\n  }\n) => (\n  <>\n    {props.pins.length > 0 && (\n      <tr>\n        <th colSpan={2}>{props.header}</th>\n      </tr>\n    )}\n    {[...props.pins].map((immPin) => (\n      <tr key={immPin.pin.name}>\n        <td>{immPin.pin.name}</td>\n        <td>\n          <Pin\n            pin={immPin}\n            toggle={props.toggle}\n            disabled={props.disabled}\n            enableEdit={props.enableEdit}\n            signed={props.displayInfo.isSigned(immPin.pin.name)}\n            setInputValid={props.setInputValid}\n            internal={props.header === \"Internal pins\" ? true : false}\n          />\n        </td>\n      </tr>\n    ))}\n  </>\n);\n\nexport const Pinout = ({\n  pins,\n  toggle,\n}: {\n  pins: ImmPin[];\n  toggle?: (pin: ChipPin, bit?: number) => void;\n}) => {\n  if (pins.length === 0) {\n    return <>None</>;\n  }\n  return (\n    <table className=\"pinout\">\n      <thead>\n        <tr>\n          <th>Name</th>\n          <th>Value</th>\n        </tr>\n      </thead>\n      <tbody>\n        {[...pins].map((immPin) => (\n          <tr key={immPin.pin.name}>\n            <td>{immPin.pin.name}</td>\n            <td>\n              <Pin pin={immPin} toggle={toggle} internal />\n            </td>\n          </tr>\n        ))}\n      </tbody>\n    </table>\n  );\n};\n\nconst Pin = ({\n  pin,\n  toggle,\n  disabled = false,\n  enableEdit = true,\n  signed = true,\n  setInputValid,\n  internal = false,\n}: {\n  pin: ImmPin;\n  toggle: ((pin: ChipPin, bit?: number) => void) | undefined;\n  disabled?: boolean;\n  enableEdit?: boolean;\n  signed?: boolean;\n  setInputValid?: (valid: boolean) => void;\n  internal: boolean;\n}) => {\n  const [isBin, setIsBin] = useState(true);\n  let inputValid = true;\n  const [decimal, setDecimal] = useState(\"\");\n\n  const toggleBin = () => {\n    setIsBin(!isBin);\n  };\n\n  const resetDispatcher = useContext(PinContext);\n  if (resetDispatcher instanceof PinResetDispatcher) {\n    resetDispatcher.registerCallback(() => {\n      setIsBin(true);\n    });\n  }\n\n  const setInputValidity = (valid: boolean) => {\n    inputValid = valid;\n    setInputValid?.(valid);\n  };\n\n  const handleDecimalChange = (value: string) => {\n    const positive = value.replace(/[^\\d]/g, \"\");\n    const numeric = signed && value[0] === \"-\" ? `-${positive}` : positive;\n\n    setDecimal(numeric);\n    if (isNaN(parseInt(numeric))) {\n      setInputValidity(false);\n    } else {\n      const newValue = parseInt(numeric);\n      if (\n        (!signed && newValue >= Math.pow(2, pin.bits.length)) ||\n        (signed &&\n          (newValue >= Math.pow(2, pin.bits.length - 1) ||\n            newValue < -Math.pow(2, pin.bits.length - 1)))\n      ) {\n        setInputValidity(false);\n      } else {\n        updatePins(newValue);\n        setInputValidity(true);\n      }\n    }\n  };\n\n  const updatePins = (n: number) => {\n    for (let i = 0; i < pin.bits.length; i++) {\n      if (pin.bits[pin.bits.length - i - 1][1] !== ((n >> i) & 1)) {\n        toggle?.(pin.pin, i);\n      }\n    }\n  };\n\n  useEffect(() => {\n    if (!isBin && inputValid) {\n      let value = 0;\n      if (signed && pin.bits[0][1]) {\n        // negative\n        for (const [i, v] of pin.bits) {\n          if (i < pin.bits.length - 1 && !v) {\n            value += 2 ** i;\n          }\n        }\n        value = -value - 1;\n      } else {\n        // positive\n        const limit = signed ? pin.bits.length - 1 : pin.bits.length;\n        for (const [i, v] of pin.bits) {\n          if (i < limit && v) {\n            value += 2 ** i;\n          }\n        }\n      }\n      setDecimal(value.toString());\n    }\n  }, [pin, isBin]);\n\n  return (\n    <div\n      style={{ display: \"flex\", flexDirection: \"row\", alignItems: \"center\" }}\n    >\n      <fieldset role=\"group\" style={{ width: `${pin.bits.length}rem` }}>\n        {isBin ? (\n          pin.bits.map(([i, v]) => (\n            <button\n              key={i}\n              disabled={disabled}\n              style={internal ? { backgroundColor: \"grey\" } : {}}\n              onClick={() => toggle?.(pin.pin, i)}\n              data-testid={`pin-${i}`}\n            >\n              {v}\n            </button>\n          ))\n        ) : (\n          <input\n            className=\"colored\"\n            value={decimal}\n            onChange={(e) => {\n              handleDecimalChange(e.target.value);\n            }}\n            disabled={!enableEdit}\n          />\n        )}\n      </fieldset>\n      {pin.bits.length > 1 && (\n        <>\n          <div style={{ width: \"1em\" }} />\n          <button\n            style={{ maxWidth: \"3em\", margin: 0 }}\n            onClick={() => toggleBin()}\n          >\n            {isBin ? \"dec\" : \"bin\"}\n          </button>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport class PinResetDispatcher {\n  private callbacks: (() => void)[] = [];\n\n  registerCallback(callback: () => void) {\n    this.callbacks.push(callback);\n  }\n\n  reset() {\n    for (const callback of this.callbacks) {\n      callback();\n    }\n  }\n}\n","import { display } from \"@davidsouther/jiffies/lib/esm/display.js\";\nimport { FileSystem } from \"@davidsouther/jiffies/lib/esm/fs.js\";\nimport { Err, isErr, Ok } from \"@davidsouther/jiffies/lib/esm/result.js\";\nimport { Dispatch, MutableRefObject, useContext, useMemo, useRef } from \"react\";\n\nimport { build as buildChip } from \"@nand2tetris/simulator/chip/builder.js\";\nimport {\n  getBuiltinChip,\n  REGISTRY,\n} from \"@nand2tetris/simulator/chip/builtins/index.js\";\nimport {\n  Chip,\n  Chip as SimChip,\n  Low,\n  Pin,\n} from \"@nand2tetris/simulator/chip/chip.js\";\nimport { Clock } from \"@nand2tetris/simulator/chip/clock.js\";\nimport { Span } from \"@nand2tetris/simulator/languages/base.js\";\nimport { HDL } from \"@nand2tetris/simulator/languages/hdl.js\";\nimport { TST } from \"@nand2tetris/simulator/languages/tst.js\";\nimport {\n  BUILTIN_CHIP_PROJECTS,\n  CHIP_ORDER,\n  CHIP_PROJECTS,\n  ChipProjects,\n} from \"@nand2tetris/projects/index.js\";\nimport { ChipTest } from \"@nand2tetris/simulator/tst.js\";\n\nimport { ImmPin, reducePins } from \"../pinout.js\";\nimport { useImmerReducer } from \"../react.js\";\n\nimport { BaseContext } from \"./base.context.js\";\nimport { assert } from \"@davidsouther/jiffies/lib/esm/assert.js\";\nimport { compare } from \"../compare.js\";\n\nexport const PROJECT_NAMES = [\n  [\"01\", `Project 1`],\n  [\"02\", `Project 2`],\n  [\"03\", `Project 3`],\n  [\"05\", `Project 5`],\n];\n\nfunction getChips(project: keyof typeof CHIP_PROJECTS) {\n  return project in CHIP_ORDER\n    ? (CHIP_ORDER as Record<typeof project, string[]>)[project]\n    : BUILTIN_CHIP_PROJECTS[project].concat(CHIP_PROJECTS[project]);\n}\n\nfunction findDropdowns(storage: Record<string, string>) {\n  const project =\n    (storage[\"/chip/project\"] as keyof typeof CHIP_PROJECTS) ?? \"01\";\n  const chips = getChips(project);\n  const chipName = storage[\"/chip/chip\"] ?? CHIP_PROJECTS[project][0];\n  return { project, chips, chipName };\n}\n\nfunction makeHdl(name: string) {\n  return `CHIP ${name} {\n  IN in;\n  OUT out;\n  PARTS:\n}`;\n}\n\nfunction makeTst() {\n  return `repeat 10 {\n  tick,\n  tock;\n}`;\n}\n\nfunction makeCmp() {\n  return `| in|out|`;\n}\n\nexport function isBuiltinOnly(chipName: string) {\n  return Object.values(BUILTIN_CHIP_PROJECTS).flat().includes(chipName);\n}\n\nfunction getTemplate(project: keyof typeof CHIP_PROJECTS, chipName: string) {\n  if (isBuiltinOnly(chipName)) {\n    return (ChipProjects[project].BUILTIN_CHIPS as Record<string, string>)[\n      chipName\n    ];\n  }\n\n  return (\n    ChipProjects[project].CHIPS as Record<string, Record<string, string>>\n  )[chipName][`${chipName}.hdl`] as string;\n}\n\nfunction getBuiltinCode(project: keyof typeof CHIP_PROJECTS, chipName: string) {\n  const template = getTemplate(project, chipName);\n  if (isBuiltinOnly(chipName)) {\n    return template;\n  }\n  const bodyComment = \"//// Replace this comment with your code.\";\n  const builtinLine = `BUILTIN ${chipName};`;\n  const builtinCode = template.includes(bodyComment)\n    ? template.replace(bodyComment, builtinLine)\n    : template.replace(\"PARTS:\", `PARTS:\\n    ${builtinLine}`);\n  return builtinCode;\n}\n\nexport interface ChipPageState {\n  files: Files;\n  sim: ChipSim;\n  controls: ControlsState;\n}\n\nexport interface ChipSim {\n  clocked: boolean;\n  inPins: ImmPin[];\n  outPins: ImmPin[];\n  internalPins: ImmPin[];\n  chip: [Chip];\n  pending: boolean;\n  invalid: boolean;\n}\n\nexport interface Files {\n  hdl: string;\n  cmp: string;\n  tst: string;\n  out: string;\n}\n\nexport interface ControlsState {\n  project: keyof typeof CHIP_PROJECTS;\n  chips: string[];\n  chipName: string;\n  hasBuiltin: boolean;\n  builtinOnly: boolean;\n  runningTest: boolean;\n  span?: Span;\n  error: string;\n}\n\nfunction reduceChip(chip: SimChip, pending = false, invalid = false): ChipSim {\n  return {\n    clocked: chip.clocked,\n    inPins: reducePins(chip.ins),\n    outPins: reducePins(chip.outs),\n    internalPins: reducePins(chip.pins),\n    chip: [chip],\n    pending,\n    invalid,\n  };\n}\n\nconst clock = Clock.get();\n\nexport type ChipStoreDispatch = Dispatch<{\n  action: keyof ReturnType<typeof makeChipStore>[\"reducers\"];\n  payload?: unknown;\n}>;\n\nexport function makeChipStore(\n  fs: FileSystem,\n  setStatus: (status: string) => void,\n  storage: Record<string, string>,\n  dispatch: MutableRefObject<ChipStoreDispatch>\n) {\n  const dropdowns = findDropdowns(storage);\n  let { project, chipName } = dropdowns;\n  const { chips } = dropdowns;\n  let chip = new Low();\n  let test = new ChipTest();\n  let usingBuiltin = false;\n  let builtinOnly = false;\n\n  const reducers = {\n    setFiles(\n      state: ChipPageState,\n      {\n        hdl = state.files.hdl,\n        tst = state.files.tst,\n        cmp = state.files.cmp,\n        out = \"\",\n      }: {\n        hdl?: string;\n        tst?: string;\n        cmp?: string;\n        out?: string;\n      }\n    ) {\n      state.files.hdl = hdl;\n      state.files.tst = tst;\n      state.files.cmp = cmp;\n      state.files.out = out;\n    },\n\n    updateChip(\n      state: ChipPageState,\n      payload?: {\n        pending?: boolean;\n        invalid?: boolean;\n        chipName?: string;\n        error?: string;\n      }\n    ) {\n      state.sim = reduceChip(\n        chip,\n        payload?.pending ?? state.sim.pending,\n        payload?.invalid ?? state.sim.invalid\n      );\n      state.controls.error = state.sim.invalid\n        ? payload?.error ?? state.controls.error\n        : \"\";\n      state.controls.chips = getChips(state.controls.project);\n      state.controls.chipName = state.sim.invalid\n        ? payload?.chipName ?? chipName\n        : chip.name ?? payload?.chipName ?? chipName;\n      if (!state.controls.chips.includes(state.controls.chipName)) {\n        state.controls.chips = [\n          ...state.controls.chips,\n          state.controls.chipName,\n        ];\n      }\n    },\n\n    setProject(state: ChipPageState, project: keyof typeof CHIP_PROJECTS) {\n      const chips = getChips(project);\n      const chipName =\n        state.controls.chipName && chips.includes(state.controls.chipName)\n          ? state.controls.chipName\n          : chips[0];\n      state.controls.project = project;\n      state.controls.chips = chips;\n      this.setChip(state, chipName);\n    },\n\n    setChip(state: ChipPageState, chipName: string) {\n      state.controls.chipName = chipName;\n      state.controls.hasBuiltin = REGISTRY.has(chipName);\n      state.controls.builtinOnly = isBuiltinOnly(chipName);\n    },\n\n    testRunning(state: ChipPageState) {\n      state.controls.runningTest = true;\n    },\n\n    testFinished(state: ChipPageState) {\n      state.controls.runningTest = false;\n      const passed = compare(state.files.cmp.trim(), state.files.out.trim());\n      setStatus(\n        passed\n          ? `Simulation successful: The output file is identical to the compare file`\n          : `Simulation error: The output file differs from the compare file`\n      );\n    },\n\n    updateTestStep(state: ChipPageState) {\n      state.files.out = test?.log() ?? \"\";\n      if (test?.currentStep?.span) {\n        state.controls.span = test.currentStep.span;\n      } else {\n        if (test.done) {\n          const end = state.files.tst.length;\n          state.controls.span = {\n            start: end - 1,\n            end,\n          };\n        }\n      }\n      this.updateChip(state, {\n        pending: state.sim.pending,\n        invalid: state.sim.invalid,\n      });\n    },\n  };\n\n  const actions = {\n    setProject(p: keyof typeof CHIP_PROJECTS) {\n      project = storage[\"/chip/project\"] = p;\n      dispatch.current({ action: \"setProject\", payload: project });\n      this.setChip(CHIP_PROJECTS[project][0]);\n    },\n\n    async setChip(chip: string, project = storage[\"/chip/project\"] ?? \"01\") {\n      chipName = storage[\"/chip/chip\"] = chip;\n      dispatch.current({ action: \"setChip\", payload: chipName });\n      builtinOnly = isBuiltinOnly(chipName);\n\n      if (builtinOnly) {\n        dispatch.current({\n          action: \"setFiles\",\n          payload: { hdl: \"\", tst: \"\", cmp: \"\" },\n        });\n        this.useBuiltin();\n        return;\n      }\n      await this.loadChip(project, chipName);\n      if (usingBuiltin) {\n        this.useBuiltin();\n      }\n    },\n\n    reset() {\n      Clock.get().reset();\n      chip.reset();\n      test.reset();\n      dispatch.current({ action: \"setFiles\", payload: {} });\n      dispatch.current({ action: \"updateChip\" });\n    },\n\n    async updateFiles({\n      hdl,\n      tst,\n      cmp,\n    }: {\n      hdl?: string;\n      tst?: string;\n      cmp: string;\n    }) {\n      dispatch.current({ action: \"setFiles\", payload: { hdl, tst, cmp } });\n      try {\n        if (hdl) {\n          await this.compileChip(hdl);\n        }\n        if (tst) {\n          this.compileTest(tst);\n        }\n      } catch (e) {\n        setStatus(display(e));\n      }\n    },\n\n    async compileChip(hdl: string) {\n      chip.remove();\n      const maybeParsed = HDL.parse(hdl);\n      if (isErr(maybeParsed)) {\n        setStatus(\"Failed to parse chip\");\n        dispatch.current({\n          action: \"updateChip\",\n          payload: { invalid: true, error: display(Err(maybeParsed)) },\n        });\n        return;\n      }\n      const maybeChip = await buildChip(Ok(maybeParsed));\n      if (isErr(maybeChip)) {\n        const error = display(Err(maybeChip));\n        setStatus(error);\n        dispatch.current({\n          action: \"updateChip\",\n          payload: { invalid: true, error },\n        });\n        return;\n      }\n      setStatus(`Compiled ${chip.name}`);\n      this.replaceChip(Ok(maybeChip));\n    },\n\n    replaceChip(nextChip: SimChip) {\n      // Store current inPins\n      const inPins = chip.ins;\n      for (const [pin, { busVoltage }] of inPins) {\n        const nextPin = nextChip.ins.get(pin);\n        if (nextPin) {\n          nextPin.busVoltage = busVoltage;\n        }\n      }\n      clock.reset();\n      nextChip.eval();\n      chip = nextChip;\n      chip.reset();\n      test = test.with(chip).reset();\n      dispatch.current({ action: \"updateChip\", payload: { invalid: false } });\n      dispatch.current({ action: \"updateTestStep\" });\n    },\n\n    async loadChip(project: string, name: string) {\n      storage[\"/chip/chip\"] = name;\n      const fsName = (ext: string) =>\n        `/projects/${project}/${name}/${name}.${ext}`;\n\n      const [hdl, tst, cmp] = await Promise.all([\n        fs.readFile(fsName(\"hdl\")).catch(() => makeHdl(name)),\n        fs.readFile(fsName(\"tst\")).catch((e) => {\n          return makeTst();\n        }),\n        fs.readFile(fsName(\"cmp\")).catch(() => makeCmp()),\n      ]);\n\n      dispatch.current({ action: \"setFiles\", payload: { hdl, tst, cmp } });\n      await this.compileChip(hdl);\n      this.compileTest(tst);\n    },\n\n    async saveChip(hdl: string, prj = project, name = chipName) {\n      dispatch.current({ action: \"setFiles\", payload: { hdl } });\n      const path = `/projects/${prj}/${name}/${name}.hdl`;\n      await fs.writeFile(path, hdl);\n      setStatus(`Saved ${path}`);\n    },\n\n    toggle(pin: Pin, i: number | undefined) {\n      if (i !== undefined) {\n        pin.busVoltage = pin.busVoltage ^ (1 << i);\n      } else {\n        if (pin.width === 1) {\n          pin.toggle();\n        } else {\n          pin.busVoltage += 1;\n        }\n      }\n      dispatch.current({ action: \"updateChip\", payload: { pending: true } });\n    },\n\n    eval() {\n      chip.eval();\n      dispatch.current({ action: \"updateChip\", payload: { pending: false } });\n    },\n\n    clock() {\n      clock.toggle();\n      if (clock.isLow) {\n        clock.frame();\n      }\n      dispatch.current({ action: \"updateChip\" });\n    },\n\n    async useBuiltin(doUseBuiltin = true, oldHdl?: string) {\n      if (!doUseBuiltin) {\n        if (!builtinOnly) {\n          usingBuiltin = false;\n        }\n        await this.loadChip(project, chipName);\n        return;\n      }\n      if (!builtinOnly) {\n        usingBuiltin = true;\n      }\n      const builtinName = chipName;\n      const nextChip = getBuiltinChip(builtinName);\n      if (isErr(nextChip)) {\n        setStatus(\n          `Failed to load builtin ${builtinName}: ${display(Err(nextChip))}`\n        );\n        return;\n      }\n\n      // Save hdl code that will be overwritten by the switch\n      if (oldHdl) {\n        await this.saveChip(oldHdl, project, chipName);\n      }\n\n      const hdl = getBuiltinCode(project, builtinName);\n      dispatch.current({ action: \"setFiles\", payload: { hdl } });\n      this.replaceChip(Ok(nextChip));\n    },\n\n    async initialize() {\n      await this.setChip(chipName, project);\n    },\n\n    compileTest(file: string) {\n      dispatch.current({ action: \"setFiles\", payload: { tst: file } });\n      const tst = TST.parse(file);\n\n      if (isErr(tst)) {\n        setStatus(`Failed to parse test`);\n        return false;\n      }\n      setStatus(`Parsed tst`);\n\n      test = ChipTest.from(Ok(tst)).with(chip).reset();\n      test.setFileSystem(fs);\n      dispatch.current({ action: \"updateTestStep\" });\n      return true;\n    },\n\n    async runTest(file: string) {\n      if (!this.compileTest(file)) {\n        return;\n      }\n      dispatch.current({ action: \"testRunning\" });\n\n      fs.pushd(\"/samples\");\n      await test.run();\n      fs.popd();\n\n      dispatch.current({ action: \"updateTestStep\" });\n      dispatch.current({ action: \"testFinished\" });\n    },\n\n    tick(): boolean {\n      return this.stepTest();\n    },\n\n    stepTest(): boolean {\n      assert(test.chipId === chip.id, \"Test and chip out of sync\");\n      const done = test.step();\n      dispatch.current({ action: \"updateTestStep\" });\n      if (done) {\n        dispatch.current({ action: \"testFinished\" });\n      }\n      return done;\n    },\n  };\n\n  const initialState: ChipPageState = (() => {\n    const controls: ControlsState = {\n      project,\n      chips,\n      chipName,\n      hasBuiltin: REGISTRY.has(chipName),\n      builtinOnly: isBuiltinOnly(chipName),\n      runningTest: false,\n      error: \"\",\n    };\n\n    const maybeChip = getBuiltinChip(controls.chipName);\n    if (isErr(maybeChip)) {\n      setStatus(display(Err(maybeChip)));\n      chip = new Low();\n    } else {\n      chip = Ok(maybeChip);\n    }\n\n    const sim = reduceChip(chip);\n\n    return {\n      controls,\n      files: {\n        hdl: \"\",\n        cmp: \"\",\n        tst: \"\",\n        out: \"\",\n      },\n      sim,\n    };\n  })();\n\n  return { initialState, reducers, actions };\n}\n\nexport function useChipPageStore() {\n  const { fs, setStatus, storage } = useContext(BaseContext);\n\n  const dispatch = useRef<ChipStoreDispatch>(() => undefined);\n\n  const { initialState, reducers, actions } = useMemo(\n    () => makeChipStore(fs, setStatus, storage, dispatch),\n    [fs, setStatus, storage, dispatch]\n  );\n\n  const [state, dispatcher] = useImmerReducer(reducers, initialState);\n  dispatch.current = dispatcher;\n\n  return { state, dispatch, actions };\n}\n","import { isErr, Ok } from \"@davidsouther/jiffies/lib/esm/result.js\";\nimport { CMP } from \"@nand2tetris/simulator/languages/cmp.js\";\n\nexport const compare = (cmp: string, out: string) => {\n  const cmpResult = CMP.parse(cmp);\n  const outResult = CMP.parse(out);\n\n  if (isErr(cmpResult) || isErr(outResult)) {\n    return false;\n  }\n\n  const cmpData = Ok(cmpResult);\n  const outData = Ok(outResult);\n\n  for (let i = 0; i < Math.min(cmpData.length, outData.length); i++) {\n    const cmpI = cmpData[i] ?? [];\n    const outI = outData[i] ?? [];\n\n    for (let j = 0; j < Math.max(cmpI.length, outI.length); j++) {\n      const cmpJ = cmpI[j] ?? \"\";\n      const outJ = outI[j] ?? \"\";\n      if (\n        !(cmpJ?.trim().match(/^\\*+$/) !== null || outJ?.trim() === cmpJ?.trim())\n      ) {\n        return false;\n      }\n    }\n  }\n  return true;\n};\n","import { Trans } from \"@lingui/macro\";\nimport {\n  CSSProperties,\n  ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport \"./chip.scss\";\n\nimport { makeVisualizationsWithId } from \"@nand2tetris/components/chips/visualizations.js\";\nimport { Clockface } from \"@nand2tetris/components/clockface.js\";\nimport { DiffTable } from \"@nand2tetris/components/difftable.js\";\nimport {\n  FullPinout,\n  PinContext,\n  PinResetDispatcher,\n} from \"@nand2tetris/components/pinout.js\";\nimport { useStateInitializer } from \"@nand2tetris/components/react.js\";\nimport { Runbar } from \"@nand2tetris/components/runbar.js\";\nimport { BaseContext } from \"@nand2tetris/components/stores/base.context.js\";\nimport {\n  Files,\n  PROJECT_NAMES,\n  isBuiltinOnly,\n  useChipPageStore,\n} from \"@nand2tetris/components/stores/chip.store.js\";\nimport { CHIP_PROJECTS } from \"@nand2tetris/projects/index.js\";\nimport { CMP } from \"@nand2tetris/simulator/languages/cmp.js\";\nimport { HDL } from \"@nand2tetris/simulator/languages/hdl.js\";\nimport { TST } from \"@nand2tetris/simulator/languages/tst.js\";\nimport { Timer } from \"@nand2tetris/simulator/timer.js\";\nimport { AppContext } from \"../App.context\";\nimport { Icon } from \"../pico/icon\";\nimport { Editor } from \"../shell/editor\";\nimport { Accordian, Panel } from \"../shell/panel\";\n\nexport const Chip = () => {\n  const { fs, setStatus } = useContext(BaseContext);\n  const { filePicker, tracking } = useContext(AppContext);\n  const { state, actions, dispatch } = useChipPageStore();\n\n  const [hdl, setHdl] = useStateInitializer(state.files.hdl);\n  const [tst, setTst] = useStateInitializer(state.files.tst);\n  const [cmp, setCmp] = useStateInitializer(state.files.cmp);\n  const [out] = useStateInitializer(state.files.out);\n\n  useEffect(() => {\n    actions.initialize();\n  }, [actions]);\n\n  useEffect(() => {\n    tracking.trackPage(\"/chip\");\n  }, [tracking]);\n\n  const saveChip = () => {\n    actions.saveChip(hdl);\n  };\n\n  useEffect(() => {\n    tracking.trackEvent(\"action\", \"setProject\", state.controls.project);\n    tracking.trackEvent(\"action\", \"setChip\", state.controls.chipName);\n  }, []);\n\n  const setProject = useCallback(\n    (project: keyof typeof CHIP_PROJECTS) => {\n      actions.setProject(project);\n      tracking.trackEvent(\"action\", \"setProject\", project);\n    },\n    [actions, tracking]\n  );\n\n  const setChip = useCallback(\n    (chip: string) => {\n      actions.setChip(chip);\n      tracking.trackEvent(\"action\", \"setChip\", chip);\n      pinResetDispatcher.reset();\n    },\n    [actions, tracking]\n  );\n\n  const doEval = useCallback(() => {\n    actions.eval();\n    tracking.trackEvent(\"action\", \"eval\");\n  }, [actions, tracking]);\n\n  const compile = useRef<(files?: Partial<Files>) => void>(() => undefined);\n  compile.current = async (files: Partial<Files> = {}) => {\n    await actions.updateFiles({\n      hdl: files.hdl,\n      tst: files.tst ?? tst,\n      cmp: files.cmp ?? cmp,\n    });\n  };\n\n  const loadTest = useCallback(async () => {\n    try {\n      const path = await filePicker.select();\n      const tst = await fs.readFile(path);\n      await compile.current({ tst });\n    } catch (e) {\n      console.error(e);\n      setStatus(`Failed to load into memory`);\n    }\n  }, [filePicker, setStatus, fs, compile]);\n\n  const runner = useRef<Timer>();\n  useEffect(() => {\n    runner.current = new (class ChipTimer extends Timer {\n      async reset(): Promise<void> {\n        await compile.current();\n        await actions.reset();\n      }\n\n      override finishFrame(): void {\n        super.finishFrame();\n        dispatch.current({ action: \"updateTestStep\" });\n      }\n\n      tick(): boolean {\n        return actions.stepTest();\n      }\n\n      toggle(): void {\n        dispatch.current({ action: \"updateTestStep\" });\n      }\n    })();\n\n    return () => {\n      runner.current?.stop();\n    };\n  }, [compile, actions, dispatch]);\n\n  const clockActions = useMemo(\n    () => ({\n      toggle() {\n        actions.clock();\n        tracking.trackEvent(\"action\", \"toggleClock\");\n      },\n      reset() {\n        tracking.trackEvent(\"action\", \"resetClock\");\n        actions.reset();\n      },\n    }),\n    [actions]\n  );\n\n  const [useBuiltin, setUseBuiltin] = useState(false);\n  const toggleUseBuiltin = () => {\n    if (useBuiltin) {\n      setUseBuiltin(false);\n      actions.useBuiltin(false);\n    } else {\n      setUseBuiltin(true);\n      actions.useBuiltin(true, hdl);\n    }\n    pinResetDispatcher.reset();\n  };\n\n  const selectors = (\n    <>\n      <fieldset role=\"group\">\n        <select\n          value={state.controls.project}\n          onChange={({ target: { value } }) => {\n            setProject(value as keyof typeof CHIP_PROJECTS);\n          }}\n          data-testid=\"project-picker\"\n        >\n          {PROJECT_NAMES.map(([number, label]) => (\n            <option key={number} value={number}>\n              {label}\n            </option>\n          ))}\n        </select>\n        <select\n          value={state.controls.chipName}\n          onChange={({ target: { value } }) => {\n            setChip(value);\n          }}\n          data-testid=\"chip-picker\"\n        >\n          {state.controls.chips.map((chip) => (\n            <option\n              key={chip}\n              value={chip}\n              style={isBuiltinOnly(chip) ? { color: \"rgb(170, 170, 170)\" } : {}}\n            >\n              {`${chip} ${isBuiltinOnly(chip) ? \"(given)\" : \"\"}`}\n            </option>\n          ))}\n        </select>\n        <button className=\"flex-0\" onClick={saveChip} disabled={useBuiltin}>\n          <Trans>Save</Trans>\n        </button>\n      </fieldset>\n    </>\n  );\n  const hdlPanel = (\n    <Panel\n      className=\"_hdl_panel\"\n      header={\n        <>\n          <div tabIndex={0}>HDL</div>\n          <fieldset>\n            {state.controls.hasBuiltin && !state.controls.builtinOnly && (\n              <label>\n                <input\n                  type=\"checkbox\"\n                  role=\"switch\"\n                  checked={useBuiltin}\n                  onChange={toggleUseBuiltin}\n                />\n                <Trans>Builtin</Trans>\n              </label>\n            )}\n          </fieldset>\n          {selectors}\n        </>\n      }\n    >\n      <Editor\n        className=\"flex-1\"\n        value={hdl}\n        onChange={(source) => {\n          setHdl(source);\n          compile.current(\n            useBuiltin || state.controls.builtinOnly ? {} : { hdl: source }\n          );\n        }}\n        grammar={HDL.parser}\n        language={\"hdl\"}\n        disabled={useBuiltin || state.controls.builtinOnly}\n      />\n    </Panel>\n  );\n\n  const [inputValid, setInputValid] = useState(true);\n\n  const chipButtons = (\n    <fieldset role=\"group\">\n      <button\n        onClick={doEval}\n        onKeyDown={doEval}\n        disabled={!state.sim.pending || !inputValid}\n      >\n        <Trans>Eval</Trans>\n      </button>\n      <button\n        onClick={clockActions.toggle}\n        style={{ maxWidth: \"initial\" }}\n        disabled={!state.sim.clocked}\n      >\n        <Trans>Clock</Trans>:{\"\\u00a0\"}\n        <Clockface />\n      </button>\n      <button\n        onClick={clockActions.reset}\n        style={{ maxWidth: \"initial\" }}\n        disabled={!state.sim.clocked}\n      >\n        <Trans>Reset</Trans>\n      </button>\n    </fieldset>\n  );\n\n  const visualizations: [string, ReactNode][] = makeVisualizationsWithId(\n    {\n      parts: state.sim.chip,\n    },\n    () => {\n      dispatch.current({ action: \"updateChip\" });\n    }\n  );\n\n  const pinResetDispatcher = new PinResetDispatcher();\n\n  const pinsPanel = (\n    <Panel\n      className=\"_parts_panel\"\n      header={\n        <>\n          <div>\n            <Trans>Chip</Trans> {state.controls.chipName}\n          </div>\n          {chipButtons}\n        </>\n      }\n    >\n      {state.sim.invalid ? (\n        <Trans>Syntax errors in the HDL code</Trans>\n      ) : (\n        <>\n          <PinContext.Provider value={pinResetDispatcher}>\n            <FullPinout\n              sim={state.sim}\n              toggle={actions.toggle}\n              setInputValid={setInputValid}\n              hideInternal={state.controls.builtinOnly || useBuiltin}\n            />\n          </PinContext.Provider>\n          {visualizations.length > 0 && (\n            <Accordian summary={<Trans>Visualization</Trans>} open={true}>\n              <main>{visualizations.map(([_, v]) => v)}</main>\n            </Accordian>\n          )}\n        </>\n      )}\n    </Panel>\n  );\n\n  const [selectedTestTab, doSetSelectedTestTab] = useState<\n    \"tst\" | \"cmp\" | \"out\"\n  >(\"tst\");\n\n  const setSelectedTestTab = useCallback(\n    (tab: typeof selectedTestTab) => {\n      doSetSelectedTestTab(tab);\n      tracking.trackEvent(\"tab\", \"change\", tab);\n    },\n    [tracking]\n  );\n\n  const testPanel = (\n    <Panel\n      className=\"_test_panel\"\n      header={\n        <>\n          <div className=\"flex-1\">\n            <Trans>Test</Trans>\n          </div>\n          <div className=\"flex-2\">\n            {runner.current && <Runbar runner={runner.current} />}\n          </div>\n          <div>\n            <button onClick={loadTest}>\n              <Icon name=\"upload_file\" />{\" \"}\n            </button>\n          </div>\n        </>\n      }\n    >\n      <div role=\"tablist\" style={{ \"--tab-count\": \"3\" } as CSSProperties}>\n        <div\n          role=\"tab\"\n          id=\"test-tab-tst\"\n          aria-controls=\"test-tabpanel-tst\"\n          aria-selected={selectedTestTab === \"tst\"}\n        >\n          <label>\n            <input\n              type=\"radio\"\n              name=\"test-tabs\"\n              aria-controls=\"test-tabpanel-tst\"\n              value=\"tst\"\n              checked={selectedTestTab === \"tst\"}\n              onChange={() => setSelectedTestTab(\"tst\")}\n            />\n            Test Script\n          </label>\n        </div>\n        <div\n          role=\"tabpanel\"\n          aria-labelledby=\"test-tab-tst\"\n          id=\"test-tabpanel-tst\"\n        >\n          <Editor\n            value={tst}\n            onChange={setTst}\n            grammar={TST.parser}\n            language={\"tst\"}\n            highlight={state.controls.span}\n            disabled={state.controls.builtinOnly}\n          />\n        </div>\n        <div\n          role=\"tab\"\n          id=\"test-tab-cmp\"\n          aria-controls=\"test-tablpanel-cmp\"\n          aria-selected={selectedTestTab === \"cmp\"}\n        >\n          <label>\n            <input\n              type=\"radio\"\n              name=\"test-tabs\"\n              aria-controls=\"test-tabpanel-cmp\"\n              value=\"cmp\"\n              checked={selectedTestTab === \"cmp\"}\n              onChange={() => setSelectedTestTab(\"cmp\")}\n            />\n            Compare File\n          </label>\n        </div>\n        <div\n          role=\"tabpanel\"\n          aria-labelledby=\"test-tab-cmp\"\n          id=\"test-tabpanel-cmp\"\n          style={{ position: \"relative\" }}\n        >\n          <Editor\n            value={cmp}\n            onChange={setCmp}\n            grammar={CMP.parser}\n            language={\"cmp\"}\n            disabled={state.controls.builtinOnly}\n          />\n        </div>\n        <div\n          role=\"tab\"\n          id=\"test-tab-out\"\n          aria-controls=\"test-tabpanel-out\"\n          aria-selected={selectedTestTab === \"out\"}\n        >\n          <label>\n            <input\n              type=\"radio\"\n              name=\"test-tabs\"\n              aria-controls=\"test-tabpanel-out\"\n              value=\"out\"\n              checked={selectedTestTab === \"out\"}\n              onChange={() => setSelectedTestTab(\"out\")}\n            />\n            Output File\n          </label>\n        </div>\n        <div\n          role=\"tabpanel\"\n          id=\"test-tabpanel-out\"\n          aria-labelledby=\"test-tab-out\"\n        >\n          <DiffTable cmp={cmp} out={out} />\n        </div>\n      </div>\n    </Panel>\n  );\n\n  return (\n    <div className=\"ChipPage grid\">\n      {hdlPanel}\n      {pinsPanel}\n      {testPanel}\n    </div>\n  );\n};\n\nexport default Chip;\n"],"names":["ALUComponent","A","op","D","out","flag","_jsxs","children","_jsx","width","height","xmlns","x","y","fill","points","stroke","xmlSpace","textAnchor","fontFamily","fontSize","strokeWidth","id","COMMANDS_ALU","WHITE","set","data","value","pixel","color","Screen","memory","canvas","useRef","draw","useCallback","ctx","current","getContext","undefined","drawImage","image","assertExists","getImageData","col","row","get","putImageData","ctxRef","ref","useClockFrame","useClockReset","clearRect","className","style","backgroundColor","maxWidth","boxSizing","marginInline","margin","borderTop","borderLeft","borderBottom","borderRight","makeVisualization","chip","updateAction","ALU","in","busVoltage","voltage","HIGH","Flags","Register","RegisterComponent","name","bits","PC","Keyboard","KeyboardComponent","keyboard","update","ScreenComponent","RAM","MemoryComponent","format","ROM32K","highlight","address","RAM8","CPU","decode","state","am","vis","parts","map","filter","v","length","ChipDisplayInfo","chipName","unsigned","Map","BUILTIN_REGISTRY","getBuiltinChip","isOk","pins","Array","from","Ok","ins","entries","concat","outs","pin","this","signBehaviors","includes","isSigned","UNSIGNED_PINS","PinContext","createContext","reducePin","range","i","reverse","reducePins","FullPinout","props","sim","inPins","outPins","internalPins","displayInfo","getDisplayInfo","PinoutBlock","header","toggle","setInputValid","disabled","pending","enableEdit","hideInternal","colSpan","immPin","Pin","signed","internal","useState","isBin","setIsBin","inputValid","decimal","setDecimal","resetDispatcher","useContext","PinResetDispatcher","registerCallback","setInputValidity","valid","updatePins","n","useEffect","limit","toString","display","flexDirection","alignItems","role","onClick","onChange","e","handleDecimalChange","positive","replace","numeric","isNaN","parseInt","newValue","Math","pow","target","toggleBin","callback","callbacks","push","reset","PROJECT_NAMES","getChips","project","CHIP_ORDER","BUILTIN_CHIP_PROJECTS","CHIP_PROJECTS","makeHdl","isBuiltinOnly","Object","values","flat","getBuiltinCode","template","getTemplate","ChipProjects","BUILTIN_CHIPS","CHIPS","bodyComment","builtinLine","reduceChip","invalid","clocked","clock","Clock","makeChipStore","fs","setStatus","storage","dispatch","dropdowns","findDropdowns","chips","Low","test","ChipTest","usingBuiltin","builtinOnly","reducers","setFiles","hdl","files","tst","cmp","updateChip","payload","controls","error","setProject","setChip","hasBuiltin","REGISTRY","testRunning","runningTest","testFinished","passed","compare","cmpResult","CMP","outResult","isErr","cmpData","outData","min","cmpI","outI","j","max","cmpJ","outJ","trim","match","updateTestStep","log","currentStep","span","done","end","start","actions","p","action","useBuiltin","loadChip","updateFiles","compileChip","compileTest","remove","maybeParsed","HDL","Err","buildChip","maybeChip","replaceChip","nextChip","nextPin","eval","with","fsName","ext","Promise","all","readFile","catch","saveChip","prj","path","writeFile","isLow","frame","doUseBuiltin","oldHdl","builtinName","initialize","file","TST","setFileSystem","runTest","pushd","run","popd","tick","stepTest","assert","chipId","step","initialState","Chip","BaseContext","AppContext","filePicker","tracking","useChipPageStore","useMemo","useImmerReducer","dispatcher","useStateInitializer","setHdl","setTst","setCmp","trackPage","trackEvent","pinResetDispatcher","doEval","compile","loadTest","select","console","runner","Timer","stop","clockActions","setUseBuiltin","selectors","number","label","hdlPanel","tabIndex","type","checked","toggleUseBuiltin","source","grammar","language","chipButtons","onKeyDown","visualizations","makeVisualizationsWithId","part","pinsPanel","Provider","summary","open","selectedTestTab","doSetSelectedTestTab","setSelectedTestTab","tab","testPanel","position"],"sourceRoot":""}