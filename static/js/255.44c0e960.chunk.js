"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[255],{9811:(t,e,s)=>{s.r(e),s.d(e,{CPU:()=>A,default:()=>T});var a=s(8061),r=s(8923),n=s(2277),i=s(6832),c=s(9613),l=s(4625),o=s(5838),d=s(9647);const u=new Int16Array([2,55944,0,64528,15,54018,1,64528,2,61584,54024,0,64648,2,55943,15,55943]);var p=s(3389),h=s(6167),m=s(7746),x=s(7559),b=s(8698);class j extends o.kG{dispatch;constructor(t,e){super(t,t.size,0),this.dispatch=e}async load(t,e){await super.load(t,e),this.dispatch.current({action:"update"})}}function g(t,e){const s=new j(t.cpu.RAM,e),a=new j(t.cpu.ROM,e),r=new j(t.cpu.Screen,e),n=new o.qT(new j(t.cpu.RAM,e));return{A:t.cpu.A,D:t.cpu.D,PC:t.cpu.PC,RAM:s,ROM:a,Screen:r,Keyboard:n}}function f(){const{fs:t,setStatus:e,storage:s}=(0,h.useContext)(b.r),a=(0,h.useRef)((()=>{})),{initialState:r,reducers:n,actions:i}=(0,h.useMemo)((()=>function(t,e,s,a){let r=new p.o6(new o.eD(u));const n={update(t){t.sim=g(r,a),t.test.highlight=r.currentStep?.span},setTest(t,e){let{tst:s,cmp:a}=e;t.test.tst=s??t.test.tst,t.test.cmp=a??t.test.cmp,t.test.out=""},testStep(t){t.test.out=r.log(),this.update(t)},testFinished(t){const s=(0,m.q)(t.test.cmp.trim(),r.log().trim());e(s?"Simulation successful: The output file is identical to the compare file":"Simulation error: The output file differs from the compare file")}},i={tick(){r.cpu.tick()},testStep(){const t=r.step();return a.current({action:"testStep"}),t&&a.current({action:"testFinished"}),t},resetRAM(){r.cpu.RAM.loadBytes([]),a.current({action:"update"}),e("Reset RAM")},toggleUseTest(){a.current({action:"update"})},resetCPU(){r.reset(),a.current({action:"setTest",payload:{}}),a.current({action:"update"}),e("Reset CPU")},reset(){this.resetCPU(),e("Reset CPU & RAM")},compileTest(t,s){a.current({action:"setTest",payload:{tst:t,cmp:s}});const n=d.qH.parse(t);return(0,l.dZ)(n)?(e("Failed to parse test"),!1):(e("Parsed tst"),r=p.o6.from((0,l.Ok)(n),r.cpu.ROM),a.current({action:"update"}),!0)},initialize(){this.compileTest("repeat {\n  ticktock;\n}")}};return{initialState:{sim:g(r,a),test:{highlight:r.currentStep?.span,tst:"",cmp:"",out:""}},reducers:n,actions:i}}(0,e,0,a)),[t,e,s,a]),[c,j]=(0,x.C)(n,r);return a.current=j,{state:c,dispatch:a,actions:i}}var C=s(258),v=s(8786),y=s(8016),k=s(1124),S=s(8582),R=s(8365),w=s(1539),M=s(7878);const P=t=>{let{runner:e,tst:[s,r,n],cmp:[i,c],out:[l],disabled:o=!1,onLoadTest:u}=t;const{fs:p,setStatus:m}=(0,h.useContext)(b.r),{filePicker:x,tracking:j}=(0,h.useContext)(y.Il),[g,f]=(0,h.useState)("tst"),v=(0,h.useCallback)((t=>{f(t),j.trackEvent("tab","change",t)}),[j]),P=(0,h.useCallback)((async()=>{try{const t=await x.select(),e=await p.readFile(t),s=await p.readFile(t.replace(/\.tst$/,".cmp"));null===u||void 0===u||u(e,s)}catch(t){console.error(t),m("Failed to load test")}}),[x,m,p]);return(0,M.jsx)(k.s,{className:"_test_panel",header:(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("div",{className:"flex-0",children:(0,M.jsx)(a.cC,{id:"Test"})}),(0,M.jsx)("div",{className:"flex-1",children:e.current&&(0,M.jsx)(C.D,{runner:e.current})}),(0,M.jsx)("div",{children:(0,M.jsx)("fieldset",{role:"group",children:(0,M.jsx)("button",{onClick:P,children:"\ud83d\udcc2"})})})]}),children:(0,M.jsxs)("div",{role:"tablist",style:{"--tab-count":"3"},children:[(0,M.jsx)("div",{role:"tab",id:"test-tab-tst","aria-controls":"test-tabpanel-tst","aria-selected":"tst"===g,children:(0,M.jsxs)("label",{children:[(0,M.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-tst",value:"tst",checked:"tst"===g,onChange:()=>v("tst")}),"Test Script"]})}),(0,M.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-tst",id:"test-tabpanel-tst",children:(0,M.jsx)(w.M,{value:s,onChange:r,grammar:d.qH.parser,language:"tst",highlight:n,disabled:o})}),(0,M.jsx)("div",{role:"tab",id:"test-tab-cmp","aria-controls":"test-tablpanel-cmp","aria-selected":"cmp"===g,children:(0,M.jsxs)("label",{children:[(0,M.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-cmp",value:"cmp",checked:"cmp"===g,onChange:()=>v("cmp")}),"Compare File"]})}),(0,M.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-cmp",id:"test-tabpanel-cmp",style:{position:"relative"},children:(0,M.jsx)(w.M,{value:i,onChange:c,grammar:R.lA.parser,language:"cmp",disabled:o})}),(0,M.jsx)("div",{role:"tab",id:"test-tab-out","aria-controls":"test-tabpanel-out","aria-selected":"out"===g,children:(0,M.jsxs)("label",{children:[(0,M.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-out",value:"out",checked:"out"===g,onChange:()=>v("out")}),"Output File"]})}),(0,M.jsx)("div",{role:"tabpanel",id:"test-tabpanel-out","aria-labelledby":"test-tab-out",children:(0,M.jsx)(S.M,{cmp:i,out:l})})]})})},A=()=>{const{state:t,actions:e,dispatch:s}=f(),{cpuProgram:l,setCpuProgram:o}=(0,h.useContext)(y.Il),[d,u]=(0,x.i)(t.test.tst),[p,m]=(0,x.i)(t.test.out),[b,j]=(0,x.i)(t.test.cmp),[g,S]=(0,h.useState)(null),[R,w]=(0,h.useState)("asm"),[A,T]=(0,h.useState)(!0),[F,O]=(0,h.useState)(0);(0,h.useEffect)((()=>{e.initialize()}),[e]),(0,h.useEffect)((()=>{l&&(0,v.$W)(l).then((e=>{t.sim.ROM.loadBytes(e),w("bin"),o(void 0)}))}),[l,o]);const D=(0,h.useRef)(),N=(0,h.useRef)(),[E,U]=(0,h.useState)(!1);(0,h.useEffect)((()=>(D.current=new class extends r.B{async tick(){return e.tick(),!1}finishFrame(){s.current({action:"update"})}reset(){e.reset()}toggle(){s.current({action:"update"})}},N.current=new class extends r.B{async tick(){return e.testStep()}finishFrame(){s.current({action:"update"})}reset(){e.reset()}toggle(){s.current({action:"update"})}},U(!0),()=>{var t,e;null===(t=D.current)||void 0===t||t.stop(),null===(e=N.current)||void 0===e||e.stop()})),[e,s]);return(0,M.jsxs)("div",{className:"CpuPage grid",children:[(0,M.jsx)(i.ZP,{name:"ROM",displayEnabled:A,memory:t.sim.ROM,highlight:t.sim.PC,format:R,onUpload:t=>{S(t),e.reset()}}),(0,M.jsx)(i.ZP,{name:"RAM",displayEnabled:A,memory:t.sim.RAM,format:"hex",onChange:()=>{O(F+1)}}),(0,M.jsxs)(k.s,{className:"IO",header:(0,M.jsxs)(M.Fragment,{children:[g&&(0,M.jsx)("div",{className:"flex-0",children:g}),(0,M.jsx)("div",{className:"flex-1",children:E&&D.current&&(0,M.jsx)(C.D,{runner:D.current})})]}),children:[(0,M.jsx)(c.l,{memory:t.sim.Screen},F),(0,M.jsx)(n.N,{update:()=>{s.current({action:"update"})},keyboard:t.sim.Keyboard}),(0,M.jsxs)("label",{children:[(0,M.jsx)("input",{type:"checkbox",role:"switch",checked:A,onChange:()=>{T(!A)}}),(0,M.jsx)(a.cC,{id:"{0}",values:{0:A?"Disable display":"Enable display"}})]}),A&&(0,M.jsx)("div",{children:(0,M.jsxs)("dl",{children:[(0,M.jsx)("dt",{children:"PC"}),(0,M.jsx)("dd",{children:t.sim.PC}),(0,M.jsx)("dt",{children:"A"}),(0,M.jsx)("dd",{children:t.sim.A}),(0,M.jsx)("dt",{children:"D"}),(0,M.jsx)("dd",{children:t.sim.D})]})})]}),E&&(0,M.jsx)(P,{runner:N,tst:[d,u,t.test.highlight],out:[p,m],cmp:[b,j],onLoadTest:(t,s)=>{e.compileTest(t,s)}})]})},T=A}}]);
//# sourceMappingURL=255.44c0e960.chunk.js.map