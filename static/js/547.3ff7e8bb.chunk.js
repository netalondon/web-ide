"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[547],{8815:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O});var s=n(5072),i=n(1058),r=n(3478),a=n(3577),o=n(8963),c=n(6604),l=n(6791),d=n(5692),u=n(7054);const m="function Main.fibonacci 0\n    push argument 0\n    push constant 2\n    lt                     // checks if n<2\n    if-goto IF_TRUE\n    goto IF_FALSE\n    label IF_TRUE          // if n<2, return n\n    push argument 0        \n    return\n    label IF_FALSE         // if n>=2, returns fib(n-2)+fib(n-1)\n    push argument 0\n    push constant 2\n    sub\n    call Main.fibonacci 1  // computes fib(n-2)\n    push argument 0\n    push constant 1\n    sub\n    call Main.fibonacci 1  // computes fib(n-1)\n    add                    // returns fib(n-1) + fib(n-2)\n    return\nfunction Sys.init 0\n    push constant 4\n    call Main.fibonacci 1   // computes the 4'th fibonacci element\nlabel WHILE\n    goto WHILE              // loops infinitely\n";var f=n(2201),p=n(4430),h=n(8637),g=n(4388),v=n(5920),S=n(6845),b=n(4913),x=n(5969);const _="repeat {\n\tvmstep;\n}";function j(e,t){const n=new x.j(e.vm.RAM,t),s=new x.j(e.vm.Screen,t),i=new f.qT(new x.j(e.vm.RAM,t)),r=e.vm.derivedLine();return{Keyboard:i,RAM:n,Screen:s,Stack:e.vm.vmStack().reverse(),Prog:e.vm.program,Statics:[...e.vm.memory.map(((e,t)=>t),16,16+e.vm.getStaticCount())],Temp:[...e.vm.memory.map(((e,t)=>t),5,15)],AddedSysInit:e.vm.addedSysInit,highlight:r}}function T(){const{fs:e,setStatus:t,storage:n}=(0,S.useContext)(d.r),s=(0,S.useRef)((()=>{})),{initialState:i,reducers:r,actions:a}=(0,S.useMemo)((()=>function(e,t,n,s){const i=(0,u.Wg)(h.VM.parse(m));let r=(0,u.Wg)(v.Vm.build(i.instructions)),a=(new g.w).with(r),o=!1,c=!0;const l={setVm(e,t){e.files.vm=t},setTst(e,t){let{tst:n,cmp:s}=t;e.files.tst=n,e.files.cmp=s??""},setExitCode(e,t){e.controls.exitCode=t},setValid(e,t){e.controls.valid=t},update(e){e.vm=j(a,s),e.test.useTest=o,e.test.highlight=a.currentStep?.span},setAnimate(e,t){e.controls.animate=t},testStep(e){e.files.out=a.log()},testFinished(e){const n=(0,b.q)(e.files.cmp.trim(),e.files.out);t(n?"Simulation successful: The output file is identical to the compare file":"Simulation error: The output file differs from the compare file")}},d={loadVm(e){for(const t of e)t.content.endsWith("\n")&&(t.content=t.content.slice(0,-1));s.current({action:"setVm",payload:e.map((e=>e.content)).join("\n")});const n=[];let i=0;for(const r of e){const e=h.VM.parse(r.content);if((0,u.dZ)(e))return s.current({action:"setValid",payload:!1}),t(`Parse error: ${e.err.message}`),!1;const a=(0,u.Wg)(e).instructions;for(const t of a)void 0!=t.line&&(t.line+=i);i+=a.length,n.push({name:r.name,instructions:a})}const o=v.Vm.buildFromFiles(n);return(0,u.dZ)(o)?(s.current({action:"setValid",payload:!1}),t(`Build Error: ${o.err.message}`),!1):(r=(0,u.Wg)(o),a.vm=r,a.reset(),s.current({action:"update"}),!0)},loadTest(e,n){s.current({action:"setTst",payload:{tst:e,cmp:n}});const i=p.qH.parse(e);return(0,u.dZ)(i)?(s.current({action:"setValid",payload:!1}),t("Failed to parse test"),!1):(s.current({action:"setValid",payload:!0}),t("Parsed tst"),r.reset(),a=g.w.from((0,u.Wg)(i)),a.vm=r,s.current({action:"update"}),!0)},setAnimate(e){c=e,s.current({action:"setAnimate",payload:e})},testStep(){const e=a.step();return s.current({action:"testStep"}),e&&s.current({action:"testFinished"}),c&&s.current({action:"update"}),e},step(){try{let e=!1;const t=r.step();return void 0!==t&&(e=!0,s.current({action:"setExitCode",payload:t})),c&&s.current({action:"update"}),e}catch(e){return t(`Runtime error: ${e.message}`),!0}},reset(){a.reset(),r.reset(),s.current({action:"update"}),s.current({action:"setExitCode",payload:void 0})},toggleUseTest(){o=!o,s.current({action:"update"})},initialize(){this.loadVm([{name:"fib",content:m}])}};return{initialState:{vm:j(a,s),controls:{exitCode:void 0,runningTest:!1,animate:!0,valid:!0},test:{useTest:o,highlight:void 0},files:{vm:"",tst:_,cmp:"",out:""}},reducers:l,actions:d}}(0,t,0,s)),[e,t,n,s]),[o,l]=(0,c.C)(r,i);return s.current=l,{state:o,dispatch:s,actions:a}}var I=n(4619),y=n(9882),E=n(8722),C=n(9200),R=n(8398),A=n(558),L=n(864);const w={[y.b.SYS_WAIT_DURATION_NOT_POSITIVE]:i.ag._("Duration must be positive (Sys.wait)"),[y.b.ARRAY_SIZE_NOT_POSITIVE]:i.ag._("Array size must be positive (Array.new)"),[y.b.DIVIDE_BY_ZERO]:i.ag._("Division by zero (Math.divide)"),[y.b.SQRT_NEG]:i.ag._("Cannot compute square root of a negative number (Math.sqrt)"),[y.b.ALLOC_SIZE_NOT_POSITIVE]:i.ag._("Allocated memory size must be positive (Memory.alloc)"),[y.b.HEAP_OVERFLOW]:i.ag._("Heap overflow (Memory.alloc)"),[y.b.ILLEGAL_PIXEL_COORD]:i.ag._("Illegal pixel coordinates (Screen.drawPixel)"),[y.b.ILLEGAL_LINE_COORD]:i.ag._("Illegal line coordinates (Screen.drawLine)"),[y.b.ILLEGAL_RECT_COORD]:i.ag._("Illegal rectangle coordinates (Screen.drawRectangle)"),[y.b.ILLEGAL_CENTER_COORD]:i.ag._("Illegal center coordinates (Screen.drawCircle)"),[y.b.ILLEGAL_RADIUS]:i.ag._("Illegal radius (Screen.drawCircle)"),[y.b.STRING_LENGTH_NEG]:i.ag._("Maximum length must be non-negative (String.new)"),[y.b.GET_CHAR_INDEX_OUT_OF_BOUNDS]:i.ag._("String index out of bounds (String.charAt)"),[y.b.SET_CHAR_INDEX_OUT_OF_BOUNDS]:i.ag._("String index out of bounds (String.setCharAt)"),[y.b.STRING_FULL]:i.ag._("String is full (String.appendChar)"),[y.b.STRING_EMPTY]:i.ag._("String is empty (String.eraseLastChar)"),[y.b.STRING_INSUFFICIENT_CAPACITY]:i.ag._("Insufficient string capacity (String.setInt)"),[y.b.ILLEGAL_CURSOR_LOCATION]:i.ag._("Illegal cursor location (Output.moveCursor)")},O=()=>{const{state:e,actions:t,dispatch:n}=T(),{toolStates:i}=(0,S.useContext)(E.Il),{setStatus:u}=(0,S.useContext)(d.r),[m,f]=(0,c.i)(e.files.tst),[p,h]=(0,c.i)(e.files.out),[g,v]=(0,c.i)(e.files.cmp);(0,S.useEffect)((()=>{i.setTool("vm")}),[]),(0,S.useEffect)((()=>{t.initialize()}),[t]),(0,S.useEffect)((()=>{t.loadTest(m,g),t.reset()}),[m,g]),(0,S.useEffect)((()=>{void 0!==e.controls.exitCode&&u(0==e.controls.exitCode?"Program halted":`Program exited with error code ${e.controls.exitCode}${(0,y.q)(e.controls.exitCode)?`: ${w[e.controls.exitCode]}`:""}`)}),[e.controls.exitCode]);const b=(0,S.useRef)(),x=(0,S.useRef)(),[j,O]=(0,S.useState)(!1);(0,S.useEffect)((()=>(b.current=new class extends I.B{async tick(){return t.step()}finishFrame(){n.current({action:"update"})}reset(){u("Reset"),t.reset()}toggle(){n.current({action:"update"})}},x.current=new class extends I.B{async tick(){return t.testStep()}finishFrame(){n.current({action:"update"})}reset(){u("Reset"),t.reset()}toggle(){n.current({action:"update"})}},O(!0),()=>{var e,t;null===(e=b.current)||void 0===e||e.stop(),null===(t=x.current)||void 0===t||t.stop()})),[t,n]);const M=(0,S.useRef)(null),k=e=>{t.setAnimate(e<=2)},F=(0,S.useRef)();return(0,L.jsxs)("div",{className:"Page VmPage grid",children:[(0,L.jsx)(R.s,{className:"program",header:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(s.cC,{id:"Program"}),(0,L.jsx)("input",{type:"file",multiple:!0,style:{display:"none"},ref:M,onChange:async e=>{var n;if(null===(n=e.target.files)||void 0===n||!n.length)return void u("No file selected");u("Loading");const s=[];for(const t of e.target.files)t.name.endsWith(".vm")&&s.push({name:t.name.replace(".vm",""),content:await t.text()});if(0==s.length)return void u("No .vm file was selected");t.loadVm(s)&&u("Loaded vm file")}}),(0,L.jsx)("button",{className:"flex-0",onClick:()=>{var e;null===(e=M.current)||void 0===e||e.click()},"data-tooltip":"Load file","data-placement":"bottom",children:"\ud83d\udcc2"})]}),children:(0,L.jsx)(C.M,{value:e.files.vm,onChange:function(e){},disabled:!0,language:"",highlight:e.vm.highlight})}),(0,L.jsxs)(R.s,{className:"stack",header:(0,L.jsx)(s.cC,{id:"VM"}),children:[(0,L.jsx)(N,{stack:e.vm.Stack,addedSysInit:e.vm.AddedSysInit}),(0,L.jsx)(P,{statics:e.vm.Statics,temp:e.vm.Temp,frame:e.vm.Stack[0]})]}),(0,L.jsxs)(R.s,{className:"display",style:{gridArea:"display"},children:[j&&b.current&&(0,L.jsx)(l.D,{runner:b.current,disabled:!e.controls.valid,onSpeedChange:k}),(0,L.jsx)(o.l,{memory:e.vm.Screen}),(0,L.jsx)(r.N,{keyboard:e.vm.Keyboard}),(0,L.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,L.jsx)(a.ZP,{ref:F,name:"Global Stack",memory:e.vm.RAM,maxSize:1792,offset:256,format:"dec",showUpload:!1,showClear:!1}),(0,L.jsx)(a.ZP,{name:"RAM",memory:e.vm.RAM,format:"dec",cellLabels:["SP:","LCL:","ARG:","THIS:","THAT:","TEMP1:","TEMP2:","TEMP3:","TEMP4:","TEMP5:","TEMP6:","TEMP7:","TEMP8:","R13:","R14:","R15:"],showUpload:!1,onChange:()=>{var e;null===(e=F.current)||void 0===e||e.rerender()}})]})]}),j&&(0,L.jsx)(A.F,{runner:x,tst:[m,f,e.test.highlight],out:[p,h],cmp:[g,v],showClear:!0,defaultTst:_,onSpeedChange:k,disabled:!e.controls.valid})]})};function M(e,t){const n={};e=e.filter((e=>{var t;return(null===(t=e.fn)||void 0===t?void 0:t.name)!=v.tN}));for(const i of e)i.fn&&(n[i.fn.name]?n[i.fn.name]++:n[i.fn.name]=1);const s=e.slice().reverse().map((e=>{var n,s,i;return(null===(n=e.fn)||void 0===n?void 0:n.name)==v.bU.name?t?`${v.bU.name} (built-in)`:v.bU.name:null!==(s=null===(i=e.fn)||void 0===i?void 0:i.name)&&void 0!==s?s:"Unknown function"}));for(const i of Object.keys(n))if(1!=n[i]){n[i]=0;for(let e=0;e<s.length;e++)s[e]===i&&(s[e]=`${i}[${n[i]}]`,n[i]++)}return s}function N(e){let{stack:t,addedSysInit:n}=e;return(0,L.jsx)("section",{children:(0,L.jsxs)("p",{children:["Call Stack:",(0,L.jsx)("code",{children:M(t,n).join(" > ")})]})})}function P(e){var t,n,s,i,r,a;let{statics:o,temp:c,frame:l}=e;return(0,L.jsxs)("section",{children:[(0,L.jsx)("header",{children:(0,L.jsx)("h6",{children:"Segments"})}),(0,L.jsxs)("main",{children:[(0,L.jsxs)("p",{children:["Stack:",(0,L.jsxs)("code",{children:["[",l.stack.values.join(", "),"]"]})]}),(null===(t=l.usedSegments)||void 0===t?void 0:t.has("static"))&&(0,L.jsxs)("p",{children:["Statics:",(0,L.jsxs)("code",{children:["[",o.join(", "),"]"]})]}),(null===(n=l.usedSegments)||void 0===n?void 0:n.has("local"))&&(0,L.jsxs)("p",{children:["Local:",(0,L.jsxs)("code",{children:["[",l.locals.values.join(", "),"]"]})]}),(null===(s=l.usedSegments)||void 0===s?void 0:s.has("argument"))&&(0,L.jsxs)("p",{children:["Argument:",(0,L.jsxs)("code",{children:["[",l.args.values.join(", "),"]"]})]}),(null===(i=l.usedSegments)||void 0===i?void 0:i.has("this"))&&(0,L.jsxs)("p",{children:["This:",(0,L.jsxs)("code",{children:["[",l.this.values.join(", "),"]"]})]}),(null===(r=l.usedSegments)||void 0===r?void 0:r.has("that"))&&(0,L.jsxs)("p",{children:["That:",(0,L.jsxs)("code",{children:["[",l.that.values.join(", "),"]"]})]}),(null===(a=l.usedSegments)||void 0===a?void 0:a.has("temp"))&&(0,L.jsxs)("p",{children:["Temp:",(0,L.jsxs)("code",{children:["[",c.join(", "),"]"]})]})]})]})}},5969:(e,t,n)=>{n.d(t,{j:()=>i});var s=n(2201);class i extends s.kG{dispatch;constructor(e,t){super(e,e.size,0),this.dispatch=t}async load(e,t){await super.load(e,t),this.dispatch.current({action:"update"})}}},554:(e,t,n)=>{n.d(t,{j:()=>s});const s=e=>{if((e=>"function"===typeof e?.toString||"string"===typeof e)(e)){const t=e.toString();return"[object Object]"===t?JSON.stringify(e):t}return JSON.stringify(e)}},2936:(e,t,n)=>{n.d(t,{b:()=>i});var s=n(5251);function i(e,t){return void 0===e&&void 0!==s.BM[t]&&(e=t),{..."inline"===t?{display:"inline-block"}:{},width:s.BM[e]??"0"}}}}]);