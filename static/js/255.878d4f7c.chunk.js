"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[255],{9811:function(e,t,n){n.r(t),n.d(t,{CPU:function(){return T},default:function(){return B}});var r=n(2951),s=n(1976),a=n(7591),i=n(4337),c=n(1026),u=n(8061),l=n(8923),o=n(2277),d=n(3052),p=n(9613),h=n(1092),f=n(7791),x=n(7169),v=n(3243),m=n(7597),b=n(4649),j=n(5838),g=new Int16Array([2,55944,0,64528,15,54018,1,64528,2,61584,54024,0,64648,2,55943,15,55943]),k=n(3389),Z=n(6167),y=n(7559),C=n(8698),R=function(e){(0,a.Z)(n,e);var t=(0,i.Z)(n);function n(e,s){var a;return(0,r.Z)(this,n),a=t.call(this,e,e.size,0),(0,b.Z)((0,x.Z)(a),"dispatch",void 0),a.dispatch=s,a}return(0,s.Z)(n,[{key:"load",value:function(){var e=(0,f.Z)((0,h.Z)().mark((function e(t,r){return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,v.Z)((0,m.Z)(n.prototype),"load",this).call(this,t,r);case 2:this.dispatch.current({action:"update"});case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(j.kG);function w(e,t){var n=new R(e.cpu.RAM,t),r=new R(e.cpu.ROM,t),s=new R(e.cpu.Screen,t),a=new j.qT(new R(e.cpu.RAM,t));return{A:e.cpu.A,D:e.cpu.D,PC:e.cpu.PC,RAM:n,ROM:r,Screen:s,Keyboard:a}}function S(){var e=(0,Z.useContext)(C.r),t=e.fs,n=e.setStatus,r=e.storage,s=(0,Z.useRef)((function(){})),a=(0,Z.useMemo)((function(){return function(e,t,n,r){var s,a=new k.o6(new j.eD(g)),i={update:function(e){var t;e.sim=w(a,r),e.test.highlight=null===(t=a.currentStep)||void 0===t?void 0:t.span}},c={tick:function(){a.cpu.tick()},testStep:function(){a.step()},resetRAM:function(){a.cpu.RAM.loadBytes([]),r.current({action:"update"}),t("Reset RAM")},toggleUseTest:function(){r.current({action:"update"})},resetCPU:function(){a.reset(),r.current({action:"update"}),t("Reset CPU")},reset:function(){this.resetRAM(),this.resetCPU(),t("Reset CPU & RAM")}};return{initialState:{sim:w(a,r),test:{highlight:null===(s=a.currentStep)||void 0===s?void 0:s.span}},reducers:i,actions:c}}(0,n,0,s)}),[t,n,r,s]),i=a.initialState,u=a.reducers,l=a.actions,o=(0,y.C)(u,i),d=(0,c.Z)(o,2),p=d[0],h=d[1];return s.current=h,{state:p,dispatch:s,actions:l}}var M=n(258),A=n(1124),P=n(8582),D=n(8365),F=n(9647),N=n(8016),U=n(1539),O=n(7878),_=function(e){var t=e.runner,n=(0,c.Z)(e.tst,3),r=n[0],s=n[1],a=n[2],i=(0,c.Z)(e.cmp,2),l=i[0],o=i[1],d=(0,c.Z)(e.out,1)[0],p=e.disabled,x=void 0!==p&&p,v=(0,Z.useContext)(C.r),m=v.fs,b=v.setStatus,j=(0,Z.useContext)(N.Il),g=j.filePicker,k=j.tracking,y=(0,Z.useState)("tst"),R=(0,c.Z)(y,2),w=R[0],S=R[1],_=(0,Z.useCallback)((function(e){S(e),k.trackEvent("tab","change",e)}),[k]),T=(0,Z.useCallback)((0,f.Z)((0,h.Z)().mark((function e(){var t,n;return(0,h.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.select();case 3:return t=e.sent,e.next=6,m.readFile(t);case 6:n=e.sent,s(n),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0),b("Failed to load test");case 14:case"end":return e.stop()}}),e,null,[[0,10]])}))),[g,b,m]);return(0,O.jsx)(A.s,{className:"_test_panel",header:(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{className:"flex-0",children:(0,O.jsx)(u.cC,{id:"Test"})}),(0,O.jsx)("div",{className:"flex-1",children:t.current&&(0,O.jsx)(M.D,{runner:t.current})}),(0,O.jsx)("div",{children:(0,O.jsx)("fieldset",{role:"group",children:(0,O.jsx)("button",{onClick:T,children:"\ud83d\udcc2"})})})]}),children:(0,O.jsxs)("div",{role:"tablist",style:{"--tab-count":"3"},children:[(0,O.jsx)("div",{role:"tab",id:"test-tab-tst","aria-controls":"test-tabpanel-tst","aria-selected":"tst"===w,children:(0,O.jsxs)("label",{children:[(0,O.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-tst",value:"tst",checked:"tst"===w,onChange:function(){return _("tst")}}),"Test Script"]})}),(0,O.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-tst",id:"test-tabpanel-tst",children:(0,O.jsx)(U.M,{value:r,onChange:s,grammar:F.qH.parser,language:"tst",highlight:a,disabled:x})}),(0,O.jsx)("div",{role:"tab",id:"test-tab-cmp","aria-controls":"test-tablpanel-cmp","aria-selected":"cmp"===w,children:(0,O.jsxs)("label",{children:[(0,O.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-cmp",value:"cmp",checked:"cmp"===w,onChange:function(){return _("cmp")}}),"Compare File"]})}),(0,O.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-cmp",id:"test-tabpanel-cmp",style:{position:"relative"},children:(0,O.jsx)(U.M,{value:l,onChange:o,grammar:D.lA.parser,language:"cmp",disabled:x})}),(0,O.jsx)("div",{role:"tab",id:"test-tab-out","aria-controls":"test-tabpanel-out","aria-selected":"out"===w,children:(0,O.jsxs)("label",{children:[(0,O.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-out",value:"out",checked:"out"===w,onChange:function(){return _("out")}}),"Output File"]})}),(0,O.jsx)("div",{role:"tabpanel",id:"test-tabpanel-out","aria-labelledby":"test-tab-out",children:(0,O.jsx)(P.M,{cmp:l,out:d})})]})})},T=function(){var e=S(),t=e.state,n=e.actions,h=e.dispatch,f=(0,Z.useState)("repeat {\n\tticktock;\n}"),x=(0,c.Z)(f,2),v=x[0],m=x[1],b=(0,Z.useState)(""),j=(0,c.Z)(b,2),g=j[0],k=j[1],y=(0,Z.useState)(""),C=(0,c.Z)(y,2),R=C[0],w=C[1],P=(0,Z.useState)(null),D=(0,c.Z)(P,2),F=D[0],N=D[1],U=(0,Z.useState)(!0),T=(0,c.Z)(U,2),B=T[0],E=T[1],I=(0,Z.useRef)(),q=(0,Z.useRef)(),K=(0,Z.useState)(!1),z=(0,c.Z)(K,2),G=z[0],H=z[1];(0,Z.useEffect)((function(){return I.current=new(function(e){(0,a.Z)(c,e);var t=(0,i.Z)(c);function c(){return(0,r.Z)(this,c),t.apply(this,arguments)}return(0,s.Z)(c,[{key:"tick",value:function(){return n.tick(),!1}},{key:"finishFrame",value:function(){h.current({action:"update"})}},{key:"reset",value:function(){n.reset()}},{key:"toggle",value:function(){h.current({action:"update"})}}]),c}(l.B)),q.current=new(function(e){(0,a.Z)(c,e);var t=(0,i.Z)(c);function c(){return(0,r.Z)(this,c),t.apply(this,arguments)}return(0,s.Z)(c,[{key:"tick",value:function(){return n.testStep(),!1}},{key:"finishFrame",value:function(){h.current({action:"update"})}},{key:"reset",value:function(){n.reset()}},{key:"toggle",value:function(){h.current({action:"update"})}}]),c}(l.B)),H(!0),function(){var e,t;null===(e=I.current)||void 0===e||e.stop(),null===(t=q.current)||void 0===t||t.stop()}}),[n,h]);return(0,O.jsxs)("div",{className:"CpuPage grid",children:[(0,O.jsx)(d.ZP,{name:"ROM",memory:t.sim.ROM,highlight:t.sim.PC,format:"asm",onUpload:function(e){N(e),n.reset()}}),(0,O.jsx)(d.ZP,{name:"RAM",memory:t.sim.RAM,format:"hex"}),(0,O.jsxs)(A.s,{className:"IO",header:(0,O.jsxs)(O.Fragment,{children:[F&&(0,O.jsx)("div",{className:"flex-0",children:F}),(0,O.jsx)("div",{className:"flex-1",children:G&&I.current&&(0,O.jsx)(M.D,{runner:I.current})})]}),children:[(0,O.jsx)(p.l,{memory:t.sim.Screen}),(0,O.jsx)(o.N,{keyboard:t.sim.Keyboard}),(0,O.jsxs)("label",{children:[(0,O.jsx)("input",{type:"checkbox",role:"switch",checked:B,onChange:function(){E(!B)}}),(0,O.jsx)(u.cC,{id:"{0}",values:{0:B?"Disable display":"Enable display"}})]}),B&&(0,O.jsx)("div",{children:(0,O.jsxs)("dl",{children:[(0,O.jsx)("dt",{children:"PC"}),(0,O.jsx)("dd",{children:t.sim.PC}),(0,O.jsx)("dt",{children:"A"}),(0,O.jsx)("dd",{children:t.sim.A}),(0,O.jsx)("dt",{children:"D"}),(0,O.jsx)("dd",{children:t.sim.D})]})})]}),G&&(0,O.jsx)(_,{runner:q,tst:[v,m,t.test.highlight],out:[g,k],cmp:[R,w]})]})},B=T}}]);
//# sourceMappingURL=255.878d4f7c.chunk.js.map