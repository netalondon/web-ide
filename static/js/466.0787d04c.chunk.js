"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[466],{8654:function(e,t,n){n.r(t),n.d(t,{Chip:function(){return le},default:function(){return ce}});var i=n(2951),r=n(1976),a=n(3243),s=n(7597),l=n(7591),c=n(4337),o=n(1092),u=n(7791),d=n(1026),p=n(8061),h=n(6167),f=n(649),v=n(7878),m=n(3300),g=n(3118),x=n(7039),b=n(3116),C=n(6329),j=n(6693),y=n(134),k=function ALUComponent(e){var t,n=e.A,i=e.op,r=e.D,a=e.out;e.flag;return(0,v.jsxs)("div",{children:[(0,v.jsx)("span",{children:"ALU"}),(0,v.jsx)("svg",{width:"250",height:"250",xmlns:"http://www.w3.org/2000/svg",children:(0,v.jsxs)("g",{children:[(0,v.jsx)("rect",{x:"1",y:"20",height:"85",width:"70",fill:"black"}),(0,v.jsx)("rect",{x:"1",y:"145",height:"85",width:"70",fill:"black"}),(0,v.jsx)("rect",{x:"180",y:"95",height:"60",width:"70",fill:"black"}),(0,v.jsx)("polygon",{points:"70,10 180,85 180,165 70,240 70,135 90,125 70,115",stroke:"#000",fill:"#6D97AB"}),(0,v.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",fontFamily:"Noto Sans JP",fontSize:"14",strokeWidth:"0",id:"svg_9",y:"63",x:"35",stroke:"white",fill:"#ffffff",children:n}),(0,v.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",fontFamily:"Noto Sans JP",fontSize:"14",id:"svg_10",y:"188",x:"35",strokeWidth:"0",stroke:"white",fill:"#ffffff",children:r}),(0,v.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",fontFamily:"Noto Sans JP",fontSize:"14",id:"svg_11",y:"125",x:"215",strokeWidth:"0",stroke:"white",fill:"#ffffff",children:a}),(0,v.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",fontFamily:"Noto Sans JP",fontSize:"14",id:"svg_13",y:"125",x:"135",strokeWidth:"0",stroke:"white",fill:"#ffffff",children:null!==(t=j.NM.op[i])&&void 0!==t?t:"(??)"})]})})]})},Z=n(2277),w=n(3052),P=n(6830),S=n(5541),_=n(7030),I="white";function set(e,t,n,i){var r=4*(512*n+t),a=i===I?255:0;e[r]=a,e[r+1]=a,e[r+2]=a,e[r+3]=255}var T=function Screen(e){var t=e.memory,n=(0,h.useRef)(),i=(0,h.useCallback)((function(){var e,i,r=null!==(e=null===(i=n.current)||void 0===i?void 0:i.getContext("2d"))&&void 0!==e?e:void 0;r&&function drawImage(e,t){for(var n,i,r=(0,S.kP)(e.getImageData(0,0,512,256),"Failed to create Context2d"),a=0;a<512;a++)for(var s=0;s<256;s++){var l=(n=a,i=s,0===(t.get(32*i+(n/16|0))&1<<n%16)?I:"black");set(r.data,a,s,l)}e.putImageData(r,0,0)}(r,t)}),[t]),r=(0,h.useCallback)((function(e){n.current=null!==e&&void 0!==e?e:void 0,i()}),[n,i]);return(0,_.RC)(i),(0,_._W)((function(){var e,t;null===(e=n.current)||void 0===e||null===(t=e.getContext("2d"))||void 0===t||t.clearRect(0,0,n.current.width,n.current.height)})),(0,v.jsxs)("article",{className:"panel",children:[(0,v.jsx)("header",{children:"Screen"}),(0,v.jsx)("main",{style:{backgroundColor:"var(--code-background-color)"},children:(0,v.jsx)("figure",{style:{width:"100%",maxWidth:"512px",boxSizing:"content-box",marginInline:"auto",margin:"auto",borderTop:"2px solid gray",borderLeft:"2px solid gray",borderBottom:"2px solid lightgray",borderRight:"2px solid lightgray"},children:(0,v.jsx)("canvas",{ref:r,width:512,height:256})})})]})};function makeVisualization(e,t){if(e instanceof g.JU)return(0,v.jsx)(k,{A:e.in("x").busVoltage,op:e.op(),D:e.in("y").busVoltage,out:e.out().busVoltage,flag:e.out("zr").voltage()===C.lj?j.vU.Zero:e.out("ng").voltage()===C.lj?j.vU.Negative:j.vU.Positive});var n;if(e instanceof x.aX)return(0,v.jsx)(P.y,{name:null!==(n=e.name)&&void 0!==n?n:"Chip ".concat(e.id),bits:e.bits});if(e instanceof x.PC)return(0,v.jsx)(P.y,{name:"PC",bits:e.bits});if(e instanceof m.N1)return(0,v.jsx)(Z.N,{keyboard:e,update:t});if(e instanceof m.lL)return(0,v.jsx)(T,{memory:e.memory});if(e instanceof b.FH)return(0,v.jsx)(w.zp,{name:e.name,memory:e.memory,format:e instanceof m.m1?"asm":"dec",highlight:e.address});if(e instanceof b.HX)return(0,v.jsxs)("span",{children:["RAM ",e.width]});if(e instanceof m.Z9){var i=(0,y.Jx)(e.in("instruction").busVoltage);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(P.y,{name:"A",bits:e.state.A}),(0,v.jsx)(P.y,{name:"D",bits:e.state.D}),(0,v.jsx)(P.y,{name:"PC",bits:e.state.PC}),(0,v.jsx)(k,{A:i.am?e.in("inM").busVoltage:e.state.A,D:e.state.D,out:e.state.ALU,op:i.op,flag:e.state.flag})]})}var r=(0,f.Z)(e.parts).map((function(e){return makeVisualization(e,t)})).filter((function(e){return void 0!==e}));return r.length>0?(0,v.jsx)(v.Fragment,{children:r}):void 0}var F=n(8582),N=n(4649),O=n(726),R=n(1585),B=n(4625),D=function(){function ChipDisplayInfo(e,t){if((0,i.Z)(this,ChipDisplayInfo),(0,N.Z)(this,"signBehaviors",new Map),g.zZ.has(e)){var n=(0,g.cT)(e);if((0,B.IY)(n)){var r,a=Array.from((0,B.Ok)(n).ins.entries()).concat(Array.from((0,B.Ok)(n).outs.entries())),s=(0,O.Z)(a);try{for(s.s();!(r=s.n()).done;){var l=r.value;this.signBehaviors.set(l.name,!t||!t.includes(l.name))}}catch(c){s.e(c)}finally{s.f()}}}}return(0,r.Z)(ChipDisplayInfo,[{key:"isSigned",value:function isSigned(e){return this.signBehaviors.get(e)}}]),ChipDisplayInfo}(),M=new Map([["Mux4Way16",["sel"]],["Mux8Way16",["sel"]],["DMux4Way",["sel"]],["DMux8Way",["sel"]],["RAM8",["address"]],["RAM64",["address"]],["RAM512",["address"]],["RAM4K",["address"]],["RAM16K",["address"]],["Screen",["address"]],["Memory",["address"]],["CPU",["addressM","pc"]]]),A=(0,h.createContext)({});function reducePin(e){return{pin:e,bits:(0,R.w)(0,e.width).map((function(t){return[t,e.voltage(t)]})).reverse()}}function reducePins(e){return(0,f.Z)(e.entries()).map(reducePin)}var E=function FullPinout(e){var t,n=e.sim,i=n.inPins,r=n.outPins,a=n.internalPins,s=function getDisplayInfo(e){return new D(e,M.get(e))}(null!==(t=e.sim.chip[0].name)&&void 0!==t?t:"");return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("style",{children:"\n        table.pinout th {\n          font-weight: bold;\n        }\n\n        table.pinout tbody td:first-child {\n          text-align: right;\n          --font-size: 1rem;\n          width: 0;\n          white-space: nowrap;\n          border-right: var(--border-width) solid var(--table-border-color);\n        }\n\n        table.pinout tbody button {\n          --font-size: 0.875em;\n          font-family: var(--font-family-monospace);\n          max-width: 2em;\n        }\n        "}),(0,v.jsx)("table",{className:"pinout",children:(0,v.jsxs)("tbody",{children:[(0,v.jsx)(V,{pins:i,header:"Input pins",toggle:e.toggle,setInputValid:e.setInputValid,displayInfo:s}),(0,v.jsx)(V,{pins:r,header:"Output pins",disabled:e.sim.pending,enableEdit:!1,displayInfo:s}),!e.hideInternal&&(0,v.jsx)(V,{pins:a,header:"Internal pins",disabled:e.sim.pending,enableEdit:!1,displayInfo:s})]})})]})},V=function PinoutBlock(e){return(0,v.jsxs)(v.Fragment,{children:[e.pins.length>0&&(0,v.jsx)("tr",{children:(0,v.jsx)("th",{colSpan:2,children:e.header})}),(0,f.Z)(e.pins).map((function(t){return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:t.pin.name}),(0,v.jsx)("td",{children:(0,v.jsx)(z,{pin:t,toggle:e.toggle,disabled:e.disabled,enableEdit:e.enableEdit,signed:e.displayInfo.isSigned(t.pin.name),setInputValid:e.setInputValid,internal:"Internal pins"===e.header})})]},t.pin.name)}))]})},z=function Pin(e){var t=e.pin,n=e.toggle,i=e.disabled,r=void 0!==i&&i,a=e.enableEdit,s=void 0===a||a,l=e.signed,c=void 0===l||l,o=e.setInputValid,u=e.internal,p=void 0!==u&&u,f=(0,h.useState)(!0),m=(0,d.Z)(f,2),g=m[0],x=m[1],b=!0,C=(0,h.useState)(""),j=(0,d.Z)(C,2),y=j[0],k=j[1],Z=(0,h.useContext)(A);Z instanceof H&&Z.registerCallback((function(){x(!0)}));var w=function setInputValidity(e){b=e,null===o||void 0===o||o(e)},P=function updatePins(e){for(var i=0;i<t.bits.length;i++)t.bits[t.bits.length-i-1][1]!==(e>>i&1)&&(null===n||void 0===n||n(t.pin,i))};return(0,h.useEffect)((function(){if(!g&&b){var e=0;if(c&&t.bits[0][1]){var n,i=(0,O.Z)(t.bits);try{for(i.s();!(n=i.n()).done;){var r=(0,d.Z)(n.value,2),a=r[0],s=r[1];a<t.bits.length-1&&!s&&(e+=Math.pow(2,a))}}catch(v){i.e(v)}finally{i.f()}e=-e-1}else{var l,o=c?t.bits.length-1:t.bits.length,u=(0,O.Z)(t.bits);try{for(u.s();!(l=u.n()).done;){var p=(0,d.Z)(l.value,2),h=p[0],f=p[1];h<o&&f&&(e+=Math.pow(2,h))}}catch(v){u.e(v)}finally{u.f()}}k(e.toString())}}),[t,g]),(0,v.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,v.jsx)("fieldset",{role:"group",style:{width:"".concat(t.bits.length,"rem")},children:g?t.bits.map((function(e){var i=(0,d.Z)(e,2),a=i[0],s=i[1];return(0,v.jsx)("button",{disabled:r,style:p?{backgroundColor:"grey"}:{},onClick:function onClick(){return null===n||void 0===n?void 0:n(t.pin,a)},"data-testid":"pin-".concat(a),children:s},a)})):(0,v.jsx)("input",{className:"colored",value:y,onChange:function onChange(e){!function handleDecimalChange(e){var n=e.replace(/[^\d]/g,""),i=c&&"-"===e[0]?"-".concat(n):n;if(k(i),isNaN(parseInt(i)))w(!1);else{var r=parseInt(i);!c&&r>=Math.pow(2,t.bits.length)||c&&(r>=Math.pow(2,t.bits.length-1)||r<-Math.pow(2,t.bits.length-1))?w(!1):(P(r),w(!0))}}(e.target.value)},disabled:!s})}),t.bits.length>1&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{style:{width:"1em"}}),(0,v.jsx)("button",{style:{maxWidth:"3em",margin:0},onClick:function onClick(){return function toggleBin(){x(!g)}()},children:g?"dec":"bin"})]})]})},H=function(){function PinResetDispatcher(){(0,i.Z)(this,PinResetDispatcher),(0,N.Z)(this,"callbacks",[])}return(0,r.Z)(PinResetDispatcher,[{key:"registerCallback",value:function registerCallback(e){this.callbacks.push(e)}},{key:"reset",value:function reset(){var e,t=(0,O.Z)(this.callbacks);try{for(t.s();!(e=t.n()).done;){(0,e.value)()}}catch(n){t.e(n)}finally{t.f()}}}]),PinResetDispatcher}(),U=n(7559),W=n(258),J=n(8698),L=n(4408),$=n(691),G=n(6531),q=n(8090),K=n(9647),X=n(7662),Y=n(3389),Q=n(8365),ee=[["01","Project 1"],["02","Project 2"],["03","Project 3"],["05","Project 5"]];function getChips(e){return e in X.CHIP_ORDER?X.CHIP_ORDER[e]:X.BUILTIN_CHIP_PROJECTS[e].concat(X.CHIP_PROJECTS[e])}function makeHdl(e){return"CHIP ".concat(e," {\n  IN in;\n  OUT out;\n  PARTS:\n}")}function isBuiltinOnly(e){return Object.values(X.BUILTIN_CHIP_PROJECTS).flat().includes(e)}function getBuiltinCode(e,t){var n=function getTemplate(e,t){return isBuiltinOnly(t)?X.ChipProjects[e].BUILTIN_CHIPS[t]:X.ChipProjects[e].CHIPS[t]["".concat(t,".hdl")]}(e,t);if(isBuiltinOnly(t))return n;var i="//// Replace this comment with your code.",r="BUILTIN ".concat(t,";");return n.includes(i)?n.replace(i,r):n.replace("PARTS:","PARTS:\n    ".concat(r))}function reduceChip(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{clocked:e.clocked,inPins:reducePins(e.ins),outPins:reducePins(e.outs),internalPins:reducePins(e.pins),chip:[e],pending:t,invalid:n}}var te=G.S.get();function makeChipStore(e,t,n,i){var r=function findDropdowns(e){var t,n,i=null!==(t=e["/chip/project"])&&void 0!==t?t:"01";return{project:i,chips:getChips(i),chipName:null!==(n=e["/chip/chip"])&&void 0!==n?n:X.CHIP_PROJECTS[i][0]}}(n),a=r.project,s=r.chipName,l=r.chips,c=new C.P9,p=new Y.l1,h=!1,v=!1,m={setFiles:function setFiles(e,t){var n=t.hdl,i=void 0===n?e.files.hdl:n,r=t.tst,a=void 0===r?e.files.tst:r,s=t.cmp,l=void 0===s?e.files.cmp:s,c=t.out,o=void 0===c?"":c;e.files.hdl=i,e.files.tst=a,e.files.cmp=l,e.files.out=o},updateChip:function updateChip(e,t){var n,i,r,a,l,o;e.sim=reduceChip(c,null!==(n=null===t||void 0===t?void 0:t.pending)&&void 0!==n?n:e.sim.pending,null!==(i=null===t||void 0===t?void 0:t.invalid)&&void 0!==i?i:e.sim.invalid),e.controls.error=e.sim.invalid?null!==(r=null===t||void 0===t?void 0:t.error)&&void 0!==r?r:e.controls.error:"",e.controls.chips=getChips(e.controls.project),e.controls.chipName=e.sim.invalid?null!==(a=null===t||void 0===t?void 0:t.chipName)&&void 0!==a?a:s:null!==(l=null!==(o=c.name)&&void 0!==o?o:null===t||void 0===t?void 0:t.chipName)&&void 0!==l?l:s,e.controls.chips.includes(e.controls.chipName)||(e.controls.chips=[].concat((0,f.Z)(e.controls.chips),[e.controls.chipName]))},setProject:function setProject(e,t){var n=getChips(t),i=e.controls.chipName&&n.includes(e.controls.chipName)?e.controls.chipName:n[0];e.controls.project=t,e.controls.chips=n,this.setChip(e,i)},setChip:function setChip(e,t){e.controls.chipName=t,e.controls.hasBuiltin=g.zZ.has(t),e.controls.builtinOnly=isBuiltinOnly(t)},testRunning:function testRunning(e){e.controls.runningTest=!0},testFinished:function testFinished(e){e.controls.runningTest=!1;var n=function compare(e,t){var n=Q.lA.parse(e),i=Q.lA.parse(t);if((0,B.dZ)(n)||(0,B.dZ)(i))return!1;for(var r=(0,B.Ok)(n),a=(0,B.Ok)(i),s=0;s<Math.min(r.length,a.length);s++)for(var l,c,o=null!==(l=r[s])&&void 0!==l?l:[],u=null!==(c=a[s])&&void 0!==c?c:[],d=0;d<Math.max(o.length,u.length);d++){var p,h,f=null!==(p=o[d])&&void 0!==p?p:"",v=null!==(h=u[d])&&void 0!==h?h:"";if(null===(null===f||void 0===f?void 0:f.trim().match(/^\*+$/))&&(null===v||void 0===v?void 0:v.trim())!==(null===f||void 0===f?void 0:f.trim()))return!1}return!0}(e.files.cmp.trim(),e.files.out.trim());t(n?"Simulation successful: The output file is identical to the compare file":"Simulation error: The output file differs from the compare file")},updateTestStep:function updateTestStep(e){var t,n,i,r;if(e.files.out=null!==(t=null===(n=p)||void 0===n?void 0:n.log())&&void 0!==t?t:"",null!==(i=p)&&void 0!==i&&null!==(r=i.currentStep)&&void 0!==r&&r.span)e.controls.span=p.currentStep.span;else if(p.done){var a=e.files.tst.length;e.controls.span={start:a-1,end:a}}this.updateChip(e,{pending:e.sim.pending,invalid:e.sim.invalid})}},x={setProject:function setProject(e){a=n["/chip/project"]=e,i.current({action:"setProject",payload:a}),this.setChip(X.CHIP_PROJECTS[a][0])},setChip:function setChip(e){var t=arguments,r=this;return(0,u.Z)((0,o.Z)().mark((function _callee(){var a,l;return(0,o.Z)().wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:if(l=t.length>1&&void 0!==t[1]?t[1]:null!==(a=n["/chip/project"])&&void 0!==a?a:"01",s=n["/chip/chip"]=e,i.current({action:"setChip",payload:s}),!(v=isBuiltinOnly(s))){c.next=8;break}return i.current({action:"setFiles",payload:{hdl:"",tst:"",cmp:""}}),r.useBuiltin(),c.abrupt("return");case 8:return c.next=10,r.loadChip(l,s);case 10:h&&r.useBuiltin();case 11:case"end":return c.stop()}}),_callee)})))()},reset:function reset(){G.S.get().reset(),c.reset(),p.reset(),i.current({action:"setFiles",payload:{}}),i.current({action:"updateChip"})},updateFiles:function updateFiles(e){var n=this;return(0,u.Z)((0,o.Z)().mark((function _callee2(){var r,a,s;return(0,o.Z)().wrap((function _callee2$(l){for(;;)switch(l.prev=l.next){case 0:if(r=e.hdl,a=e.tst,s=e.cmp,i.current({action:"setFiles",payload:{hdl:r,tst:a,cmp:s}}),l.prev=2,!r){l.next=6;break}return l.next=6,n.compileChip(r);case 6:a&&n.compileTest(a),l.next=12;break;case 9:l.prev=9,l.t0=l.catch(2),t((0,L.j)(l.t0));case 12:case"end":return l.stop()}}),_callee2,null,[[2,9]])})))()},compileChip:function compileChip(e){var n=this;return(0,u.Z)((0,o.Z)().mark((function _callee3(){var r,a,s;return(0,o.Z)().wrap((function _callee3$(l){for(;;)switch(l.prev=l.next){case 0:if(c.remove(),r=q.Gq.parse(e),!(0,B.dZ)(r)){l.next=6;break}return t("Failed to parse chip"),i.current({action:"updateChip",payload:{invalid:!0,error:(0,L.j)((0,B.UG)(r))}}),l.abrupt("return");case 6:return l.next=8,(0,$.J_)((0,B.Ok)(r));case 8:if(a=l.sent,!(0,B.dZ)(a)){l.next=14;break}return s=(0,L.j)((0,B.UG)(a)),t(s),i.current({action:"updateChip",payload:{invalid:!0,error:s}}),l.abrupt("return");case 14:t("Compiled ".concat(c.name)),n.replaceChip((0,B.Ok)(a));case 16:case"end":return l.stop()}}),_callee3)})))()},replaceChip:function replaceChip(e){var t,n=c.ins,r=(0,O.Z)(n);try{for(r.s();!(t=r.n()).done;){var a=(0,d.Z)(t.value,2),s=a[0],l=a[1].busVoltage,o=e.ins.get(s);o&&(o.busVoltage=l)}}catch(u){r.e(u)}finally{r.f()}te.reset(),e.eval(),(c=e).reset(),p=p.with(c).reset(),i.current({action:"updateChip",payload:{invalid:!1}}),i.current({action:"updateTestStep"})},loadChip:function loadChip(t,r){var a=this;return(0,u.Z)((0,o.Z)().mark((function _callee4(){var s,l,c,u,p,h;return(0,o.Z)().wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return n["/chip/chip"]=r,s=function fsName(e){return"/projects/".concat(t,"/").concat(r,"/").concat(r,".").concat(e)},o.next=4,Promise.all([e.readFile(s("hdl")).catch((function(){return makeHdl(r)})),e.readFile(s("tst")).catch((function(e){return"repeat 10 {\n  tick,\n  tock;\n}"})),e.readFile(s("cmp")).catch((function(){return"| in|out|"}))]);case 4:return l=o.sent,c=(0,d.Z)(l,3),u=c[0],p=c[1],h=c[2],i.current({action:"setFiles",payload:{hdl:u,tst:p,cmp:h}}),o.next=12,a.compileChip(u);case 12:a.compileTest(p);case 13:case"end":return o.stop()}}),_callee4)})))()},saveChip:function saveChip(n){var r=arguments;return(0,u.Z)((0,o.Z)().mark((function _callee5(){var l,c,u;return(0,o.Z)().wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return l=r.length>1&&void 0!==r[1]?r[1]:a,c=r.length>2&&void 0!==r[2]?r[2]:s,i.current({action:"setFiles",payload:{hdl:n}}),u="/projects/".concat(l,"/").concat(c,"/").concat(c,".hdl"),o.next=6,e.writeFile(u,n);case 6:t("Saved ".concat(u));case 7:case"end":return o.stop()}}),_callee5)})))()},toggle:function toggle(e,t){void 0!==t?e.busVoltage=e.busVoltage^1<<t:1===e.width?e.toggle():e.busVoltage+=1,i.current({action:"updateChip",payload:{pending:!0}})},eval:function _eval(){c.eval(),i.current({action:"updateChip",payload:{pending:!1}})},clock:function clock(){te.toggle(),te.isLow&&te.frame(),i.current({action:"updateChip"})},useBuiltin:function useBuiltin(){var e=arguments,n=this;return(0,u.Z)((0,o.Z)().mark((function _callee6(){var r,l,c,u,d;return(0,o.Z)().wrap((function _callee6$(o){for(;;)switch(o.prev=o.next){case 0:if(r=!(e.length>0&&void 0!==e[0])||e[0],l=e.length>1?e[1]:void 0,r){o.next=7;break}return v||(h=!1),o.next=6,n.loadChip(a,s);case 6:return o.abrupt("return");case 7:if(v||(h=!0),c=s,u=(0,g.cT)(c),!(0,B.dZ)(u)){o.next=13;break}return t("Failed to load builtin ".concat(c,": ").concat((0,L.j)((0,B.UG)(u)))),o.abrupt("return");case 13:if(!l){o.next=16;break}return o.next=16,n.saveChip(l,a,s);case 16:d=getBuiltinCode(a,c),i.current({action:"setFiles",payload:{hdl:d}}),n.replaceChip((0,B.Ok)(u));case 19:case"end":return o.stop()}}),_callee6)})))()},initialize:function initialize(){var e=this;return(0,u.Z)((0,o.Z)().mark((function _callee7(){return(0,o.Z)().wrap((function _callee7$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setChip(s,a);case 2:case"end":return t.stop()}}),_callee7)})))()},compileTest:function compileTest(n){i.current({action:"setFiles",payload:{tst:n}});var r=K.qH.parse(n);return(0,B.dZ)(r)?(t("Failed to parse test"),!1):(t("Parsed tst"),(p=Y.l1.from((0,B.Ok)(r)).with(c).reset()).setFileSystem(e),i.current({action:"updateTestStep"}),!0)},runTest:function runTest(t){var n=this;return(0,u.Z)((0,o.Z)().mark((function _callee8(){return(0,o.Z)().wrap((function _callee8$(r){for(;;)switch(r.prev=r.next){case 0:if(n.compileTest(t)){r.next=2;break}return r.abrupt("return");case 2:return i.current({action:"testRunning"}),e.pushd("/samples"),r.next=6,p.run();case 6:e.popd(),i.current({action:"updateTestStep"}),i.current({action:"testFinished"});case 9:case"end":return r.stop()}}),_callee8)})))()},tick:function tick(){return this.stepTest()},stepTest:function stepTest(){(0,S.hu)(p.chipId===c.id,"Test and chip out of sync");var e=p.step();return i.current({action:"updateTestStep"}),e&&i.current({action:"testFinished"}),e}};return{initialState:function(){var e={project:a,chips:l,chipName:s,hasBuiltin:g.zZ.has(s),builtinOnly:isBuiltinOnly(s),runningTest:!1,error:""},n=(0,g.cT)(e.chipName);return(0,B.dZ)(n)?(t((0,L.j)((0,B.UG)(n))),c=new C.P9):c=(0,B.Ok)(n),{controls:e,files:{hdl:"",cmp:"",tst:"",out:""},sim:reduceChip(c)}}(),reducers:m,actions:x}}var ne=n(8923),ie=n(8016),re=n(659),ae=n(1539),se=n(1124),le=function Chip(){var e=(0,h.useContext)(J.r),t=e.fs,n=e.setStatus,m=(0,h.useContext)(ie.Il),g=m.filePicker,x=m.tracking,b=function useChipPageStore(){var e=(0,h.useContext)(J.r),t=e.fs,n=e.setStatus,i=e.storage,r=(0,h.useRef)((function(){})),a=(0,h.useMemo)((function(){return makeChipStore(t,n,i,r)}),[t,n,i,r]),s=a.initialState,l=a.reducers,c=a.actions,o=(0,U.C)(l,s),u=(0,d.Z)(o,2),p=u[0],f=u[1];return r.current=f,{state:p,dispatch:r,actions:c}}(),C=b.state,j=b.actions,y=b.dispatch,k=(0,U.i)(C.files.hdl),Z=(0,d.Z)(k,2),w=Z[0],P=Z[1],S=(0,U.i)(C.files.tst),I=(0,d.Z)(S,2),T=I[0],N=I[1],O=(0,U.i)(C.files.cmp),R=(0,d.Z)(O,2),B=R[0],D=R[1],M=(0,U.i)(C.files.out),V=(0,d.Z)(M,1)[0];(0,h.useEffect)((function(){j.initialize()}),[j]),(0,h.useEffect)((function(){x.trackPage("/chip")}),[x]);(0,h.useEffect)((function(){x.trackEvent("action","setProject",C.controls.project),x.trackEvent("action","setChip",C.controls.chipName)}),[]);var z=(0,h.useCallback)((function(e){j.setProject(e),x.trackEvent("action","setProject",e)}),[j,x]),L=(0,h.useCallback)((function(e){j.setChip(e),x.trackEvent("action","setChip",e),be.reset()}),[j,x]),$=(0,h.useCallback)((function(){j.eval(),x.trackEvent("action","eval")}),[j,x]),G=(0,h.useRef)((function(){}));G.current=(0,u.Z)((0,o.Z)().mark((function _callee(){var e,t,n,i=arguments;return(0,o.Z)().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return n=i.length>0&&void 0!==i[0]?i[0]:{},r.next=3,j.updateFiles({hdl:n.hdl,tst:null!==(e=n.tst)&&void 0!==e?e:T,cmp:null!==(t=n.cmp)&&void 0!==t?t:B});case 3:case"end":return r.stop()}}),_callee)})));var X=(0,h.useCallback)((0,u.Z)((0,o.Z)().mark((function _callee2(){var e,i;return(0,o.Z)().wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,g.select();case 3:return e=r.sent,r.next=6,t.readFile(e);case 6:return i=r.sent,r.next=9,G.current({tst:i});case 9:r.next=15;break;case 11:r.prev=11,r.t0=r.catch(0),console.error(r.t0),n("Failed to load into memory");case 15:case"end":return r.stop()}}),_callee2,null,[[0,11]])}))),[g,n,t,G]),Y=(0,h.useRef)();(0,h.useEffect)((function(){return Y.current=new(function(e){(0,l.Z)(ChipTimer,e);var t=(0,c.Z)(ChipTimer);function ChipTimer(){return(0,i.Z)(this,ChipTimer),t.apply(this,arguments)}return(0,r.Z)(ChipTimer,[{key:"reset",value:function(){var e=(0,u.Z)((0,o.Z)().mark((function _callee3(){return(0,o.Z)().wrap((function _callee3$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G.current();case 2:return e.next=4,j.reset();case 4:case"end":return e.stop()}}),_callee3)})));return function reset(){return e.apply(this,arguments)}}()},{key:"finishFrame",value:function finishFrame(){(0,a.Z)((0,s.Z)(ChipTimer.prototype),"finishFrame",this).call(this),y.current({action:"updateTestStep"})}},{key:"tick",value:function tick(){return j.stepTest()}},{key:"toggle",value:function toggle(){y.current({action:"updateTestStep"})}}]),ChipTimer}(ne.B)),function(){var e;null===(e=Y.current)||void 0===e||e.stop()}}),[G,j,y]);var te=(0,h.useMemo)((function(){return{toggle:function toggle(){j.clock(),x.trackEvent("action","toggleClock")},reset:function reset(){x.trackEvent("action","resetClock"),j.reset()}}}),[j]),le=(0,h.useState)(!1),ce=(0,d.Z)(le,2),oe=ce[0],ue=ce[1],de=(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)("fieldset",{role:"group",children:[(0,v.jsx)("select",{value:C.controls.project,onChange:function onChange(e){var t=e.target.value;z(t)},"data-testid":"project-picker",children:ee.map((function(e){var t=(0,d.Z)(e,2),n=t[0],i=t[1];return(0,v.jsx)("option",{value:n,children:i},n)}))}),(0,v.jsx)("select",{value:C.controls.chipName,onChange:function onChange(e){var t=e.target.value;L(t)},"data-testid":"chip-picker",children:C.controls.chips.map((function(e){return(0,v.jsx)("option",{value:e,style:isBuiltinOnly(e)?{color:"rgb(170, 170, 170)"}:{},children:"".concat(e," ").concat(isBuiltinOnly(e)?"(given)":"")},e)}))}),(0,v.jsx)("button",{className:"flex-0",onClick:function saveChip(){j.saveChip(w)},disabled:oe,children:(0,v.jsx)(p.cC,{id:"Save"})})]})}),pe=(0,v.jsx)(se.s,{className:"_hdl_panel",header:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{tabIndex:0,children:"HDL"}),(0,v.jsx)("fieldset",{children:C.controls.hasBuiltin&&!C.controls.builtinOnly&&(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"checkbox",role:"switch",checked:oe,onChange:function toggleUseBuiltin(){oe?(ue(!1),j.useBuiltin(!1)):(ue(!0),j.useBuiltin(!0,w)),be.reset()}}),(0,v.jsx)(p.cC,{id:"Builtin"})]})}),de]}),children:(0,v.jsx)(ae.M,{className:"flex-1",value:w,onChange:function onChange(e){P(e),G.current(oe||C.controls.builtinOnly?{}:{hdl:e})},grammar:q.Gq.parser,language:"hdl",disabled:oe||C.controls.builtinOnly})}),he=(0,h.useState)(!0),fe=(0,d.Z)(he,2),ve=fe[0],me=fe[1],ge=(0,v.jsxs)("fieldset",{role:"group",children:[(0,v.jsx)("button",{onClick:$,onKeyDown:$,disabled:!C.sim.pending||!ve,children:(0,v.jsx)(p.cC,{id:"Eval"})}),(0,v.jsxs)("button",{onClick:te.toggle,style:{maxWidth:"initial"},disabled:!C.sim.clocked,children:[(0,v.jsx)(p.cC,{id:"Clock"}),":","\xa0",(0,v.jsx)(_.uY,{})]}),(0,v.jsx)("button",{onClick:te.reset,style:{maxWidth:"initial"},disabled:!C.sim.clocked,children:(0,v.jsx)(p.cC,{id:"Reset"})})]}),xe=function makeVisualizationsWithId(e,t){return(0,f.Z)(e.parts).map((function(e,n){return["".concat(e.id,"_").concat(n),makeVisualization(e,t)]})).filter((function(e){var t=(0,d.Z)(e,2);return t[0],void 0!==t[1]}))}({parts:C.sim.chip},(function(){y.current({action:"updateChip"})})),be=new H,Ce=(0,v.jsx)(se.s,{className:"_parts_panel",header:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{children:[(0,v.jsx)(p.cC,{id:"Chip"})," ",C.controls.chipName]}),ge]}),children:C.sim.invalid?(0,v.jsx)(p.cC,{id:"Syntax errors in the HDL code"}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(A.Provider,{value:be,children:(0,v.jsx)(E,{sim:C.sim,toggle:j.toggle,setInputValid:me,hideInternal:C.controls.builtinOnly||oe})}),xe.length>0&&(0,v.jsx)(se.G,{summary:(0,v.jsx)(p.cC,{id:"Visualization"}),open:!0,children:(0,v.jsx)("main",{children:xe.map((function(e){var t=(0,d.Z)(e,2);t[0];return t[1]}))})})]})}),je=(0,h.useState)("tst"),ye=(0,d.Z)(je,2),ke=ye[0],Ze=ye[1],we=(0,h.useCallback)((function(e){Ze(e),x.trackEvent("tab","change",e)}),[x]),Pe=(0,v.jsx)(se.s,{className:"_test_panel",header:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"flex-1",children:(0,v.jsx)(p.cC,{id:"Test"})}),(0,v.jsx)("div",{className:"flex-2",children:Y.current&&(0,v.jsx)(W.D,{runner:Y.current})}),(0,v.jsx)("div",{children:(0,v.jsxs)("button",{onClick:X,children:[(0,v.jsx)(re.J,{name:"upload_file"})," "]})})]}),children:(0,v.jsxs)("div",{role:"tablist",style:{"--tab-count":"3"},children:[(0,v.jsx)("div",{role:"tab",id:"test-tab-tst","aria-controls":"test-tabpanel-tst","aria-selected":"tst"===ke,children:(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-tst",value:"tst",checked:"tst"===ke,onChange:function onChange(){return we("tst")}}),"Test Script"]})}),(0,v.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-tst",id:"test-tabpanel-tst",children:(0,v.jsx)(ae.M,{value:T,onChange:N,grammar:K.qH.parser,language:"tst",highlight:C.controls.span,disabled:C.controls.builtinOnly})}),(0,v.jsx)("div",{role:"tab",id:"test-tab-cmp","aria-controls":"test-tablpanel-cmp","aria-selected":"cmp"===ke,children:(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-cmp",value:"cmp",checked:"cmp"===ke,onChange:function onChange(){return we("cmp")}}),"Compare File"]})}),(0,v.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-cmp",id:"test-tabpanel-cmp",style:{position:"relative"},children:(0,v.jsx)(ae.M,{value:B,onChange:D,grammar:Q.lA.parser,language:"cmp",disabled:C.controls.builtinOnly})}),(0,v.jsx)("div",{role:"tab",id:"test-tab-out","aria-controls":"test-tabpanel-out","aria-selected":"out"===ke,children:(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-out",value:"out",checked:"out"===ke,onChange:function onChange(){return we("out")}}),"Output File"]})}),(0,v.jsx)("div",{role:"tabpanel",id:"test-tabpanel-out","aria-labelledby":"test-tab-out",children:(0,v.jsx)(F.M,{cmp:B,out:V})})]})});return(0,v.jsxs)("div",{className:"ChipPage grid",children:[pe,Ce,Pe]})},ce=le}}]);
//# sourceMappingURL=466.0787d04c.chunk.js.map