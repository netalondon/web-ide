"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[255],{9811:function(t,e,n){n.r(e),n.d(e,{CPU:function(){return T},default:function(){return B}});var r=n(2951),s=n(1976),a=n(7591),i=n(4337),c=n(1026),u=n(8923),l=n(3052),o=n(9613),d=n(2277),p=n(1092),h=n(7791),f=n(7169),v=n(3243),x=n(7597),m=n(4649),b=n(5838),j=new Int16Array([2,55944,0,64528,15,54018,1,64528,2,61584,54024,0,64648,2,55943,15,55943]),g=n(3389),k=n(6167),Z=n(7559),y=n(8698),C=function(t){(0,a.Z)(n,t);var e=(0,i.Z)(n);function n(t,s){var a;return(0,r.Z)(this,n),a=e.call(this,t,t.size,0),(0,m.Z)((0,f.Z)(a),"dispatch",void 0),a.dispatch=s,a}return(0,s.Z)(n,[{key:"load",value:function(){var t=(0,h.Z)((0,p.Z)().mark((function t(e,r){return(0,p.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,v.Z)((0,x.Z)(n.prototype),"load",this).call(this,e,r);case 2:this.dispatch.current({action:"update"});case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}]),n}(b.kG);function R(t,e){var n=new C(t.cpu.RAM,e),r=new C(t.cpu.ROM,e),s=new C(t.cpu.Screen,e),a=new b.qT(new C(t.cpu.RAM,e));return{A:t.cpu.A,D:t.cpu.D,PC:t.cpu.PC,RAM:n,ROM:r,Screen:s,Keyboard:a}}function w(){var t=(0,k.useContext)(y.r),e=t.fs,n=t.setStatus,r=t.storage,s=(0,k.useRef)((function(){})),a=(0,k.useMemo)((function(){return function(t,e,n,r){var s,a=new g.o6(new b.eD(j)),i={update:function(t){var e;t.sim=R(a,r),t.test.highlight=null===(e=a.currentStep)||void 0===e?void 0:e.span}},c={tick:function(){a.cpu.tick()},testStep:function(){a.step()},resetRAM:function(){a.cpu.RAM.loadBytes([]),r.current({action:"update"}),e("Reset RAM")},toggleUseTest:function(){r.current({action:"update"})},resetCPU:function(){a.reset(),r.current({action:"update"}),e("Reset CPU")},reset:function(){this.resetRAM(),this.resetCPU(),e("Reset CPU & RAM")}};return{initialState:{sim:R(a,r),test:{highlight:null===(s=a.currentStep)||void 0===s?void 0:s.span}},reducers:i,actions:c}}(0,n,0,s)}),[e,n,r,s]),i=a.initialState,u=a.reducers,l=a.actions,o=(0,Z.C)(u,i),d=(0,c.Z)(o,2),p=d[0],h=d[1];return s.current=h,{state:p,dispatch:s,actions:l}}var M=n(8061),A=n(8582),S=n(258),P=n(8365),D=n(9647),F=n(8016),N=n(1539),O=n(1124),U=n(7878),_=function(t){var e=t.runner,n=(0,c.Z)(t.tst,3),r=n[0],s=n[1],a=n[2],i=(0,c.Z)(t.cmp,2),u=i[0],l=i[1],o=(0,c.Z)(t.out,1)[0],d=t.disabled,f=void 0!==d&&d,v=(0,k.useContext)(y.r),x=v.fs,m=v.setStatus,b=(0,k.useContext)(F.Il),j=b.filePicker,g=b.tracking,Z=(0,k.useState)("tst"),C=(0,c.Z)(Z,2),R=C[0],w=C[1],_=(0,k.useCallback)((function(t){w(t),g.trackEvent("tab","change",t)}),[g]),T=(0,k.useCallback)((0,h.Z)((0,p.Z)().mark((function t(){var e,n;return(0,p.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,j.select();case 3:return e=t.sent,t.next=6,x.readFile(e);case 6:n=t.sent,s(n),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.error(t.t0),m("Failed to load test");case 14:case"end":return t.stop()}}),t,null,[[0,10]])}))),[j,m,x]);return(0,U.jsx)(O.s,{className:"_test_panel",header:(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)("div",{className:"flex-0",children:(0,U.jsx)(M.cC,{id:"Test"})}),(0,U.jsx)("div",{className:"flex-1",children:e.current&&(0,U.jsx)(S.D,{runner:e.current})}),(0,U.jsx)("div",{children:(0,U.jsx)("fieldset",{role:"group",children:(0,U.jsx)("button",{onClick:T,children:"\ud83d\udcc2"})})})]}),children:(0,U.jsxs)("div",{role:"tablist",style:{"--tab-count":"3"},children:[(0,U.jsx)("div",{role:"tab",id:"test-tab-tst","aria-controls":"test-tabpanel-tst","aria-selected":"tst"===R,children:(0,U.jsxs)("label",{children:[(0,U.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-tst",value:"tst",checked:"tst"===R,onChange:function(){return _("tst")}}),"Test Script"]})}),(0,U.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-tst",id:"test-tabpanel-tst",children:(0,U.jsx)(N.M,{value:r,onChange:s,grammar:D.qH.parser,language:"tst",highlight:a,disabled:f})}),(0,U.jsx)("div",{role:"tab",id:"test-tab-cmp","aria-controls":"test-tablpanel-cmp","aria-selected":"cmp"===R,children:(0,U.jsxs)("label",{children:[(0,U.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-cmp",value:"cmp",checked:"cmp"===R,onChange:function(){return _("cmp")}}),"Compare File"]})}),(0,U.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-cmp",id:"test-tabpanel-cmp",style:{position:"relative"},children:(0,U.jsx)(N.M,{value:u,onChange:l,grammar:P.lA.parser,language:"cmp",disabled:f})}),(0,U.jsx)("div",{role:"tab",id:"test-tab-out","aria-controls":"test-tabpanel-out","aria-selected":"out"===R,children:(0,U.jsxs)("label",{children:[(0,U.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-out",value:"out",checked:"out"===R,onChange:function(){return _("out")}}),"Output File"]})}),(0,U.jsx)("div",{role:"tabpanel",id:"test-tabpanel-out","aria-labelledby":"test-tab-out",children:(0,U.jsx)(A.M,{cmp:u,out:o})})]})})},T=function(){var t=w(),e=t.state,n=t.actions,p=t.dispatch,h=(0,k.useState)("repeat {\n\tticktock;\n}"),f=(0,c.Z)(h,2),v=f[0],x=f[1],m=(0,k.useState)(""),b=(0,c.Z)(m,2),j=b[0],g=b[1],Z=(0,k.useState)(""),y=(0,c.Z)(Z,2),C=y[0],R=y[1],M=(0,k.useRef)(),A=(0,k.useRef)();return(0,k.useEffect)((function(){return M.current=new(function(t){(0,a.Z)(c,t);var e=(0,i.Z)(c);function c(){return(0,r.Z)(this,c),e.apply(this,arguments)}return(0,s.Z)(c,[{key:"tick",value:function(){return n.tick(),!1}},{key:"finishFrame",value:function(){p.current({action:"update"})}},{key:"reset",value:function(){n.reset()}},{key:"toggle",value:function(){p.current({action:"update"})}}]),c}(u.B)),A.current=new(function(t){(0,a.Z)(c,t);var e=(0,i.Z)(c);function c(){return(0,r.Z)(this,c),e.apply(this,arguments)}return(0,s.Z)(c,[{key:"tick",value:function(){return n.testStep(),!1}},{key:"finishFrame",value:function(){p.current({action:"update"})}},{key:"reset",value:function(){n.reset()}},{key:"toggle",value:function(){p.current({action:"update"})}}]),c}(u.B)),function(){var t,e;null===(t=M.current)||void 0===t||t.stop(),null===(e=A.current)||void 0===e||e.stop()}}),[n,p]),(0,U.jsxs)("div",{className:"CpuPage grid",children:[(0,U.jsx)(l.ZP,{name:"ROM",memory:e.sim.ROM,highlight:e.sim.PC,format:"asm"}),(0,U.jsx)(l.ZP,{name:"RAM",memory:e.sim.RAM,format:"hex"}),(0,U.jsxs)(O.s,{className:"IO",children:[(0,U.jsx)("div",{children:M.current&&(0,U.jsx)(S.D,{runner:M.current})}),(0,U.jsx)(o.l,{memory:e.sim.Screen}),(0,U.jsx)(d.N,{keyboard:e.sim.Keyboard}),(0,U.jsx)("div",{children:(0,U.jsxs)("dl",{children:[(0,U.jsx)("dt",{children:"PC"}),(0,U.jsx)("dd",{children:e.sim.PC}),(0,U.jsx)("dt",{children:"A"}),(0,U.jsx)("dd",{children:e.sim.A}),(0,U.jsx)("dt",{children:"D"}),(0,U.jsx)("dd",{children:e.sim.D})]})})]}),(0,U.jsx)(_,{runner:A,tst:[v,x,e.test.highlight],out:[j,g],cmp:[C,R]})]})},B=T}}]);
//# sourceMappingURL=255.54d77ff3.chunk.js.map