"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[255],{9811:(t,e,s)=>{s.r(e),s.d(e,{CPU:()=>A,default:()=>P});var a=s(8061),r=s(8923),n=s(2277),i=s(3052),c=s(9613),l=s(4625),o=s(5838),d=s(9647);const u=new Int16Array([2,55944,0,64528,15,54018,1,64528,2,61584,54024,0,64648,2,55943,15,55943]);var p=s(3389),h=s(6167),m=s(7746),x=s(7559),b=s(8698);class j extends o.kG{dispatch;constructor(t,e){super(t,t.size,0),this.dispatch=e}async load(t,e){await super.load(t,e),this.dispatch.current({action:"update"})}}function g(t,e){const s=new j(t.cpu.RAM,e),a=new j(t.cpu.ROM,e),r=new j(t.cpu.Screen,e),n=new o.qT(new j(t.cpu.RAM,e));return{A:t.cpu.A,D:t.cpu.D,PC:t.cpu.PC,RAM:s,ROM:a,Screen:r,Keyboard:n}}function f(){const{fs:t,setStatus:e,storage:s}=(0,h.useContext)(b.r),a=(0,h.useRef)((()=>{})),{initialState:r,reducers:n,actions:i}=(0,h.useMemo)((()=>function(t,e,s,a){let r=new p.o6(new o.eD(u));const n={update(t){t.sim=g(r,a),t.test.highlight=r.currentStep?.span},setTest(t,e){let{tst:s,cmp:a}=e;t.test.tst=s??t.test.tst,t.test.cmp=a??t.test.cmp,t.test.out=""},testStep(t){t.test.out=r.log(),this.update(t)},testFinished(t){const s=(0,m.q)(t.test.cmp.trim(),r.log().trim());e(s?"Simulation successful: The output file is identical to the compare file":"Simulation error: The output file differs from the compare file")}},i={tick(){r.cpu.tick()},testStep(){const t=r.step();return a.current({action:"testStep"}),t&&a.current({action:"testFinished"}),t},resetRAM(){r.cpu.RAM.loadBytes([]),a.current({action:"update"}),e("Reset RAM")},toggleUseTest(){a.current({action:"update"})},resetCPU(){r.reset(),a.current({action:"setTest",payload:{}}),a.current({action:"update"}),e("Reset CPU")},reset(){this.resetCPU(),e("Reset CPU & RAM")},compileTest(t,s){a.current({action:"setTest",payload:{tst:t,cmp:s}});const n=d.qH.parse(t);return(0,l.dZ)(n)?(e("Failed to parse test"),!1):(e("Parsed tst"),r=p.o6.from((0,l.Ok)(n),r.cpu.ROM),a.current({action:"update"}),!0)},initialize(){this.compileTest("repeat {\n  ticktock;\n}")}};return{initialState:{sim:g(r,a),test:{highlight:r.currentStep?.span,tst:"",cmp:"",out:""}},reducers:n,actions:i}}(0,e,0,a)),[t,e,s,a]),[c,j]=(0,x.C)(n,r);return a.current=j,{state:c,dispatch:a,actions:i}}var C=s(258),v=s(1124),y=s(8582),k=s(8365),S=s(8016),R=s(1539),w=s(7878);const M=t=>{let{runner:e,tst:[s,r,n],cmp:[i,c],out:[l],disabled:o=!1,onLoadTest:u}=t;const{fs:p,setStatus:m}=(0,h.useContext)(b.r),{filePicker:x,tracking:j}=(0,h.useContext)(S.Il),[g,f]=(0,h.useState)("tst"),M=(0,h.useCallback)((t=>{f(t),j.trackEvent("tab","change",t)}),[j]),A=(0,h.useCallback)((async()=>{try{const t=await x.select(),e=await p.readFile(t),s=await p.readFile(t.replace(/\.tst$/,".cmp"));null===u||void 0===u||u(e,s)}catch(t){console.error(t),m("Failed to load test")}}),[x,m,p]);return(0,w.jsx)(v.s,{className:"_test_panel",header:(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{className:"flex-0",children:(0,w.jsx)(a.cC,{id:"Test"})}),(0,w.jsx)("div",{className:"flex-1",children:e.current&&(0,w.jsx)(C.D,{runner:e.current})}),(0,w.jsx)("div",{children:(0,w.jsx)("fieldset",{role:"group",children:(0,w.jsx)("button",{onClick:A,children:"\ud83d\udcc2"})})})]}),children:(0,w.jsxs)("div",{role:"tablist",style:{"--tab-count":"3"},children:[(0,w.jsx)("div",{role:"tab",id:"test-tab-tst","aria-controls":"test-tabpanel-tst","aria-selected":"tst"===g,children:(0,w.jsxs)("label",{children:[(0,w.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-tst",value:"tst",checked:"tst"===g,onChange:()=>M("tst")}),"Test Script"]})}),(0,w.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-tst",id:"test-tabpanel-tst",children:(0,w.jsx)(R.M,{value:s,onChange:r,grammar:d.qH.parser,language:"tst",highlight:n,disabled:o})}),(0,w.jsx)("div",{role:"tab",id:"test-tab-cmp","aria-controls":"test-tablpanel-cmp","aria-selected":"cmp"===g,children:(0,w.jsxs)("label",{children:[(0,w.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-cmp",value:"cmp",checked:"cmp"===g,onChange:()=>M("cmp")}),"Compare File"]})}),(0,w.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-cmp",id:"test-tabpanel-cmp",style:{position:"relative"},children:(0,w.jsx)(R.M,{value:i,onChange:c,grammar:k.lA.parser,language:"cmp",disabled:o})}),(0,w.jsx)("div",{role:"tab",id:"test-tab-out","aria-controls":"test-tabpanel-out","aria-selected":"out"===g,children:(0,w.jsxs)("label",{children:[(0,w.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-out",value:"out",checked:"out"===g,onChange:()=>M("out")}),"Output File"]})}),(0,w.jsx)("div",{role:"tabpanel",id:"test-tabpanel-out","aria-labelledby":"test-tab-out",children:(0,w.jsx)(y.M,{cmp:i,out:l})})]})})},A=()=>{const{state:t,actions:e,dispatch:s}=f(),[l,o]=(0,x.i)(t.test.tst),[d,u]=(0,x.i)(t.test.out),[p,m]=(0,x.i)(t.test.cmp),[b,j]=(0,h.useState)(null),[g,y]=(0,h.useState)(!0),[k,S]=(0,h.useState)(0);(0,h.useEffect)((()=>{e.initialize()}),[e]);const R=(0,h.useRef)(),A=(0,h.useRef)(),[P,T]=(0,h.useState)(!1);(0,h.useEffect)((()=>(R.current=new class extends r.B{tick(){return e.tick(),!1}finishFrame(){s.current({action:"update"})}reset(){e.reset()}toggle(){s.current({action:"update"})}},A.current=new class extends r.B{tick(){return e.testStep()}finishFrame(){s.current({action:"update"})}reset(){e.reset()}toggle(){s.current({action:"update"})}},T(!0),()=>{var t,e;null===(t=R.current)||void 0===t||t.stop(),null===(e=A.current)||void 0===e||e.stop()})),[e,s]);return(0,w.jsxs)("div",{className:"CpuPage grid",children:[(0,w.jsx)(i.ZP,{name:"ROM",displayEnabled:g,memory:t.sim.ROM,highlight:t.sim.PC,format:"asm",onUpload:t=>{j(t),e.reset()}}),(0,w.jsx)(i.ZP,{name:"RAM",displayEnabled:g,memory:t.sim.RAM,format:"hex",onChange:()=>{S(k+1)}}),(0,w.jsxs)(v.s,{className:"IO",header:(0,w.jsxs)(w.Fragment,{children:[b&&(0,w.jsx)("div",{className:"flex-0",children:b}),(0,w.jsx)("div",{className:"flex-1",children:P&&R.current&&(0,w.jsx)(C.D,{runner:R.current})})]}),children:[(0,w.jsx)(c.l,{memory:t.sim.Screen},k),(0,w.jsx)(n.N,{update:()=>{s.current({action:"update"})},keyboard:t.sim.Keyboard}),(0,w.jsxs)("label",{children:[(0,w.jsx)("input",{type:"checkbox",role:"switch",checked:g,onChange:()=>{y(!g)}}),(0,w.jsx)(a.cC,{id:"{0}",values:{0:g?"Disable display":"Enable display"}})]}),g&&(0,w.jsx)("div",{children:(0,w.jsxs)("dl",{children:[(0,w.jsx)("dt",{children:"PC"}),(0,w.jsx)("dd",{children:t.sim.PC}),(0,w.jsx)("dt",{children:"A"}),(0,w.jsx)("dd",{children:t.sim.A}),(0,w.jsx)("dt",{children:"D"}),(0,w.jsx)("dd",{children:t.sim.D})]})})]}),P&&(0,w.jsx)(M,{runner:A,tst:[l,o,t.test.highlight],out:[d,u],cmp:[p,m],onLoadTest:(t,s)=>{e.compileTest(t,s)}})]})},P=A}}]);
//# sourceMappingURL=255.e62e6c91.chunk.js.map