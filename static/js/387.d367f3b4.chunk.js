"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[387],{8582:(t,e,s)=>{s.d(e,{M:()=>c});var i=s(7878),n=s(8365),r=s(4408),a=s(1585),o=s(4625);const c=t=>{let{className:e="",out:s,cmp:c,zeroState:l}=t;const u=n.lA.parse(s),d=n.lA.parse(c);if((0,o.dZ)(u))return(0,i.jsxs)("details",{children:[(0,i.jsx)("summary",{children:"Failed to parse output"}),(0,i.jsx)("pre",{children:(0,r.j)((0,o.UG)(u))}),(0,i.jsx)("code",{children:(0,i.jsx)("pre",{children:s})})]});if((0,o.dZ)(d))return(0,i.jsxs)("details",{children:[(0,i.jsx)("summary",{children:"Failed to parse compare"}),(0,i.jsxs)("code",{children:[(0,i.jsx)("pre",{children:(0,r.j)((0,o.UG)(d))}),(0,i.jsx)("pre",{children:c})]})]});const p=(0,o.Ok)(d),m=(0,o.Ok)(u);let f=0;const g=(0,a.w)(0,Math.min(p.length,m.length)).map((t=>{const e=p[t]??[],s=m[t]??[];return(0,a.w)(0,Math.max(e.length,s.length)).map(((t,i)=>[e[i]??"",s[i]??""])).map((t=>{let[e,s]=t;const i={cmp:e??'"',out:s??'"',pass:null!==e?.trim().match(/^\*+$/)||s?.trim()===e?.trim()};return i.pass||(f+=1),i}))}));return(0,i.jsxs)("div",{className:"scroll-x "+e,children:[f>0&&(0,i.jsxs)("p",{children:[f," failure",1===f?"":"s"]}),g.length>0?(0,i.jsx)("table",{style:{fontFamily:"var(--font-family-monospace)",marginBottom:"none"},children:(0,i.jsx)("tbody",{children:g.map(((t,e)=>(0,i.jsx)("tr",{children:t.map(((t,e)=>{let{cmp:s,out:n,pass:r}=t;return(0,i.jsx)(h,{cmp:s,out:n,pass:r},e)}))},e)))})}):l??(0,i.jsx)("p",{children:"Execute test script to compare output."})]})},h=t=>{let{cmp:e,out:s,pass:n}=t;return n?(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("td",{children:e})}):(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("td",{children:[(0,i.jsx)("ins",{children:e}),(0,i.jsx)("br",{}),(0,i.jsx)("del",{children:s})]})})}},4408:(t,e,s)=>{s.d(e,{j:()=>i});const i=t=>{if((t=>"function"===typeof t?.toString||"string"===typeof t)(t)){const e=t.toString();return"[object Object]"===e?JSON.stringify(t):e}return JSON.stringify(t)}},134:(t,e,s)=>{s.d(e,{Ff:()=>O,Jx:()=>v,Z9:()=>k,Zu:()=>r,aL:()=>x});var i=s(6693),n=s(5838);function r(){return{A:0,D:0,PC:0,ALU:0,flag:i.vU.Zero}}const a=32768,o=36864,c=36864,h=36864,l=4032,u=32800,d=32784,p=32776,m=32769,f=32770,g=32772;function v(t){function e(e){return(t&e)===e}return{c:e(a),x1:e(o),x2:e(c),am:e(h),op:(t&l)>>6,d1:e(u),d2:e(d),d3:e(p),j1:e(m),j2:e(f),j3:e(g)}}function x(t,e){let{inM:s,instruction:n}=t,{A:r,D:a,PC:o}=e;const c=v(n),h=c.am?s:r,[l,u]=(0,i.Bb)(c.op,a,h);return[{A:r,D:a,PC:o+1,ALU:l,flag:u},c.d3]}function O(t,e){let{inM:s,instruction:n,reset:r}=t,{A:a,D:o,PC:c,ALU:h,flag:l}=e;const u=v(n),d=u.j1&&l===i.vU.Positive,p=u.j2&&l===i.vU.Zero,m=u.j3&&l===i.vU.Negative;c=r?0:d||p||m?a:c,u.d2&&(o=h);const f=a;u.c?u.d1&&(a=h):a=32767&n;const g=u.am?s:a,x=(0,i.Bb)(u.op,o,g);h=x[0],l=x[1];return[{addressM:u.d3?f:a,outM:h,writeM:u.d3},{A:a,D:o,ALU:h,flag:l,PC:c}]}class k{RAM;ROM;Screen;Keyboard;#t=0;#e=0;#s=0;#i={A:0,D:0,PC:0,ALU:0,flag:i.vU.Zero};get state(){return this.#i}get PC(){return this.#t}get A(){return this.#e}get D(){return this.#s}setA(t){this.#e=t}setD(t){this.#s=t}setPC(t){this.#t=t}constructor(t){let{RAM:e=new n.FH,ROM:s}=t;this.RAM=e,this.ROM=s,this.Screen=new n.kG(this.RAM,n.yJ,n.GD),this.Keyboard=new n.qT(this.RAM)}reset(){this.#t=0,this.#e=0,this.#s=0}tick(){const[{addressM:t,outM:e,writeM:s},{A:n,D:r,PC:a}]=function(t,e){const[s,i]=x(t,e);return O(t,s)}({inM:this.RAM.get(this.#e),instruction:this.ROM.get(this.#t),reset:!1},{A:this.#e,D:this.#s,PC:this.#t,ALU:this.#s,flag:i.vU.Zero});this.#e=n,this.#s=r,this.#t=a,s&&this.RAM.set(t,e)}}},8365:(t,e,s)=>{s.d(e,{lA:()=>c});var i=s(5640),n=s(1510);const r="\nCmp <: Base {\n  Root := line*\n  line = bar cell+ newline?\n  cell = cellvalue bar\n  cellvalue = (~(bar|newline) any)*\n}",a=i.Z.grammar(r,n.y1),o=a.extendSemantics(n.rJ);o.addAttribute("cell",{cell:(t,e)=>t.sourceString}),o.addAttribute("line",{line:(t,e,s)=>e.children.map((t=>t.cell))}),o.addAttribute("root",{Root:t=>t.children.map((t=>t.line))});const c={grammar:r,semantics:o,parser:a,parse:(0,n.Pz)(a,o)}},9647:(t,e,s)=>{s.d(e,{qH:()=>c});var i=s(5640),n=s(1510);const r='\nTst <: Base {\n  Root := Tst\n  Tst = (TstStatement | TstRepeat | TstWhile)+\n\n  TstRepeat = Repeat Number? OpenBrace TstStatement+ CloseBrace\n  TstWhile = While Condition OpenBrace TstStatement+ CloseBrace\n  TstStatement = List<TstOperation, ","> (Semi | Bang)\n\n  TstOperation =\n    | TstFileOperation\n    | TstOutputListOperation\n    | TstEvalOperation\n    | TstSetOperation\n    | TstOutputOperation\n    | TstEchoOperation\n    | TstClearEchoOperation\n    | TstLoadROMOperation\n\n  TstLoadROMOperation = ROM32K Load FileName\n  TstFileOperation = FileOperation FileName\n  TstOutputListOperation = "output-list" OutputFormat+\n  OutputFormat = Name Index? percent FormatStyle wholeDec dot wholeDec dot wholeDec\n  TstSetOperation = Set Name Index? Number\n  Index = OpenSquare wholeDec? CloseSquare\n  Condition = Value CompareOp Value\n  TstEvalOperation = Eval | TickTock| Tick | Tock\n  TstOutputOperation = Output\n  TstEchoOperation = Echo String\n  TstClearEchoOperation = ClearEcho\n\n  FileName = Name\n  FileOperation = "load" | "output-file" | "compare-to"\n\n  Set = "set"\n  Eval = "eval"\n  Tick = "tick"\n  Tock = "tock"\n  TickTock = "ticktock"\n  Echo = "echo"\n  Repeat = "repeat"\n  ClearEcho = "clear-echo"\n  Output = "output"\n  OutputList = "output-list"\n  FormatStyle = "B"|"D"|"S"|"X"\n  ROM32K = "ROM32K"\n  Load = "load"\n  While = "while"\n\n  CompareOp = "<>" | "<=" | ">=" | "=" | "<" | ">"\n}',a=i.Z.grammar(r,n.y1),o=a.extendSemantics(n.rJ);o.extendAttribute("value",{Index:(t,e,s)=>e?.child(0)?.value??-1}),o.extendAttribute("name",{FileName(t){let{name:e}=t;return e}}),o.addAttribute("index",{Index:(t,e,s)=>e.child(0)?.value??0}),o.addAttribute("format",{OutputFormat(t,e,s,i,n,r,a,o,c){let{name:h}=t,{sourceString:l}=i,{value:u}=n,{value:d}=a,{value:p}=c;return{id:h,builtin:void 0!==e?.child(0),address:e?.child(0)?.value??-1,style:l,width:d,lpad:u,rpad:p}}}),o.addAttribute("operation",{TstEvalOperation:t=>({op:t.sourceString}),TstOutputOperation:t=>({op:"output"}),TstOutputListOperation:(t,e)=>({op:"output-list",spec:e.children.map((t=>t.format))}),TstSetOperation(t,e,s,i){let{name:n}=e,{value:r}=i;const a={op:"set",id:n,value:r},o=s.child(0)?.child(1)?.child(0);return o&&(a.index=o.value),a},TstEchoOperation:(t,e)=>({op:"echo",message:e.String}),TstClearEchoOperation:t=>({op:"clear-echo"}),TstLoadROMOperation(t,e,s){let{name:i}=s;return{op:"loadRom",file:i}},TstFileOperation:(t,e)=>({op:t.sourceString,file:e.sourceString})}),o.addAttribute("condition",{Condition(t,e,s){let{value:i}=t,{sourceString:n}=e,{value:r}=s;return{left:i,right:r,op:n}}}),o.addAttribute("statement",{TstWhile:(t,e,s,i,n)=>({statements:i.children.map((t=>{let{statement:e}=t;return e})),condition:e.condition,span:{start:t.source.startIdx,end:e.source.endIdx}}),TstRepeat:(t,e,s,i,n)=>({statements:i.children.map((t=>{let{statement:e}=t;return e})),count:e.child(0)?.value??-1,span:{start:t.source.startIdx,end:e.source.endIdx}}),TstStatement(t,e){const s={ops:t.asIteration().children.map((t=>t.operation)),span:{start:this.source.startIdx,end:this.source.endIdx}};return"!"===e.sourceString&&(s.break=!0),s}}),o.addAttribute("tst",{Tst:t=>({lines:t.children.map((t=>t.statement))})}),o.addAttribute("root",{Root(t){let{tst:e}=t;return e}});const c={grammar:r,semantics:o,parser:a,parse:(0,n.Pz)(a,o)}},3389:(t,e,s)=>{s.d(e,{o6:()=>x,l1:()=>v});var i=s(5541),n=s(9956),r=s(6329),a=s(6531),o=s(326);class c{variable;fmt;lPad;rPad;len;index;builtin;constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"%B1.1.1",s=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;if(this.variable=t,e.startsWith("%")&&void 0===s&&void 0===n&&void 0===r){const{fmt:t,lPad:s,rPad:i,len:n}=e.match(/^%(?<fmt>[BDXS])(?<lPad>\d+)\.(?<len>\d+)\.(?<rPad>\d+)$/)?.groups;this.fmt=t,this.lPad=parseInt(s),this.rPad=parseInt(i),this.len=parseInt(n),this.builtin=!1,this.index=-1}else(0,i.hu)(["B","X","D","S"].includes(e[0])),this.fmt=e[0],this.len=s??3,this.lPad=n??1,this.rPad=r??1,this.builtin=a??!1,this.index=o??-1}header(t){let e=`${this.variable}`;if(this.builtin){e=`${e}[${this.index>=0?this.index:""}]`}return e.length>this.len+this.lPad+this.rPad?e.substring(0,this.len+this.lPad+this.rPad):this.padCenter(e)}print(t){const e=t.getVar(this.variable,this.index);if("S"===this.fmt)return this.padLeft(e);const s=(0,{B:o.Ly,D:o.E_,X:o.$v}[this.fmt])(e);return"D"===this.fmt?this.padRight(s):this.padCenter(s.slice(s.length-this.len))}padCenter(t){const e=this.lPad+this.len+this.rPad,s=Math.floor((e-t.length)/2),i=e-s-t.length,n=s+t.length,r=n+i;return t=(t=t.padStart(n)).padEnd(r)}padLeft(t){t=t.substring(0,this.len);const e=this.rPad+this.len,s=this.lPad+e;return t=(t=t.padEnd(e)).padStart(s)}padRight(t){t=t.substring(0,this.len);const e=this.lPad+this.len,s=this.rPad+e;return t=(t=t.padStart(e)).padEnd(s)}}var h=s(5838),l=s(134);class u{instructions=[];_outputList=[];_log="";fs=new n.Wd;setFileSystem(t){return this.fs=t,this}echo(t){}clearEcho(){}async load(t){}async compareTo(t){}outputFile(t){}outputList(t){this._outputList=t}addInstruction(t){this.instructions.push(t)}reset(){return this._steps=function*(t){for(const e of t.instructions)yield*e.steps(t)}(this),this._step=this._steps.next(),this._step,this._log="",this}_steps;_step;get steps(){return void 0===this._steps&&(this.reset(),this._steps=(0,i.kP)(this._steps,"Reset did not initialize steps"),this._step=(0,i.kP)(this._step,"Reset did not find first step")),this._steps}get currentStep(){return this._step?.value}get done(){return this._step?.done??!1}step(){return!!this._step.done||(this._step.value.do(this),this._step=this.steps.next(),!1)}async run(){for(this.reset();!await this.step(););}breakpoints=new Map;addBreakpoint(t,e){this.breakpoints.set(t,e)}clearBreakpoints(){this.breakpoints.clear()}output(){const t=this._outputList.map((t=>t.print(this)));this._log+=`|${t.join("|")}|\n`}header(){const t=this._outputList.map((t=>t.header(this)));this._log+=`|${t.join("|")}|\n`}log(){return this._log}}function d(t){return void 0!==t.ops}function p(t){return void 0!==t.condition}function m(t){const e=new b;e.span=t.span;for(const s of t.ops){const t=f(s);void 0!==t&&e.addInstruction(t)}return e}function f(t){const{op:e}=t;switch(e){case"tick":return new j;case"tock":return new M;case"ticktock":return new C;case"eval":return new _;case"output":return new k;case"set":return new O(t.id,t.value,t.index);case"output-list":return new y(t.spec);case"echo":return new S(t.message);case"clear-echo":return new P;case"loadRom":return new R(t.file);case"load":case"output-file":case"compare-to":return;default:(0,i.qV)(e,`Unknown tst operation ${e}`)}}function g(t,e){for(const s of e.lines)if(d(s))t.addInstruction(m(s));else{const e=p(s)?new A(new T(s.condition.left,s.condition.right,s.condition.op)):new w(s.count);e.span=s.span,t.addInstruction(e);for(const t of s.statements)e.addInstruction(m(t))}return t.reset(),t}class v extends u{chip=new r.P9;get chipId(){return this.chip.id}clock=a.S.get();static from(t){return g(new v,t)}with(t){return this.chip=t,this}hasVar(t){return"time"===t||(t=`${t}`,this.chip.hasIn(t)||this.chip.hasOut(t))}getVar(t,e){if("time"===(t=`${t}`))return this.clock.toString();const s=this.chip.get(t,e);return s?s instanceof r.Gc?s.busVoltage:s.voltage():0}setVar(t,e,s){const i=this.chip.get(t,s);i instanceof r.Gc?i.busVoltage=e:i?.pull(0===e?r.yE:r.lj)}eval(){this.chip.eval()}tick(){this.chip.eval(),this.clock.tick()}tock(){this.chip.eval(),this.clock.tock()}async load(t){await this.chip.load(this.fs,t)}async run(){this.clock.reset(),await super.run()}}class x extends u{cpu;ticks=0;static from(t,e){return g(new x(e),t)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new h.eD(new Int16Array);super(),this.cpu=new l.Z9({ROM:t}),this.reset()}reset(){return super.reset(),this.cpu.reset(),this.ticks=0,this}hasVar(t){return"number"!==typeof t&&!("A"!==t&&"D"!==t&&"PC"!==t&&"time"!==t&&!t.startsWith("RAM"))}getVar(t,e){switch(t){case"A":return this.cpu.A;case"D":return this.cpu.D;case"PC":return this.cpu.PC;case"time":return this.ticks;case"RAM":return void 0===e?0:this.cpu.RAM.get(e)}return 0}setVar(t,e,s){switch(t){case"A":this.cpu.setA(e);break;case"D":this.cpu.setD(e);break;case"PC":this.cpu.setPC(e);break;case"RAM":this.cpu.RAM.set(s??0,e)}}ticktock(){this.ticks+=1,this.cpu.tick()}async load(t){await this.cpu.ROM.load(this.fs,t)}}class O{variable;value;index;constructor(t,e,s){this.variable=t,this.value=e,this.index=s}do(t){t.setVar(this.variable,this.value,this.index)}*steps(){yield this}}class k{do(t){t.output()}*steps(){yield this}}class y{outputs=[];constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const e of t)this.addOutput(e)}addOutput(t){this.outputs.push(new c(t.id,t.style,t.width,t.lpad,t.rpad,t.builtin,t.address))}do(t){t.outputList(this.outputs),t.header()}*steps(){yield this}}class b{instructions=[];span;addInstruction(t){this.instructions.push(t)}do(t){for(const e of this.instructions)e.do(t)}*steps(t){yield this}}class w extends b{repeat;constructor(t){super(),this.repeat=t}do(){}*innerSteps(t){for(const e of this.instructions)yield*e.steps(t)}*steps(t){if(-1===this.repeat)for(yield this;;)yield*this.innerSteps(t);else for(let e=0;e<this.repeat;e++)yield this,yield*this.innerSteps(t)}}class T{x;y;op;constructor(t,e,s){this.x=t,this.y=e,this.op=s}check(t){const e=t.hasVar(this.x)?t.getVar(this.x):this.x,s=t.hasVar(this.y)?t.getVar(this.y):this.y;if("string"===typeof e||"string"===typeof s)switch(this.op){case"=":return`${e}`===`${s}`;case"<>":return`${e}`!==`${s}`}else switch(this.op){case"<":return e<s;case"<=":return e<=s;case">":return e>s;case">=":return e>=s;case"=":return e===s;case"<>":return e!==s}return!1}}class A extends b{condition;constructor(t){super(),this.condition=t}*steps(t){for(;this.condition.check(t);){yield this;for(const e of this.instructions)yield*e.steps(t)}}}class S{content;constructor(t){this.content=t}do(t){t.echo(this.content)}*steps(){yield this}}class P{do(t){t.clearEcho()}*steps(){yield this}}class R{file;constructor(t){this.file=t}async do(t){t.fs.pushd("/test"),await t.load(this.file),t.fs.popd()}*steps(){yield this}}class _{_chipTestInstruction_=!0;do(t){t.eval()}*steps(){yield this}}class j{_chipTestInstruction_=!0;do(t){t.tick()}*steps(){yield this}}class M{_chipTestInstruction_=!0;do(t){t.tock()}*steps(){yield this}}class C{_cpuTestInstruction_=!0;do(t){t.ticktock()}*steps(){yield this}}}}]);
//# sourceMappingURL=387.d367f3b4.chunk.js.map