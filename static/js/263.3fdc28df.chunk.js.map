{"version":3,"file":"static/js/263.3fdc28df.chunk.js","mappings":"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","sources":["../../components/src/chips/alu.tsx","../../components/src/chips/register.tsx","../../components/src/chips/keyboard.tsx","../../node_modules/@davidsouther/jiffies/lib/esm/dom/css/constants.js","../../node_modules/@davidsouther/jiffies/lib/esm/dom/css/core.js","../../node_modules/@davidsouther/jiffies/lib/esm/dom/css/border.js","../../node_modules/@davidsouther/jiffies/lib/esm/dom/css/sizing.js","../../node_modules/immer/src/utils/errors.ts","../../node_modules/immer/src/utils/common.ts","../../node_modules/immer/src/utils/plugins.ts","../../node_modules/immer/src/core/scope.ts","../../node_modules/immer/src/core/finalize.ts","../../node_modules/immer/src/core/proxy.ts","../../node_modules/immer/src/core/immerClass.ts","../../node_modules/immer/src/core/current.ts","../../node_modules/immer/src/immer.ts","../../node_modules/immer/src/utils/env.ts","../../components/src/react.ts","../../components/src/inline_edit.tsx","../../components/src/virtual_scroll.tsx","../../components/src/clockface.tsx","../../components/src/chips/memory.tsx","../../components/src/chips/screen.tsx","../../components/src/chips/visualizations.tsx","../../components/src/pin_display.ts","../../components/src/pinout.tsx","../../components/src/runbar.tsx","../../components/src/timer.tsx","../../components/src/stores/chip.store.ts","../../simulator/src/timer.ts","shell/editor.tsx","../../node_modules/@davidsouther/jiffies/lib/esm/debounce.js","shell/panel.tsx","pages/chip.tsx"],"sourcesContent":["import {\n  COMMANDS_ALU,\n  COMMANDS_OP,\n  Flags,\n} from \"@nand2tetris/simulator/cpu/alu.js\";\n\nexport const ALUComponent = ({\n  A,\n  op,\n  D,\n  out,\n  flag,\n}: {\n  A: number;\n  op: COMMANDS_OP;\n  D: number;\n  out: number;\n  flag: keyof typeof Flags;\n}) => (\n  <div>\n    <span>ALU</span>\n    <svg width=\"250\" height=\"250\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g>\n        <rect x=\"1\" y=\"20\" height=\"85\" width=\"70\" fill=\"black\" />\n        <rect x=\"1\" y=\"145\" height=\"85\" width=\"70\" fill=\"black\" />\n        <rect x=\"180\" y=\"95\" height=\"60\" width=\"70\" fill=\"black\" />\n        <polygon\n          points=\"70,10 180,85 180,165 70,240 70,135 90,125 70,115\"\n          stroke=\"#000\"\n          fill=\"#6D97AB\"\n        />\n        <text\n          xmlSpace=\"preserve\"\n          textAnchor=\"middle\"\n          fontFamily=\"Noto Sans JP\"\n          fontSize=\"14\"\n          strokeWidth=\"0\"\n          id=\"svg_9\"\n          y=\"63\"\n          x=\"35\"\n          stroke=\"white\"\n          fill=\"#ffffff\"\n        >\n          {A}\n        </text>\n        <text\n          xmlSpace=\"preserve\"\n          textAnchor=\"middle\"\n          fontFamily=\"Noto Sans JP\"\n          fontSize=\"14\"\n          id=\"svg_10\"\n          y=\"188\"\n          x=\"35\"\n          strokeWidth=\"0\"\n          stroke=\"white\"\n          fill=\"#ffffff\"\n        >\n          {D}\n        </text>\n        <text\n          xmlSpace=\"preserve\"\n          textAnchor=\"middle\"\n          fontFamily=\"Noto Sans JP\"\n          fontSize=\"14\"\n          id=\"svg_11\"\n          y=\"125\"\n          x=\"215\"\n          strokeWidth=\"0\"\n          stroke=\"white\"\n          fill=\"#ffffff\"\n        >\n          {out}\n        </text>\n        <text\n          xmlSpace=\"preserve\"\n          textAnchor=\"middle\"\n          fontFamily=\"Noto Sans JP\"\n          fontSize=\"14\"\n          id=\"svg_13\"\n          y=\"125\"\n          x=\"135\"\n          strokeWidth=\"0\"\n          stroke=\"white\"\n          fill=\"#ffffff\"\n        >\n          {COMMANDS_ALU.op[op] ?? \"(??)\"}\n        </text>\n      </g>\n    </svg>\n  </div>\n);\n","import { dec } from \"@nand2tetris/simulator/util/twos.js\";\n\nexport const RegisterComponent = ({\n  name,\n  bits,\n}: {\n  name: string;\n  bits: number;\n}) => (\n  <div>\n    {name}: {dec(bits)}\n  </div>\n);\n","import { Keyboard as KeyboardChip } from \"@nand2tetris/simulator/chip/builtins/computer/computer.js\";\nimport { KeyboardEvent, useState } from \"react\";\nimport { RegisterComponent } from \"./register.js\";\n\nconst KeyMap: Record<string, number | undefined> = {\n  // Delete: 127,\n  Enter: 128,\n  Backspace: 129,\n  ArrowLeft: 130,\n  ArrowUp: 131,\n  ArrowRight: 132,\n  ArrowDown: 133,\n  Home: 134,\n  End: 135,\n  PageUp: 136,\n  PageDown: 137,\n  Insert: 138,\n  Delete: 139,\n  Escape: 140,\n  F1: 141,\n  F2: 142,\n  F3: 143,\n  F4: 144,\n  F5: 145,\n  F6: 146,\n  F7: 147,\n  F8: 148,\n  F9: 149,\n  F10: 150,\n  F11: 151,\n  F12: 152,\n};\n\nfunction keyPressToHackCharacter(keypress: KeyboardEvent): number {\n  const mapping = KeyMap[keypress.key];\n  if (mapping !== undefined) {\n    return mapping;\n  }\n  if (keypress.key.length === 1) {\n    const code = keypress.key.charCodeAt(0);\n    if (code >= 32 && code <= 126) {\n      return code;\n    }\n  }\n\n  return 0;\n}\n\nexport const Keyboard = ({\n  keyboard,\n  update,\n}: {\n  keyboard: KeyboardChip;\n  update?: () => void;\n}) => {\n  // const [showPicker, setShowPicker] = useState(false);\n  const [enabled, setEnabled] = useState(false);\n  const [character, setCharacter] = useState(\"\");\n  const [bits, setBits] = useState(keyboard.out().busVoltage);\n  let currentKey = 0;\n\n  const toggleEnabled = () => {\n    setEnabled(!enabled);\n  };\n\n  const onKeyDown = (event: KeyboardEvent<HTMLButtonElement>) => {\n    event.preventDefault();\n    if (!enabled) {\n      return;\n    }\n\n    setCharacter(event.key);\n    const key = keyPressToHackCharacter(event);\n    if (key === currentKey) {\n      return;\n    }\n    setKey(key);\n    update?.();\n  };\n\n  const onKeyUp = (event: KeyboardEvent<HTMLButtonElement>) => {\n    if (!enabled) {\n      return;\n    }\n\n    currentKey = 0;\n    keyboard.clearKey();\n    update?.();\n    setBits(keyboard.out().busVoltage);\n    setCharacter(\"\");\n  };\n\n  const setKey = (key: number) => {\n    if (key === 0) {\n      return;\n    }\n    keyboard.setKey(key);\n    setBits(keyboard.out().busVoltage);\n    currentKey = key;\n  };\n\n  return (\n    <div className=\"flex row align-baseline\">\n      <div className=\"flex-1\">\n        <RegisterComponent name=\"Keyboard\" bits={bits} />\n      </div>\n      <div className=\"flex-1\">{`Character: ${character}`}</div>\n      <div className=\"flex-1\">\n        <button onClick={toggleEnabled} onKeyDown={onKeyDown} onKeyUp={onKeyUp}>\n          {/* <Icon name=\"keyboard\" /> */}\n          {enabled ? \"Disable   \" : \"Enable   \"}\n        </button>\n      </div>\n    </div>\n  );\n};\n","export const Sizes = {\n    none: \"0px\",\n    sm: \"0.125rem\",\n    \"\": \"0.25rem\",\n    md: \"0.375rem\",\n    lg: \"0.5rem\",\n    xl: \"0.75rem\",\n    \"2xl\": \"1rem\",\n    \"3xl\": \"1.5rem\",\n    full: \"9999px\",\n};\nexport const Sides = {\n    \"\": \"\",\n    t: \"Top\",\n    r: \"Right\",\n    l: \"Left\",\n    b: \"Bottom\",\n    tl: \"TopLeft\",\n    tr: \"TopRight\",\n    bl: \"BottomLeft\",\n    br: \"BottomRight\",\n};\nexport const Widths = {\n    \"1/4\": \"25%\",\n    \"1/2\": \"50%\",\n    \"3/4\": \"75%\",\n    full: \"100%\",\n};\n","import { Sides, Sizes } from \"./constants.js\";\nexport function isSide(v) {\n    return Sides[v] !== undefined;\n}\nexport function isSize(v) {\n    return Sizes[v] !== undefined;\n}\nexport function getSize(size) {\n    return Sizes[size];\n}\nexport function getSide(side) {\n    switch (side) {\n        case \"t\":\n            return [...getSide(\"tl\"), ...getSide(\"tr\")];\n        case \"r\":\n            return [...getSide(\"tr\"), ...getSide(\"br\")];\n        case \"b\":\n            return [...getSide(\"br\"), ...getSide(\"bl\")];\n        case \"l\":\n            return [...getSide(\"tl\"), ...getSide(\"bl\")];\n        default:\n            return [Sides[side]];\n    }\n}\n","import { isSide, getSize, getSide } from \"./core.js\";\nexport function rounded(size = \"\", side = \"\") {\n    if (isSide(size)) {\n        side = size;\n        size = \"\";\n    }\n    const sized = getSize(size);\n    return getSide(side).reduce((prev, curr) => {\n        if (curr === \"\") {\n            prev.borderRadius = sized;\n        }\n        else {\n            // @ts-ignore\n            prev[`border${curr}Radius`] = sized;\n        }\n        return prev;\n    }, {});\n}\nexport function border({ side = \"\", style = \"solid\", radius = \"\", width = 1, color = \"black\", }) {\n    return {};\n}\nexport function inset(width, color1 = \"gray\", color2 = \"lightgray\") {\n    return {\n        ...border({ side: \"tl\", width, color: color1, radius: \"none\" }),\n        ...border({ side: \"br\", width, color: color2, radius: \"none\" }),\n    };\n}\n","import { Widths } from \"./constants.js\";\nexport function width(amount, block) {\n    if (amount === undefined && Widths[block] !== undefined) {\n        amount = block;\n    }\n    return {\n        ...(block === \"inline\" ? { display: \"inline-block\" } : {}),\n        width: Widths[amount] ?? \"0\",\n    };\n}\n","const errors = {\n\t0: \"Illegal state\",\n\t1: \"Immer drafts cannot have computed properties\",\n\t2: \"This object has been frozen and should not be mutated\",\n\t3(data: any) {\n\t\treturn (\n\t\t\t\"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? \" +\n\t\t\tdata\n\t\t)\n\t},\n\t4: \"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.\",\n\t5: \"Immer forbids circular references\",\n\t6: \"The first or second argument to `produce` must be a function\",\n\t7: \"The third argument to `produce` must be a function or undefined\",\n\t8: \"First argument to `createDraft` must be a plain object, an array, or an immerable object\",\n\t9: \"First argument to `finishDraft` must be a draft returned by `createDraft`\",\n\t10: \"The given draft is already finalized\",\n\t11: \"Object.defineProperty() cannot be used on an Immer draft\",\n\t12: \"Object.setPrototypeOf() cannot be used on an Immer draft\",\n\t13: \"Immer only supports deleting array indices\",\n\t14: \"Immer only supports setting array indices and the 'length' property\",\n\t15(path: string) {\n\t\treturn \"Cannot apply patch, path doesn't resolve: \" + path\n\t},\n\t16: 'Sets cannot have \"replace\" patches.',\n\t17(op: string) {\n\t\treturn \"Unsupported patch operation: \" + op\n\t},\n\t18(plugin: string) {\n\t\treturn `The plugin for '${plugin}' has not been loaded into Immer. To enable the plugin, import and call \\`enable${plugin}()\\` when initializing your application.`\n\t},\n\t20: \"Cannot use proxies if Proxy, Proxy.revocable or Reflect are not available\",\n\t21(thing: string) {\n\t\treturn `produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${thing}'`\n\t},\n\t22(thing: string) {\n\t\treturn `'current' expects a draft, got: ${thing}`\n\t},\n\t23(thing: string) {\n\t\treturn `'original' expects a draft, got: ${thing}`\n\t},\n\t24: \"Patching reserved attributes like __proto__, prototype and constructor is not allowed\"\n} as const\n\nexport function die(error: keyof typeof errors, ...args: any[]): never {\n\tif (__DEV__) {\n\t\tconst e = errors[error]\n\t\tconst msg = !e\n\t\t\t? \"unknown error nr: \" + error\n\t\t\t: typeof e === \"function\"\n\t\t\t? e.apply(null, args as any)\n\t\t\t: e\n\t\tthrow new Error(`[Immer] ${msg}`)\n\t}\n\tthrow new Error(\n\t\t`[Immer] minified error nr: ${error}${\n\t\t\targs.length ? \" \" + args.map(s => `'${s}'`).join(\",\") : \"\"\n\t\t}. Find the full error at: https://bit.ly/3cXEKWf`\n\t)\n}\n","import {\n\tDRAFT_STATE,\n\tDRAFTABLE,\n\thasSet,\n\tObjectish,\n\tDrafted,\n\tAnyObject,\n\tAnyMap,\n\tAnySet,\n\tImmerState,\n\thasMap,\n\tArchtype,\n\tdie\n} from \"../internal\"\n\n/** Returns true if the given value is an Immer draft */\n/*#__PURE__*/\nexport function isDraft(value: any): boolean {\n\treturn !!value && !!value[DRAFT_STATE]\n}\n\n/** Returns true if the given value can be drafted by Immer */\n/*#__PURE__*/\nexport function isDraftable(value: any): boolean {\n\tif (!value) return false\n\treturn (\n\t\tisPlainObject(value) ||\n\t\tArray.isArray(value) ||\n\t\t!!value[DRAFTABLE] ||\n\t\t!!value.constructor?.[DRAFTABLE] ||\n\t\tisMap(value) ||\n\t\tisSet(value)\n\t)\n}\n\nconst objectCtorString = Object.prototype.constructor.toString()\n/*#__PURE__*/\nexport function isPlainObject(value: any): boolean {\n\tif (!value || typeof value !== \"object\") return false\n\tconst proto = Object.getPrototypeOf(value)\n\tif (proto === null) {\n\t\treturn true\n\t}\n\tconst Ctor =\n\t\tObject.hasOwnProperty.call(proto, \"constructor\") && proto.constructor\n\n\tif (Ctor === Object) return true\n\n\treturn (\n\t\ttypeof Ctor == \"function\" &&\n\t\tFunction.toString.call(Ctor) === objectCtorString\n\t)\n}\n\n/** Get the underlying object that is represented by the given draft */\n/*#__PURE__*/\nexport function original<T>(value: T): T | undefined\nexport function original(value: Drafted<any>): any {\n\tif (!isDraft(value)) die(23, value)\n\treturn value[DRAFT_STATE].base_\n}\n\n/*#__PURE__*/\nexport const ownKeys: (target: AnyObject) => PropertyKey[] =\n\ttypeof Reflect !== \"undefined\" && Reflect.ownKeys\n\t\t? Reflect.ownKeys\n\t\t: typeof Object.getOwnPropertySymbols !== \"undefined\"\n\t\t? obj =>\n\t\t\t\tObject.getOwnPropertyNames(obj).concat(\n\t\t\t\t\tObject.getOwnPropertySymbols(obj) as any\n\t\t\t\t)\n\t\t: /* istanbul ignore next */ Object.getOwnPropertyNames\n\nexport const getOwnPropertyDescriptors =\n\tObject.getOwnPropertyDescriptors ||\n\tfunction getOwnPropertyDescriptors(target: any) {\n\t\t// Polyfill needed for Hermes and IE, see https://github.com/facebook/hermes/issues/274\n\t\tconst res: any = {}\n\t\townKeys(target).forEach(key => {\n\t\t\tres[key] = Object.getOwnPropertyDescriptor(target, key)\n\t\t})\n\t\treturn res\n\t}\n\nexport function each<T extends Objectish>(\n\tobj: T,\n\titer: (key: string | number, value: any, source: T) => void,\n\tenumerableOnly?: boolean\n): void\nexport function each(obj: any, iter: any, enumerableOnly = false) {\n\tif (getArchtype(obj) === Archtype.Object) {\n\t\t;(enumerableOnly ? Object.keys : ownKeys)(obj).forEach(key => {\n\t\t\tif (!enumerableOnly || typeof key !== \"symbol\") iter(key, obj[key], obj)\n\t\t})\n\t} else {\n\t\tobj.forEach((entry: any, index: any) => iter(index, entry, obj))\n\t}\n}\n\n/*#__PURE__*/\nexport function getArchtype(thing: any): Archtype {\n\t/* istanbul ignore next */\n\tconst state: undefined | ImmerState = thing[DRAFT_STATE]\n\treturn state\n\t\t? state.type_ > 3\n\t\t\t? state.type_ - 4 // cause Object and Array map back from 4 and 5\n\t\t\t: (state.type_ as any) // others are the same\n\t\t: Array.isArray(thing)\n\t\t? Archtype.Array\n\t\t: isMap(thing)\n\t\t? Archtype.Map\n\t\t: isSet(thing)\n\t\t? Archtype.Set\n\t\t: Archtype.Object\n}\n\n/*#__PURE__*/\nexport function has(thing: any, prop: PropertyKey): boolean {\n\treturn getArchtype(thing) === Archtype.Map\n\t\t? thing.has(prop)\n\t\t: Object.prototype.hasOwnProperty.call(thing, prop)\n}\n\n/*#__PURE__*/\nexport function get(thing: AnyMap | AnyObject, prop: PropertyKey): any {\n\t// @ts-ignore\n\treturn getArchtype(thing) === Archtype.Map ? thing.get(prop) : thing[prop]\n}\n\n/*#__PURE__*/\nexport function set(thing: any, propOrOldValue: PropertyKey, value: any) {\n\tconst t = getArchtype(thing)\n\tif (t === Archtype.Map) thing.set(propOrOldValue, value)\n\telse if (t === Archtype.Set) {\n\t\tthing.delete(propOrOldValue)\n\t\tthing.add(value)\n\t} else thing[propOrOldValue] = value\n}\n\n/*#__PURE__*/\nexport function is(x: any, y: any): boolean {\n\t// From: https://github.com/facebook/fbjs/blob/c69904a511b900266935168223063dd8772dfc40/packages/fbjs/src/core/shallowEqual.js\n\tif (x === y) {\n\t\treturn x !== 0 || 1 / x === 1 / y\n\t} else {\n\t\treturn x !== x && y !== y\n\t}\n}\n\n/*#__PURE__*/\nexport function isMap(target: any): target is AnyMap {\n\treturn hasMap && target instanceof Map\n}\n\n/*#__PURE__*/\nexport function isSet(target: any): target is AnySet {\n\treturn hasSet && target instanceof Set\n}\n/*#__PURE__*/\nexport function latest(state: ImmerState): any {\n\treturn state.copy_ || state.base_\n}\n\n/*#__PURE__*/\nexport function shallowCopy(base: any) {\n\tif (Array.isArray(base)) return Array.prototype.slice.call(base)\n\tconst descriptors = getOwnPropertyDescriptors(base)\n\tdelete descriptors[DRAFT_STATE as any]\n\tlet keys = ownKeys(descriptors)\n\tfor (let i = 0; i < keys.length; i++) {\n\t\tconst key: any = keys[i]\n\t\tconst desc = descriptors[key]\n\t\tif (desc.writable === false) {\n\t\t\tdesc.writable = true\n\t\t\tdesc.configurable = true\n\t\t}\n\t\t// like object.assign, we will read any _own_, get/set accessors. This helps in dealing\n\t\t// with libraries that trap values, like mobx or vue\n\t\t// unlike object.assign, non-enumerables will be copied as well\n\t\tif (desc.get || desc.set)\n\t\t\tdescriptors[key] = {\n\t\t\t\tconfigurable: true,\n\t\t\t\twritable: true, // could live with !!desc.set as well here...\n\t\t\t\tenumerable: desc.enumerable,\n\t\t\t\tvalue: base[key]\n\t\t\t}\n\t}\n\treturn Object.create(Object.getPrototypeOf(base), descriptors)\n}\n\n/**\n * Freezes draftable objects. Returns the original object.\n * By default freezes shallowly, but if the second argument is `true` it will freeze recursively.\n *\n * @param obj\n * @param deep\n */\nexport function freeze<T>(obj: T, deep?: boolean): T\nexport function freeze<T>(obj: any, deep: boolean = false): T {\n\tif (isFrozen(obj) || isDraft(obj) || !isDraftable(obj)) return obj\n\tif (getArchtype(obj) > 1 /* Map or Set */) {\n\t\tobj.set = obj.add = obj.clear = obj.delete = dontMutateFrozenCollections as any\n\t}\n\tObject.freeze(obj)\n\tif (deep) each(obj, (key, value) => freeze(value, true), true)\n\treturn obj\n}\n\nfunction dontMutateFrozenCollections() {\n\tdie(2)\n}\n\nexport function isFrozen(obj: any): boolean {\n\tif (obj == null || typeof obj !== \"object\") return true\n\t// See #600, IE dies on non-objects in Object.isFrozen\n\treturn Object.isFrozen(obj)\n}\n","import {\n\tImmerState,\n\tPatch,\n\tImmerScope,\n\tDrafted,\n\tAnyObject,\n\tImmerBaseState,\n\tAnyMap,\n\tAnySet,\n\tProxyType,\n\tdie\n} from \"../internal\"\n\n/** Plugin utilities */\nconst plugins: {\n\tPatches?: {\n\t\tgeneratePatches_(\n\t\t\tstate: ImmerState,\n\t\t\tbasePath: PatchPath,\n\t\t\tpatches: Patch[],\n\t\t\tinversePatches: Patch[]\n\t\t): void\n\t\tgenerateReplacementPatches_(\n\t\t\tbase: any,\n\t\t\treplacement: any,\n\t\t\tpatches: Patch[],\n\t\t\tinversePatches: Patch[]\n\t\t): void\n\t\tapplyPatches_<T>(draft: T, patches: Patch[]): T\n\t}\n\tES5?: {\n\t\twillFinalizeES5_(scope: ImmerScope, result: any, isReplaced: boolean): void\n\t\tcreateES5Proxy_<T>(\n\t\t\tbase: T,\n\t\t\tparent?: ImmerState\n\t\t): Drafted<T, ES5ObjectState | ES5ArrayState>\n\t\thasChanges_(state: ES5ArrayState | ES5ObjectState): boolean\n\t}\n\tMapSet?: {\n\t\tproxyMap_<T extends AnyMap>(target: T, parent?: ImmerState): T\n\t\tproxySet_<T extends AnySet>(target: T, parent?: ImmerState): T\n\t}\n} = {}\n\ntype Plugins = typeof plugins\n\nexport function getPlugin<K extends keyof Plugins>(\n\tpluginKey: K\n): Exclude<Plugins[K], undefined> {\n\tconst plugin = plugins[pluginKey]\n\tif (!plugin) {\n\t\tdie(18, pluginKey)\n\t}\n\t// @ts-ignore\n\treturn plugin\n}\n\nexport function loadPlugin<K extends keyof Plugins>(\n\tpluginKey: K,\n\timplementation: Plugins[K]\n): void {\n\tif (!plugins[pluginKey]) plugins[pluginKey] = implementation\n}\n\n/** ES5 Plugin */\n\ninterface ES5BaseState extends ImmerBaseState {\n\tassigned_: {[key: string]: any}\n\tparent_?: ImmerState\n\trevoked_: boolean\n}\n\nexport interface ES5ObjectState extends ES5BaseState {\n\ttype_: ProxyType.ES5Object\n\tdraft_: Drafted<AnyObject, ES5ObjectState>\n\tbase_: AnyObject\n\tcopy_: AnyObject | null\n}\n\nexport interface ES5ArrayState extends ES5BaseState {\n\ttype_: ProxyType.ES5Array\n\tdraft_: Drafted<AnyObject, ES5ArrayState>\n\tbase_: any\n\tcopy_: any\n}\n\n/** Map / Set plugin */\n\nexport interface MapState extends ImmerBaseState {\n\ttype_: ProxyType.Map\n\tcopy_: AnyMap | undefined\n\tassigned_: Map<any, boolean> | undefined\n\tbase_: AnyMap\n\trevoked_: boolean\n\tdraft_: Drafted<AnyMap, MapState>\n}\n\nexport interface SetState extends ImmerBaseState {\n\ttype_: ProxyType.Set\n\tcopy_: AnySet | undefined\n\tbase_: AnySet\n\tdrafts_: Map<any, Drafted> // maps the original value to the draft value in the new set\n\trevoked_: boolean\n\tdraft_: Drafted<AnySet, SetState>\n}\n\n/** Patches plugin */\n\nexport type PatchPath = (string | number)[]\n","import {\n\tPatch,\n\tPatchListener,\n\tDrafted,\n\tImmer,\n\tDRAFT_STATE,\n\tImmerState,\n\tProxyType,\n\tgetPlugin\n} from \"../internal\"\nimport {die} from \"../utils/errors\"\n\n/** Each scope represents a `produce` call. */\n\nexport interface ImmerScope {\n\tpatches_?: Patch[]\n\tinversePatches_?: Patch[]\n\tcanAutoFreeze_: boolean\n\tdrafts_: any[]\n\tparent_?: ImmerScope\n\tpatchListener_?: PatchListener\n\timmer_: Immer\n\tunfinalizedDrafts_: number\n}\n\nlet currentScope: ImmerScope | undefined\n\nexport function getCurrentScope() {\n\tif (__DEV__ && !currentScope) die(0)\n\treturn currentScope!\n}\n\nfunction createScope(\n\tparent_: ImmerScope | undefined,\n\timmer_: Immer\n): ImmerScope {\n\treturn {\n\t\tdrafts_: [],\n\t\tparent_,\n\t\timmer_,\n\t\t// Whenever the modified draft contains a draft from another scope, we\n\t\t// need to prevent auto-freezing so the unowned draft can be finalized.\n\t\tcanAutoFreeze_: true,\n\t\tunfinalizedDrafts_: 0\n\t}\n}\n\nexport function usePatchesInScope(\n\tscope: ImmerScope,\n\tpatchListener?: PatchListener\n) {\n\tif (patchListener) {\n\t\tgetPlugin(\"Patches\") // assert we have the plugin\n\t\tscope.patches_ = []\n\t\tscope.inversePatches_ = []\n\t\tscope.patchListener_ = patchListener\n\t}\n}\n\nexport function revokeScope(scope: ImmerScope) {\n\tleaveScope(scope)\n\tscope.drafts_.forEach(revokeDraft)\n\t// @ts-ignore\n\tscope.drafts_ = null\n}\n\nexport function leaveScope(scope: ImmerScope) {\n\tif (scope === currentScope) {\n\t\tcurrentScope = scope.parent_\n\t}\n}\n\nexport function enterScope(immer: Immer) {\n\treturn (currentScope = createScope(currentScope, immer))\n}\n\nfunction revokeDraft(draft: Drafted) {\n\tconst state: ImmerState = draft[DRAFT_STATE]\n\tif (\n\t\tstate.type_ === ProxyType.ProxyObject ||\n\t\tstate.type_ === ProxyType.ProxyArray\n\t)\n\t\tstate.revoke_()\n\telse state.revoked_ = true\n}\n","import {\n\tImmerScope,\n\tDRAFT_STATE,\n\tisDraftable,\n\tNOTHING,\n\tPatchPath,\n\teach,\n\thas,\n\tfreeze,\n\tImmerState,\n\tisDraft,\n\tSetState,\n\tset,\n\tProxyType,\n\tgetPlugin,\n\tdie,\n\trevokeScope,\n\tisFrozen,\n\tshallowCopy\n} from \"../internal\"\n\nexport function processResult(result: any, scope: ImmerScope) {\n\tscope.unfinalizedDrafts_ = scope.drafts_.length\n\tconst baseDraft = scope.drafts_![0]\n\tconst isReplaced = result !== undefined && result !== baseDraft\n\tif (!scope.immer_.useProxies_)\n\t\tgetPlugin(\"ES5\").willFinalizeES5_(scope, result, isReplaced)\n\tif (isReplaced) {\n\t\tif (baseDraft[DRAFT_STATE].modified_) {\n\t\t\trevokeScope(scope)\n\t\t\tdie(4)\n\t\t}\n\t\tif (isDraftable(result)) {\n\t\t\t// Finalize the result in case it contains (or is) a subset of the draft.\n\t\t\tresult = finalize(scope, result)\n\t\t\tif (!scope.parent_) maybeFreeze(scope, result)\n\t\t}\n\t\tif (scope.patches_) {\n\t\t\tgetPlugin(\"Patches\").generateReplacementPatches_(\n\t\t\t\tbaseDraft[DRAFT_STATE].base_,\n\t\t\t\tresult,\n\t\t\t\tscope.patches_,\n\t\t\t\tscope.inversePatches_!\n\t\t\t)\n\t\t}\n\t} else {\n\t\t// Finalize the base draft.\n\t\tresult = finalize(scope, baseDraft, [])\n\t}\n\trevokeScope(scope)\n\tif (scope.patches_) {\n\t\tscope.patchListener_!(scope.patches_, scope.inversePatches_!)\n\t}\n\treturn result !== NOTHING ? result : undefined\n}\n\nfunction finalize(rootScope: ImmerScope, value: any, path?: PatchPath) {\n\t// Don't recurse in tho recursive data structures\n\tif (isFrozen(value)) return value\n\n\tconst state: ImmerState = value[DRAFT_STATE]\n\t// A plain object, might need freezing, might contain drafts\n\tif (!state) {\n\t\teach(\n\t\t\tvalue,\n\t\t\t(key, childValue) =>\n\t\t\t\tfinalizeProperty(rootScope, state, value, key, childValue, path),\n\t\t\ttrue // See #590, don't recurse into non-enumerable of non drafted objects\n\t\t)\n\t\treturn value\n\t}\n\t// Never finalize drafts owned by another scope.\n\tif (state.scope_ !== rootScope) return value\n\t// Unmodified draft, return the (frozen) original\n\tif (!state.modified_) {\n\t\tmaybeFreeze(rootScope, state.base_, true)\n\t\treturn state.base_\n\t}\n\t// Not finalized yet, let's do that now\n\tif (!state.finalized_) {\n\t\tstate.finalized_ = true\n\t\tstate.scope_.unfinalizedDrafts_--\n\t\tconst result =\n\t\t\t// For ES5, create a good copy from the draft first, with added keys and without deleted keys.\n\t\t\tstate.type_ === ProxyType.ES5Object || state.type_ === ProxyType.ES5Array\n\t\t\t\t? (state.copy_ = shallowCopy(state.draft_))\n\t\t\t\t: state.copy_\n\t\t// Finalize all children of the copy\n\t\t// For sets we clone before iterating, otherwise we can get in endless loop due to modifying during iteration, see #628\n\t\t// Although the original test case doesn't seem valid anyway, so if this in the way we can turn the next line\n\t\t// back to each(result, ....)\n\t\teach(\n\t\t\tstate.type_ === ProxyType.Set ? new Set(result) : result,\n\t\t\t(key, childValue) =>\n\t\t\t\tfinalizeProperty(rootScope, state, result, key, childValue, path)\n\t\t)\n\t\t// everything inside is frozen, we can freeze here\n\t\tmaybeFreeze(rootScope, result, false)\n\t\t// first time finalizing, let's create those patches\n\t\tif (path && rootScope.patches_) {\n\t\t\tgetPlugin(\"Patches\").generatePatches_(\n\t\t\t\tstate,\n\t\t\t\tpath,\n\t\t\t\trootScope.patches_,\n\t\t\t\trootScope.inversePatches_!\n\t\t\t)\n\t\t}\n\t}\n\treturn state.copy_\n}\n\nfunction finalizeProperty(\n\trootScope: ImmerScope,\n\tparentState: undefined | ImmerState,\n\ttargetObject: any,\n\tprop: string | number,\n\tchildValue: any,\n\trootPath?: PatchPath\n) {\n\tif (__DEV__ && childValue === targetObject) die(5)\n\tif (isDraft(childValue)) {\n\t\tconst path =\n\t\t\trootPath &&\n\t\t\tparentState &&\n\t\t\tparentState!.type_ !== ProxyType.Set && // Set objects are atomic since they have no keys.\n\t\t\t!has((parentState as Exclude<ImmerState, SetState>).assigned_!, prop) // Skip deep patches for assigned keys.\n\t\t\t\t? rootPath!.concat(prop)\n\t\t\t\t: undefined\n\t\t// Drafts owned by `scope` are finalized here.\n\t\tconst res = finalize(rootScope, childValue, path)\n\t\tset(targetObject, prop, res)\n\t\t// Drafts from another scope must prevented to be frozen\n\t\t// if we got a draft back from finalize, we're in a nested produce and shouldn't freeze\n\t\tif (isDraft(res)) {\n\t\t\trootScope.canAutoFreeze_ = false\n\t\t} else return\n\t}\n\t// Search new objects for unfinalized drafts. Frozen objects should never contain drafts.\n\tif (isDraftable(childValue) && !isFrozen(childValue)) {\n\t\tif (!rootScope.immer_.autoFreeze_ && rootScope.unfinalizedDrafts_ < 1) {\n\t\t\t// optimization: if an object is not a draft, and we don't have to\n\t\t\t// deepfreeze everything, and we are sure that no drafts are left in the remaining object\n\t\t\t// cause we saw and finalized all drafts already; we can stop visiting the rest of the tree.\n\t\t\t// This benefits especially adding large data tree's without further processing.\n\t\t\t// See add-data.js perf test\n\t\t\treturn\n\t\t}\n\t\tfinalize(rootScope, childValue)\n\t\t// immer deep freezes plain objects, so if there is no parent state, we freeze as well\n\t\tif (!parentState || !parentState.scope_.parent_)\n\t\t\tmaybeFreeze(rootScope, childValue)\n\t}\n}\n\nfunction maybeFreeze(scope: ImmerScope, value: any, deep = false) {\n\tif (scope.immer_.autoFreeze_ && scope.canAutoFreeze_) {\n\t\tfreeze(value, deep)\n\t}\n}\n","import {\n\teach,\n\thas,\n\tis,\n\tisDraftable,\n\tshallowCopy,\n\tlatest,\n\tImmerBaseState,\n\tImmerState,\n\tDrafted,\n\tAnyObject,\n\tAnyArray,\n\tObjectish,\n\tgetCurrentScope,\n\tDRAFT_STATE,\n\tdie,\n\tcreateProxy,\n\tProxyType\n} from \"../internal\"\n\ninterface ProxyBaseState extends ImmerBaseState {\n\tassigned_: {\n\t\t[property: string]: boolean\n\t}\n\tparent_?: ImmerState\n\trevoke_(): void\n}\n\nexport interface ProxyObjectState extends ProxyBaseState {\n\ttype_: ProxyType.ProxyObject\n\tbase_: any\n\tcopy_: any\n\tdraft_: Drafted<AnyObject, ProxyObjectState>\n}\n\nexport interface ProxyArrayState extends ProxyBaseState {\n\ttype_: ProxyType.ProxyArray\n\tbase_: AnyArray\n\tcopy_: AnyArray | null\n\tdraft_: Drafted<AnyArray, ProxyArrayState>\n}\n\ntype ProxyState = ProxyObjectState | ProxyArrayState\n\n/**\n * Returns a new draft of the `base` object.\n *\n * The second argument is the parent draft-state (used internally).\n */\nexport function createProxyProxy<T extends Objectish>(\n\tbase: T,\n\tparent?: ImmerState\n): Drafted<T, ProxyState> {\n\tconst isArray = Array.isArray(base)\n\tconst state: ProxyState = {\n\t\ttype_: isArray ? ProxyType.ProxyArray : (ProxyType.ProxyObject as any),\n\t\t// Track which produce call this is associated with.\n\t\tscope_: parent ? parent.scope_ : getCurrentScope()!,\n\t\t// True for both shallow and deep changes.\n\t\tmodified_: false,\n\t\t// Used during finalization.\n\t\tfinalized_: false,\n\t\t// Track which properties have been assigned (true) or deleted (false).\n\t\tassigned_: {},\n\t\t// The parent draft state.\n\t\tparent_: parent,\n\t\t// The base state.\n\t\tbase_: base,\n\t\t// The base proxy.\n\t\tdraft_: null as any, // set below\n\t\t// The base copy with any updated values.\n\t\tcopy_: null,\n\t\t// Called by the `produce` function.\n\t\trevoke_: null as any,\n\t\tisManual_: false\n\t}\n\n\t// the traps must target something, a bit like the 'real' base.\n\t// but also, we need to be able to determine from the target what the relevant state is\n\t// (to avoid creating traps per instance to capture the state in closure,\n\t// and to avoid creating weird hidden properties as well)\n\t// So the trick is to use 'state' as the actual 'target'! (and make sure we intercept everything)\n\t// Note that in the case of an array, we put the state in an array to have better Reflect defaults ootb\n\tlet target: T = state as any\n\tlet traps: ProxyHandler<object | Array<any>> = objectTraps\n\tif (isArray) {\n\t\ttarget = [state] as any\n\t\ttraps = arrayTraps\n\t}\n\n\tconst {revoke, proxy} = Proxy.revocable(target, traps)\n\tstate.draft_ = proxy as any\n\tstate.revoke_ = revoke\n\treturn proxy as any\n}\n\n/**\n * Object drafts\n */\nexport const objectTraps: ProxyHandler<ProxyState> = {\n\tget(state, prop) {\n\t\tif (prop === DRAFT_STATE) return state\n\n\t\tconst source = latest(state)\n\t\tif (!has(source, prop)) {\n\t\t\t// non-existing or non-own property...\n\t\t\treturn readPropFromProto(state, source, prop)\n\t\t}\n\t\tconst value = source[prop]\n\t\tif (state.finalized_ || !isDraftable(value)) {\n\t\t\treturn value\n\t\t}\n\t\t// Check for existing draft in modified state.\n\t\t// Assigned values are never drafted. This catches any drafts we created, too.\n\t\tif (value === peek(state.base_, prop)) {\n\t\t\tprepareCopy(state)\n\t\t\treturn (state.copy_![prop as any] = createProxy(\n\t\t\t\tstate.scope_.immer_,\n\t\t\t\tvalue,\n\t\t\t\tstate\n\t\t\t))\n\t\t}\n\t\treturn value\n\t},\n\thas(state, prop) {\n\t\treturn prop in latest(state)\n\t},\n\townKeys(state) {\n\t\treturn Reflect.ownKeys(latest(state))\n\t},\n\tset(\n\t\tstate: ProxyObjectState,\n\t\tprop: string /* strictly not, but helps TS */,\n\t\tvalue\n\t) {\n\t\tconst desc = getDescriptorFromProto(latest(state), prop)\n\t\tif (desc?.set) {\n\t\t\t// special case: if this write is captured by a setter, we have\n\t\t\t// to trigger it with the correct context\n\t\t\tdesc.set.call(state.draft_, value)\n\t\t\treturn true\n\t\t}\n\t\tif (!state.modified_) {\n\t\t\t// the last check is because we need to be able to distinguish setting a non-existing to undefined (which is a change)\n\t\t\t// from setting an existing property with value undefined to undefined (which is not a change)\n\t\t\tconst current = peek(latest(state), prop)\n\t\t\t// special case, if we assigning the original value to a draft, we can ignore the assignment\n\t\t\tconst currentState: ProxyObjectState = current?.[DRAFT_STATE]\n\t\t\tif (currentState && currentState.base_ === value) {\n\t\t\t\tstate.copy_![prop] = value\n\t\t\t\tstate.assigned_[prop] = false\n\t\t\t\treturn true\n\t\t\t}\n\t\t\tif (is(value, current) && (value !== undefined || has(state.base_, prop)))\n\t\t\t\treturn true\n\t\t\tprepareCopy(state)\n\t\t\tmarkChanged(state)\n\t\t}\n\n\t\tif (\n\t\t\tstate.copy_![prop] === value &&\n\t\t\t// special case: NaN\n\t\t\ttypeof value !== \"number\" &&\n\t\t\t// special case: handle new props with value 'undefined'\n\t\t\t(value !== undefined || prop in state.copy_)\n\t\t)\n\t\t\treturn true\n\n\t\t// @ts-ignore\n\t\tstate.copy_![prop] = value\n\t\tstate.assigned_[prop] = true\n\t\treturn true\n\t},\n\tdeleteProperty(state, prop: string) {\n\t\t// The `undefined` check is a fast path for pre-existing keys.\n\t\tif (peek(state.base_, prop) !== undefined || prop in state.base_) {\n\t\t\tstate.assigned_[prop] = false\n\t\t\tprepareCopy(state)\n\t\t\tmarkChanged(state)\n\t\t} else {\n\t\t\t// if an originally not assigned property was deleted\n\t\t\tdelete state.assigned_[prop]\n\t\t}\n\t\t// @ts-ignore\n\t\tif (state.copy_) delete state.copy_[prop]\n\t\treturn true\n\t},\n\t// Note: We never coerce `desc.value` into an Immer draft, because we can't make\n\t// the same guarantee in ES5 mode.\n\tgetOwnPropertyDescriptor(state, prop) {\n\t\tconst owner = latest(state)\n\t\tconst desc = Reflect.getOwnPropertyDescriptor(owner, prop)\n\t\tif (!desc) return desc\n\t\treturn {\n\t\t\twritable: true,\n\t\t\tconfigurable: state.type_ !== ProxyType.ProxyArray || prop !== \"length\",\n\t\t\tenumerable: desc.enumerable,\n\t\t\tvalue: owner[prop]\n\t\t}\n\t},\n\tdefineProperty() {\n\t\tdie(11)\n\t},\n\tgetPrototypeOf(state) {\n\t\treturn Object.getPrototypeOf(state.base_)\n\t},\n\tsetPrototypeOf() {\n\t\tdie(12)\n\t}\n}\n\n/**\n * Array drafts\n */\n\nconst arrayTraps: ProxyHandler<[ProxyArrayState]> = {}\neach(objectTraps, (key, fn) => {\n\t// @ts-ignore\n\tarrayTraps[key] = function() {\n\t\targuments[0] = arguments[0][0]\n\t\treturn fn.apply(this, arguments)\n\t}\n})\narrayTraps.deleteProperty = function(state, prop) {\n\tif (__DEV__ && isNaN(parseInt(prop as any))) die(13)\n\t// @ts-ignore\n\treturn arrayTraps.set!.call(this, state, prop, undefined)\n}\narrayTraps.set = function(state, prop, value) {\n\tif (__DEV__ && prop !== \"length\" && isNaN(parseInt(prop as any))) die(14)\n\treturn objectTraps.set!.call(this, state[0], prop, value, state[0])\n}\n\n// Access a property without creating an Immer draft.\nfunction peek(draft: Drafted, prop: PropertyKey) {\n\tconst state = draft[DRAFT_STATE]\n\tconst source = state ? latest(state) : draft\n\treturn source[prop]\n}\n\nfunction readPropFromProto(state: ImmerState, source: any, prop: PropertyKey) {\n\tconst desc = getDescriptorFromProto(source, prop)\n\treturn desc\n\t\t? `value` in desc\n\t\t\t? desc.value\n\t\t\t: // This is a very special case, if the prop is a getter defined by the\n\t\t\t  // prototype, we should invoke it with the draft as context!\n\t\t\t  desc.get?.call(state.draft_)\n\t\t: undefined\n}\n\nfunction getDescriptorFromProto(\n\tsource: any,\n\tprop: PropertyKey\n): PropertyDescriptor | undefined {\n\t// 'in' checks proto!\n\tif (!(prop in source)) return undefined\n\tlet proto = Object.getPrototypeOf(source)\n\twhile (proto) {\n\t\tconst desc = Object.getOwnPropertyDescriptor(proto, prop)\n\t\tif (desc) return desc\n\t\tproto = Object.getPrototypeOf(proto)\n\t}\n\treturn undefined\n}\n\nexport function markChanged(state: ImmerState) {\n\tif (!state.modified_) {\n\t\tstate.modified_ = true\n\t\tif (state.parent_) {\n\t\t\tmarkChanged(state.parent_)\n\t\t}\n\t}\n}\n\nexport function prepareCopy(state: {base_: any; copy_: any}) {\n\tif (!state.copy_) {\n\t\tstate.copy_ = shallowCopy(state.base_)\n\t}\n}\n","import {\n\tIProduceWithPatches,\n\tIProduce,\n\tImmerState,\n\tDrafted,\n\tisDraftable,\n\tprocessResult,\n\tPatch,\n\tObjectish,\n\tDRAFT_STATE,\n\tDraft,\n\tPatchListener,\n\tisDraft,\n\tisMap,\n\tisSet,\n\tcreateProxyProxy,\n\tgetPlugin,\n\tdie,\n\thasProxies,\n\tenterScope,\n\trevokeScope,\n\tleaveScope,\n\tusePatchesInScope,\n\tgetCurrentScope,\n\tNOTHING,\n\tfreeze,\n\tcurrent\n} from \"../internal\"\n\ninterface ProducersFns {\n\tproduce: IProduce\n\tproduceWithPatches: IProduceWithPatches\n}\n\nexport class Immer implements ProducersFns {\n\tuseProxies_: boolean = hasProxies\n\n\tautoFreeze_: boolean = true\n\n\tconstructor(config?: {useProxies?: boolean; autoFreeze?: boolean}) {\n\t\tif (typeof config?.useProxies === \"boolean\")\n\t\t\tthis.setUseProxies(config!.useProxies)\n\t\tif (typeof config?.autoFreeze === \"boolean\")\n\t\t\tthis.setAutoFreeze(config!.autoFreeze)\n\t}\n\n\t/**\n\t * The `produce` function takes a value and a \"recipe function\" (whose\n\t * return value often depends on the base state). The recipe function is\n\t * free to mutate its first argument however it wants. All mutations are\n\t * only ever applied to a __copy__ of the base state.\n\t *\n\t * Pass only a function to create a \"curried producer\" which relieves you\n\t * from passing the recipe function every time.\n\t *\n\t * Only plain objects and arrays are made mutable. All other objects are\n\t * considered uncopyable.\n\t *\n\t * Note: This function is __bound__ to its `Immer` instance.\n\t *\n\t * @param {any} base - the initial state\n\t * @param {Function} producer - function that receives a proxy of the base state as first argument and which can be freely modified\n\t * @param {Function} patchListener - optional function that will be called with all the patches produced here\n\t * @returns {any} a new state, or the initial state if nothing was modified\n\t */\n\tproduce: IProduce = (base: any, recipe?: any, patchListener?: any) => {\n\t\t// curried invocation\n\t\tif (typeof base === \"function\" && typeof recipe !== \"function\") {\n\t\t\tconst defaultBase = recipe\n\t\t\trecipe = base\n\n\t\t\tconst self = this\n\t\t\treturn function curriedProduce(\n\t\t\t\tthis: any,\n\t\t\t\tbase = defaultBase,\n\t\t\t\t...args: any[]\n\t\t\t) {\n\t\t\t\treturn self.produce(base, (draft: Drafted) => recipe.call(this, draft, ...args)) // prettier-ignore\n\t\t\t}\n\t\t}\n\n\t\tif (typeof recipe !== \"function\") die(6)\n\t\tif (patchListener !== undefined && typeof patchListener !== \"function\")\n\t\t\tdie(7)\n\n\t\tlet result\n\n\t\t// Only plain objects, arrays, and \"immerable classes\" are drafted.\n\t\tif (isDraftable(base)) {\n\t\t\tconst scope = enterScope(this)\n\t\t\tconst proxy = createProxy(this, base, undefined)\n\t\t\tlet hasError = true\n\t\t\ttry {\n\t\t\t\tresult = recipe(proxy)\n\t\t\t\thasError = false\n\t\t\t} finally {\n\t\t\t\t// finally instead of catch + rethrow better preserves original stack\n\t\t\t\tif (hasError) revokeScope(scope)\n\t\t\t\telse leaveScope(scope)\n\t\t\t}\n\t\t\tif (typeof Promise !== \"undefined\" && result instanceof Promise) {\n\t\t\t\treturn result.then(\n\t\t\t\t\tresult => {\n\t\t\t\t\t\tusePatchesInScope(scope, patchListener)\n\t\t\t\t\t\treturn processResult(result, scope)\n\t\t\t\t\t},\n\t\t\t\t\terror => {\n\t\t\t\t\t\trevokeScope(scope)\n\t\t\t\t\t\tthrow error\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\tusePatchesInScope(scope, patchListener)\n\t\t\treturn processResult(result, scope)\n\t\t} else if (!base || typeof base !== \"object\") {\n\t\t\tresult = recipe(base)\n\t\t\tif (result === undefined) result = base\n\t\t\tif (result === NOTHING) result = undefined\n\t\t\tif (this.autoFreeze_) freeze(result, true)\n\t\t\tif (patchListener) {\n\t\t\t\tconst p: Patch[] = []\n\t\t\t\tconst ip: Patch[] = []\n\t\t\t\tgetPlugin(\"Patches\").generateReplacementPatches_(base, result, p, ip)\n\t\t\t\tpatchListener(p, ip)\n\t\t\t}\n\t\t\treturn result\n\t\t} else die(21, base)\n\t}\n\n\tproduceWithPatches: IProduceWithPatches = (\n\t\tbase: any,\n\t\trecipe?: any,\n\t): any => {\n\t\t// curried invocation\n\t\tif (typeof base === \"function\") {\n\t\t\treturn (state: any, ...args: any[]) =>\n\t\t\t\tthis.produceWithPatches(state, (draft: any) => base(draft, ...args))\n\t\t}\n\n\t\tlet patches: Patch[], inversePatches: Patch[]\n\t\tconst result = this.produce(base, recipe, (p: Patch[], ip: Patch[]) => {\n\t\t\tpatches = p\n\t\t\tinversePatches = ip\n\t\t})\n\n\t\tif (typeof Promise !== \"undefined\" && result instanceof Promise) {\n\t\t\treturn result.then(nextState => [nextState, patches!, inversePatches!])\n\t\t}\n\t\treturn [result, patches!, inversePatches!]\n\t}\n\n\tcreateDraft<T extends Objectish>(base: T): Draft<T> {\n\t\tif (!isDraftable(base)) die(8)\n\t\tif (isDraft(base)) base = current(base)\n\t\tconst scope = enterScope(this)\n\t\tconst proxy = createProxy(this, base, undefined)\n\t\tproxy[DRAFT_STATE].isManual_ = true\n\t\tleaveScope(scope)\n\t\treturn proxy as any\n\t}\n\n\tfinishDraft<D extends Draft<any>>(\n\t\tdraft: D,\n\t\tpatchListener?: PatchListener\n\t): D extends Draft<infer T> ? T : never {\n\t\tconst state: ImmerState = draft && (draft as any)[DRAFT_STATE]\n\t\tif (__DEV__) {\n\t\t\tif (!state || !state.isManual_) die(9)\n\t\t\tif (state.finalized_) die(10)\n\t\t}\n\t\tconst {scope_: scope} = state\n\t\tusePatchesInScope(scope, patchListener)\n\t\treturn processResult(undefined, scope)\n\t}\n\n\t/**\n\t * Pass true to automatically freeze all copies created by Immer.\n\t *\n\t * By default, auto-freezing is enabled.\n\t */\n\tsetAutoFreeze(value: boolean) {\n\t\tthis.autoFreeze_ = value\n\t}\n\n\t/**\n\t * Pass true to use the ES2015 `Proxy` class when creating drafts, which is\n\t * always faster than using ES5 proxies.\n\t *\n\t * By default, feature detection is used, so calling this is rarely necessary.\n\t */\n\tsetUseProxies(value: boolean) {\n\t\tif (value && !hasProxies) {\n\t\t\tdie(20)\n\t\t}\n\t\tthis.useProxies_ = value\n\t}\n\n\tapplyPatches<T extends Objectish>(base: T, patches: Patch[]): T {\n\t\t// If a patch replaces the entire state, take that replacement as base\n\t\t// before applying patches\n\t\tlet i: number\n\t\tfor (i = patches.length - 1; i >= 0; i--) {\n\t\t\tconst patch = patches[i]\n\t\t\tif (patch.path.length === 0 && patch.op === \"replace\") {\n\t\t\t\tbase = patch.value\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\t// If there was a patch that replaced the entire state, start from the\n\t\t// patch after that.\n\t\tif (i > -1) {\n\t\t\tpatches = patches.slice(i + 1)\n\t\t}\n\n\t\tconst applyPatchesImpl = getPlugin(\"Patches\").applyPatches_\n\t\tif (isDraft(base)) {\n\t\t\t// N.B: never hits if some patch a replacement, patches are never drafts\n\t\t\treturn applyPatchesImpl(base, patches)\n\t\t}\n\t\t// Otherwise, produce a copy of the base state.\n\t\treturn this.produce(base, (draft: Drafted) =>\n\t\t\tapplyPatchesImpl(draft, patches)\n\t\t)\n\t}\n}\n\nexport function createProxy<T extends Objectish>(\n\timmer: Immer,\n\tvalue: T,\n\tparent?: ImmerState\n): Drafted<T, ImmerState> {\n\t// precondition: createProxy should be guarded by isDraftable, so we know we can safely draft\n\tconst draft: Drafted = isMap(value)\n\t\t? getPlugin(\"MapSet\").proxyMap_(value, parent)\n\t\t: isSet(value)\n\t\t? getPlugin(\"MapSet\").proxySet_(value, parent)\n\t\t: immer.useProxies_\n\t\t? createProxyProxy(value, parent)\n\t\t: getPlugin(\"ES5\").createES5Proxy_(value, parent)\n\n\tconst scope = parent ? parent.scope_ : getCurrentScope()\n\tscope.drafts_.push(draft)\n\treturn draft\n}\n","import {\n\tdie,\n\tisDraft,\n\tshallowCopy,\n\teach,\n\tDRAFT_STATE,\n\tget,\n\tset,\n\tImmerState,\n\tisDraftable,\n\tArchtype,\n\tgetArchtype,\n\tgetPlugin\n} from \"../internal\"\n\n/** Takes a snapshot of the current state of a draft and finalizes it (but without freezing). This is a great utility to print the current state during debugging (no Proxies in the way). The output of current can also be safely leaked outside the producer. */\nexport function current<T>(value: T): T\nexport function current(value: any): any {\n\tif (!isDraft(value)) die(22, value)\n\treturn currentImpl(value)\n}\n\nfunction currentImpl(value: any): any {\n\tif (!isDraftable(value)) return value\n\tconst state: ImmerState | undefined = value[DRAFT_STATE]\n\tlet copy: any\n\tconst archType = getArchtype(value)\n\tif (state) {\n\t\tif (\n\t\t\t!state.modified_ &&\n\t\t\t(state.type_ < 4 || !getPlugin(\"ES5\").hasChanges_(state as any))\n\t\t)\n\t\t\treturn state.base_\n\t\t// Optimization: avoid generating new drafts during copying\n\t\tstate.finalized_ = true\n\t\tcopy = copyHelper(value, archType)\n\t\tstate.finalized_ = false\n\t} else {\n\t\tcopy = copyHelper(value, archType)\n\t}\n\n\teach(copy, (key, childValue) => {\n\t\tif (state && get(state.base_, key) === childValue) return // no need to copy or search in something that didn't change\n\t\tset(copy, key, currentImpl(childValue))\n\t})\n\t// In the future, we might consider freezing here, based on the current settings\n\treturn archType === Archtype.Set ? new Set(copy) : copy\n}\n\nfunction copyHelper(value: any, archType: number): any {\n\t// creates a shallow copy, even if it is a map or set\n\tswitch (archType) {\n\t\tcase Archtype.Map:\n\t\t\treturn new Map(value)\n\t\tcase Archtype.Set:\n\t\t\t// Set will be cloned as array temporarily, so that we can replace individual items\n\t\t\treturn Array.from(value)\n\t}\n\treturn shallowCopy(value)\n}\n","import {\n\tIProduce,\n\tIProduceWithPatches,\n\tImmer,\n\tDraft,\n\tImmutable\n} from \"./internal\"\n\nexport {\n\tDraft,\n\tImmutable,\n\tPatch,\n\tPatchListener,\n\toriginal,\n\tcurrent,\n\tisDraft,\n\tisDraftable,\n\tNOTHING as nothing,\n\tDRAFTABLE as immerable,\n\tfreeze\n} from \"./internal\"\n\nconst immer = new Immer()\n\n/**\n * The `produce` function takes a value and a \"recipe function\" (whose\n * return value often depends on the base state). The recipe function is\n * free to mutate its first argument however it wants. All mutations are\n * only ever applied to a __copy__ of the base state.\n *\n * Pass only a function to create a \"curried producer\" which relieves you\n * from passing the recipe function every time.\n *\n * Only plain objects and arrays are made mutable. All other objects are\n * considered uncopyable.\n *\n * Note: This function is __bound__ to its `Immer` instance.\n *\n * @param {any} base - the initial state\n * @param {Function} producer - function that receives a proxy of the base state as first argument and which can be freely modified\n * @param {Function} patchListener - optional function that will be called with all the patches produced here\n * @returns {any} a new state, or the initial state if nothing was modified\n */\nexport const produce: IProduce = immer.produce\nexport default produce\n\n/**\n * Like `produce`, but `produceWithPatches` always returns a tuple\n * [nextState, patches, inversePatches] (instead of just the next state)\n */\nexport const produceWithPatches: IProduceWithPatches = immer.produceWithPatches.bind(\n\timmer\n)\n\n/**\n * Pass true to automatically freeze all copies created by Immer.\n *\n * Always freeze by default, even in production mode\n */\nexport const setAutoFreeze = immer.setAutoFreeze.bind(immer)\n\n/**\n * Pass true to use the ES2015 `Proxy` class when creating drafts, which is\n * always faster than using ES5 proxies.\n *\n * By default, feature detection is used, so calling this is rarely necessary.\n */\nexport const setUseProxies = immer.setUseProxies.bind(immer)\n\n/**\n * Apply an array of Immer patches to the first argument.\n *\n * This function is a producer, which means copy-on-write is in effect.\n */\nexport const applyPatches = immer.applyPatches.bind(immer)\n\n/**\n * Create an Immer draft from the given base state, which may be a draft itself.\n * The draft can be modified until you finalize it with the `finishDraft` function.\n */\nexport const createDraft = immer.createDraft.bind(immer)\n\n/**\n * Finalize an Immer draft from a `createDraft` call, returning the base state\n * (if no changes were made) or a modified copy. The draft must *not* be\n * mutated afterwards.\n *\n * Pass a function as the 2nd argument to generate Immer patches based on the\n * changes that were made.\n */\nexport const finishDraft = immer.finishDraft.bind(immer)\n\n/**\n * This function is actually a no-op, but can be used to cast an immutable type\n * to an draft type and make TypeScript happy\n *\n * @param value\n */\nexport function castDraft<T>(value: T): Draft<T> {\n\treturn value as any\n}\n\n/**\n * This function is actually a no-op, but can be used to cast a mutable type\n * to an immutable type and make TypeScript happy\n * @param value\n */\nexport function castImmutable<T>(value: T): Immutable<T> {\n\treturn value as any\n}\n\nexport {Immer}\n\nexport {enableES5} from \"./plugins/es5\"\nexport {enablePatches} from \"./plugins/patches\"\nexport {enableMapSet} from \"./plugins/mapset\"\nexport {enableAllPlugins} from \"./plugins/all\"\n","// Should be no imports here!\n\n// Some things that should be evaluated before all else...\n\n// We only want to know if non-polyfilled symbols are available\nconst hasSymbol =\n\ttypeof Symbol !== \"undefined\" && typeof Symbol(\"x\") === \"symbol\"\nexport const hasMap = typeof Map !== \"undefined\"\nexport const hasSet = typeof Set !== \"undefined\"\nexport const hasProxies =\n\ttypeof Proxy !== \"undefined\" &&\n\ttypeof Proxy.revocable !== \"undefined\" &&\n\ttypeof Reflect !== \"undefined\"\n\n/**\n * The sentinel value returned by producers to replace the draft with undefined.\n */\nexport const NOTHING: Nothing = hasSymbol\n\t? Symbol.for(\"immer-nothing\")\n\t: ({[\"immer-nothing\"]: true} as any)\n\n/**\n * To let Immer treat your class instances as plain immutable objects\n * (albeit with a custom prototype), you must define either an instance property\n * or a static property on each of your custom classes.\n *\n * Otherwise, your class instance will never be drafted, which means it won't be\n * safe to mutate in a produce callback.\n */\nexport const DRAFTABLE: unique symbol = hasSymbol\n\t? Symbol.for(\"immer-draftable\")\n\t: (\"__$immer_draftable\" as any)\n\nexport const DRAFT_STATE: unique symbol = hasSymbol\n\t? Symbol.for(\"immer-state\")\n\t: (\"__$immer_state\" as any)\n\n// Even a polyfilled Symbol might provide Symbol.iterator\nexport const iteratorSymbol: typeof Symbol.iterator =\n\t(typeof Symbol != \"undefined\" && Symbol.iterator) || (\"@@iterator\" as any)\n\n/** Use a class type for `nothing` so its type is unique */\nexport class Nothing {\n\t// This lets us do `Exclude<T, Nothing>`\n\t// @ts-ignore\n\tprivate _!: unique symbol\n}\n","import produce from \"immer\";\nimport { Dispatch, useEffect, useReducer, useState } from \"react\";\n\nexport function useImmerReducer<\n  T,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  Reducers extends Record<string, (state: T, action?: any) => T | void>\n>(reducers: Reducers, initialState: T) {\n  return useReducer(\n    (\n      state: T,\n      command: {\n        action: keyof Reducers;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        payload?: any;\n      }\n    ): T =>\n      produce(state, (draft: T) => {\n        reducers[command.action](draft, command.payload);\n      }),\n    initialState\n  );\n}\n\nexport function useStateInitializer<T>(init: T): [T, Dispatch<T>] {\n  const [state, setState] = useState<T>(init);\n  useEffect(() => {\n    setState(init);\n  }, [init]);\n  return [state, setState];\n}\n","import { width } from \"@davidsouther/jiffies/lib/esm/dom/css/sizing.js\";\nimport { useCallback, useState } from \"react\";\nimport { useStateInitializer } from \"./react.js\";\n\nconst Mode = { VIEW: 0, EDIT: 1 };\n\nexport const InlineEdit = (props: {\n  mode?: keyof typeof Mode;\n  value: string;\n  highlight: boolean;\n  onChange: (value: string) => void;\n  onFocus?: () => void;\n}) => {\n  const [mode, setMode] = useState(props.mode ?? Mode.VIEW);\n  const [value, setValue] = useStateInitializer(props.value);\n\n  const render = () => {\n    switch (mode) {\n      case Mode.EDIT:\n        return edit();\n      case Mode.VIEW:\n        return view();\n      default:\n        return <span />;\n    }\n  };\n\n  const view = () => (\n    <span\n      style={{ cursor: \"text\", ...width(\"full\", \"inline\") }}\n      onClick={() => {\n        setMode(Mode.EDIT);\n      }}\n    >\n      {value}\n    </span>\n  );\n\n  const doSelect = useCallback(\n    (ref: HTMLInputElement | null) => ref?.select(),\n    []\n  );\n  const doChange = useCallback(\n    (target: HTMLInputElement) => {\n      setMode(Mode.VIEW);\n      setValue(target.value ?? \"\");\n      props.onChange(target.value ?? \"\");\n    },\n    [props, setMode, setValue]\n  );\n  const edit = () => {\n    const edit = (\n      <span style={{ display: \"block\", position: \"relative\" }}>\n        <input\n          ref={doSelect}\n          style={{\n            zIndex: \"10\",\n            position: \"absolute\",\n            left: \"0\",\n            marginTop: \"-0.375rem\",\n            color: props.highlight ? \"white\" : undefined,\n          }}\n          onFocus={props.onFocus}\n          onBlur={({ target }) => doChange(target)}\n          onKeyPress={({ key, target }) => {\n            if (key === \"Enter\") {\n              doChange(target as HTMLInputElement);\n            }\n          }}\n          type=\"text\"\n          defaultValue={value}\n        />\n      </span>\n    );\n    return edit;\n  };\n\n  return render();\n};\n\nexport default InlineEdit;\n","/* eslint-disable @typescript-eslint/ban-types */\nimport {\n  Key,\n  ReactNode,\n  useCallback,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n} from \"react\";\n\nexport interface VirtualScrollSettings {\n  /**Minimum offset into the adapter. Default is 0.  */\n  minIndex: number;\n  /** Maximum offset into the adapter. Default is Number.MAX_SAFE_INTEGER.  */\n  maxIndex: number;\n  /** Initial index to start rendering from. Default is minIndex.  */\n  startIndex: number;\n  /**\n   * Number of items to render in visible area. Default is entire range from\n   * minIndex to maxIndex.\n   */\n  count: number;\n  /**\n   * Maximum number of items to render on either side of the visible area.\n   * Default is `count`.\n   */\n  tolerance: number;\n  /** Height of each item, in pixels. Default is 20px. */\n  itemHeight: number;\n}\n\nexport interface VirtualScrollDataAdapter<T> {\n  (offset: number, limit: number): Iterable<T>;\n}\n\nexport function arrayAdapter<T>(data: T[]): VirtualScrollDataAdapter<T> {\n  return (offset, limit) => data.slice(offset, offset + limit);\n}\n\nexport interface VirtualScrollProps<T, U extends ReactNode> {\n  settings?: Partial<VirtualScrollSettings>;\n  get: VirtualScrollDataAdapter<T>;\n  row: (t: T) => U;\n  rowKey: (t: T) => Key;\n}\n\nexport function fillVirtualScrollSettings(\n  settings: Partial<VirtualScrollSettings>\n): VirtualScrollSettings {\n  const {\n    minIndex = 0,\n    maxIndex = Number.MAX_SAFE_INTEGER,\n    startIndex = 0,\n    itemHeight = 20,\n    count = Math.max(maxIndex - minIndex, 1),\n    tolerance = count,\n  } = settings;\n\n  return { minIndex, maxIndex, startIndex, itemHeight, count, tolerance };\n}\n\nexport function initialState<T>(\n  settings: VirtualScrollSettings,\n  adapter: VirtualScrollDataAdapter<T>\n): VirtualScrollState<T> {\n  // From Denis Hilt, https://blog.logrocket.com/virtual-scrolling-core-principles-and-basic-implementation-in-react/\n  const { minIndex, maxIndex, startIndex, itemHeight, count, tolerance } =\n    settings;\n  const bufferedItems = count + 2 * tolerance;\n  const itemsAbove = Math.max(0, startIndex - tolerance - minIndex);\n\n  const viewportHeight = count * itemHeight;\n  const totalHeight = (maxIndex - minIndex) * itemHeight;\n  const toleranceHeight = tolerance * itemHeight;\n  const bufferHeight = viewportHeight + 2 * toleranceHeight;\n  const topPaddingHeight = itemsAbove * itemHeight;\n  const bottomPaddingHeight = totalHeight - (topPaddingHeight + bufferHeight);\n\n  const state: VirtualScrollState<T> = {\n    scrollTop: 0,\n    settings,\n    viewportHeight,\n    totalHeight,\n    toleranceHeight,\n    bufferedItems,\n    topPaddingHeight,\n    bottomPaddingHeight,\n    data: [],\n  };\n\n  return {\n    ...state,\n    ...doScroll(topPaddingHeight + toleranceHeight, state, adapter),\n  };\n}\n\nexport function getData<T>(\n  minIndex: number,\n  maxIndex: number,\n  offset: number,\n  limit: number,\n  get: VirtualScrollDataAdapter<T>\n): T[] {\n  const start = Math.max(0, minIndex, offset);\n  const end = Math.min(maxIndex, offset + limit - 1);\n  const data = get(start, end - start);\n  return [...data];\n}\n\ninterface ScrollUpdate<T> {\n  scrollTop: number;\n  topPaddingHeight: number;\n  bottomPaddingHeight: number;\n  data: T[];\n}\n\nexport function doScroll<T>(\n  scrollTop: number,\n  state: VirtualScrollState<T>,\n  get: VirtualScrollDataAdapter<T>\n): ScrollUpdate<T> {\n  const {\n    totalHeight,\n    toleranceHeight,\n    bufferedItems,\n    settings: { itemHeight, minIndex, maxIndex },\n  } = state;\n  const index =\n    minIndex + Math.floor((scrollTop - toleranceHeight) / itemHeight);\n  const data = getData(minIndex, maxIndex, index, bufferedItems, get);\n  const topPaddingHeight = Math.max((index - minIndex) * itemHeight, 0);\n  const bottomPaddingHeight = Math.max(\n    totalHeight - (topPaddingHeight + data.length * itemHeight),\n    0\n  );\n\n  return { scrollTop, topPaddingHeight, bottomPaddingHeight, data };\n}\n\ninterface VirtualScrollState<T> {\n  settings: VirtualScrollSettings;\n  scrollTop: number; // px\n  bufferedItems: number; // count\n  totalHeight: number; // px\n  viewportHeight: number; // px\n  topPaddingHeight: number; // px\n  bottomPaddingHeight: number; // px\n  toleranceHeight: number; // px\n  data: T[];\n}\n\nconst scrollReducer =\n  <T extends {}>(get: VirtualScrollDataAdapter<T>) =>\n  (state: VirtualScrollState<T>, scrollTop: number) => ({\n    ...state,\n    ...doScroll(scrollTop, state, get),\n  });\n\nexport const VirtualScroll = <T extends {}, U extends ReactNode = ReactNode>(\n  props: VirtualScrollProps<T, U> & { className?: string }\n) => {\n  const viewportRef = useRef<HTMLDivElement | null>(null);\n\n  const { settings, startState, reducer } = useMemo(() => {\n    const settings = fillVirtualScrollSettings(props.settings ?? {});\n    const startState = initialState<T>(settings, props.get);\n    const reducer = scrollReducer(props.get);\n    return { settings, reducer, startState };\n  }, [props.settings, props.get]);\n\n  const [state, dispatchScroll] = useReducer(reducer, startState);\n\n  useEffect(() => {\n    if (viewportRef.current !== null) {\n      dispatchScroll(viewportRef.current.scrollTop);\n    }\n  }, [settings, props.row]);\n\n  const initialScroll = useCallback(\n    (div: HTMLDivElement | null) => {\n      if (div) {\n        div.scrollTop = viewportRef.current\n          ? viewportRef.current.scrollTop\n          : settings.startIndex * settings.itemHeight;\n      }\n      viewportRef.current = div;\n    },\n    [viewportRef, settings.startIndex, settings.itemHeight]\n  );\n\n  const rows = state.data.map((d) => (\n    <div key={props.rowKey(d)} style={{ height: `${settings.itemHeight}px` }}>\n      {props.row(d)}\n    </div>\n  ));\n\n  return (\n    <div\n      ref={initialScroll}\n      style={{\n        height: `${state.viewportHeight}px`,\n        overflowY: \"scroll\",\n        overflowAnchor: \"none\",\n      }}\n      className={props.className ?? \"\"}\n      onScroll={(e) => dispatchScroll((e.target as HTMLDivElement).scrollTop)}\n    >\n      <div style={{ height: `${state.topPaddingHeight}px` }} />\n      {rows}\n      <div style={{ height: `${state.bottomPaddingHeight}px` }} />\n    </div>\n  );\n};\n\nexport default VirtualScroll;\n","import { useEffect, useMemo, useState } from \"react\";\n\nimport { display } from \"@davidsouther/jiffies/lib/esm/display.js\";\nimport { Clock } from \"@nand2tetris/simulator/chip/clock.js\";\n\nexport function useClock(actions: {\n  tick?: () => void;\n  toggle?: () => void;\n  reset?: () => void;\n}) {\n  const clock = useMemo(() => Clock.get(), []);\n\n  useEffect(() => {\n    const subscription = clock.$.subscribe(() => {\n      actions.tick?.();\n    });\n    return () => subscription.unsubscribe();\n  }, [actions, clock.$]);\n\n  return {\n    toggle() {\n      clock.tick();\n      actions.toggle?.();\n    },\n\n    reset() {\n      clock.reset();\n      actions.reset?.();\n    },\n  };\n}\n\nexport function useClockFrame(frameFinished: () => void) {\n  useEffect(() => {\n    const subscription = Clock.get().frame$.subscribe(() => {\n      frameFinished();\n    });\n    return () => subscription.unsubscribe();\n  }, [frameFinished]);\n}\n\nexport function useClockReset(reset: () => void) {\n  useEffect(() => {\n    const subscription = Clock.get().reset$.subscribe(() => {\n      reset();\n    });\n    return () => subscription.unsubscribe();\n  }, [reset]);\n}\n\nexport function displayClock() {\n  return display(Clock.get());\n}\n\nexport function useClockface() {\n  const [clockface, setClockface] = useState(displayClock());\n\n  useEffect(() => {\n    const subscription = Clock.get().$.subscribe(() => {\n      setClockface(displayClock());\n    });\n    return () => subscription.unsubscribe();\n  }, []);\n\n  return clockface;\n}\n\nexport const Clockface = () => {\n  const clockface = useClockface();\n  return <span style={{ whiteSpace: \"nowrap\" }}>{clockface}</span>;\n};\n","import { rounded } from \"@davidsouther/jiffies/lib/esm/dom/css/border.js\";\nimport { ReactNode, useCallback, useMemo, useState } from \"react\";\n\nimport {\n  Format,\n  FORMATS,\n  Memory as MemoryChip,\n} from \"@nand2tetris/simulator/cpu/memory.js\";\nimport { asm } from \"@nand2tetris/simulator/util/asm.js\";\nimport { bin, dec, hex } from \"@nand2tetris/simulator/util/twos.js\";\nimport InlineEdit from \"../inline_edit.js\";\nimport VirtualScroll, { VirtualScrollSettings } from \"../virtual_scroll.js\";\nimport { useClockReset } from \"../clockface.js\";\n\nconst ITEM_HEIGHT = 34;\n\nexport const MemoryBlock = ({\n  memory,\n  jmp = { value: 0 },\n  highlight = -1,\n  editable = false,\n  format = dec,\n  onChange = () => undefined,\n  onFocus = () => undefined,\n}: {\n  jmp?: { value: number };\n  memory: MemoryChip;\n  highlight?: number;\n  editable?: boolean;\n  format?: (v: number) => string;\n  onChange?: (i: number, value: string, previous: number) => void;\n  onFocus?: (i: number) => void;\n}) => {\n  const settings = useMemo<Partial<VirtualScrollSettings>>(\n    () => ({\n      count: Math.min(memory.size, 20),\n      maxIndex: memory.size,\n      itemHeight: ITEM_HEIGHT,\n      startIndex: jmp.value,\n    }),\n    [memory.size, jmp]\n  );\n  const get = useCallback(\n    (offset: number, count: number) =>\n      memory\n        .range(offset, offset + count)\n        .map((v, i) => [i + offset, v] as [number, number]),\n    [memory]\n  );\n  const row = useCallback(\n    ([i, v]: [number, number]) => (\n      <MemoryCell\n        index={i}\n        value={format(v)}\n        editable={editable}\n        highlight={i === highlight}\n        onChange={onChange}\n        onFocus={onFocus}\n      />\n    ),\n    [format, editable, highlight, onChange]\n  );\n\n  return (\n    <VirtualScroll<[number, number], ReactNode>\n      settings={settings}\n      get={get}\n      row={row}\n      rowKey={([i]) => i}\n    />\n  );\n};\n\nexport const MemoryCell = ({\n  index,\n  value,\n  highlight = false,\n  editable = false,\n  onChange = () => undefined,\n  onFocus = () => undefined,\n}: {\n  index: number;\n  value: string;\n  highlight?: boolean;\n  editable?: boolean;\n  onChange?: (i: number, value: string, previous: number) => void;\n  onFocus?: (i: number) => void;\n}) => (\n  <div style={{ display: \"flex\", height: \"100%\" }}>\n    <code\n      style={{\n        ...rounded(\"none\"),\n        ...(highlight\n          ? { background: \"var(--code-kbd-background-color)\", color: \"white\" }\n          : {}),\n      }}\n    >\n      {hex(index)}\n    </code>\n    <code\n      style={{\n        flex: \"1\",\n        textAlign: \"right\",\n        ...rounded(\"none\"),\n        ...(highlight\n          ? { background: \"var(--code-kbd-background-color)\", color: \"white\" }\n          : {}),\n      }}\n    >\n      {editable ? (\n        <InlineEdit\n          value={value}\n          highlight={highlight}\n          onChange={(newValue: string) =>\n            onChange(index, newValue, Number(value))\n          }\n          onFocus={() => onFocus(index)}\n        />\n      ) : (\n        <span>{value}</span>\n      )}\n    </code>\n  </div>\n);\n\nexport const Memory = ({\n  name = \"Memory\",\n  highlight = -1,\n  editable = true,\n  memory,\n  format = \"dec\",\n}: {\n  name?: string;\n  editable?: boolean;\n  highlight?: number;\n  memory: MemoryChip;\n  format: Format;\n}) => {\n  const [fmt, setFormat] = useState(format);\n  const [jmp, setJmp] = useState(\"\");\n  const [goto, setGoto] = useState({ value: 0 });\n  const [highlighted, setHighlighted] = useState(0);\n\n  const jumpTo = () => {\n    const value =\n      !isNaN(parseInt(jmp)) && isFinite(parseInt(jmp)) ? Number(jmp) : 0;\n    setHighlighted(value);\n    setGoto({\n      value: value,\n    });\n  };\n\n  // const { filePicker, fs } = useContext(AppContext);\n  // const doLoad = useCallback(async () => {\n  //   try {\n  //     const file = await filePicker.select();\n  //     await memory.load(fs, file);\n  //   } catch (e) {\n  //     console.error(e);\n  //   }\n  // }, [fs, filePicker, memory]);\n\n  const doLoad = () => undefined;\n\n  const doUpdate = useCallback(\n    (i: number, v: string) => {\n      memory.update(i, v, fmt ?? \"dec\");\n    },\n    [memory, fmt]\n  );\n\n  useClockReset(() => {\n    setJmp(\"\");\n    setGoto({ value: 0 });\n  });\n\n  return (\n    <article className=\"panel\">\n      <header>\n        <div>{name}</div>\n        <fieldset role=\"group\">\n          <button onClick={doLoad} className=\"flex-0\">\n            {/* <Icon name=\"upload_file\" /> */}\n            \n          </button>\n          <input\n            style={{ width: \"4em\", height: \"100%\" }}\n            placeholder=\"Goto\"\n            value={jmp}\n            onKeyDown={({ key }) => key === \"Enter\" && jumpTo()}\n            onChange={({ target: { value } }) => setJmp(value)}\n          />\n          <button onClick={jumpTo} className=\"flex-0\">\n            {/* <Icon name=\"move_down\" /> */}\n            \n          </button>\n          {FORMATS.map((option) => (\n            <label\n              className=\"flex-0\"\n              key={option}\n              role=\"button\"\n              aria-current={option === fmt}\n            >\n              <input\n                type=\"radio\"\n                name={name}\n                value={option}\n                checked={option === fmt}\n                onChange={() => setFormat(option)}\n              />\n              {option}\n            </label>\n          ))}\n        </fieldset>\n      </header>\n      <MemoryBlock\n        jmp={goto}\n        memory={memory}\n        highlight={highlighted}\n        editable={editable}\n        format={(v: number) => doFormat(fmt, v)}\n        onChange={doUpdate}\n        onFocus={(i) => setHighlighted(i)}\n      />\n    </article>\n  );\n};\n\nexport default Memory;\n\nfunction doFormat(format: Format, v: number): string {\n  switch (format) {\n    case \"bin\":\n      return bin(v);\n    case \"hex\":\n      return hex(v);\n    case \"asm\":\n      return asm(v);\n    case \"dec\":\n    default:\n      return dec(v);\n  }\n}\n","import { Memory } from \"@nand2tetris/simulator/cpu/memory.js\";\nimport { assertExists } from \"@davidsouther/jiffies/lib/esm/assert.js\";\nimport { useCallback, useRef } from \"react\";\nimport { useClockFrame, useClockReset } from \"../clockface.js\";\n\nconst WHITE = \"white\";\nconst BLACK = \"black\";\ntype COLOR = typeof WHITE | typeof BLACK;\n\nexport interface ScreenMemory {\n  get(idx: number): number;\n}\n\nexport function reduceScreen(memory: Memory, offset = 0): ScreenMemory {\n  return {\n    get(idx: number): number {\n      return memory.get(offset + idx);\n    },\n  };\n}\n\nfunction get(mem: ScreenMemory, x: number, y: number): COLOR {\n  const byte = mem.get(32 * y + ((x / 16) | 0));\n  const bit = byte & (1 << x % 16);\n  return bit === 0 ? WHITE : BLACK;\n}\n\nfunction set(data: Uint8ClampedArray, x: number, y: number, value: COLOR) {\n  const pixel = (y * 512 + x) * 4;\n  const color = value === WHITE ? 255 : 0;\n  data[pixel] = color;\n  data[pixel + 1] = color;\n  data[pixel + 2] = color;\n  data[pixel + 3] = 255;\n}\n\nfunction drawImage(ctx: CanvasRenderingContext2D, memory: ScreenMemory) {\n  const image = assertExists(\n    ctx.getImageData(0, 0, 512, 256),\n    \"Failed to create Context2d\"\n  );\n  for (let col = 0; col < 512; col++) {\n    for (let row = 0; row < 256; row++) {\n      const color = get(memory, col, row);\n      set(image.data, col, row, color);\n    }\n  }\n  ctx.putImageData(image, 0, 0);\n}\n\nexport const Screen = ({ memory }: { memory: ScreenMemory }) => {\n  const canvas = useRef<HTMLCanvasElement>();\n\n  const draw = useCallback(() => {\n    const ctx = canvas.current?.getContext(\"2d\") ?? undefined;\n\n    if (ctx) {\n      drawImage(ctx, memory);\n    }\n  }, [memory]);\n\n  const ctxRef = useCallback(\n    (ref: HTMLCanvasElement | null) => {\n      canvas.current = ref ?? undefined;\n      draw();\n    },\n    [canvas, draw]\n  );\n\n  useClockFrame(draw);\n  useClockReset(() => {\n    canvas.current\n      ?.getContext(\"2d\")\n      ?.clearRect(0, 0, canvas.current.width, canvas.current.height);\n  });\n\n  return (\n    <article className=\"panel\">\n      <header>Screen</header>\n      <main>\n        <figure\n          style={{\n            width: \"100%\",\n            maxWidth: \"512px\",\n            boxSizing: \"content-box\",\n            marginInline: \"auto\",\n            margin: \"0\",\n            borderTop: \"2px solid gray\",\n            borderLeft: \"2px solid gray\",\n            borderBottom: \"2px solid lightgray\",\n            borderRight: \"2px solid lightgray\",\n          }}\n        >\n          <canvas ref={ctxRef} width={512} height={256}></canvas>\n        </figure>\n      </main>\n    </article>\n  );\n};\n","import {\n  Keyboard,\n  Screen,\n} from \"@nand2tetris/simulator/chip/builtins/computer/computer.js\";\nimport { ALU } from \"@nand2tetris/simulator/chip/builtins/index.js\";\nimport {\n  PC,\n  Register,\n} from \"@nand2tetris/simulator/chip/builtins/sequential/bit.js\";\nimport {\n  RAM,\n  RAM8,\n} from \"@nand2tetris/simulator/chip/builtins/sequential/ram.js\";\nimport { Chip, HIGH } from \"@nand2tetris/simulator/chip/chip.js\";\nimport { Flags } from \"@nand2tetris/simulator/cpu/alu.js\";\nimport { CPU, decode } from \"@nand2tetris/simulator/cpu/cpu.js\";\nimport { ReactElement } from \"react\";\nimport { ALUComponent } from \"./alu.js\";\nimport { Keyboard as KeyboardComponent } from \"./keyboard.js\";\nimport { Memory as MemoryComponent } from \"./memory.js\";\nimport { RegisterComponent } from \"./register.js\";\nimport { Screen as ScreenComponent } from \"./screen.js\";\n\nexport function getBuiltinVisualization(part: Chip): ReactElement | undefined {\n  switch (part.name) {\n    case \"Register\":\n    case \"ARegister\":\n    case \"DRegister\":\n    case \"PC\":\n    case \"KEYBOARD\":\n    case \"RAM8\":\n    case \"RAM64\":\n    case \"RAM512\":\n    case \"RAM4K\":\n    case \"RAM16K\":\n    case \"ROM32K\":\n    case \"Screen\":\n    case \"Memory\":\n    default:\n      return undefined;\n  }\n}\n\nexport function makeVisualization(\n  chip: Chip,\n  updateAction?: () => void\n): ReactElement | undefined {\n  if (chip instanceof ALU) {\n    return (\n      <ALUComponent\n        A={chip.in(\"x\").busVoltage}\n        op={chip.op()}\n        D={chip.in(\"y\").busVoltage}\n        out={chip.out().busVoltage}\n        flag={\n          (chip.out(\"zr\").voltage() === HIGH\n            ? Flags.Zero\n            : chip.out(\"ng\").voltage() === HIGH\n            ? Flags.Negative\n            : Flags.Positive) as keyof typeof Flags\n        }\n      />\n    );\n  }\n  if (chip instanceof Register) {\n    return (\n      <RegisterComponent\n        name={chip.name ?? `Chip ${chip.id}`}\n        bits={chip.bits}\n      />\n    );\n  }\n  if (chip instanceof PC) {\n    return <RegisterComponent name=\"PC\" bits={chip.bits} />;\n  }\n  if (chip instanceof Keyboard) {\n    return <KeyboardComponent keyboard={chip} update={updateAction} />;\n  }\n  if (chip instanceof Screen) {\n    return <ScreenComponent memory={chip.memory} />;\n  }\n  if (chip instanceof RAM) {\n    return (\n      <MemoryComponent\n        name={chip.name}\n        memory={chip.memory}\n        format=\"dec\"\n        highlight={chip.address}\n      />\n    );\n  }\n  if (chip instanceof RAM8) {\n    return <span>RAM {chip.width}</span>;\n  }\n  if (chip instanceof CPU) {\n    const bits = decode(chip.in(\"instruction\").busVoltage);\n    return (\n      <>\n        <RegisterComponent name={\"A\"} bits={chip.state.A} />\n        <RegisterComponent name={\"D\"} bits={chip.state.D} />\n        <RegisterComponent name={\"PC\"} bits={chip.state.PC} />\n        <ALUComponent\n          A={bits.am ? chip.in(\"inM\").busVoltage : chip.state.A}\n          D={chip.state.D}\n          out={chip.state.ALU}\n          op={bits.op}\n          flag={chip.state.flag as keyof typeof Flags}\n        />\n      </>\n    );\n  }\n\n  const vis = [...chip.parts]\n    .map((chip) => makeVisualization(chip, updateAction))\n    .filter((v) => v !== undefined);\n  return vis.length > 0 ? <>{vis}</> : undefined;\n}\n\nexport function makeVisualizationsWithId(\n  chip: {\n    parts: Chip[];\n  },\n  updateAction?: () => void\n): [string, ReactElement][] {\n  return [...chip.parts]\n    .map((part, i): [string, ReactElement | undefined] => [\n      `${part.id}_${i}`,\n      makeVisualization(part, updateAction),\n    ])\n    .filter(([_, v]) => v !== undefined) as [string, ReactElement][];\n}\n","import { Ok, isOk } from \"@davidsouther/jiffies/lib/esm/result.js\";\nimport {\n  REGISTRY as BUILTIN_REGISTRY,\n  getBuiltinChip,\n} from \"@nand2tetris/simulator/chip/builtins/index.js\";\n\nexport class ChipDisplayInfo {\n  signBehaviors: Map<string, boolean> = new Map();\n\n  public constructor(chipName: string, unsigned?: string[]) {\n    if (BUILTIN_REGISTRY.has(chipName)) {\n      const chip = getBuiltinChip(chipName);\n      if (isOk(chip)) {\n        const pins = Array.from(Ok(chip).ins.entries()).concat(\n          Array.from(Ok(chip).outs.entries())\n        );\n        for (const pin of pins) {\n          this.signBehaviors.set(\n            pin.name,\n            !unsigned || !unsigned.includes(pin.name)\n          );\n        }\n      }\n    }\n  }\n\n  public isSigned(pin: string) {\n    return this.signBehaviors.get(pin);\n  }\n}\n\nconst UNSIGNED_PINS = new Map<string, string[]>([\n  [\"Mux4Way16\", [\"sel\"]],\n  [\"Mux8Way16\", [\"sel\"]],\n  [\"DMux4Way\", [\"sel\"]],\n  [\"DMux8Way\", [\"sel\"]],\n  [\"RAM8\", [\"address\"]],\n  [\"RAM64\", [\"address\"]],\n  [\"RAM512\", [\"address\"]],\n  [\"RAM4K\", [\"address\"]],\n  [\"RAM16K\", [\"address\"]],\n  [\"Screen\", [\"address\"]],\n  [\"Memory\", [\"address\"]],\n  [\"CPU\", [\"addressM\", \"pc\"]],\n]);\n\nexport const getDisplayInfo = (chipName: string) =>\n  new ChipDisplayInfo(chipName, UNSIGNED_PINS.get(chipName));\n","// import { plural, Trans } from \"@lingui/macro\";\nimport {\n  Pin as ChipPin,\n  Pins,\n  Voltage,\n} from \"@nand2tetris/simulator/chip/chip.js\";\nimport { range } from \"@davidsouther/jiffies/lib/esm/range.js\";\nimport { ChipSim } from \"./stores/chip.store.js\";\nimport { createContext, useContext, useEffect, useState } from \"react\";\nimport { ChipDisplayInfo, getDisplayInfo } from \"./pin_display.js\";\n\nexport const PinContext = createContext({});\n\nexport interface ImmPin {\n  bits: [number, Voltage][];\n  pin: ChipPin;\n}\n\nexport function reducePin(pin: ChipPin) {\n  return {\n    pin,\n    bits: range(0, pin.width)\n      .map((i) => [i, pin.voltage(i)] as [number, Voltage])\n      .reverse(),\n  };\n}\n\nexport function reducePins(pins: Pins): ImmPin[] {\n  return [...pins.entries()].map(reducePin);\n}\n\nexport interface PinoutPins {\n  pins: ImmPin[];\n  toggle?: (pin: ChipPin, bit?: number) => void;\n}\n\nexport const FullPinout = (props: {\n  sim: ChipSim;\n  toggle: (pin: ChipPin, i: number | undefined) => void;\n  setInputValid: (pending: boolean) => void;\n  hideInternal?: boolean;\n}) => {\n  const { inPins, outPins, internalPins } = props.sim;\n  const displayInfo = getDisplayInfo(props.sim.chip[0].name ?? \"\");\n  return (\n    <>\n      <style>{`\n        table.pinout th {\n          font-weight: bold;\n        }\n\n        table.pinout tbody td:first-child {\n          text-align: right;\n          --font-size: 1rem;\n          width: 0;\n          white-space: nowrap;\n          border-right: var(--border-width) solid var(--table-border-color);\n        }\n\n        table.pinout tbody button {\n          --font-size: 0.875em;\n          font-family: var(--font-family-monospace);\n          max-width: 2em;\n        }\n        `}</style>\n      <table className=\"pinout\">\n        <tbody>\n          <PinoutBlock\n            pins={inPins}\n            header=\"Input pins\"\n            toggle={props.toggle}\n            setInputValid={props.setInputValid}\n            displayInfo={displayInfo}\n          />\n          <PinoutBlock\n            pins={outPins}\n            header=\"Output pins\"\n            disabled={props.sim.pending}\n            enableEdit={false}\n            displayInfo={displayInfo}\n          />\n          {!props.hideInternal && (\n            <PinoutBlock\n              pins={internalPins}\n              header=\"Internal pins\"\n              disabled={props.sim.pending}\n              enableEdit={false}\n              displayInfo={displayInfo}\n            />\n          )}\n        </tbody>\n      </table>\n    </>\n  );\n};\n\nexport const PinoutBlock = (\n  props: PinoutPins & {\n    header: string;\n    disabled?: boolean;\n    enableEdit?: boolean;\n    setInputValid?: (valid: boolean) => void;\n    displayInfo: ChipDisplayInfo;\n  }\n) => (\n  <>\n    {props.pins.length > 0 && (\n      <tr>\n        <th colSpan={2}>{props.header}</th>\n      </tr>\n    )}\n    {[...props.pins].map((immPin) => (\n      <tr key={immPin.pin.name}>\n        <td>{immPin.pin.name}</td>\n        <td>\n          <Pin\n            pin={immPin}\n            toggle={props.toggle}\n            disabled={props.disabled}\n            enableEdit={props.enableEdit}\n            signed={props.displayInfo.isSigned(immPin.pin.name)}\n            setInputValid={props.setInputValid}\n            internal={props.header === \"Internal pins\" ? true : false}\n          />\n        </td>\n      </tr>\n    ))}\n  </>\n);\n\nexport const Pinout = ({\n  pins,\n  toggle,\n}: {\n  pins: ImmPin[];\n  toggle?: (pin: ChipPin, bit?: number) => void;\n}) => {\n  if (pins.length === 0) {\n    return <>None</>;\n  }\n  return (\n    <table className=\"pinout\">\n      <thead>\n        <tr>\n          <th>Name</th>\n          <th>Value</th>\n        </tr>\n      </thead>\n      <tbody>\n        {[...pins].map((immPin) => (\n          <tr key={immPin.pin.name}>\n            <td>{immPin.pin.name}</td>\n            <td>\n              <Pin pin={immPin} toggle={toggle} internal />\n            </td>\n          </tr>\n        ))}\n      </tbody>\n    </table>\n  );\n};\n\nconst Pin = ({\n  pin,\n  toggle,\n  disabled = false,\n  enableEdit = true,\n  signed = true,\n  setInputValid,\n  internal = false,\n}: {\n  pin: ImmPin;\n  toggle: ((pin: ChipPin, bit?: number) => void) | undefined;\n  disabled?: boolean;\n  enableEdit?: boolean;\n  signed?: boolean;\n  setInputValid?: (valid: boolean) => void;\n  internal: boolean;\n}) => {\n  const [isBin, setIsBin] = useState(true);\n  let inputValid = true;\n  const [decimal, setDecimal] = useState(\"\");\n\n  const toggleBin = () => {\n    setIsBin(!isBin);\n  };\n\n  const resetDispatcher = useContext(PinContext);\n  if (resetDispatcher instanceof PinResetDispatcher) {\n    resetDispatcher.registerCallback(() => {\n      setIsBin(true);\n    });\n  }\n\n  const setInputValidity = (valid: boolean) => {\n    inputValid = valid;\n    setInputValid?.(valid);\n  };\n\n  const handleDecimalChange = (value: string) => {\n    const positive = value.replace(/[^\\d]/g, \"\");\n    const numeric = signed && value[0] === \"-\" ? `-${positive}` : positive;\n\n    setDecimal(numeric);\n    if (isNaN(parseInt(numeric))) {\n      setInputValidity(false);\n    } else {\n      const newValue = parseInt(numeric);\n      if (\n        (!signed && newValue >= Math.pow(2, pin.bits.length)) ||\n        (signed &&\n          (newValue >= Math.pow(2, pin.bits.length - 1) ||\n            newValue < -Math.pow(2, pin.bits.length - 1)))\n      ) {\n        setInputValidity(false);\n      } else {\n        updatePins(newValue);\n        setInputValidity(true);\n      }\n    }\n  };\n\n  const updatePins = (n: number) => {\n    for (let i = 0; i < pin.bits.length; i++) {\n      if (pin.bits[pin.bits.length - i - 1][1] !== ((n >> i) & 1)) {\n        toggle?.(pin.pin, i);\n      }\n    }\n  };\n\n  useEffect(() => {\n    if (!isBin && inputValid) {\n      let value = 0;\n      if (signed && pin.bits[0][1]) {\n        // negative\n        for (const [i, v] of pin.bits) {\n          if (i < pin.bits.length - 1 && !v) {\n            value += 2 ** i;\n          }\n        }\n        value = -value - 1;\n      } else {\n        // positive\n        const limit = signed ? pin.bits.length - 1 : pin.bits.length;\n        for (const [i, v] of pin.bits) {\n          if (i < limit && v) {\n            value += 2 ** i;\n          }\n        }\n      }\n      setDecimal(value.toString());\n    }\n  }, [pin, isBin]);\n\n  return (\n    <div\n      style={{ display: \"flex\", flexDirection: \"row\", alignItems: \"center\" }}\n    >\n      <fieldset role=\"group\" style={{ width: `${pin.bits.length}rem` }}>\n        {isBin ? (\n          pin.bits.map(([i, v]) => (\n            <button\n              key={i}\n              disabled={disabled}\n              style={internal ? { backgroundColor: \"grey\" } : {}}\n              onClick={() => toggle?.(pin.pin, i)}\n              data-testid={`pin-${i}`}\n            >\n              {v}\n            </button>\n          ))\n        ) : (\n          <input\n            className=\"colored\"\n            value={decimal}\n            onChange={(e) => {\n              handleDecimalChange(e.target.value);\n            }}\n            disabled={!enableEdit}\n          />\n        )}\n      </fieldset>\n      {pin.bits.length > 1 && (\n        <>\n          <div style={{ width: \"1em\" }} />\n          <button\n            style={{ maxWidth: \"3em\", margin: 0 }}\n            onClick={() => toggleBin()}\n          >\n            {isBin ? \"dec\" : \"bin\"}\n          </button>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport class PinResetDispatcher {\n  private callbacks: (() => void)[] = [];\n\n  registerCallback(callback: () => void) {\n    this.callbacks.push(callback);\n  }\n\n  reset() {\n    for (const callback of this.callbacks) {\n      callback();\n    }\n  }\n}\n","import { ReactNode } from \"react\";\nimport { Timer } from \"@nand2tetris/simulator/timer.js\";\nimport { useTimer } from \"./timer.js\";\n\nexport const Runbar = (props: { runner: Timer; children?: ReactNode }) => {\n  const runner = useTimer(props.runner);\n  return (\n    <fieldset role=\"group\">\n      <button\n        className=\"flex-0\"\n        onClick={() => runner.actions.frame()}\n        data-tooltip={`Step`}\n        data-placement=\"bottom\"\n      >\n        {/* <Icon name=\"play_arrow\" /> */}\n        \n      </button>\n      <button\n        className=\"flex-0\"\n        onClick={() =>\n          runner.state.running ? runner.actions.stop() : runner.actions.start()\n        }\n        data-tooltip={runner.state.running ? `Pause` : `Play`}\n        data-placement=\"bottom\"\n      >\n        {/* <Icon name={runner.state.running ? \"pause\" : \"fast_forward\"} /> */}\n        {runner.state.running ? \"\" : \"\"}\n      </button>\n      <button\n        className=\"flex-0\"\n        onClick={() => runner.actions.reset()}\n        data-tooltip={`Reset`}\n        data-placement=\"bottom\"\n      >\n        {/* <Icon name=\"fast_rewind\" /> */}\n      </button>\n      <select\n        className=\"flex-1\"\n        name=\"speed\"\n        value={runner.state.speed}\n        onChange={(e) => {\n          runner.dispatch({\n            action: \"setSpeed\",\n            payload: Number(e.target?.value ?? runner.state.speed),\n          });\n        }}\n        disabled={runner.state.running}\n      >\n        {[\n          // [2000, `Debug`], // For debugging, basically the same as clicking through\n          [1000, `Slow`],\n          [500, `Fast`],\n          [16, `Faster`],\n        ].map(([speed, label]) => (\n          <option key={speed} value={speed}>\n            {label}\n          </option>\n        ))}\n      </select>\n      <select\n        className=\"flex-1\"\n        name=\"steps\"\n        value={runner.state.steps}\n        onChange={(e) => {\n          runner.dispatch({\n            action: \"setSteps\",\n            payload: Number(e.target?.value ?? runner.state.steps),\n          });\n        }}\n        disabled={runner.state.running}\n      >\n        {[\n          [1, `1 Step`],\n          [500, \"500\"],\n          [1000, \"1000\"],\n          [2000, \"2000\"],\n        ].map(([steps, label]) => (\n          <option key={steps} value={steps}>\n            {label}\n          </option>\n        ))}\n      </select>\n      {props.children}\n    </fieldset>\n  );\n};\n","import { Timer } from \"@nand2tetris/simulator/timer.js\";\nimport { useImmerReducer } from \"./react.js\";\n\nexport interface TimerStoreState {\n  steps: number;\n  speed: number;\n  running: boolean;\n}\n\nimport { Dispatch, MutableRefObject, useMemo, useRef } from \"react\";\nexport type TimerStoreDispatch = Dispatch<{\n  action: keyof ReturnType<typeof makeTimerStore>[\"reducers\"];\n  payload?: unknown;\n}>;\n\nconst makeTimerStore = (\n  timer: Timer,\n  dispatch: MutableRefObject<TimerStoreDispatch>\n) => {\n  const initialState: TimerStoreState = {\n    running: timer.running,\n    speed: timer.speed,\n    steps: timer.steps,\n  };\n\n  const finishFrame = timer.finishFrame.bind(timer);\n  timer.finishFrame = function () {\n    finishFrame();\n    dispatch.current({ action: \"update\" });\n  };\n\n  const reducers = {\n    update(state: TimerStoreState) {\n      state.running = timer.running;\n      state.speed = timer.speed;\n      state.steps = timer.steps;\n    },\n    setSteps(state: TimerStoreState, steps: number) {\n      state.steps = steps;\n      timer.steps = steps;\n    },\n    setSpeed(state: TimerStoreState, speed: number) {\n      state.speed = speed;\n      timer.speed = speed;\n    },\n  };\n\n  const actions = {\n    frame() {\n      timer.frame();\n    },\n    start() {\n      timer.start();\n      dispatch.current({ action: \"update\" });\n    },\n    stop() {\n      timer.stop();\n      dispatch.current({ action: \"update\" });\n    },\n    reset() {\n      timer.reset();\n      dispatch.current({ action: \"update\" });\n    },\n  };\n\n  return { initialState, reducers, actions };\n};\n\nexport function useTimer(timer: Timer) {\n  const dispatch = useRef<TimerStoreDispatch>(() => undefined);\n\n  const { initialState, reducers, actions } = useMemo(\n    () => makeTimerStore(timer, dispatch),\n    [timer, dispatch]\n  );\n\n  const [state, dispatcher] = useImmerReducer(reducers, initialState);\n\n  dispatch.current = dispatcher;\n\n  return { state, dispatch: dispatch.current, actions };\n}\n","import { display } from \"@davidsouther/jiffies/lib/esm/display.js\";\nimport { FileSystem } from \"@davidsouther/jiffies/lib/esm/fs.js\";\nimport { Err, isErr, Ok } from \"@davidsouther/jiffies/lib/esm/result.js\";\nimport { Dispatch, MutableRefObject, useContext, useMemo, useRef } from \"react\";\n\nimport { build as buildChip } from \"@nand2tetris/simulator/chip/builder.js\";\nimport {\n  getBuiltinChip,\n  REGISTRY,\n} from \"@nand2tetris/simulator/chip/builtins/index.js\";\nimport {\n  Chip,\n  Chip as SimChip,\n  Low,\n  Pin,\n} from \"@nand2tetris/simulator/chip/chip.js\";\nimport { Clock } from \"@nand2tetris/simulator/chip/clock.js\";\nimport { Span } from \"@nand2tetris/simulator/languages/base.js\";\nimport { HDL } from \"@nand2tetris/simulator/languages/hdl.js\";\nimport { TST } from \"@nand2tetris/simulator/languages/tst.js\";\nimport {\n  BUILTIN_CHIP_PROJECTS,\n  CHIP_ORDER,\n  CHIP_PROJECTS,\n  ChipProjects,\n} from \"@nand2tetris/projects/index.js\";\nimport { ChipTest } from \"@nand2tetris/simulator/tst.js\";\n\nimport { ImmPin, reducePins } from \"../pinout.js\";\nimport { useImmerReducer } from \"../react.js\";\n\nimport { BaseContext } from \"./base.context.js\";\nimport { assert } from \"@davidsouther/jiffies/lib/esm/assert.js\";\n\nexport const PROJECT_NAMES = [\n  [\"01\", `Project 1`],\n  [\"02\", `Project 2`],\n  [\"03\", `Project 3`],\n  [\"05\", `Project 5`],\n];\n\nfunction getChips(project: keyof typeof CHIP_PROJECTS) {\n  return project in CHIP_ORDER\n    ? (CHIP_ORDER as Record<typeof project, string[]>)[project]\n    : BUILTIN_CHIP_PROJECTS[project].concat(CHIP_PROJECTS[project]);\n}\n\nfunction findDropdowns(storage: Record<string, string>) {\n  const project =\n    (storage[\"/chip/project\"] as keyof typeof CHIP_PROJECTS) ?? \"01\";\n  const chips = getChips(project);\n  const chipName = storage[\"/chip/chip\"] ?? CHIP_PROJECTS[project][0];\n  return { project, chips, chipName };\n}\n\nfunction makeHdl(name: string) {\n  return `CHIP ${name} {\n  IN in;\n  OUT out;\n  PARTS:\n}`;\n}\n\nfunction makeTst() {\n  return `repeat 10 {\n  tick,\n  tock;\n}`;\n}\n\nfunction makeCmp() {\n  return `| in|out|`;\n}\n\nexport function isBuiltinOnly(chipName: string) {\n  return Object.values(BUILTIN_CHIP_PROJECTS).flat().includes(chipName);\n}\n\nfunction getTemplate(project: keyof typeof CHIP_PROJECTS, chipName: string) {\n  if (isBuiltinOnly(chipName)) {\n    return (ChipProjects[project].BUILTIN_CHIPS as Record<string, string>)[\n      chipName\n    ];\n  }\n\n  return (\n    ChipProjects[project].CHIPS as Record<string, Record<string, string>>\n  )[chipName][`${chipName}.hdl`] as string;\n}\n\nfunction getBuiltinCode(project: keyof typeof CHIP_PROJECTS, chipName: string) {\n  const template = getTemplate(project, chipName);\n  if (isBuiltinOnly(chipName)) {\n    return template;\n  }\n  const bodyComment = \"//// Replace this comment with your code.\";\n  const builtinLine = `BUILTIN ${chipName};`;\n  const builtinCode = template.includes(bodyComment)\n    ? template.replace(bodyComment, builtinLine)\n    : template.replace(\"PARTS:\", `PARTS:\\n    ${builtinLine}`);\n  return builtinCode;\n}\n\nexport interface ChipPageState {\n  files: Files;\n  sim: ChipSim;\n  controls: ControlsState;\n}\n\nexport interface ChipSim {\n  clocked: boolean;\n  inPins: ImmPin[];\n  outPins: ImmPin[];\n  internalPins: ImmPin[];\n  chip: [Chip];\n  pending: boolean;\n  invalid: boolean;\n}\n\nexport interface Files {\n  hdl: string;\n  cmp: string;\n  tst: string;\n  out: string;\n}\n\nexport interface ControlsState {\n  project: keyof typeof CHIP_PROJECTS;\n  chips: string[];\n  chipName: string;\n  hasBuiltin: boolean;\n  builtinOnly: boolean;\n  runningTest: boolean;\n  span?: Span;\n  error: string;\n}\n\nfunction reduceChip(chip: SimChip, pending = false, invalid = false): ChipSim {\n  return {\n    clocked: chip.clocked,\n    inPins: reducePins(chip.ins),\n    outPins: reducePins(chip.outs),\n    internalPins: reducePins(chip.pins),\n    chip: [chip],\n    pending,\n    invalid,\n  };\n}\n\nconst clock = Clock.get();\n\nexport type ChipStoreDispatch = Dispatch<{\n  action: keyof ReturnType<typeof makeChipStore>[\"reducers\"];\n  payload?: unknown;\n}>;\n\nexport function makeChipStore(\n  fs: FileSystem,\n  setStatus: (status: string) => void,\n  storage: Record<string, string>,\n  dispatch: MutableRefObject<ChipStoreDispatch>\n) {\n  const dropdowns = findDropdowns(storage);\n  let { project, chipName } = dropdowns;\n  const { chips } = dropdowns;\n  let chip = new Low();\n  let test = new ChipTest();\n  let usingBuiltin = false;\n  let builtinOnly = false;\n\n  const reducers = {\n    setFiles(\n      state: ChipPageState,\n      {\n        hdl = state.files.hdl,\n        tst = state.files.tst,\n        cmp = state.files.cmp,\n        out = \"\",\n      }: {\n        hdl?: string;\n        tst?: string;\n        cmp?: string;\n        out?: string;\n      }\n    ) {\n      state.files.hdl = hdl;\n      state.files.tst = tst;\n      state.files.cmp = cmp;\n      state.files.out = out;\n    },\n\n    updateChip(\n      state: ChipPageState,\n      payload?: {\n        pending?: boolean;\n        invalid?: boolean;\n        chipName?: string;\n        error?: string;\n      }\n    ) {\n      state.sim = reduceChip(\n        chip,\n        payload?.pending ?? state.sim.pending,\n        payload?.invalid ?? state.sim.invalid\n      );\n      state.controls.error = state.sim.invalid\n        ? payload?.error ?? state.controls.error\n        : \"\";\n      state.controls.chips = getChips(state.controls.project);\n      state.controls.chipName = state.sim.invalid\n        ? payload?.chipName ?? chipName\n        : chip.name ?? payload?.chipName ?? chipName;\n      if (!state.controls.chips.includes(state.controls.chipName)) {\n        state.controls.chips = [\n          ...state.controls.chips,\n          state.controls.chipName,\n        ];\n      }\n    },\n\n    setProject(state: ChipPageState, project: keyof typeof CHIP_PROJECTS) {\n      const chips = getChips(project);\n      const chipName =\n        state.controls.chipName && chips.includes(state.controls.chipName)\n          ? state.controls.chipName\n          : chips[0];\n      state.controls.project = project;\n      state.controls.chips = chips;\n      this.setChip(state, chipName);\n    },\n\n    setChip(state: ChipPageState, chipName: string) {\n      state.controls.chipName = chipName;\n      state.controls.hasBuiltin = REGISTRY.has(chipName);\n      state.controls.builtinOnly = isBuiltinOnly(chipName);\n    },\n\n    testRunning(state: ChipPageState) {\n      state.controls.runningTest = true;\n    },\n\n    testFinished(state: ChipPageState) {\n      state.controls.runningTest = false;\n      const passed = state.files.out.trim() === state.files.cmp.trim();\n      setStatus(\n        passed\n          ? `Simulation successful: The output file is identical to the compare file`\n          : `Simulation error: The output file differs from the compare file`\n      );\n    },\n\n    updateTestStep(state: ChipPageState) {\n      state.files.out = test?.log() ?? \"\";\n      if (test?.currentStep?.span) {\n        state.controls.span = test.currentStep.span;\n      } else {\n        if (test.done) {\n          const end = state.files.tst.length;\n          state.controls.span = {\n            start: end - 1,\n            end,\n          };\n        }\n      }\n      this.updateChip(state, {\n        pending: state.sim.pending,\n        invalid: state.sim.invalid,\n      });\n    },\n  };\n\n  const actions = {\n    setProject(p: keyof typeof CHIP_PROJECTS) {\n      project = storage[\"/chip/project\"] = p;\n      dispatch.current({ action: \"setProject\", payload: project });\n      this.setChip(CHIP_PROJECTS[project][0]);\n    },\n\n    async setChip(chip: string, project = storage[\"/chip/project\"] ?? \"01\") {\n      chipName = storage[\"/chip/chip\"] = chip;\n      dispatch.current({ action: \"setChip\", payload: chipName });\n      builtinOnly = isBuiltinOnly(chipName);\n\n      if (builtinOnly) {\n        dispatch.current({\n          action: \"setFiles\",\n          payload: { hdl: \"\", tst: \"\", cmp: \"\" },\n        });\n        this.useBuiltin();\n        return;\n      }\n      await this.loadChip(project, chipName);\n      if (usingBuiltin) {\n        this.useBuiltin();\n      }\n    },\n\n    reset() {\n      Clock.get().reset();\n      chip.reset();\n      test.reset();\n      dispatch.current({ action: \"setFiles\", payload: {} });\n      dispatch.current({ action: \"updateChip\" });\n    },\n\n    async updateFiles({\n      hdl,\n      tst,\n      cmp,\n    }: {\n      hdl?: string;\n      tst?: string;\n      cmp: string;\n    }) {\n      dispatch.current({ action: \"setFiles\", payload: { hdl, tst, cmp } });\n      try {\n        if (hdl) {\n          await this.compileChip(hdl);\n        }\n        if (tst) {\n          this.compileTest(tst);\n        }\n      } catch (e) {\n        setStatus(display(e));\n      }\n    },\n\n    async compileChip(hdl: string) {\n      chip.remove();\n      const maybeParsed = HDL.parse(hdl);\n      if (isErr(maybeParsed)) {\n        setStatus(\"Failed to parse chip\");\n        dispatch.current({\n          action: \"updateChip\",\n          payload: { invalid: true, error: display(Err(maybeParsed)) },\n        });\n        return;\n      }\n      const maybeChip = await buildChip(Ok(maybeParsed));\n      if (isErr(maybeChip)) {\n        const error = display(Err(maybeChip));\n        setStatus(error);\n        dispatch.current({\n          action: \"updateChip\",\n          payload: { invalid: true, error },\n        });\n        return;\n      }\n      setStatus(`Compiled ${chip.name}`);\n      this.replaceChip(Ok(maybeChip));\n    },\n\n    replaceChip(nextChip: SimChip) {\n      // Store current inPins\n      const inPins = chip.ins;\n      for (const [pin, { busVoltage }] of inPins) {\n        const nextPin = nextChip.ins.get(pin);\n        if (nextPin) {\n          nextPin.busVoltage = busVoltage;\n        }\n      }\n      clock.reset();\n      nextChip.eval();\n      chip = nextChip;\n      chip.reset();\n      test = test.with(chip).reset();\n      dispatch.current({ action: \"updateChip\", payload: { invalid: false } });\n      dispatch.current({ action: \"updateTestStep\" });\n    },\n\n    async loadChip(project: string, name: string) {\n      storage[\"/chip/chip\"] = name;\n      const fsName = (ext: string) =>\n        `/projects/${project}/${name}/${name}.${ext}`;\n\n      const [hdl, tst, cmp] = await Promise.all([\n        fs.readFile(fsName(\"hdl\")).catch(() => makeHdl(name)),\n        fs.readFile(fsName(\"tst\")).catch((e) => {\n          return makeTst();\n        }),\n        fs.readFile(fsName(\"cmp\")).catch(() => makeCmp()),\n      ]);\n\n      dispatch.current({ action: \"setFiles\", payload: { hdl, tst, cmp } });\n      await this.compileChip(hdl);\n      this.compileTest(tst);\n    },\n\n    async saveChip(hdl: string, prj = project, name = chipName) {\n      dispatch.current({ action: \"setFiles\", payload: { hdl } });\n      const path = `/projects/${prj}/${name}/${name}.hdl`;\n      await fs.writeFile(path, hdl);\n      setStatus(`Saved ${path}`);\n    },\n\n    toggle(pin: Pin, i: number | undefined) {\n      if (i !== undefined) {\n        pin.busVoltage = pin.busVoltage ^ (1 << i);\n      } else {\n        if (pin.width === 1) {\n          pin.toggle();\n        } else {\n          pin.busVoltage += 1;\n        }\n      }\n      dispatch.current({ action: \"updateChip\", payload: { pending: true } });\n    },\n\n    eval() {\n      chip.eval();\n      dispatch.current({ action: \"updateChip\", payload: { pending: false } });\n    },\n\n    clock() {\n      clock.toggle();\n      if (clock.isLow) {\n        clock.frame();\n      }\n      dispatch.current({ action: \"updateChip\" });\n    },\n\n    async useBuiltin(doUseBuiltin = true, oldHdl?: string) {\n      if (!doUseBuiltin) {\n        if (!builtinOnly) {\n          usingBuiltin = false;\n        }\n        await this.loadChip(project, chipName);\n        return;\n      }\n      if (!builtinOnly) {\n        usingBuiltin = true;\n      }\n      const builtinName = chipName;\n      const nextChip = getBuiltinChip(builtinName);\n      if (isErr(nextChip)) {\n        setStatus(\n          `Failed to load builtin ${builtinName}: ${display(Err(nextChip))}`\n        );\n        return;\n      }\n\n      // Save hdl code that will be overwritten by the switch\n      if (oldHdl) {\n        await this.saveChip(oldHdl, project, chipName);\n      }\n\n      const hdl = getBuiltinCode(project, builtinName);\n      dispatch.current({ action: \"setFiles\", payload: { hdl } });\n      this.replaceChip(Ok(nextChip));\n    },\n\n    async initialize() {\n      await this.setChip(chipName, project);\n    },\n\n    compileTest(file: string) {\n      dispatch.current({ action: \"setFiles\", payload: { tst: file } });\n      const tst = TST.parse(file);\n\n      if (isErr(tst)) {\n        setStatus(`Failed to parse test`);\n        return false;\n      }\n      setStatus(`Parsed tst`);\n\n      test = ChipTest.from(Ok(tst)).with(chip).reset();\n      test.setFileSystem(fs);\n      dispatch.current({ action: \"updateTestStep\" });\n      return true;\n    },\n\n    async runTest(file: string) {\n      if (!this.compileTest(file)) {\n        return;\n      }\n      dispatch.current({ action: \"testRunning\" });\n\n      fs.pushd(\"/samples\");\n      await test.run();\n      fs.popd();\n\n      dispatch.current({ action: \"updateTestStep\" });\n      dispatch.current({ action: \"testFinished\" });\n    },\n\n    tick(): Promise<boolean> {\n      return this.stepTest();\n    },\n\n    async stepTest(): Promise<boolean> {\n      assert(test.chipId === chip.id, \"Test and chip out of sync\");\n      const done = await test.step();\n      dispatch.current({ action: \"updateTestStep\" });\n      if (done) {\n        dispatch.current({ action: \"testFinished\" });\n      }\n      return done;\n    },\n  };\n\n  const initialState: ChipPageState = (() => {\n    const controls: ControlsState = {\n      project,\n      chips,\n      chipName,\n      hasBuiltin: REGISTRY.has(chipName),\n      builtinOnly: isBuiltinOnly(chipName),\n      runningTest: false,\n      error: \"\",\n    };\n\n    const maybeChip = getBuiltinChip(controls.chipName);\n    if (isErr(maybeChip)) {\n      setStatus(display(Err(maybeChip)));\n      chip = new Low();\n    } else {\n      chip = Ok(maybeChip);\n    }\n\n    const sim = reduceChip(chip);\n\n    return {\n      controls,\n      files: {\n        hdl: \"\",\n        cmp: \"\",\n        tst: \"\",\n        out: \"\",\n      },\n      sim,\n    };\n  })();\n\n  return { initialState, reducers, actions };\n}\n\nexport function useChipPageStore() {\n  const { fs, setStatus, storage } = useContext(BaseContext);\n\n  const dispatch = useRef<ChipStoreDispatch>(() => undefined);\n\n  const { initialState, reducers, actions } = useMemo(\n    () => makeChipStore(fs, setStatus, storage, dispatch),\n    [fs, setStatus, storage, dispatch]\n  );\n\n  const [state, dispatcher] = useImmerReducer(\n    reducers as unknown as Record<\n      string,\n      (state: ChipPageState, action?: unknown) => ChipPageState\n    >,\n    initialState\n  );\n  dispatch.current = dispatcher;\n\n  return { state, dispatch, actions };\n}\n","import { Clock } from \"./chip/clock.js\";\n\nexport const MAX_STEPS = 1000;\n\nconst clock = Clock.get();\n\nexport abstract class Timer {\n  frame() {\n    this.tick();\n    this.finishFrame();\n  }\n\n  abstract tick(): Promise<boolean> | boolean;\n\n  finishFrame() {\n    clock.frame();\n  }\n\n  abstract reset(): void;\n\n  abstract toggle(): void;\n\n  steps = 1; // How many steps to take per update\n  speed = 1000; // how often to update, in ms\n  get running() {\n    return this.#running;\n  }\n\n  #running = false;\n  #sinceLastFrame = 0;\n  #lastUpdate = 0;\n  #run = async () => {\n    if (!this.#running) {\n      return;\n    }\n    const now = Date.now();\n    const delta = now - this.#lastUpdate;\n    this.#lastUpdate = now;\n    this.#sinceLastFrame += delta;\n    if (this.#sinceLastFrame > this.speed) {\n      let done = false;\n      for (let i = 0; i < Math.min(this.steps, MAX_STEPS) && !done; i++) {\n        done = await this.tick();\n      }\n      this.finishFrame();\n      if (done) {\n        this.stop();\n      }\n      this.#sinceLastFrame -= this.speed;\n    }\n    requestAnimationFrame(this.#run);\n  };\n\n  start() {\n    this.#running = true;\n    this.#lastUpdate = Date.now() - this.speed;\n    this.#run();\n    this.toggle();\n  }\n\n  stop() {\n    this.#running = false;\n    this.toggle();\n  }\n}\n","import { debounce } from \"@davidsouther/jiffies/lib/esm/debounce\";\nimport { Trans } from \"@lingui/macro\";\nimport MonacoEditor, { useMonaco } from \"@monaco-editor/react\";\nimport type * as monacoT from \"monaco-editor/esm/vs/editor/editor.api\";\nimport { OnMount } from \"@monaco-editor/react\";\nimport ohm from \"ohm-js\";\nimport {\n  CSSProperties,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { AppContext } from \"../App.context\";\n\nimport {\n  Span,\n  UNKNOWN_PARSE_ERROR,\n} from \"@nand2tetris/simulator/languages/base.js\";\n\nimport \"./editor.scss\";\n\nexport const ErrorPanel = ({ error }: { error?: ohm.MatchResult }) => {\n  return error?.failed() ? (\n    <details className=\"ErrorPanel\" open>\n      <summary role=\"button\" className=\"secondary\">\n        <Trans>Parse Error</Trans>\n      </summary>\n      <pre>\n        <code>\n          {error?.message ?? error?.shortMessage ?? UNKNOWN_PARSE_ERROR}\n        </code>\n      </pre>\n    </details>\n  ) : (\n    <></>\n  );\n};\n\nconst Textarea = ({\n  value,\n  onChange,\n  language,\n  disabled = false,\n}: {\n  value: string;\n  onChange: (value: string) => void;\n  language: string;\n  disabled?: boolean;\n}) => {\n  const [text, setText] = useState(value);\n  return (\n    <textarea\n      data-testid={`editor-${language}`}\n      disabled={disabled}\n      value={text}\n      onChange={(e) => {\n        const value = e.target?.value;\n        setText(value);\n        onChange(value);\n      }}\n    />\n  );\n};\n\nconst MONACO_LIGHT_THEME = \"vs\";\nconst MONACO_DARK_THEME = \"vs-dark\";\n\nconst makeHighlight = (\n  monaco: typeof monacoT | null,\n  editor: monacoT.editor.IStandaloneCodeEditor | undefined,\n  highlight: Span | undefined,\n  decorations: string[]\n): string[] => {\n  if (!(editor && highlight)) return decorations;\n  const model = editor.getModel();\n  if (!model) return decorations;\n  const start = model.getPositionAt(highlight.start);\n  const end = model.getPositionAt(highlight.end);\n  const range = monaco?.Range.fromPositions(start, end);\n  const nextDecoration: monacoT.editor.IModelDeltaDecoration[] = [];\n  if (range) {\n    nextDecoration.push({\n      range,\n      options: { inlineClassName: \"highlight\" },\n    });\n    editor.revealRangeInCenter(range);\n  }\n  return editor.deltaDecorations(decorations, nextDecoration);\n};\n\nconst Monaco = ({\n  value,\n  onChange,\n  language,\n  error,\n  disabled = false,\n  highlight: currentHighlight,\n}: {\n  value: string;\n  onChange: (value: string) => void;\n  language: string;\n  error?: ohm.MatchResult | undefined;\n  disabled?: boolean;\n  highlight?: Span;\n}) => {\n  const { theme } = useContext(AppContext);\n  const monaco = useMonaco();\n\n  const editor = useRef<monacoT.editor.IStandaloneCodeEditor>();\n  const decorations = useRef<string[]>([]);\n  const highlight = useRef<Span | undefined>(undefined);\n\n  const codeTheme = useCallback(() => {\n    const isDark =\n      theme === \"system\"\n        ? window.matchMedia(\"(prefers-color-scheme: dark)\").matches\n        : theme === \"dark\";\n    return isDark ? MONACO_DARK_THEME : MONACO_LIGHT_THEME;\n  }, [theme]);\n\n  const doHighlight = useCallback(() => {\n    decorations.current = makeHighlight(\n      monaco,\n      editor.current,\n      // I'm not sure why this makes things work, but it is load bearing.\n      // Removing the empty span will cause the initial first-statement\n      // highlight in the test view to not show. Setting it to [0, 1] will\n      // cause a 1-character highlight in the editor view, so don't do that\n      // either.\n      highlight.current ?? { start: 0, end: 0 },\n      decorations.current\n    );\n  }, [decorations, monaco, editor, highlight]);\n\n  // Mark and center highlighted spans\n  useEffect(() => {\n    highlight.current = currentHighlight;\n    doHighlight();\n  }, [currentHighlight]);\n\n  // Set options when mounting\n  const onMount: OnMount = useCallback(\n    (ed) => {\n      editor.current = ed;\n      editor.current?.updateOptions({\n        fontFamily: `\"JetBrains Mono\", source-code-pro, Menlo, Monaco,\n      Consolas, \"Roboto Mono\", \"Ubuntu Monospace\", \"Noto Mono\", \"Oxygen Mono\",\n      \"Liberation Mono\", monospace, \"Apple Color Emoji\", \"Segoe UI Emoji\",\n      \"Segoe UI Symbol\", \"Noto Color Emoji\"`,\n        fontSize: 16,\n        minimap: {\n          enabled: false,\n        },\n        theme: codeTheme(),\n        scrollBeyondLastLine: false,\n        readOnly: disabled,\n      });\n      doHighlight();\n    },\n    [codeTheme]\n  );\n\n  // Set themes\n  useEffect(() => {\n    if (editor.current === undefined) return;\n    editor.current.updateOptions({ theme: codeTheme() });\n  }, [editor, codeTheme]);\n\n  // Prevent editing disabled editors\n  useEffect(() => {\n    if (editor.current === undefined) return;\n    editor.current.updateOptions({ readOnly: disabled });\n  }, [editor, disabled]);\n\n  // Add error markers on parse failure\n  useEffect(() => {\n    if (editor.current === undefined) return;\n    if (monaco === null) return;\n    const model = editor.current.getModel();\n    if (model === null) return;\n    if (error === undefined || error.succeeded()) {\n      monaco.editor.setModelMarkers(model, language, []);\n      return;\n    }\n    // Line 7, col 5:\n    const { line, column, message } =\n      /Line (?<line>\\d+), col (?<column>\\d+): (?<message>.*)/.exec(\n        error.shortMessage ?? \"\"\n      )?.groups ?? { line: 1, column: 1, message: \"could not parse error\" };\n    const startLineNumber = Number(line);\n    const endLineNumber = startLineNumber;\n    const startColumn = Number(column);\n    const restOfLine = model\n      .getLineContent(startLineNumber)\n      .substring(startColumn - 1);\n    let endColumn =\n      startColumn + (restOfLine.match(/([^\\s]+)/)?.[0].length ?? 1);\n    if (endColumn <= startColumn) {\n      endColumn = startColumn + 1;\n    }\n\n    monaco.editor.setModelMarkers(model, language, [\n      {\n        message,\n        startColumn,\n        startLineNumber,\n        endColumn,\n        endLineNumber,\n        severity: 8, // monacoT.MarkerSeverity.Error,\n      },\n    ]);\n  }, [error, editor, monaco, language]);\n\n  return (\n    <>\n      <MonacoEditor\n        value={value}\n        onChange={(v = \"\") => onChange(v)}\n        language={language}\n        onMount={onMount}\n      />\n    </>\n  );\n};\n\nexport const Editor = ({\n  className = \"\",\n  style = {},\n  disabled = false,\n  value,\n  onChange,\n  grammar,\n  language,\n  highlight,\n}: {\n  className?: string;\n  style?: CSSProperties;\n  disabled?: boolean;\n  value: string;\n  onChange: (source: string) => void;\n  grammar: ohm.Grammar;\n  language: string;\n  highlight?: Span;\n}) => {\n  const [error, setError] = useState<ohm.MatchResult>();\n  const { monaco } = useContext(AppContext);\n\n  const parse = useCallback(\n    (text = \"\") => {\n      const parsed = grammar.match(text);\n      setError(parsed.failed() ? parsed : undefined);\n    },\n    [setError, grammar]\n  );\n\n  useEffect(() => parse(value), [parse, value]);\n  const doParse = useMemo(() => debounce(parse, 500), [parse]);\n\n  const onChangeCB = useCallback(\n    (text = \"\") => {\n      onChange(text);\n      doParse(text);\n    },\n    [doParse, onChange]\n  );\n\n  return (\n    <div className={`Editor ${className}`} style={style}>\n      {monaco.canUse && monaco.wants ? (\n        <Monaco\n          value={value}\n          onChange={onChangeCB}\n          language={language}\n          error={error}\n          disabled={disabled}\n          highlight={highlight}\n        />\n      ) : (\n        <>\n          <Textarea\n            value={value}\n            onChange={onChangeCB}\n            language={language}\n            disabled={disabled}\n          />\n          <ErrorPanel error={error} />\n        </>\n      )}\n    </div>\n  );\n};\n","export function debounce(fn, ms = 32) {\n    let timer;\n    return (...args) => {\n        clearTimeout(timer);\n        timer = setTimeout(() => (clearTimeout(timer), fn(...args)), ms);\n        return timer;\n    };\n}\n","import { CSSProperties, ReactNode } from \"react\";\n\nexport const Panel = (props: {\n  children: ReactNode;\n  header?: ReactNode;\n  footer?: ReactNode;\n  className?: string;\n  style?: CSSProperties;\n}) => {\n  return (\n    <article className={[\"panel\", props.className ?? \"\"].join(\" \")}>\n      {props.header && <header>{props.header}</header>}\n      <main>{props.children}</main>\n      {props.footer && <footer>{props.footer}</footer>}\n    </article>\n  );\n};\n\nexport const Accordian = (props: {\n  children: ReactNode;\n  summary: ReactNode;\n  className?: string;\n  style?: CSSProperties;\n  open?: boolean;\n}) => {\n  return (\n    <details\n      className={props.className ?? \"\"}\n      open={props.open}\n      style={props.style}\n    >\n      <summary>\n        <div className=\"flex row align-baseline\">{props.summary}</div>\n      </summary>\n      {props.children}\n    </details>\n  );\n};\n","import { Trans } from \"@lingui/macro\";\nimport {\n  CSSProperties,\n  ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport \"./chip.scss\";\n\nimport { makeVisualizationsWithId } from \"@nand2tetris/components/chips/visualizations.js\";\nimport { Clockface } from \"@nand2tetris/components/clockface.js\";\nimport { DiffTable } from \"@nand2tetris/components/difftable.js\";\nimport {\n  FullPinout,\n  PinContext,\n  PinResetDispatcher,\n} from \"@nand2tetris/components/pinout.js\";\nimport { useStateInitializer } from \"@nand2tetris/components/react.js\";\nimport { Runbar } from \"@nand2tetris/components/runbar.js\";\nimport { BaseContext } from \"@nand2tetris/components/stores/base.context.js\";\nimport {\n  Files,\n  PROJECT_NAMES,\n  isBuiltinOnly,\n  useChipPageStore,\n} from \"@nand2tetris/components/stores/chip.store.js\";\nimport { CHIP_PROJECTS } from \"@nand2tetris/projects/index.js\";\nimport { CMP } from \"@nand2tetris/simulator/languages/cmp.js\";\nimport { HDL } from \"@nand2tetris/simulator/languages/hdl.js\";\nimport { TST } from \"@nand2tetris/simulator/languages/tst.js\";\nimport { Timer } from \"@nand2tetris/simulator/timer.js\";\nimport { AppContext } from \"../App.context\";\nimport { Icon } from \"../pico/icon\";\nimport { Editor } from \"../shell/editor\";\nimport { Accordian, Panel } from \"../shell/panel\";\n\nexport const Chip = () => {\n  const { fs, setStatus } = useContext(BaseContext);\n  const { filePicker, tracking } = useContext(AppContext);\n  const { state, actions, dispatch } = useChipPageStore();\n\n  const [hdl, setHdl] = useStateInitializer(state.files.hdl);\n  const [tst, setTst] = useStateInitializer(state.files.tst);\n  const [cmp, setCmp] = useStateInitializer(state.files.cmp);\n  const [out] = useStateInitializer(state.files.out);\n\n  useEffect(() => {\n    actions.initialize();\n  }, [actions]);\n\n  useEffect(() => {\n    tracking.trackPage(\"/chip\");\n  }, [tracking]);\n\n  const saveChip = () => {\n    actions.saveChip(hdl);\n  };\n\n  useEffect(() => {\n    tracking.trackEvent(\"action\", \"setProject\", state.controls.project);\n    tracking.trackEvent(\"action\", \"setChip\", state.controls.chipName);\n  }, []);\n\n  const setProject = useCallback(\n    (project: keyof typeof CHIP_PROJECTS) => {\n      actions.setProject(project);\n      tracking.trackEvent(\"action\", \"setProject\", project);\n    },\n    [actions, tracking]\n  );\n\n  const setChip = useCallback(\n    (chip: string) => {\n      actions.setChip(chip);\n      tracking.trackEvent(\"action\", \"setChip\", chip);\n      pinResetDispatcher.reset();\n    },\n    [actions, tracking]\n  );\n\n  const doEval = useCallback(() => {\n    actions.eval();\n    tracking.trackEvent(\"action\", \"eval\");\n  }, [actions, tracking]);\n\n  const compile = useRef<(files?: Partial<Files>) => void>(() => undefined);\n  compile.current = async (files: Partial<Files> = {}) => {\n    await actions.updateFiles({\n      hdl: files.hdl,\n      tst: files.tst ?? tst,\n      cmp: files.cmp ?? cmp,\n    });\n  };\n\n  const loadTest = useCallback(async () => {\n    try {\n      const path = await filePicker.select();\n      const tst = await fs.readFile(path);\n      await compile.current({ tst });\n    } catch (e) {\n      console.error(e);\n      setStatus(`Failed to load into memory`);\n    }\n  }, [filePicker, setStatus, fs, compile]);\n\n  const runner = useRef<Timer>();\n  useEffect(() => {\n    runner.current = new (class ChipTimer extends Timer {\n      async reset(): Promise<void> {\n        await compile.current();\n        await actions.reset();\n      }\n\n      override finishFrame(): void {\n        super.finishFrame();\n        dispatch.current({ action: \"updateTestStep\" });\n      }\n\n      async tick(): Promise<boolean> {\n        return actions.stepTest();\n      }\n\n      toggle(): void {\n        dispatch.current({ action: \"updateTestStep\" });\n      }\n    })();\n\n    return () => {\n      runner.current?.stop();\n    };\n  }, [compile, actions, dispatch]);\n\n  const clockActions = useMemo(\n    () => ({\n      toggle() {\n        actions.clock();\n        tracking.trackEvent(\"action\", \"toggleClock\");\n      },\n      reset() {\n        tracking.trackEvent(\"action\", \"resetClock\");\n        actions.reset();\n      },\n    }),\n    [actions]\n  );\n\n  const [useBuiltin, setUseBuiltin] = useState(false);\n  const toggleUseBuiltin = () => {\n    if (useBuiltin) {\n      setUseBuiltin(false);\n      actions.useBuiltin(false);\n    } else {\n      setUseBuiltin(true);\n      actions.useBuiltin(true, hdl);\n    }\n    pinResetDispatcher.reset();\n  };\n\n  const selectors = (\n    <>\n      <fieldset role=\"group\">\n        <select\n          value={state.controls.project}\n          onChange={({ target: { value } }) => {\n            setProject(value as keyof typeof CHIP_PROJECTS);\n          }}\n          data-testid=\"project-picker\"\n        >\n          {PROJECT_NAMES.map(([number, label]) => (\n            <option key={number} value={number}>\n              {label}\n            </option>\n          ))}\n        </select>\n        <select\n          value={state.controls.chipName}\n          onChange={({ target: { value } }) => {\n            setChip(value);\n          }}\n          data-testid=\"chip-picker\"\n        >\n          {state.controls.chips.map((chip) => (\n            <option\n              key={chip}\n              value={chip}\n              style={isBuiltinOnly(chip) ? { color: \"rgb(170, 170, 170)\" } : {}}\n            >\n              {`${chip} ${isBuiltinOnly(chip) ? \"(given)\" : \"\"}`}\n            </option>\n          ))}\n        </select>\n        <button className=\"flex-0\" onClick={saveChip} disabled={useBuiltin}>\n          <Trans>Save</Trans>\n        </button>\n      </fieldset>\n    </>\n  );\n  const hdlPanel = (\n    <Panel\n      className=\"_hdl_panel\"\n      header={\n        <>\n          <div tabIndex={0}>HDL</div>\n          <fieldset>\n            {state.controls.hasBuiltin && !state.controls.builtinOnly && (\n              <label>\n                <input\n                  type=\"checkbox\"\n                  role=\"switch\"\n                  checked={useBuiltin}\n                  onChange={toggleUseBuiltin}\n                />\n                <Trans>Builtin</Trans>\n              </label>\n            )}\n          </fieldset>\n          {selectors}\n        </>\n      }\n    >\n      <Editor\n        className=\"flex-1\"\n        value={hdl}\n        onChange={(source) => {\n          setHdl(source);\n          compile.current(\n            useBuiltin || state.controls.builtinOnly ? {} : { hdl: source }\n          );\n        }}\n        grammar={HDL.parser}\n        language={\"hdl\"}\n        disabled={useBuiltin || state.controls.builtinOnly}\n      />\n    </Panel>\n  );\n\n  const [inputValid, setInputValid] = useState(true);\n\n  const chipButtons = (\n    <fieldset role=\"group\">\n      <button\n        onClick={doEval}\n        onKeyDown={doEval}\n        disabled={!state.sim.pending || !inputValid}\n      >\n        <Trans>Eval</Trans>\n      </button>\n      <button\n        onClick={clockActions.toggle}\n        style={{ maxWidth: \"initial\" }}\n        disabled={!state.sim.clocked}\n      >\n        <Trans>Clock</Trans>:{\"\\u00a0\"}\n        <Clockface />\n      </button>\n      <button\n        onClick={clockActions.reset}\n        style={{ maxWidth: \"initial\" }}\n        disabled={!state.sim.clocked}\n      >\n        <Trans>Reset</Trans>\n      </button>\n    </fieldset>\n  );\n\n  const visualizations: [string, ReactNode][] = makeVisualizationsWithId(\n    {\n      parts: state.sim.chip,\n    },\n    () => {\n      dispatch.current({ action: \"updateChip\" });\n    }\n  );\n\n  const pinResetDispatcher = new PinResetDispatcher();\n\n  const pinsPanel = (\n    <Panel\n      className=\"_parts_panel\"\n      header={\n        <>\n          <div>\n            <Trans>Chip</Trans> {state.controls.chipName}\n          </div>\n          {chipButtons}\n        </>\n      }\n    >\n      {state.sim.invalid ? (\n        <Trans>Syntax errors in the HDL code</Trans>\n      ) : (\n        <>\n          <PinContext.Provider value={pinResetDispatcher}>\n            <FullPinout\n              sim={state.sim}\n              toggle={actions.toggle}\n              setInputValid={setInputValid}\n              hideInternal={state.controls.builtinOnly}\n            />\n          </PinContext.Provider>\n          {visualizations.length > 0 && (\n            <Accordian summary={<Trans>Visualization</Trans>} open={true}>\n              <main>{visualizations.map(([_, v]) => v)}</main>\n            </Accordian>\n          )}\n        </>\n      )}\n    </Panel>\n  );\n\n  const [selectedTestTab, doSetSelectedTestTab] = useState<\n    \"tst\" | \"cmp\" | \"out\"\n  >(\"tst\");\n\n  const setSelectedTestTab = useCallback(\n    (tab: typeof selectedTestTab) => {\n      doSetSelectedTestTab(tab);\n      tracking.trackEvent(\"tab\", \"change\", tab);\n    },\n    [tracking]\n  );\n\n  const testPanel = (\n    <Panel\n      className=\"_test_panel\"\n      header={\n        <>\n          <div className=\"flex-1\">\n            <Trans>Test</Trans>\n          </div>\n          <div className=\"flex-2\">\n            {runner.current && <Runbar runner={runner.current} />}\n          </div>\n          <div>\n            <button onClick={loadTest}>\n              <Icon name=\"upload_file\" />{\" \"}\n            </button>\n          </div>\n        </>\n      }\n    >\n      <div role=\"tablist\" style={{ \"--tab-count\": \"3\" } as CSSProperties}>\n        <div\n          role=\"tab\"\n          id=\"test-tab-tst\"\n          aria-controls=\"test-tabpanel-tst\"\n          aria-selected={selectedTestTab === \"tst\"}\n        >\n          <label>\n            <input\n              type=\"radio\"\n              name=\"test-tabs\"\n              aria-controls=\"test-tabpanel-tst\"\n              value=\"tst\"\n              checked={selectedTestTab === \"tst\"}\n              onChange={() => setSelectedTestTab(\"tst\")}\n            />\n            Test Script\n          </label>\n        </div>\n        <div\n          role=\"tabpanel\"\n          aria-labelledby=\"test-tab-tst\"\n          id=\"test-tabpanel-tst\"\n        >\n          <Editor\n            value={tst}\n            onChange={setTst}\n            grammar={TST.parser}\n            language={\"tst\"}\n            highlight={state.controls.span}\n            disabled={state.controls.builtinOnly}\n          />\n        </div>\n        <div\n          role=\"tab\"\n          id=\"test-tab-cmp\"\n          aria-controls=\"test-tablpanel-cmp\"\n          aria-selected={selectedTestTab === \"cmp\"}\n        >\n          <label>\n            <input\n              type=\"radio\"\n              name=\"test-tabs\"\n              aria-controls=\"test-tabpanel-cmp\"\n              value=\"cmp\"\n              checked={selectedTestTab === \"cmp\"}\n              onChange={() => setSelectedTestTab(\"cmp\")}\n            />\n            Compare File\n          </label>\n        </div>\n        <div\n          role=\"tabpanel\"\n          aria-labelledby=\"test-tab-cmp\"\n          id=\"test-tabpanel-cmp\"\n          style={{ position: \"relative\" }}\n        >\n          <Editor\n            value={cmp}\n            onChange={setCmp}\n            grammar={CMP.parser}\n            language={\"cmp\"}\n            disabled={state.controls.builtinOnly}\n          />\n        </div>\n        <div\n          role=\"tab\"\n          id=\"test-tab-out\"\n          aria-controls=\"test-tabpanel-out\"\n          aria-selected={selectedTestTab === \"out\"}\n        >\n          <label>\n            <input\n              type=\"radio\"\n              name=\"test-tabs\"\n              aria-controls=\"test-tabpanel-out\"\n              value=\"out\"\n              checked={selectedTestTab === \"out\"}\n              onChange={() => setSelectedTestTab(\"out\")}\n            />\n            Output File\n          </label>\n        </div>\n        <div\n          role=\"tabpanel\"\n          id=\"test-tabpanel-out\"\n          aria-labelledby=\"test-tab-out\"\n        >\n          <DiffTable cmp={cmp} out={out} />\n        </div>\n      </div>\n    </Panel>\n  );\n\n  return (\n    <div className=\"ChipPage grid\">\n      {hdlPanel}\n      {pinsPanel}\n      {testPanel}\n    </div>\n  );\n};\n\nexport default Chip;\n"],"names":["ALUComponent","A","op","D","out","flag","_jsxs","children","_jsx","width","height","xmlns","x","y","fill","points","stroke","xmlSpace","textAnchor","fontFamily","fontSize","strokeWidth","id","COMMANDS_ALU","RegisterComponent","name","bits","dec","KeyMap","Enter","Backspace","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Home","End","PageUp","PageDown","Insert","Delete","Escape","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","Keyboard","keyboard","update","useState","enabled","setEnabled","character","setCharacter","busVoltage","setBits","currentKey","setKey","key","className","onClick","onKeyDown","event","preventDefault","keypress","mapping","undefined","length","code","charCodeAt","keyPressToHackCharacter","onKeyUp","clearKey","Sizes","none","sm","md","lg","xl","full","Sides","t","r","l","b","tl","tr","bl","br","Widths","isSide","v","getSize","size","getSide","side","rounded","sized","reduce","prev","curr","borderRadius","amount","block","display","die","error","args","msg","Error","map","s","join","isDraft","value","DRAFT_STATE","isDraftable","proto","Object","getPrototypeOf","Ctor","hasOwnProperty","call","constructor","Function","toString","objectCtorString","Array","isArray","DRAFTABLE","_value$constructor","isMap","isSet","each","obj","iter","enumerableOnly","getArchtype","keys","ownKeys","forEach","entry","index","thing","state","type_","has","prop","prototype","get","set","propOrOldValue","delete","add","is","target","hasMap","Map","hasSet","Set","latest","copy_","base_","shallowCopy","base","slice","descriptors","getOwnPropertyDescriptors","i","desc","writable","configurable","enumerable","create","freeze","deep","isFrozen","clear","dontMutateFrozenCollections","getPlugin","pluginKey","plugin","plugins","getCurrentScope","currentScope","usePatchesInScope","scope","patchListener","patches_","inversePatches_","patchListener_","revokeScope","leaveScope","drafts_","revokeDraft","parent_","enterScope","immer","immer_","canAutoFreeze_","unfinalizedDrafts_","draft","revoke_","revoked_","processResult","result","baseDraft","isReplaced","useProxies_","willFinalizeES5_","modified_","finalize","maybeFreeze","generateReplacementPatches_","NOTHING","rootScope","path","childValue","finalizeProperty","scope_","finalized_","draft_","generatePatches_","parentState","targetObject","rootPath","res","assigned_","concat","autoFreeze_","peek","getDescriptorFromProto","source","getOwnPropertyDescriptor","markChanged","prepareCopy","createProxy","parent","proxyMap_","proxySet_","isManual_","traps","objectTraps","arrayTraps","Proxy","revocable","revoke","proxy","createES5Proxy_","push","current","currentImpl","copy","archType","hasChanges_","copyHelper","from","hasSymbol","Symbol","hasProxies","Reflect","for","iterator","getOwnPropertySymbols","getOwnPropertyNames","_desc$get","currentState","deleteProperty","owner","defineProperty","setPrototypeOf","fn","arguments","apply","this","Immer","e","config","recipe","defaultBase","self","_this","produce","_this2","hasError","Promise","then","p","ip","produceWithPatches","patches","inversePatches","n","nextState","useProxies","setUseProxies","autoFreeze","setAutoFreeze","createDraft","finishDraft","applyPatches","patch","applyPatchesImpl","applyPatches_","bind","useImmerReducer","reducers","initialState","useReducer","command","action","payload","useStateInitializer","init","setState","useEffect","Mode","props","mode","setMode","setValue","view","style","cursor","doSelect","useCallback","ref","select","doChange","onChange","edit","position","zIndex","left","marginTop","color","highlight","onFocus","onBlur","onKeyPress","type","defaultValue","render","doScroll","scrollTop","totalHeight","toleranceHeight","bufferedItems","settings","itemHeight","minIndex","maxIndex","Math","floor","data","offset","limit","start","max","min","getData","topPaddingHeight","bottomPaddingHeight","viewportRef","useRef","useMemo","Number","MAX_SAFE_INTEGER","startIndex","count","tolerance","fillVirtualScrollSettings","startState","adapter","viewportHeight","reducer","scrollReducer","dispatchScroll","row","initialScroll","div","rows","d","rowKey","overflowY","overflowAnchor","onScroll","useClockReset","reset","subscription","Clock","reset$","subscribe","unsubscribe","displayClock","Clockface","clockface","setClockface","$","useClockface","whiteSpace","MemoryBlock","memory","jmp","editable","format","range","MemoryCell","VirtualScroll","background","hex","flex","textAlign","InlineEdit","newValue","Memory","fmt","setFormat","setJmp","goto","setGoto","highlighted","setHighlighted","jumpTo","isNaN","parseInt","isFinite","doUpdate","role","placeholder","FORMATS","option","checked","bin","asm","doFormat","WHITE","mem","pixel","Screen","frameFinished","canvas","draw","ctx","getContext","image","assertExists","getImageData","col","putImageData","drawImage","ctxRef","frame$","clearRect","maxWidth","boxSizing","marginInline","margin","borderTop","borderLeft","borderBottom","borderRight","makeVisualization","chip","updateAction","ALU","in","voltage","HIGH","Flags","Register","PC","KeyboardComponent","ScreenComponent","RAM","MemoryComponent","address","RAM8","CPU","decode","am","vis","parts","filter","ChipDisplayInfo","chipName","unsigned","BUILTIN_REGISTRY","getBuiltinChip","isOk","pins","Ok","ins","entries","outs","pin","signBehaviors","includes","UNSIGNED_PINS","PinContext","createContext","reducePin","reverse","reducePins","FullPinout","sim","inPins","outPins","internalPins","displayInfo","PinoutBlock","header","toggle","setInputValid","disabled","pending","enableEdit","hideInternal","colSpan","immPin","Pin","signed","isSigned","internal","isBin","setIsBin","inputValid","decimal","setDecimal","resetDispatcher","useContext","PinResetDispatcher","registerCallback","setInputValidity","valid","updatePins","flexDirection","alignItems","backgroundColor","positive","replace","numeric","pow","handleDecimalChange","callback","callbacks","Runbar","runner","timer","dispatch","running","speed","steps","finishFrame","setSteps","setSpeed","actions","frame","stop","makeTimerStore","dispatcher","useTimer","label","PROJECT_NAMES","getChips","project","CHIP_ORDER","BUILTIN_CHIP_PROJECTS","CHIP_PROJECTS","makeHdl","isBuiltinOnly","values","flat","getBuiltinCode","template","ChipProjects","BUILTIN_CHIPS","CHIPS","getTemplate","bodyComment","builtinLine","reduceChip","invalid","clocked","clock","makeChipStore","fs","setStatus","storage","dropdowns","chips","findDropdowns","Low","test","ChipTest","usingBuiltin","builtinOnly","setFiles","hdl","files","tst","cmp","updateChip","controls","setProject","setChip","hasBuiltin","REGISTRY","testRunning","runningTest","testFinished","passed","trim","updateTestStep","log","currentStep","span","done","end","useBuiltin","loadChip","updateFiles","compileChip","compileTest","remove","maybeParsed","HDL","isErr","Err","buildChip","maybeChip","replaceChip","nextChip","nextPin","eval","with","fsName","ext","all","readFile","catch","saveChip","prj","writeFile","isLow","doUseBuiltin","oldHdl","builtinName","initialize","file","TST","setFileSystem","runTest","pushd","run","popd","tick","stepTest","assert","chipId","step","Timer","now","Date","delta","requestAnimationFrame","ErrorPanel","failed","open","message","shortMessage","UNKNOWN_PARSE_ERROR","Textarea","language","text","setText","Monaco","currentHighlight","theme","AppContext","monaco","useMonaco","editor","decorations","codeTheme","window","matchMedia","matches","doHighlight","model","getModel","getPositionAt","Range","fromPositions","nextDecoration","options","inlineClassName","revealRangeInCenter","deltaDecorations","makeHighlight","onMount","ed","updateOptions","minimap","scrollBeyondLastLine","readOnly","succeeded","setModelMarkers","exec","groups","line","column","startLineNumber","endLineNumber","startColumn","endColumn","getLineContent","substring","match","severity","Editor","grammar","setError","parse","parsed","doParse","ms","clearTimeout","setTimeout","debounce","onChangeCB","canUse","wants","Panel","footer","Accordian","summary","Chip","BaseContext","filePicker","tracking","useChipPageStore","setHdl","setTst","setCmp","trackPage","trackEvent","pinResetDispatcher","doEval","compile","loadTest","console","clockActions","setUseBuiltin","selectors","number","hdlPanel","tabIndex","chipButtons","visualizations","part","makeVisualizationsWithId","pinsPanel","Provider","selectedTestTab","doSetSelectedTestTab","setSelectedTestTab","tab","testPanel","CMP"],"sourceRoot":""}