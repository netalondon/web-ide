"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[255],{9811:function(e,t,n){n.r(t),n.d(t,{CPU:function(){return F},default:function(){return I}});var r=n(2951),s=n(1976),a=n(7591),i=n(4337),c=n(1026),l=n(8061),u=n(8923),o=n(2277),d=n(3052),p=n(1092),h=n(7791),m=n(7169),f=n(3243),v=n(7597),x=n(4649),b=n(5838),C=new Int16Array([2,55944,0,64528,15,54018,1,64528,2,61584,54024,0,64648,2,55943,15,55943]),g=n(3389),j=n(6167),k=n(7559),y=n(8698),P=function(e){(0,a.Z)(ImmMemory,e);var t=(0,i.Z)(ImmMemory);function ImmMemory(e,n){var s;return(0,r.Z)(this,ImmMemory),s=t.call(this,e,e.size,0),(0,x.Z)((0,m.Z)(s),"dispatch",void 0),s.dispatch=n,s}return(0,s.Z)(ImmMemory,[{key:"load",value:function(){var e=(0,h.Z)((0,p.Z)().mark((function _callee(e,t){return(0,p.Z)().wrap((function _callee$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,f.Z)((0,v.Z)(ImmMemory.prototype),"load",this).call(this,e,t);case 2:this.dispatch.current({action:"update"});case 3:case"end":return n.stop()}}),_callee,this)})));return function load(t,n){return e.apply(this,arguments)}}()}]),ImmMemory}(b.kG);function reduceCPUTest(e,t){var n=new P(e.cpu.RAM,t),r=new P(e.cpu.ROM,t),s=new P(e.cpu.Screen,t),a=new b.qT(new P(e.cpu.RAM,t));return{A:e.cpu.A,D:e.cpu.D,PC:e.cpu.PC,RAM:n,ROM:r,Screen:s,Keyboard:a}}function useCpuPageStore(){var e=(0,j.useContext)(y.r),t=e.fs,n=e.setStatus,r=e.storage,s=(0,j.useRef)((function(){})),a=(0,j.useMemo)((function(){return function makeCpuStore(e,t,n,r){var s,a=new g.o6(new b.eD(C)),i={update:function update(e){var t;e.sim=reduceCPUTest(a,r),e.test.highlight=null===(t=a.currentStep)||void 0===t?void 0:t.span}},c={tick:function tick(){a.cpu.tick()},testStep:function testStep(){a.step()},resetRAM:function resetRAM(){a.cpu.RAM.loadBytes([]),r.current({action:"update"}),t("Reset RAM")},toggleUseTest:function toggleUseTest(){r.current({action:"update"})},resetCPU:function resetCPU(){a.reset(),r.current({action:"update"}),t("Reset CPU")},reset:function reset(){this.resetRAM(),this.resetCPU(),t("Reset CPU & RAM")}};return{initialState:{sim:reduceCPUTest(a,r),test:{highlight:null===(s=a.currentStep)||void 0===s?void 0:s.span}},reducers:i,actions:c}}(0,n,0,s)}),[t,n,r,s]),i=a.initialState,l=a.reducers,u=a.actions,o=(0,k.C)(l,i),d=(0,c.Z)(o,2),p=d[0],h=d[1];return s.current=h,{state:p,dispatch:s,actions:u}}var Z=n(258),T=n(1124),M=n(8582),U=n(8365),S=n(9647),R=n(8016),w=n(1539),A=n(7878),_=function TestPanel(e){var t=e.runner,n=(0,c.Z)(e.tst,3),r=n[0],s=n[1],a=n[2],i=(0,c.Z)(e.cmp,2),u=i[0],o=i[1],d=(0,c.Z)(e.out,1)[0],m=e.disabled,f=void 0!==m&&m,v=(0,j.useContext)(y.r),x=v.fs,b=v.setStatus,C=(0,j.useContext)(R.Il),g=C.filePicker,k=C.tracking,P=(0,j.useState)("tst"),_=(0,c.Z)(P,2),F=_[0],I=_[1],D=(0,j.useCallback)((function(e){I(e),k.trackEvent("tab","change",e)}),[k]),N=(0,j.useCallback)((0,h.Z)((0,p.Z)().mark((function _callee(){var e,t;return(0,p.Z)().wrap((function _callee$(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,g.select();case 3:return e=n.sent,n.next=6,x.readFile(e);case 6:t=n.sent,s(t),n.next=14;break;case 10:n.prev=10,n.t0=n.catch(0),console.error(n.t0),b("Failed to load test");case 14:case"end":return n.stop()}}),_callee,null,[[0,10]])}))),[g,b,x]);return(0,A.jsx)(T.s,{className:"_test_panel",header:(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("div",{className:"flex-0",children:(0,A.jsx)(l.cC,{id:"Test"})}),(0,A.jsx)("div",{className:"flex-1",children:t.current&&(0,A.jsx)(Z.D,{runner:t.current})}),(0,A.jsx)("div",{children:(0,A.jsx)("fieldset",{role:"group",children:(0,A.jsx)("button",{onClick:N,children:"\ud83d\udcc2"})})})]}),children:(0,A.jsxs)("div",{role:"tablist",style:{"--tab-count":"3"},children:[(0,A.jsx)("div",{role:"tab",id:"test-tab-tst","aria-controls":"test-tabpanel-tst","aria-selected":"tst"===F,children:(0,A.jsxs)("label",{children:[(0,A.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-tst",value:"tst",checked:"tst"===F,onChange:function onChange(){return D("tst")}}),"Test Script"]})}),(0,A.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-tst",id:"test-tabpanel-tst",children:(0,A.jsx)(w.M,{value:r,onChange:s,grammar:S.qH.parser,language:"tst",highlight:a,disabled:f})}),(0,A.jsx)("div",{role:"tab",id:"test-tab-cmp","aria-controls":"test-tablpanel-cmp","aria-selected":"cmp"===F,children:(0,A.jsxs)("label",{children:[(0,A.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-cmp",value:"cmp",checked:"cmp"===F,onChange:function onChange(){return D("cmp")}}),"Compare File"]})}),(0,A.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-cmp",id:"test-tabpanel-cmp",style:{position:"relative"},children:(0,A.jsx)(w.M,{value:u,onChange:o,grammar:U.lA.parser,language:"cmp",disabled:f})}),(0,A.jsx)("div",{role:"tab",id:"test-tab-out","aria-controls":"test-tabpanel-out","aria-selected":"out"===F,children:(0,A.jsxs)("label",{children:[(0,A.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-out",value:"out",checked:"out"===F,onChange:function onChange(){return D("out")}}),"Output File"]})}),(0,A.jsx)("div",{role:"tabpanel",id:"test-tabpanel-out","aria-labelledby":"test-tab-out",children:(0,A.jsx)(M.M,{cmp:u,out:d})})]})})},F=function CPU(){var e=useCpuPageStore(),t=e.state,n=e.actions,p=e.dispatch,h=(0,j.useState)("repeat {\n\tticktock;\n}"),m=(0,c.Z)(h,2),f=m[0],v=m[1],x=(0,j.useState)(""),b=(0,c.Z)(x,2),C=b[0],g=b[1],k=(0,j.useState)(""),y=(0,c.Z)(k,2),P=y[0],M=y[1],U=(0,j.useState)(null),S=(0,c.Z)(U,2),R=S[0],w=S[1],F=(0,j.useState)(!0),I=(0,c.Z)(F,2),D=I[0],N=I[1],O=(0,j.useRef)(),E=(0,j.useRef)(),B=(0,j.useState)(!1),q=(0,c.Z)(B,2),K=q[0],$=q[1];(0,j.useEffect)((function(){return O.current=new(function(e){(0,a.Z)(CPUTimer,e);var c=(0,i.Z)(CPUTimer);function CPUTimer(){return(0,r.Z)(this,CPUTimer),c.apply(this,arguments)}return(0,s.Z)(CPUTimer,[{key:"tick",value:function tick(){return n.tick(),!1}},{key:"finishFrame",value:function finishFrame(){p.current({action:"update"}),console.log(t.sim.PC)}},{key:"reset",value:function reset(){n.reset()}},{key:"toggle",value:function toggle(){p.current({action:"update"})}}]),CPUTimer}(u.B)),E.current=new(function(e){(0,a.Z)(CPUTestTimer,e);var t=(0,i.Z)(CPUTestTimer);function CPUTestTimer(){return(0,r.Z)(this,CPUTestTimer),t.apply(this,arguments)}return(0,s.Z)(CPUTestTimer,[{key:"tick",value:function tick(){return n.testStep(),!1}},{key:"finishFrame",value:function finishFrame(){p.current({action:"update"})}},{key:"reset",value:function reset(){n.reset()}},{key:"toggle",value:function toggle(){p.current({action:"update"})}}]),CPUTestTimer}(u.B)),$(!0),function(){var e,t;null===(e=O.current)||void 0===e||e.stop(),null===(t=E.current)||void 0===t||t.stop()}}),[n,p]);var z=(0,j.useCallback)((function(e){w(e),n.reset()}),[w,n.reset]);return(0,A.jsxs)("div",{className:"CpuPage grid",children:[(0,A.jsx)(d.ZP,{name:"ROM",memory:D?t.sim.ROM:void 0,highlight:D?t.sim.PC:void 0,format:"asm",onUpload:z}),(0,A.jsx)(d.ZP,{name:"RAM",memory:D?t.sim.RAM:void 0,format:"hex"}),(0,A.jsxs)(T.s,{className:"IO",header:(0,A.jsxs)(A.Fragment,{children:[R&&(0,A.jsx)("div",{className:"flex-0",children:R}),(0,A.jsx)("div",{className:"flex-1",children:K&&O.current&&(0,A.jsx)(Z.D,{runner:O.current})})]}),children:[(0,A.jsx)(o.N,{keyboard:t.sim.Keyboard}),(0,A.jsxs)("label",{children:[(0,A.jsx)("input",{type:"checkbox",role:"switch",checked:D,onChange:function toggleDisplayEnabled(){N(!D)}}),(0,A.jsx)(l.cC,{id:"{0}",values:{0:D?"Disable display":"Enable display"}})]}),D&&(0,A.jsx)("div",{children:(0,A.jsxs)("dl",{children:[(0,A.jsx)("dt",{children:"PC"}),(0,A.jsx)("dd",{children:t.sim.PC}),(0,A.jsx)("dt",{children:"A"}),(0,A.jsx)("dd",{children:t.sim.A}),(0,A.jsx)("dt",{children:"D"}),(0,A.jsx)("dd",{children:t.sim.D})]})})]}),K&&(0,A.jsx)(_,{runner:E,tst:[f,v,t.test.highlight],out:[C,g],cmp:[P,M]})]})},I=F}}]);
//# sourceMappingURL=255.7e686be4.chunk.js.map