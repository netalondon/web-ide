"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[654],{8815:(e,t,s)=>{s.r(t),s.d(t,{VMInstructionRow:()=>k,default:()=>f});var n=s(3478),a=s(8963);var r=s(6845),c=s(5692),i=s(6604),l=s(2201),d=s(4388),o=s(8637),h=s(5969),u=s(7054),p=s(6391);function x(e,t){const s=new h.j(e.vm.RAM,t),n=new h.j(e.vm.Screen,t),a=new l.qT(new h.j(e.vm.Keyboard,t)),r=e.vm.derivedLine();return{Keyboard:a,RAM:s,Screen:n,Stack:e.vm.vmStack().reverse(),Prog:e.vm.program,highlight:r}}function j(){const{fs:e,setStatus:t,storage:s}=(0,r.useContext)(c.r),n=(0,r.useRef)((()=>{})),{initialState:a,reducers:l,actions:h}=(0,r.useMemo)((()=>function(e,t,s,n){const a=(0,u.Wg)(o.VM.parse("\nfunction Main.fibonacci 0\npush argument 0\npush constant 2\nlt                     // checks if n<2\nif-goto IF_TRUE\ngoto IF_FALSE\nlabel IF_TRUE          // if n<2, return n\npush argument 0        \nreturn\nlabel IF_FALSE         // if n>=2, returns fib(n-2)+fib(n-1)\npush argument 0\npush constant 2\nsub\ncall Main.fibonacci 1  // computes fib(n-2)\npush argument 0\npush constant 1\nsub\ncall Main.fibonacci 1  // computes fib(n-1)\nadd                    // returns fib(n-1) + fib(n-2)\nreturn\n\nfunction Sys.init 0\npush constant 4\ncall Main.fibonacci 1   // computes the 4'th fibonacci element\nlabel WHILE\ngoto WHILE              // loops infinitely\n")),r=(0,u.Wg)(p.Vm.build(a.instructions)),c=(new d.w).with(r);let i=!1;const l={update(e){e.vm=x(c,n),e.test.useTest=i,e.test.highlight=c.currentStep?.span}};return{initialState:{vm:x(c,n),controls:{error:"",runningTest:!1},test:{useTest:i,highlight:void 0}},reducers:l,actions:{step(){i?c.step():r.step(),n.current({action:"update"})},reset(){c.reset(),r.reset(),n.current({action:"update"})},toggleUseTest(){i=!i,n.current({action:"update"})}}}}(0,0,0,n)),[e,t,s,n]),[j,g]=(0,i.C)(l,a);return n.current=g,{state:j,dispatch:n,actions:h}}var g=s(4619),m=s(8398),b=s(558),v=s(864);const f=()=>{const{state:e,actions:t,dispatch:s}=j(),[c,i]=(0,r.useState)("repeat {\n\tvmstep;\n}"),[l,d]=(0,r.useState)(""),[o,h]=(0,r.useState)(""),u=(0,r.useRef)();return(0,r.useEffect)((()=>(u.current=new class extends g.B{async tick(){return t.step(),!1}finishFrame(){s.current({action:"update"})}reset(){t.reset()}toggle(){s.current({action:"update"})}},()=>{var e;null===(e=u.current)||void 0===e||e.stop()})),[t,s]),(0,v.jsxs)("div",{className:"Page VmPage grid",children:[(0,v.jsx)(m.s,{className:"program",children:(0,v.jsx)("main",{children:(0,v.jsxs)("table",{children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:"Inst"}),(0,v.jsx)("td",{children:"Target"}),(0,v.jsx)("td",{children:"Val"})]})}),(0,v.jsx)("tbody",{children:e.vm.Prog.map(((t,s)=>k({inst:t,key:s,highlighted:s===e.vm.highlight})))})]})})}),(0,v.jsxs)(m.s,{className:"IO",children:[(0,v.jsx)("div",{children:(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"checkbox",onChange:t.toggleUseTest,checked:e.test.useTest,role:"switch"}),"Use Test Script"]})}),(0,v.jsx)(a.l,{memory:e.vm.Screen}),(0,v.jsx)(n.N,{keyboard:e.vm.Keyboard}),(0,v.jsx)("div",{children:e.vm.Stack.map(((e,t)=>{var s,n;return(0,v.jsxs)("section",{children:[(0,v.jsx)("header",{children:(0,v.jsxs)("h3",{children:["Function",(0,v.jsx)("code",{children:null!==(s=null===(n=e.fn)||void 0===n?void 0:n.name)&&void 0!==s?s:"Unknown Function"})]})}),(0,v.jsxs)("main",{children:[(0,v.jsxs)("p",{children:[(0,v.jsx)("em",{children:"Args:"}),(0,v.jsxs)("code",{children:["[",e.args.values.join(", "),"]"]})]}),(0,v.jsxs)("p",{children:[(0,v.jsx)("em",{children:"Locals:"}),(0,v.jsxs)("code",{children:["[",e.locals.values.join(", "),"]"]})]}),(0,v.jsxs)("p",{children:[(0,v.jsx)("em",{children:"Stack:"}),(0,v.jsxs)("code",{children:["[",e.stack.values.join(", "),"]"]})]})]})]},t)}))})]}),(0,v.jsx)(b.F,{runner:u,tst:[c,i,e.test.highlight],out:[l,d],cmp:[o,h]})]})};function k(e){let{inst:t,key:s,highlighted:n}=e;switch(t.op){case"add":case"and":case"eq":case"gt":case"lt":case"neg":case"not":case"or":case"sub":case"return":return(0,v.jsxs)("tr",{className:n?"highlight":"",children:[(0,v.jsx)("td",{children:t.op}),(0,v.jsx)("td",{colSpan:2})]},s);case"if-goto":case"label":case"goto":return(0,v.jsxs)("tr",{className:n?"highlight":"",children:[(0,v.jsx)("td",{children:t.op}),(0,v.jsx)("td",{colSpan:2,children:t.label})]},s);case"function":case"call":return(0,v.jsxs)("tr",{className:n?"highlight":"",children:[(0,v.jsx)("td",{children:t.op}),(0,v.jsx)("td",{children:t.name}),(0,v.jsx)("td",{children:"call"===t.op?t.nArgs:t.nVars})]},s);case"pop":case"push":return(0,v.jsxs)("tr",{className:n?"highlight":"",children:[(0,v.jsx)("td",{children:t.op}),(0,v.jsx)("td",{children:t.segment}),(0,v.jsx)("td",{children:t.offset})]},s);default:return(0,v.jsx)("tr",{className:n?"highlight":"",children:(0,v.jsx)("td",{colSpan:3,children:"Unknown"})},s)}}},558:(e,t,s)=>{s.d(t,{F:()=>x});var n=s(5072),a=s(6845),r=s(1965),c=s(6791),i=s(7880),l=s(5692),d=s(4430),o=s(8722),h=s(9200),u=s(8398),p=s(864);const x=e=>{let{runner:t,tst:[s,x,j],cmp:[g,m],out:[b],disabled:v=!1,onLoadTest:f}=e;const{fs:k,setStatus:S}=(0,a.useContext)(l.r),{filePicker:y,tracking:w}=(0,a.useContext)(o.Il),[C,F]=(0,a.useState)("tst"),T=(0,a.useCallback)((e=>{F(e),w.trackEvent("tab","change",e)}),[w]),M=(0,a.useCallback)((async()=>{try{const e=await y.select(),t=await k.readFile(e),s=await k.readFile(e.replace(/\.tst$/,".cmp"));null===f||void 0===f||f(t,s)}catch(e){console.error(e),S("Failed to load test")}}),[y,S,k]);return(0,p.jsx)(u.s,{className:"_test_panel",header:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"flex-0",children:(0,p.jsx)(n.cC,{id:"Test"})}),(0,p.jsx)("div",{className:"flex-1",children:t.current&&(0,p.jsx)(c.D,{runner:t.current})}),(0,p.jsx)("div",{children:(0,p.jsx)("fieldset",{role:"group",children:(0,p.jsx)("button",{onClick:M,children:"\ud83d\udcc2"})})})]}),children:(0,p.jsxs)("div",{role:"tablist",style:{"--tab-count":"3"},children:[(0,p.jsx)("div",{role:"tab",id:"test-tab-tst","aria-controls":"test-tabpanel-tst","aria-selected":"tst"===C,children:(0,p.jsxs)("label",{children:[(0,p.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-tst",value:"tst",checked:"tst"===C,onChange:()=>T("tst")}),"Test Script"]})}),(0,p.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-tst",id:"test-tabpanel-tst",children:(0,p.jsx)(h.M,{value:s,onChange:x,grammar:d.qH.parser,language:"tst",highlight:j,disabled:v})}),(0,p.jsx)("div",{role:"tab",id:"test-tab-cmp","aria-controls":"test-tablpanel-cmp","aria-selected":"cmp"===C,children:(0,p.jsxs)("label",{children:[(0,p.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-cmp",value:"cmp",checked:"cmp"===C,onChange:()=>T("cmp")}),"Compare File"]})}),(0,p.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-cmp",id:"test-tabpanel-cmp",style:{position:"relative"},children:(0,p.jsx)(h.M,{value:g,onChange:m,grammar:i.lA.parser,language:"cmp",disabled:v})}),(0,p.jsx)("div",{role:"tab",id:"test-tab-out","aria-controls":"test-tabpanel-out","aria-selected":"out"===C,children:(0,p.jsxs)("label",{children:[(0,p.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-out",value:"out",checked:"out"===C,onChange:()=>T("out")}),"Output File"]})}),(0,p.jsx)("div",{role:"tabpanel",id:"test-tabpanel-out","aria-labelledby":"test-tab-out",children:(0,p.jsx)(r.M,{cmp:g,out:b})})]})})}},5969:(e,t,s)=>{s.d(t,{j:()=>a});var n=s(2201);class a extends n.kG{dispatch;constructor(e,t){super(e,e.size,0),this.dispatch=t}async load(e,t){await super.load(e,t),this.dispatch.current({action:"update"})}}}}]);