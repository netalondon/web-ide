"use strict";(globalThis.webpackChunk_nand2tetris_web=globalThis.webpackChunk_nand2tetris_web||[]).push([[700],{2675:(t,e,s)=>{s.d(e,{K:()=>h});var n=s(4621),i=s(8878),r=s(8029),a=s(782);let o=(...t)=>(0,a.jsx)(a.Fragment,{});const u=({error:t})=>t?(0,a.jsxs)("details",{className:"ErrorPanel",open:!0,children:[(0,a.jsx)("summary",{role:"button",className:"secondary",children:(0,a.jsx)(n.x6,{id:"Parse Error"})}),(0,a.jsx)("pre",{children:(0,a.jsx)("code",{children:null===t||void 0===t?void 0:t.message})})]}):(0,a.jsx)(a.Fragment,{}),c=({value:t,onChange:e,language:s,disabled:n=!1})=>{const[r,o]=(0,i.useState)(t);return(0,a.jsx)("textarea",{"data-testid":`editor-${s}`,disabled:n,value:r,onChange:t=>{var s;const n=null===(s=t.target)||void 0===s?void 0:s.value;o(n),e(n)}})},h=({className:t="",style:e={},disabled:n=!1,value:h,error:l,onChange:d,onCursorPositionChange:m,grammar:p,language:g,highlight:f,highlightType:b="highlight",customDecorations:w=[],dynamicHeight:A=!1,alwaysRecenter:v=!0,lineNumberTransform:y})=>{const{monaco:x}=(0,i.useContext)(r.BR),[D,M]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{(async()=>{x.canUse&&x.wants&&!D&&(o=(await Promise.all([s.e(983),s.e(953),s.e(965)]).then(s.bind(s,8965))).Monaco,M(!0))})()}),[x,D,M]),(0,a.jsx)("div",{className:`Editor ${A?"dynamic-height":""} ${t}`,style:e,children:x.canUse&&x.wants&&D?(0,a.jsx)(o,{value:h,onChange:d,onCursorPositionChange:m,language:g,error:l,disabled:n,highlight:f,highlightType:b,customDecorations:w,dynamicHeight:A,alwaysRecenter:v,lineNumberTransform:y}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c,{value:h,onChange:d,language:g,disabled:n}),(0,a.jsx)(u,{error:l})]})})}},4280:(t,e,s)=>{s.d(e,{Z:()=>i,p:()=>r});var n=s(782);const i=t=>{var e;return(0,n.jsxs)("article",{className:["panel",null!==(e=t.className)&&void 0!==e?e:""].join(" "),children:[t.header&&(0,n.jsx)("header",{children:t.header}),(0,n.jsx)("main",{children:t.children}),t.footer&&(0,n.jsx)("footer",{children:t.footer})]})},r=t=>{var e;return(0,n.jsxs)("details",{className:null!==(e=t.className)&&void 0!==e?e:"",open:t.open,style:t.style,children:[(0,n.jsx)("summary",{children:(0,n.jsx)("div",{className:"flex row align-baseline",children:t.summary})}),t.children]})}},2144:(t,e,s)=>{s.d(e,{F:()=>n});const n="Loading in progress..."},8177:(t,e,s)=>{s.d(e,{A:()=>r,b:()=>a});var n=s(8727),i=s(8878);function r(t,e){return(0,i.useReducer)(((e,s)=>(0,n.Ay)(e,(e=>{t[s.action](e,s.payload)}))),e)}function a(t){const[e,s]=(0,i.useState)(t);return(0,i.useEffect)((()=>{s(t)}),[t]),[e,s]}},7022:(t,e,s)=>{s.d(e,{T:()=>a});var n=s(782),i=s(8878),r=s(8177);const a=t=>{const e=function(t){const e=(0,i.useRef)((()=>{})),{initialState:s,reducers:n,actions:a}=(0,i.useMemo)((()=>((t,e)=>{const s={running:t.running,speed:t.speed,steps:t.steps},n=t.finishFrame.bind(t);return t.finishFrame=function(){n(),e.current({action:"update"})},{initialState:s,reducers:{update(e){e.running=t.running,e.speed=t.speed,e.steps=t.steps},setSteps(e,s){e.steps=s,t.steps=s},setSpeed(e,s){e.speed=s,t.speed=s}},actions:{frame(){t.frame()},start(){t.start(),e.current({action:"update"})},stop(){t.stop(),e.current({action:"update"})},reset(){t.reset(),e.current({action:"update"})}}}})(t,e)),[t,e]),[o,u]=(0,r.A)(n,s);return e.current=u,{state:o,dispatch:e.current,actions:a}}(t.runner),[s,a]=(0,i.useState)(2),o={0:[1e3,1],1:[500,1],2:[16,1],3:[16,16666],4:[16,499980]};(0,i.useEffect)((()=>{u()}),[s]);const u=()=>{const[t,n]=o[s];e.dispatch({action:"setSpeed",payload:t}),e.dispatch({action:"setSteps",payload:n})},c=(0,i.useRef)(null),h=t=>{c.current?.blur()};return(0,i.useEffect)((()=>(window.addEventListener("keydown",h),window.addEventListener("keyup",h),()=>{window.removeEventListener("keydown",h),window.removeEventListener("keyup",h)}))),(0,n.jsxs)("div",{className:"flex row wrap",children:[(0,n.jsxs)("fieldset",{role:"group",children:[t.prefix,(0,n.jsx)("button",{className:"flex-0",disabled:t.disabled,onClick:()=>e.actions.frame(),"data-tooltip":t.overrideTooltips?.step??"Step","data-placement":"bottom",children:"\u27a1\ufe0f"}),(0,n.jsx)("button",{className:"flex-0",ref:c,disabled:t.disabled,onClick:()=>e.state.running?e.actions.stop():e.actions.start(),"data-tooltip":e.state.running?t.overrideTooltips?.pause??"Pause":t.overrideTooltips?.run??"Run","data-placement":"bottom",children:e.state.running?"\u23f8":"\ufe0f\u23e9"}),(0,n.jsx)("button",{className:"flex-0",onClick:()=>{e.state.running&&e.actions.stop(),e.actions.reset()},"data-tooltip":t.overrideTooltips?.reset??"Reset","data-placement":"bottom",children:"\u23ee"})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:"normal"},children:[(0,n.jsx)("span",{style:{padding:"0.2rem"},children:"Slow"}),(0,n.jsx)("input",{type:"range",min:0,max:4,step:1,value:s,disabled:e.state.running,onChange:e=>{a(Number(e.target.value)),t.onSpeedChange?.(Number(e.target.value))},style:{width:"150px",padding:"0.2rem"},"data-tooltip":"Execution speed","data-placement":"bottom"}),(0,n.jsx)("span",{style:{padding:"0.2rem"},children:"Fast"})]}),t.children]})}},9651:(t,e,s)=>{s.d(e,{$L:()=>u,RY:()=>o,_b:()=>y,ti:()=>v,vu:()=>A,xo:()=>d,z7:()=>c});var n=s(2469),i=s(742),r=s(5874),a=s(1487);const o=1,u=0;class c{name;width;state;next=[];constructor(t,e=1){this.name=t,this.width=e,this.state=(0,i.y)(0,this.width).map((()=>u))}ensureWidth(t){(0,n.vA)(t<=16,`Cannot widen past 16 to ${t} bits`),this.width<t&&(this.width=t,this.state=[...this.state,...(0,i.y)(this.width,t).map((()=>u))])}connect(t){this.next.push(t),t.busVoltage=this.busVoltage}pull(t,e=0){(0,n.vA)(e>=0&&e<this.width,`Bit out of bounds: ${this.name}@${e}`),this.state[e]=t,this.next.forEach((s=>s.pull(t,e)))}voltage(t=0){return(0,n.vA)(t>=0&&t<this.width),this.state[t]}set busVoltage(t){for(const e of(0,i.y)(0,this.width))this.state[e]=(t&1<<e)>>e;this.next.forEach((t=>t.busVoltage=this.busVoltage))}get busVoltage(){return(0,i.y)(0,this.width).reduce(((t,e)=>t|this.state[e]<<e),0)}toggle(t=0){const e=this.voltage(t)===u?o:u;this.pull(e,t)}}class h extends c{bus;start;width;constructor(t,e,s=1){super(t.name),this.bus=t,this.start=e,this.width=s,(0,n.vA)(e>=0&&e+s<=t.width,`Mismatched InSubBus dimensions on ${t.name} (${s} + ${e} > ${t.width})`),this.connect(t)}pull(t,e=0){(0,n.vA)(e>=0&&e<this.width),this.bus.pull(t,this.start+e)}voltage(t=0){return(0,n.vA)(t>=0&&t<this.width),this.bus.voltage(this.start+t)}set busVoltage(t){const e=this.bus.busVoltage&~x(this.width+this.start),s=this.bus.busVoltage&x(this.start),n=(t&x(this.width))<<this.start;this.bus.busVoltage=e|n|s}get busVoltage(){return this.bus.busVoltage>>this.start&x(this.width)}connect(t){(0,n.vA)(this.start+this.width<=t.width,`Mismatched InSubBus connection dimensions (From ${t.name} to ${this.name})`),this.bus=t}}class l extends c{bus;start;width;constructor(t,e,s=1){super(t.name),this.bus=t,this.start=e,this.width=s,(0,n.vA)(e>=0&&s<=t.width,"Mismatched OutSubBus dimensions"),this.connect(t)}set busVoltage(t){this.bus.busVoltage=(t&x(this.width+this.start))>>this.start}get busVoltage(){return this.bus.busVoltage&x(this.width)}connect(t){(0,n.vA)(this.width<=t.width,"Mismatched OutSubBus connection dimensions"),this.bus=t}}class d extends c{value;constructor(t,e){super(t,16),this.value=e}pullHigh(t=0){}pullLow(t=0){}voltage(t=0){return 1&this.busVoltage}set busVoltage(t){}get busVoltage(){return this.value}}const m=new d("true",65535),p=new d("false",0);function g(t){const{pin:e,w:s}=t.match(/(?<pin>[a-zA-Z]+)(\[(?<w>\d+)\])?/)?.groups;return{pin:e,width:s?Number(s):1}}class f{map=new Map;insert(t){const{name:e}=t;(0,n.vA)(!this.map.has(e),`Pins already has ${e}!`),this.map.set(e,t)}emplace(t,e){if(this.has(t))return this.get(t);{const s=new c(t,e);return this.insert(s),s}}has(t){return this.map.has(t)}get(t){return this.map.get(t)}entries(){return this.map.values()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}function b(t,e,s){return t+e<=s.width?(0,r.Ok)():(0,r._)(`Sub-bus index out of range (${s.name} has width ${s.width})`)}let w=0;class A{name;id=w++;ins=new f;outs=new f;pins=new f;insToPart=new Map;partToOuts=new Map;parts=[];clockedPins;get clocked(){if(this.clockedPins.size>0)return!0;for(const t of this.parts)if(t.clocked)return!0;return!1}constructor(t,e,s,n=[],i=[]){this.name=s;for(const r of t){const{pin:t,width:e=1}=void 0!==r.pin?r:g(r);this.ins.insert(new c(t,e))}for(const r of e){const{pin:t,width:e=1}=void 0!==r.pin?r:g(r);this.outs.insert(new c(t,e))}for(const r of n){const{pin:t,width:e=1}=void 0!==r.pin?r:g(r);this.pins.insert(new c(t,e))}this.clockedPins=new Set(i),a.z.get().$.subscribe((()=>this.eval()))}reset(){for(const[t,e]of this.ins)e.busVoltage=0;for(const t of this.parts)t.reset();this.eval()}in(t="in"){return(0,n.vA)(this.hasIn(t),`No in pin ${t}`),this.ins.get(t)}out(t="out"){return(0,n.vA)(this.hasOut(t),`No in pin ${t}`),this.outs.get(t)}hasIn(t){return this.ins.has(t)}hasOut(t){return this.outs.has(t)}pin(t){return(0,n.vA)(this.pins.has(t)),this.pins.get(t)}get(t,e){return this.ins.has(t)?this.ins.get(t):this.outs.has(t)?this.outs.get(t):this.pins.has(t)?this.pins.get(t):this.getBuiltin(t,e)}getBuiltin(t,e=0){if(D.includes(t))for(const s of this.parts){const n=s.get(t,e);if(n)return n}}isInPin(t){return this.ins.has(t)}isOutPin(t){return this.outs.has(t)}wire(t,e){for(let n=0;n<e.length;n++){const{from:s,to:i}=e[n];if(t.isOutPin(i.name)){const e=this.wireOutPin(t,i,s);if((0,r.ys)(e))return(0,r._)({wireIndex:n,lhs:(0,r._)(e).lhs,message:(0,r._)(e).message})}else{const e=this.wireInPin(t,i,s);if((0,r.ys)(e))return(0,r._)({wireIndex:n,lhs:(0,r._)(e).lhs,message:(0,r._)(e).message})}}const s=this.parts.findIndex((e=>[...this.partToOuts.get(t)??[]].some((t=>this.insToPart.get(t)?.has(e)))));return s<0?this.parts.push(t):s>0?this.parts.splice(s-1,0,t):this.parts.unshift(t),(0,r.Ok)()}findPin(t,e){return"true"===t||"1"===t?m:"false"===t||"0"===t?p:this.ins.has(t)?this.ins.get(t):this.outs.has(t)?this.outs.get(t):this.pins.emplace(t,e)}wireOutPin(t,e,s){const i=(0,n.Z1)(t.outs.get(e.name),(()=>`Cannot wire to missing pin ${e.name}`));e.width??=i.width;let a=this.findPin(s.name,s.width??e.width);const o=this.pins.has(a.name);if(s.width??=a.width,a instanceof d)return(0,r._)({message:"Cannot wire to constant bus",lhs:!0});if(o&&a instanceof c&&a.ensureWidth(s.start+s.width),s.start>0||s.width!==a.width){const t=b(s.start,s.width,a);if((0,r.ys)(t))return(0,r._)({message:(0,r._)(t),lhs:!0});a=new h(a,s.start,s.width)}if(e.start>0||e.width!==i.width){const t=b(e.start,e.width,i);if((0,r.ys)(t))return(0,r._)({message:(0,r._)(t),lhs:!1});a=new l(a,e.start,e.width)}i.connect(a);const u=this.partToOuts.get(t)??new Set;return u.add(a.name),this.partToOuts.set(t,u),(0,r.Ok)()}wireInPin(t,e,s){let i=(0,n.Z1)(t.ins.get(e.name),(()=>`Cannot wire to missing pin ${e.name}`));e.width??=i.width;const a=this.findPin(s.name,s.width??e.width);if(s.width??=a.width,e.start>0||e.width!==i.width){const t=b(e.start,e.width,i);if((0,r.ys)(t))return(0,r._)({message:(0,r._)(t),lhs:!0});i=new h(i,e.start,e.width)}if(!["true","false"].includes(a.name)&&(s.start>0||s.width!==a.width)){const t=b(s.start,s.width,a);if((0,r.ys)(t))return(0,r._)({message:(0,r._)(t),lhs:!1});i=new l(i,s.start,s.width)}a.connect(i);const o=this.insToPart.get(a.name)??new Set;return o.add(t),this.insToPart.set(a.name,o),(0,r.Ok)()}eval(){for(const t of this.parts)m.next.forEach((t=>t.busVoltage=m.busVoltage)),p.next.forEach((t=>t.busVoltage=p.busVoltage)),t.eval()}tick(){this.eval()}tock(){this.eval()}remove(){for(const t of this.parts)t.remove()}async load(t,e){for(const s of this.parts)"ROM32K"===s.name&&await s.load(t,e)}}class v extends A{constructor(){super([],[]),this.outs.insert(p)}}class y extends A{get clocked(){return!0}#t=a.z.get().$.subscribe((({level:t})=>{t===u?this.tock():this.tick()}));remove(){this.#t.unsubscribe(),super.remove()}reset(){super.reset(),this.tick(),this.tock()}}function x(t){return Math.pow(2,t)-1}const D=["Register","ARegister","DRegister","PC","RAM8","RAM64","RAM512","RAM4K","RAM16K","ROM32K","Screen","Keyboard","Memory"]},1487:(t,e,s)=>{s.d(e,{z:()=>u});var n=s(7740),i=s(1435),r=s(2469),a=s(9651);let o;class u{level=a.$L;ticks=0;static get(){return void 0===o&&(o=new u),o}get isHigh(){return this.level===a.RY}get isLow(){return this.level===a.$L}subject=new n.t({level:this.level,ticks:this.ticks});frameSubject=new i.B;resetSubject=new i.B;$=this.subject;frame$=this.frameSubject;reset$=this.resetSubject;next(){this.subject.next({level:this.level,ticks:this.ticks})}constructor(){}reset(){this.level=a.$L,this.ticks=0,this.next(),this.resetSubject.next()}tick(){(0,r.vA)(this.level===a.$L,"Can only tick up from LOW"),this.level=a.RY,this.next()}tock(){(0,r.vA)(this.level===a.RY,"Can only tock down from HIGH"),this.level=a.$L,this.ticks+=1,this.next()}toggle(){this.level===a.RY?this.tock():this.tick()}eval(){this.tick(),this.tock()}frame(){this.frameSubject.next()}toString(){return`${this.ticks}${this.level===a.RY?"+":""}`}}},8739:(t,e,s)=>{s.d(e,{Lo:()=>a,Nt:()=>u,Qv:()=>l,_0:()=>r,ft:()=>d,iI:()=>m,nf:()=>i,qn:()=>g,uW:()=>c,v0:()=>p});const n=new Set(["0","1","-1","D","A","!D","!A","-D","-A","D+1","A+1","D-1","A-1","D+A","D-A","A-D","D&A","D|A"]);function i(t){return n.has(t)}const r={op:{42:"0",63:"1",58:"-1",12:"x",48:"y",13:"!x",49:"!y",15:"-x",51:"-y",31:"x+1",55:"y+1",14:"x-1",50:"y-1",2:"x+y",19:"x-y",7:"y-x",0:"x&y",21:"x|y"}},a={asm:{0:42,1:63,"-1":58,D:12,A:48,"!D":13,"!A":49,"-D":15,"-A":51,"D+1":31,"A+1":55,"D-1":14,"A-1":50,"D+A":2,"D-A":19,"A-D":7,"D&A":0,"D|A":21},op:{42:"0",63:"1",58:"-1",12:"D",48:"A",13:"!D",49:"!A",15:"-D",51:"-A",31:"D+1",55:"A+1",14:"D-1",50:"A-1",2:"D+A",19:"D-A",7:"A-D",0:"D&A",21:"D|A"},getOp:t=>a.asm[t.replace("M","A")]},o=new Set(["","M","D","MD","A","AM","AD","AMD"]);function u(t){return o.has(t)}const c={asm:{"":0,M:1,D:2,MD:3,A:4,AM:5,AD:6,AMD:7},op:{0:"",1:"M",2:"D",3:"MD",4:"A",5:"AM",6:"AD",7:"AMD"}},h=new Set(["","JGT","JEQ","JGE","JLT","JNE","JLE","JMP"]);function l(t){return h.has(t)}const d={asm:{"":0,JGT:1,JEQ:2,JGE:3,JLT:4,JNE:5,JLE:6,JMP:7},op:{0:"",1:"JGT",2:"JEQ",3:"JGE",4:"JLT",5:"JNE",6:"JLE",7:"JMP"}},m={1:"Positive",0:"Zero",15:"Negative",Positive:1,Zero:0,Negative:15};function p(t,e,s){let n=0;switch(t){case 42:n=0;break;case 63:n=1;break;case 58:n=-1;break;case 12:n=e;break;case 48:n=s;break;case 13:n=~e;break;case 49:n=~s;break;case 15:n=-e;break;case 51:n=-s;break;case 31:n=e+1;break;case 55:n=s+1;break;case 14:n=e-1;break;case 50:n=s-1;break;case 2:n=e+s;break;case 19:n=e-s;break;case 7:n=s-e;break;case 0:n=e&s;break;case 21:n=e|s}n&=65535;return[n,0===n?m.Zero:32768&n?m.Negative:m.Positive]}function g(t,e,s){32&t&&(e=0),16&t&&(e=65535&~e),8&t&&(s=0),4&t&&(s=65535&~s);let n=65535&(2&t?e+s:e&s);1&t&&(n=65535&~n);return[n,0===n?m.Zero:32768&n?m.Negative:m.Positive]}},7076:(t,e,s)=>{s.d(e,{L7:()=>u,PC:()=>g,RL:()=>l,XK:()=>b,ce:()=>m,dh:()=>c,hR:()=>o,ky:()=>d,n9:()=>f,pc:()=>h,qN:()=>p});var n=s(2469),i=s(6983),r=s(7496),a=s(7844);const o=["bin","dec","hex","asm"],u=16384,c=256,h=32,l=c*h,d=24576;class m{memory;changed;get size(){return this.memory.length}constructor(t){"number"===typeof t?(this.memory=new Int16Array(t),this.changed=new Array(t).fill(!1)):(this.memory=new Int16Array(t),this.changed=new Array(this.size).fill(!0))}get(t){return t<0||t>=this.size?65535:this.memory[t]??0}wasChanged(t){return this.changed[t]}setChanged(t,e){this.changed[t]=e}set(t,e){t>=0&&t<this.size&&(this.memory[t]=65535&e,this.setChanged(t,!0))}reset(){this.memory.fill(0),this.changed.fill(!1)}update(t,e,s){let n;switch(s){case"asm":try{n=(0,r.op)(e)}catch{n=void 0}break;case"bin":n=(0,a.Yp)(e);break;case"hex":n=(0,a.l8)(e);break;default:n=(0,a.ZR)(e)}void 0!==n&&isFinite(n)&&n<=65535&&this.set(t,n)}async load(t,e,s){try{this.loadBytes(await(0,i.Hh)(t,e),s)}catch(n){throw new Error(`Memory Failed to load file ${e}`)}}loadBytes(t,e){this.memory.set(new Int16Array(t),e),this.memory.fill(0,t.length,this.size),this.changed.fill(!0,0,t.length),this.changed.fill(!1,t.length,this.size)}range(t=0,e=this.size){return[...this.memory.slice(t,e)]}*map(t,e=0,s=this.size){(0,n.vA)(e<=s);for(let n=e;n<s;n++)yield t(n,this.get(n))}[Symbol.iterator](){return this.map(((t,e)=>e))}}class p{parent;size;offset;constructor(t,e,s){this.parent=t,this.size=e,this.offset=s}get(t){return t<0||t>=this.size?65535:this.parent.get(this.offset+t)}wasChanged(t){return this.parent.wasChanged(this.offset+t)}setChanged(t,e){this.parent.setChanged(t+this.offset,e)}set(t,e,s=!0){t>=0&&t<this.size&&this.parent.set(t+this.offset,e)}reset(){for(let t=0;t<this.size;t++)this.set(t,0,!1),this.setChanged(t,!1)}update(t,e,s){t>=0&&t<this.size&&this.parent.update(t+this.offset,e,s)}load(t,e){return this.parent.load(t,e,this.offset)}loadBytes(t){return this.parent.loadBytes(t,this.offset)}range(t,e){return this.parent.range(t,e)}map(t,e=0,s=this.size){return this.parent.map(t,e+this.offset,s+this.offset)}[Symbol.iterator](){return this.map(((t,e)=>e))}}class g extends p{constructor(t){super(t,1,24576)}getKey(){return this.get(0)}setKey(t){this.set(0,65535&t)}clearKey(){this.set(0,0)}}class f extends m{static SIZE=32768;constructor(t){if(t){const e=new Int16Array(f.SIZE);e.set(t),super(e)}else super(f.SIZE)}}class b extends m{keyboard=new p(this,1,d);screen=new p(this,l,u);static SIZE=32768;constructor(){super(b.SIZE)}}},6983:(t,e,s)=>{s.d(e,{Hh:()=>i});var n=s(9547);async function i(t,e){if(e.endsWith(".hack"))return async function(t,e){return n.aU(await t.readFile(e))}(t,e);if(e.endsWith(".asm"))return async function(t,e){return n.aY(await t.readFile(e))}(t,e);throw new Error(`Cannot load file without hack or asm extension ${e}`)}},4666:(t,e,s)=>{s.d(e,{y0:()=>v,EU:()=>g,J$:()=>m,ld:()=>f});var n=s(2469),i=s(4533),r=s(8739),a=s(7076),o=s(7496),u=s(3977),c=s(5874);const h='\nASM <: Base {\n  Root := ASM\n  ASM = intermediateInstruction* instruction?\n  \n  instruction = label|aInstruction|cInstruction\n  intermediateInstruction = instruction space+\n\n  label = openParen identifier closeParen\n  aInstruction = at (identifier | decNumber)\n  cInstruction = assign? op jmp?\n  \n  /* The book (figure 4.5) specifies DM and ADM as the correct forms for destination,\n     but since the desktop simulators accept only MD and AMD we have decided to accept both */\n  assign = (\n      "AMD" | "ADM"\n      | "AM"\n      | "AD"\n      | "MD" | "DM"\n      | "M"\n      | "D"\n      | "A"\n      ) equal\n      \n  op =\n      | "0" | "1" | "-1"\n      | "!D" | "!A" | "!M"\n      | "-D" | "-A" | "-M"\n      | "D+1" | "A+1" | "M+1"\n      | "D-1" | "A-1" | "M-1"\n      | "D+A" | "D+M"\n      | "D-A" | "D-M"\n      | "A-D" | "M-D"\n      | "D&A" | "D&M"\n      | "D|A" | "D|M"\n      | "D" | "A" | "M"\n\n\n  jmp = semi ("JGT" | "JEQ" | "JGE" | "JLT" | "JNE" | "JLE" | "JMP")\n}',l=i.A.grammar(h,u.lN),d=l.extendSemantics(u.JE);function m(t){return"A"==t.type&&void 0!==t.value}function p(t){return"A"==t.type&&void 0!==t.label}function g(t,e){let s=16;const i=new Map([["R0",0],["R1",1],["R2",2],["R3",3],["R4",4],["R5",5],["R6",6],["R7",7],["R8",8],["R9",9],["R10",10],["R11",11],["R12",12],["R13",13],["R14",14],["R15",15],["SP",0],["LCL",1],["ARG",2],["THIS",3],["THAT",4],["SCREEN",a.L7],["KBD",a.ky]]);const r=[];let o=0;for(const n of t.instructions)if("L"!==n.type)o+=1,"A"===n.type&&p(n)&&r.push(n);else{if(i.has(n.label))return(0,c._)((0,u.$5)(`Duplicate label ${n.label}`,n.span));i.set(n.label,o),e?.(n.label,o,!1)}return r.forEach((function(t){const r=(a=t.label,i.has(a)||(i.set(a,s),e?.(a,s,!0),s+=1),(0,n.Z1)(i.get(a),`Label not in symbols: ${a}`));var a;t.value=r,delete t.label})),(0,c.Ok)()}d.addAttribute("root",{Root(t){return this.asm}}),d.addAttribute("asm",{ASM(t,e){const s=t.children.map((t=>t.intermediateInstruction))??[];return{instructions:e.child(0)?[...s,e.child(0).instruction]:s}}}),d.addAttribute("intermediateInstruction",{intermediateInstruction:(t,e)=>t.instruction}),d.addAttribute("instruction",{aInstruction(t,e){return b(e.value,(0,u.Ln)(this.source))},cInstruction(t,e,s){let n=t.child(0)?.child(0)?.sourceString??"";"DM"==n&&(n="MD"),"ADM"==n&&(n="AMD");const i=e.sourceString,r=s.child(0)?.child(1)?.sourceString??"";return w(n,i,r,(0,u.Ln)(this.source))},label(t,{name:e},s){return A(e,(0,u.Ln)(this.source))}});function f(t){if("A"===t.type){if(p(t))throw new Error("ASM Emitting unfilled A instruction");return t.value}if("C"===t.type)return(0,o.m)(t.isM,t.op,t.store??0,t.jump??0)}const b=(t,e)=>"string"===typeof t?{type:"A",label:t,span:e}:{type:"A",value:t,span:e},w=(t,e,s,n)=>{const i={type:"C",op:r.Lo.getOp(e),isM:e.includes("M"),span:n};return s&&(i.jump=r.ft.asm[s]),t&&(i.store=r.uW.asm[t]),i},A=(t,e)=>({type:"L",label:t,span:e}),v={grammar:h,semantics:d,parser:l,parse:(0,u.Q5)(l,d),passes:{fillLabel:g,emit:function(t){return t.instructions.map(f).filter((t=>void 0!==t))}},A:b,C:w,AC:(t,e,s,n)=>[b(t),w(e,s,n)],L:A}},3977:(t,e,s)=>{s.d(e,{JE:()=>o,$5:()=>c,lN:()=>a,Q5:()=>h,Ln:()=>l});var n=s(5874),i=s(4533),r=s(7844);const a={Base:i.A.grammar('\nBase {\n  Root = Value*\n\n  At = at\n  Bang = bang\n  Bar = bar\n  CloseAngle = closeAngle\n  CloseBrace = closeBrace\n  CloseParen = closeParen\n  CloseSquare = closeSquare\n  Comma = comma\n  Dollar = dollar\n  Dot = dot\n  DoubleQuote = doubleQuote\n  Equal = equal\n  OpenAngle = openAngle\n  OpenBrace = openBrace\n  OpenParen = openParen\n  OpenSquare = openSquare\n  Percent = percent\n  Semi = semi\n  Underscore = underscore\n\n  at = "@"\n  bang = "!"\n  bar = "|"\n  closeAngle = ">"\n  closeBrace = "}"\n  closeParen = ")"\n  closeSquare = "]"\n  comma = ","\n  dollar = "$"\n  dot = "."\n  doubleQuote = "\\""\n  equal = "="\n  minus = "-"\n  newline = "\\r"? "\\n"\n  openAngle = "<"\n  openBrace = "{"\n  openParen = "("\n  openSquare = "["\n  percent = "%"\n  semi = ";"\n  underscore = "_"\n\n  Value = identifier | number | boolean\n\n  boolean = true | false\n  True = true\n  False = false\n  true = "true"\n  false = "false"\n\n  Name = identifier\n  identifier = (letter|underscore|dot|dollar) (alnum|underscore|dot|dollar)*\n\n  Number = number\n  number = hexNumber | decNumber | binNumber\n  binNumber = ("%B") ("0"|"1")+\n  hexNumber = ("%X") hexDigit+\n  decNumber = ("%D")? (wholeDec | realDec)\n  wholeDec = minus? digit+\n  realDec = minus? digit* "." digit+\n\n  String = DoubleQuote (~doubleQuote any)* doubleQuote\n  \n  spaces := (lineComment | comment | space)*\n  commentStart = "/*"\n  commentEnd = "*/"\n  comment = commentStart (~commentEnd any)* commentEnd\n  lineCommentStart = "//"\n  lineComment = lineCommentStart (~"\\n" any)*\n\n  List<elem, sep> = NonemptyListOf<elem, sep> sep?\n  EmptyList<elem, sep> = EmptyList<elem, sep> sep?\n}')},o=a.Base.createSemantics();o.extendOperation("asIteration",{List:(t,e)=>t.asIteration()}),o.addAttribute("value",{decNumber:(t,e)=>(0,r.ZR)(e.sourceString),wholeDec:(t,e)=>(0,r.ZR)(e.sourceString),binNumber:(t,e)=>(0,r.Yp)(e.sourceString),hexNumber:(t,e)=>(0,r.l8)(e.sourceString),Number:t=>t.value,Name:t=>t.name,identifier(t,e){return this.sourceString}}),o.addAttribute("name",{identifier(t,e){return this.sourceString},Name(t){return this.child(0)?.name}}),o.addAttribute("String",{String:(t,e,s)=>e.sourceString});const u="HDL statement has a syntax error";function c(t,e){const s=t.match(/Line \d+, col \d+: (?<message>.*)/),n=s?.groups?.message?s.groups.message:t;return{message:`${void 0!=e?.line?`Line ${e.line}: `:""}${n}`,span:e}}function h(t,e,s=(({root:t})=>t)){return function(i){try{const r=t.match(i);if(r.succeeded()){const t=e(r),i=s(t);return(0,n.Ok)(i)}return(0,n._)(c(r.shortMessage??u,l(r.getInterval())))}catch(r){return(0,n._)(r)}}}function l(t){return{start:t.startIdx,end:t.endIdx,line:t.getLineAndColumn().lineNum}}},9547:(t,e,s)=>{s.d(e,{aU:()=>o,aY:()=>a,yt:()=>u});var n=s(5874),i=s(4666),r=s(7844);async function a(t){const e=(0,n.oA)(i.y0.parse(t));return i.y0.passes.fillLabel(e),i.y0.passes.emit(e)}async function o(t){return t.split("\n").filter((t=>""!==t.trim())).map(r.Yp)}async function u(t){return t.split("\n").filter((t=>""!==t.trim())).map(r._Q)}},1091:(t,e,s)=>{s.d(e,{M:()=>i});const n=s(1487).z.get();class i{frame(){this.tick(),this.finishFrame()}finishFrame(){n.frame()}steps=1;speed=1e3;get running(){return this.#e}#e=!1;#s=0;#n=0;#i=async()=>{if(!this.#e)return;const t=Date.now(),e=t-this.#n;if(this.#n=t,this.#s+=e,this.#s>this.speed){let t=!1,e=this.steps;const s=`Timing ${e} steps`;for(console.time(s);!t&&e--;)t=await this.tick();console.timeEnd(s),this.finishFrame(),t&&this.stop(),this.#s-=this.speed}requestAnimationFrame(this.#i)};start(){this.#e=!0,this.#n=Date.now()-this.speed,this.#i(),this.toggle()}stop(){this.#e=!1,this.toggle()}}},7496:(t,e,s)=>{s.d(e,{k:()=>i,m:()=>a,op:()=>r});var n=s(8739);function i(t){return 32768&t?function(t){t&=65535;const e=(4096&t)>>12,s=(4032&t)>>6,i=(56&t)>>3,r=7&t;if(void 0===n.Lo.op[s])return"#ERR";let a=n.Lo.op[s];e&&(a=a.replace(/A/g,"M"));const o=n.uW.op[i],u=n.ft.op[r];let c=a;o&&(c=`${o}=${c}`);u&&(c=`${c};${u}`);return c}(t):function(t){return"@"+(32767&t).toString(10)}(t)}function r(t){return"@"===t[0]?function(t){return parseInt(t.substring(1),10)}(t):function(t){const e=t.match(/(?:(?<assignExists>.+)=)?(.+)(?:;(?<jumpExists>.+))?/),{assignExists:s,jumpExists:i}=e?.groups??{},r=t.match(/(?:(?<assign>[AMD]{1,3})=)?(?<operation>[-+!01ADM&|]{1,3})(?:;(?<jump>JGT|JLT|JGE|JLE|JEQ|JMP))?/);let{assign:o,jump:u}=r?.groups??{};const{operation:c}=r?.groups??{};if(o=o??(s?void 0:""),u=u??(i?void 0:""),r?.[0]!=t||!(0,n.Nt)(o)||!(0,n.Qv)(u)||!(0,n.nf)(c)&&!(0,n.nf)(c.replace("M","A")))throw new Error("Invalid c instruction");const h=c.includes("M"),l=n.uW.asm[o],d=n.ft.asm[u],m=n.Lo.getOp(c);return a(h,m,l,d)}(t)}function a(t,e,s,n){return 57344+(t?4096:0)+(e<<6)+(s<<3)+n}},7844:(t,e,s)=>{s.d(e,{FN:()=>m,Yp:()=>c,ZR:()=>u,_Q:()=>h,ad:()=>p,e5:()=>d,l8:()=>o,uh:()=>l,xu:()=>g});const n=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];function i(t){return n[t]??"X"}function r(t){switch(t){case 0:return"0000";case 1:return"0001";case 2:return"0010";case 3:return"0011";case 4:return"0100";case 5:return"0101";case 6:return"0110";case 7:return"0111";case 8:return"1000";case 9:return"1001";case 10:return"1010";case 11:return"1011";case 12:return"1100";case 13:return"1101";case 14:return"1110";case 15:return"1111";default:return"erro"}}function a(t,e){return 65535&parseInt(t.replace(/[^\d a-f A-F +-.]/g,""),e)}function o(t){return a(t,16)}function u(t){return a(t,10)}function c(t){return a(t.replaceAll(" ",""),2)}function h(t){return t.toUpperCase().includes("X")?o(t):u(t)}function l(t){return`0x${i((61440&t)>>12)}${i((3840&t)>>8)}${i((240&t)>>4)}${i(15&t)}`}function d(t,e=16){return`${r((61440&t)>>12)}${r((3840&t)>>8)}${r((240&t)>>4)}${r(15&t)}`.substring(16-e)}function m(t){return 32768===(t&=65535)?"-32768":32768&t?`-${t=1+~t&32767}`:`${t}`}function p(t){return`${t&=65535}`}function g(t,e){let s=~((t&=65535)&(e&=65535));return s&=65535,s}}}]);