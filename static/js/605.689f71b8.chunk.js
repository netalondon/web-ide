"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[605],{9605:function(e,t,n){n.r(t),n.d(t,{Chip:function(){return Jt},default:function(){return Gt}});var r=n(2951),i=n(1976),o=n(3243),a=n(7597),s=n(7591),c=n(4337),u=n(1092),l=n(7791),d=n(1026),f=n(8061),p=n(6167),h=n(649),v=n(7878),m=n(3300),g=n(3118),x=n(7039),b=n(3116),j=n(6329),y=n(6693),k=n(134),C=n(326),Z=function(e){var t,n=e.A,r=e.op,i=e.D,o=e.out,a=e.flag;return(0,v.jsxs)("div",{children:[(0,v.jsx)("span",{children:"ALU"}),(0,v.jsxs)("dl",{children:[(0,v.jsx)("dt",{children:"A"})," ",(0,v.jsx)("dd",{children:(0,C.Ly)(n)}),(0,v.jsx)("dt",{children:"op"})," ",(0,v.jsx)("dd",{children:null!==(t=y.PH.op[r])&&void 0!==t?t:"(??)"}),(0,v.jsx)("dt",{children:"D"})," ",(0,v.jsx)("dd",{children:(0,C.Ly)(i)}),(0,v.jsx)("dt",{children:"="})," ",(0,v.jsx)("dd",{children:(0,C.Ly)(o)}),(0,v.jsx)("dd",{children:y.vU[a]})]})]})},w=function(e){var t=e.name,n=e.bits;return(0,v.jsxs)("div",{children:[t,": ",(0,C.E_)(n)]})},P={Enter:128,Backspace:129,ArrowLeft:130,ArrowUp:131,ArrowRight:132,ArrowDown:133,Home:134,End:135,PageUp:136,PageDown:137,Insert:138,Delete:139,Escape:140,F1:141,F2:142,F3:143,F4:144,F5:145,F6:146,F7:147,F8:148,F9:149,F10:150,F11:151,F12:152};var S=function(e){var t=e.keyboard,n=(0,p.useState)(!1),r=(0,d.Z)(n,2),i=r[0],o=r[1],a=(0,p.useState)(t.out().busVoltage),s=(0,d.Z)(a,2),c=s[0],u=s[1],l=(0,p.useCallback)((function(e){var n=function(e){var t=P[e.key];if(void 0!==t)return t;if(1===e.key.length){var n=e.key.charCodeAt(0);if(n>=32&&n<=126)return n}return 0}(e);0!==n&&(e.preventDefault(),t.setKey(n),u(t.out().busVoltage),o(!1))}),[t,o,u]),f=(0,p.useCallback)((function(){o(!0)}),[]);return(0,v.jsxs)("div",{className:"flex row align-baseline",children:[(0,v.jsx)("div",{className:"flex-1",children:(0,v.jsx)(w,{name:"Keyboard",bits:c})}),(0,v.jsx)("div",{className:"flex-1",children:i?(0,v.jsx)("input",{ref:function(e){return null===e||void 0===e?void 0:e.focus()},type:"text",onKeyDown:l}):(0,v.jsx)("button",{onClick:f,children:"\u2328\ufe0f"})})]})},F=n(189),N={none:"0px",sm:"0.125rem","":"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},O={"":"",t:"Top",r:"Right",l:"Left",b:"Bottom",tl:"TopLeft",tr:"TopRight",bl:"BottomLeft",br:"BottomRight"},A={"1/4":"25%","1/2":"50%","3/4":"75%",full:"100%"};function E(e){return void 0!==O[e]}function I(e){return N[e]}function M(e){switch(e){case"t":return[].concat((0,h.Z)(M("tl")),(0,h.Z)(M("tr")));case"r":return[].concat((0,h.Z)(M("tr")),(0,h.Z)(M("br")));case"b":return[].concat((0,h.Z)(M("br")),(0,h.Z)(M("bl")));case"l":return[].concat((0,h.Z)(M("tl")),(0,h.Z)(M("bl")));default:return[O[e]]}}function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";E(e)&&(t=e,e="");var n=I(e);return M(t).reduce((function(e,t){return""===t?e.borderRadius=n:e["border".concat(t,"Radius")]=n,e}),{})}var R=n(5838),D=n(7693);function H(e,t){var n;return void 0===e&&void 0!==A[t]&&(e=t),(0,F.Z)((0,F.Z)({},"inline"===t?{display:"inline-block"}:{}),{},{width:null!==(n=A[e])&&void 0!==n?n:"0"})}function _(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+e+(n.length?" "+n.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function L(e){return!!e&&!!e[Se]}function U(e){var t;return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===Fe}(e)||Array.isArray(e)||!!e[Pe]||!!(null===(t=e.constructor)||void 0===t?void 0:t[Pe])||G(e)||$(e))}function z(e,t,n){void 0===n&&(n=!1),0===B(e)?(n?Object.keys:Ne)(e).forEach((function(r){n&&"symbol"==typeof r||t(r,e[r],e)})):e.forEach((function(n,r){return t(r,n,e)}))}function B(e){var t=e[Se];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:G(e)?2:$(e)?3:0}function K(e,t){return 2===B(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function V(e,t){return 2===B(e)?e.get(t):e[t]}function W(e,t,n){var r=B(e);2===r?e.set(t,n):3===r?(e.delete(t),e.add(n)):e[t]=n}function J(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function G(e){return ke&&e instanceof Map}function $(e){return Ce&&e instanceof Set}function q(e){return e.o||e.t}function X(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=Oe(e);delete t[Se];for(var n=Ne(t),r=0;r<n.length;r++){var i=n[r],o=t[i];!1===o.writable&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function Y(e,t){return void 0===t&&(t=!1),ee(e)||L(e)||!U(e)||(B(e)>1&&(e.set=e.add=e.clear=e.delete=Q),Object.freeze(e),t&&z(e,(function(e,t){return Y(t,!0)}),!0)),e}function Q(){_(2)}function ee(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function te(e){var t=Ae[e];return t||_(18,e),t}function ne(){return je}function re(e,t){t&&(te("Patches"),e.u=[],e.s=[],e.v=t)}function ie(e){oe(e),e.p.forEach(se),e.p=null}function oe(e){e===je&&(je=e.l)}function ae(e){return je={p:[],l:je,h:e,m:!0,_:0}}function se(e){var t=e[Se];0===t.i||1===t.i?t.j():t.O=!0}function ce(e,t){t._=t.p.length;var n=t.p[0],r=void 0!==e&&e!==n;return t.h.g||te("ES5").S(t,e,r),r?(n[Se].P&&(ie(t),_(4)),U(e)&&(e=ue(t,e),t.l||de(t,e)),t.u&&te("Patches").M(n[Se].t,e,t.u,t.s)):e=ue(t,n,[]),ie(t),t.u&&t.v(t.u,t.s),e!==we?e:void 0}function ue(e,t,n){if(ee(t))return t;var r=t[Se];if(!r)return z(t,(function(i,o){return le(e,r,t,i,o,n)}),!0),t;if(r.A!==e)return t;if(!r.P)return de(e,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var i=4===r.i||5===r.i?r.o=X(r.k):r.o;z(3===r.i?new Set(i):i,(function(t,o){return le(e,r,i,t,o,n)})),de(e,i,!1),n&&e.u&&te("Patches").R(r,n,e.u,e.s)}return r.o}function le(e,t,n,r,i,o){if(L(i)){var a=ue(e,i,o&&t&&3!==t.i&&!K(t.D,r)?o.concat(r):void 0);if(W(n,r,a),!L(a))return;e.m=!1}if(U(i)&&!ee(i)){if(!e.h.F&&e._<1)return;ue(e,i),t&&t.A.l||de(e,i)}}function de(e,t,n){void 0===n&&(n=!1),e.h.F&&e.m&&Y(t,n)}function fe(e,t){var n=e[Se];return(n?q(n):e)[t]}function pe(e,t){if(t in e)for(var n=Object.getPrototypeOf(e);n;){var r=Object.getOwnPropertyDescriptor(n,t);if(r)return r;n=Object.getPrototypeOf(n)}}function he(e){e.P||(e.P=!0,e.l&&he(e.l))}function ve(e){e.o||(e.o=X(e.t))}function me(e,t,n){var r=G(t)?te("MapSet").N(t,n):$(t)?te("MapSet").T(t,n):e.g?function(e,t){var n=Array.isArray(e),r={i:n?1:0,A:t?t.A:ne(),P:!1,I:!1,D:{},l:t,t:e,k:null,o:null,j:null,C:!1},i=r,o=Ee;n&&(i=[r],o=Ie);var a=Proxy.revocable(i,o),s=a.revoke,c=a.proxy;return r.k=c,r.j=s,c}(t,n):te("ES5").J(t,n);return(n?n.A:ne()).p.push(r),r}function ge(e){return L(e)||_(22,e),function e(t){if(!U(t))return t;var n,r=t[Se],i=B(t);if(r){if(!r.P&&(r.i<4||!te("ES5").K(r)))return r.t;r.I=!0,n=xe(t,i),r.I=!1}else n=xe(t,i);return z(n,(function(t,i){r&&V(r.t,t)===i||W(n,t,e(i))})),3===i?new Set(n):n}(e)}function xe(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return X(e)}var be,je,ye="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),ke="undefined"!=typeof Map,Ce="undefined"!=typeof Set,Ze="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,we=ye?Symbol.for("immer-nothing"):((be={})["immer-nothing"]=!0,be),Pe=ye?Symbol.for("immer-draftable"):"__$immer_draftable",Se=ye?Symbol.for("immer-state"):"__$immer_state",Fe=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),Ne="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,Oe=Object.getOwnPropertyDescriptors||function(e){var t={};return Ne(e).forEach((function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)})),t},Ae={},Ee={get:function(e,t){if(t===Se)return e;var n=q(e);if(!K(n,t))return function(e,t,n){var r,i=pe(t,n);return i?"value"in i?i.value:null===(r=i.get)||void 0===r?void 0:r.call(e.k):void 0}(e,n,t);var r=n[t];return e.I||!U(r)?r:r===fe(e.t,t)?(ve(e),e.o[t]=me(e.A.h,r,e)):r},has:function(e,t){return t in q(e)},ownKeys:function(e){return Reflect.ownKeys(q(e))},set:function(e,t,n){var r=pe(q(e),t);if(null==r?void 0:r.set)return r.set.call(e.k,n),!0;if(!e.P){var i=fe(q(e),t),o=null==i?void 0:i[Se];if(o&&o.t===n)return e.o[t]=n,e.D[t]=!1,!0;if(J(n,i)&&(void 0!==n||K(e.t,t)))return!0;ve(e),he(e)}return e.o[t]===n&&"number"!=typeof n&&(void 0!==n||t in e.o)||(e.o[t]=n,e.D[t]=!0,!0)},deleteProperty:function(e,t){return void 0!==fe(e.t,t)||t in e.t?(e.D[t]=!1,ve(e),he(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var n=q(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty:function(){_(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){_(12)}},Ie={};z(Ee,(function(e,t){Ie[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),Ie.deleteProperty=function(e,t){return Ie.set.call(this,e,t,void 0)},Ie.set=function(e,t,n){return Ee.set.call(this,e[0],t,n,e[0])};var Me=function(){function e(e){var t=this;this.g=Ze,this.F=!0,this.produce=function(e,n,r){if("function"==typeof e&&"function"!=typeof n){var i=n;n=e;var o=t;return function(e){var t=this;void 0===e&&(e=i);for(var r=arguments.length,a=Array(r>1?r-1:0),s=1;s<r;s++)a[s-1]=arguments[s];return o.produce(e,(function(e){var r;return(r=n).call.apply(r,[t,e].concat(a))}))}}var a;if("function"!=typeof n&&_(6),void 0!==r&&"function"!=typeof r&&_(7),U(e)){var s=ae(t),c=me(t,e,void 0),u=!0;try{a=n(c),u=!1}finally{u?ie(s):oe(s)}return"undefined"!=typeof Promise&&a instanceof Promise?a.then((function(e){return re(s,r),ce(e,s)}),(function(e){throw ie(s),e})):(re(s,r),ce(a,s))}if(!e||"object"!=typeof e){if(void 0===(a=n(e))&&(a=e),a===we&&(a=void 0),t.F&&Y(a,!0),r){var l=[],d=[];te("Patches").M(e,a,l,d),r(l,d)}return a}_(21,e)},this.produceWithPatches=function(e,n){if("function"==typeof e)return function(n){for(var r=arguments.length,i=Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return t.produceWithPatches(n,(function(t){return e.apply(void 0,[t].concat(i))}))};var r,i,o=t.produce(e,n,(function(e,t){r=e,i=t}));return"undefined"!=typeof Promise&&o instanceof Promise?o.then((function(e){return[e,r,i]})):[o,r,i]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){U(e)||_(8),L(e)&&(e=ge(e));var t=ae(this),n=me(this,e,void 0);return n[Se].C=!0,oe(t),n},t.finishDraft=function(e,t){var n=(e&&e[Se]).A;return re(n,t),ce(void 0,n)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!Ze&&_(20),this.g=e},t.applyPatches=function(e,t){var n;for(n=t.length-1;n>=0;n--){var r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));var i=te("Patches").$;return L(e)?i(e,t):this.produce(e,(function(e){return i(e,t)}))},e}(),Te=new Me,Re=Te.produce,De=(Te.produceWithPatches.bind(Te),Te.setAutoFreeze.bind(Te),Te.setUseProxies.bind(Te),Te.applyPatches.bind(Te),Te.createDraft.bind(Te),Te.finishDraft.bind(Te),Re);function He(e,t){return(0,p.useReducer)((function(t,n){return De(t,(function(t){e[n.action](t,n.payload)}))}),t)}function _e(e){var t=(0,p.useState)(e),n=(0,d.Z)(t,2),r=n[0],i=n[1];return(0,p.useEffect)((function(){i(e)}),[e]),[r,i]}var Le=0,Ue=1,ze=function(e){var t,n=(0,p.useState)(null!==(t=e.mode)&&void 0!==t?t:Le),r=(0,d.Z)(n,2),i=r[0],o=r[1],a=_e(e.value),s=(0,d.Z)(a,2),c=s[0],u=s[1],l=function(){return(0,v.jsx)("span",{style:(0,F.Z)({cursor:"text"},H("full","inline")),onClick:function(){o(Ue)},children:c})},f=(0,p.useCallback)((function(e){return null===e||void 0===e?void 0:e.select()}),[]),h=(0,p.useCallback)((function(t){var n,r;o(Le),u(null!==(n=t.value)&&void 0!==n?n:""),e.onChange(null!==(r=t.value)&&void 0!==r?r:"")}),[e,o,u]),m=function(){var e=(0,v.jsx)("span",{style:{display:"block",position:"relative"},children:(0,v.jsx)("input",{ref:f,style:{zIndex:"10",position:"absolute",left:"0",marginTop:"-0.375rem"},onBlur:function(e){var t=e.target;return h(t)},onKeyPress:function(e){var t=e.key,n=e.target;"Enter"===t&&h(n)},type:"text",defaultValue:c})});return e};return function(){switch(i){case Ue:return m();case Le:return l();default:return(0,v.jsx)("span",{})}}()};function Be(e,t,n){var r=t.totalHeight,i=t.toleranceHeight,o=t.bufferedItems,a=t.settings,s=a.itemHeight,c=a.minIndex,u=a.maxIndex,l=c+Math.floor((e-i)/s),d=function(e,t,n,r,i){var o=Math.max(0,e,n),a=i(o,Math.min(t,n+r-1)-o);return(0,h.Z)(a)}(c,u,l,o,n),f=Math.max((l-c)*s,0);return{scrollTop:e,topPaddingHeight:f,bottomPaddingHeight:Math.max(r-(f+d.length*s),0),data:d}}var Ke=function(e){var t,n=(0,p.useRef)(null),r=(0,p.useMemo)((function(){var t,n=function(e){var t=e.minIndex,n=void 0===t?0:t,r=e.maxIndex,i=void 0===r?Number.MAX_SAFE_INTEGER:r,o=e.startIndex,a=void 0===o?0:o,s=e.itemHeight,c=void 0===s?20:s,u=e.count,l=void 0===u?Math.max(i-n,1):u,d=e.tolerance;return{minIndex:n,maxIndex:i,startIndex:a,itemHeight:c,count:l,tolerance:void 0===d?l:d}}(null!==(t=e.settings)&&void 0!==t?t:{}),r=function(e,t){var n=e.minIndex,r=e.maxIndex,i=e.startIndex,o=e.itemHeight,a=e.count,s=e.tolerance,c=a+2*s,u=Math.max(0,i-s-n),l=a*o,d=Math.min(r-n,1)*o,f=s*o,p=u*o,h={scrollTop:0,settings:e,viewportHeight:l,totalHeight:d,toleranceHeight:f,bufferedItems:c,topPaddingHeight:p,bottomPaddingHeight:d-(p+(l+2*f)),data:[]};return(0,F.Z)((0,F.Z)({},h),Be(p+f,h,t))}(n,e.get),i=function(e){return function(t,n){return(0,F.Z)((0,F.Z)({},t),Be(n,t,e))}}(e.get);return{settings:n,reducer:i,startState:r}}),[e.settings,e.get]),i=r.settings,o=r.startState,a=r.reducer,s=(0,p.useReducer)(a,o),c=(0,d.Z)(s,2),u=c[0],l=c[1];(0,p.useEffect)((function(){null!==n.current&&l(n.current.scrollTop)}),[i,e.row]);var f=(0,p.useCallback)((function(e){e&&(e.scrollTop=n.current?n.current.scrollTop:i.startIndex*i.itemHeight),n.current=e}),[n,i.startIndex,i.itemHeight]),h=u.data.map((function(t){return(0,v.jsx)("div",{style:{height:"".concat(i.itemHeight,"px")},children:e.row(t)},e.rowKey(t))}));return(0,v.jsxs)("div",{ref:f,style:{height:"".concat(u.viewportHeight,"px"),overflowY:"scroll",overflowAnchor:"none"},className:null!==(t=e.className)&&void 0!==t?t:"",onScroll:function(e){return l(e.target.scrollTop)},children:[(0,v.jsx)("div",{style:{height:"".concat(u.topPaddingHeight,"px")}}),h,(0,v.jsx)("div",{style:{height:"".concat(u.bottomPaddingHeight,"px")}})]})},Ve=function(e){var t=e.memory,n=e.jmp,r=void 0===n?{value:0}:n,i=e.highlight,o=void 0===i?-1:i,a=e.editable,s=void 0!==a&&a,c=e.format,u=void 0===c?C.E_:c,l=e.onChange,f=void 0===l?function(){}:l,h=(0,p.useMemo)((function(){return{count:Math.min(t.size,20),maxIndex:t.size,itemHeight:34,startIndex:r.value}}),[t.size,r]),m=(0,p.useCallback)((function(e,n){return t.range(e,e+n).map((function(t,n){return[n+e,t]}))}),[t]),g=(0,p.useCallback)((function(e){var t=(0,d.Z)(e,2),n=t[0],r=t[1];return(0,v.jsx)(We,{index:n,value:u(r),editable:s,highlight:n===o,onChange:f})}),[u,s,o,f]);return(0,v.jsx)(Ke,{settings:h,get:m,row:g,rowKey:function(e){return(0,d.Z)(e,1)[0]}})},We=function(e){var t=e.index,n=e.value,r=e.highlight,i=void 0!==r&&r,o=e.editable,a=void 0!==o&&o,s=e.onChange,c=void 0===s?function(){}:s;return(0,v.jsxs)("div",{style:{display:"flex",height:"100%"},children:[(0,v.jsx)("code",{style:(0,F.Z)((0,F.Z)({},T("none")),i?{background:"var(--code-kbd-background-color)"}:{}),children:(0,C.$v)(t)}),(0,v.jsx)("code",{style:(0,F.Z)((0,F.Z)({flex:"1",textAlign:"right"},T("none")),i?{background:"var(--code-kbd-background-color)"}:{}),children:a?(0,v.jsx)(ze,{value:n,onChange:function(e){return c(t,e,Number(n))}}):(0,v.jsx)("span",{children:n})})]})},Je=function(e){var t=e.name,n=void 0===t?"Memory":t,r=e.highlight,i=void 0===r?-1:r,o=e.editable,a=void 0===o||o,s=e.memory,c=e.format,u=void 0===c?"dec":c,l=(0,p.useState)(u),f=(0,d.Z)(l,2),h=f[0],m=f[1],g=(0,p.useState)("0"),x=(0,d.Z)(g,2),b=x[0],j=x[1],y=(0,p.useState)({value:0}),k=(0,d.Z)(y,2),Z=k[0],w=k[1],P=function(){w({value:Number(b)})},S=(0,p.useCallback)((function(e,t){s.update(e,t,null!==h&&void 0!==h?h:"dec")}),[s,h]);return(0,v.jsxs)("article",{className:"panel",children:[(0,v.jsxs)("header",{children:[(0,v.jsx)("div",{children:n}),(0,v.jsxs)("fieldset",{role:"group",children:[(0,v.jsx)("button",{onClick:function(){},className:"flex-0",children:"\ud83d\udcc2"}),(0,v.jsx)("input",{style:{width:"4em",height:"100%"},placeholder:"Goto",onKeyDown:function(e){return"Enter"===e.key&&P()},onChange:function(e){var t=e.target.value;return j(null!==t&&void 0!==t?t:"0")}}),(0,v.jsx)("button",{onClick:P,className:"flex-0",children:"\u2935\ufe0f"}),R.I2.map((function(e){return(0,v.jsxs)("label",{className:"flex-0",role:"button","aria-current":e===h,children:[(0,v.jsx)("input",{type:"radio",name:n,value:e,checked:e===h,onChange:function(){return m(e)}}),e]},e)}))]})]}),(0,v.jsx)(Ve,{jmp:Z,memory:s,highlight:i,editable:a,format:function(e){return function(e,t){switch(e){case"bin":return(0,C.Ly)(t);case"hex":return(0,C.$v)(t);case"asm":return(0,D.a)(t);default:return(0,C.E_)(t)}}(h,e)},onChange:S})]})};var Ge=n(5541),$e=n(4408),qe=n(6531);function Xe(){return(0,$e.j)(qe.S.get())}var Ye=function(){var e=function(){var e=(0,p.useState)(Xe()),t=(0,d.Z)(e,2),n=t[0],r=t[1];return(0,p.useEffect)((function(){var e=qe.S.get().$.subscribe((function(){r(Xe())}));return function(){return e.unsubscribe()}}),[]),n}();return(0,v.jsx)("span",{style:{whiteSpace:"nowrap"},children:e})},Qe="white";function et(e,t,n){return 0===(e.get(32*n+(t/16|0))&1<<t%16)?Qe:"black"}function tt(e,t,n,r){var i=4*(512*n+t),o=r===Qe?255:0;e[i]=o,e[i+1]=o,e[i+2]=o,e[i+3]=255}var nt=function(e){var t,n=e.memory,r=(0,p.useRef)(),i=(0,p.useCallback)((function(){var e,t,i=null!==(e=null===(t=r.current)||void 0===t?void 0:t.getContext("2d"))&&void 0!==e?e:void 0;i&&function(e,t){for(var n=(0,Ge.kP)(e.getImageData(0,0,512,256),"Failed to create Context2d"),r=0;r<512;r++)for(var i=0;i<256;i++){var o=et(t,r,i);tt(n.data,r,i,o)}e.putImageData(n,0,0)}(i,n)}),[n]),o=(0,p.useCallback)((function(e){r.current=null!==e&&void 0!==e?e:void 0,i()}),[r,i]);return t=i,(0,p.useEffect)((function(){var e=qe.S.get().frame$.subscribe((function(){t()}));return function(){return e.unsubscribe()}}),[t]),(0,v.jsxs)("article",{className:"panel",children:[(0,v.jsx)("header",{children:"Screen"}),(0,v.jsx)("main",{children:(0,v.jsx)("figure",{style:{width:"100%",maxWidth:"512px",boxSizing:"content-box",marginInline:"auto",margin:"0",borderTop:"2px solid gray",borderLeft:"2px solid gray",borderBottom:"2px solid lightgray",borderRight:"2px solid lightgray"},children:(0,v.jsx)("canvas",{ref:o,width:512,height:256})})})]})};function rt(e){if(e instanceof g.JU)return(0,v.jsx)(Z,{A:e.in("x").busVoltage,op:e.op(),D:e.in("y").busVoltage,out:e.out().busVoltage,flag:e.out("zr").voltage()===j.lj?y.vU.Zero:e.out("ng").voltage()===j.lj?y.vU.Negative:y.vU.Positive});var t;if(e instanceof x.l0)return(0,v.jsx)(w,{name:null!==(t=e.name)&&void 0!==t?t:"Chip ".concat(e.id),bits:e.bits});if(e instanceof x.PC)return(0,v.jsx)(w,{name:"PC",bits:e.bits});if(e instanceof m.N1)return(0,v.jsx)(S,{keyboard:e});if(e instanceof m.lL)return(0,v.jsx)(nt,{memory:e.memory});if(e instanceof b.FH)return(0,v.jsx)(Je,{name:e.name,memory:e.memory,format:"dec",highlight:e.address});if(e instanceof b.HX)return(0,v.jsxs)("span",{children:["RAM ",e.width]});if(e instanceof k.Z9){var n=(0,k.Jx)(e.in("instruction").busVoltage);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(w,{name:"A",bits:e.state.A}),(0,v.jsx)(w,{name:"D",bits:e.state.D}),(0,v.jsx)(w,{name:"PC",bits:e.state.PC}),(0,v.jsx)(Z,{A:n.am?e.in("inM").busVoltage:e.state.A,D:e.state.D,out:e.state.ALU,op:n.op,flag:e.state.flag})]})}var r=(0,h.Z)(e.parts).map(rt).filter((function(e){return void 0!==e}));return r.length>0?(0,v.jsx)(v.Fragment,{children:r}):void 0}var it=n(8582),ot=n(1585);function at(e){return{pin:e,bits:(0,ot.w)(0,e.width).map((function(t){return[t,e.voltage(t)]})).reverse()}}function st(e){return(0,h.Z)(e.entries()).map(at)}var ct=function(e){var t=e.sim,n=t.inPins,r=t.outPins,i=t.internalPins;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("style",{children:"\n        table.pinout th {\n          font-weight: bold;\n        }\n\n        table.pinout tbody td:first-child {\n          text-align: right;\n          --font-size: 1rem;\n          width: 0;\n          white-space: nowrap;\n          border-right: var(--border-width) solid var(--table-border-color);\n        }\n\n        table.pinout tbody button {\n          --font-size: 0.875em;\n          font-family: var(--font-family-monospace);\n          max-width: 2em;\n        }\n        "}),(0,v.jsx)("table",{className:"pinout",children:(0,v.jsxs)("tbody",{children:[(0,v.jsx)(ut,{pins:n,header:"Input pins",toggle:e.toggle}),(0,v.jsx)(ut,{pins:r,header:"Output pins",disabled:e.sim.pending}),(0,v.jsx)(ut,{pins:i,header:"Internal pins",disabled:e.sim.pending})]})})]})},ut=function(e){return(0,v.jsxs)(v.Fragment,{children:[e.pins.length>0&&(0,v.jsx)("tr",{children:(0,v.jsx)("th",{colSpan:2,children:e.header})}),(0,h.Z)(e.pins).map((function(t){return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:t.pin.name}),(0,v.jsx)("td",{children:(0,v.jsx)(lt,{pin:t,toggle:e.toggle,disabled:e.disabled})})]},t.pin.name)}))]})},lt=function(e){var t=e.pin,n=e.toggle,r=e.disabled,i=void 0!==r&&r;return(0,v.jsx)("fieldset",{role:"group",style:{width:"".concat(t.bits.length,"rem")},children:t.bits.map((function(e){var r=(0,d.Z)(e,2),o=r[0],a=r[1];return(0,v.jsx)("button",{onClick:function(){return null===n||void 0===n?void 0:n(t.pin,o)},disabled:i,"data-testid":"pin-".concat(o),children:a},o)}))})};var dt=function(e){var t=function(e){var t=(0,p.useRef)((function(){})),n=(0,p.useMemo)((function(){return function(e,t){var n={running:e.running,speed:e.speed,steps:e.steps},r=e.finishFrame.bind(e);return e.finishFrame=function(){r(),t.current({action:"update"})},{initialState:n,reducers:{update:function(t){t.running=e.running,t.speed=e.speed,t.steps=e.steps},setSteps:function(t,n){t.steps=n,e.steps=n},setSpeed:function(t,n){t.speed=n,e.speed=n}},actions:{frame:function(){e.frame()},start:function(){e.start(),t.current({action:"update"})},stop:function(){e.stop(),t.current({action:"update"})},reset:function(){e.reset(),t.current({action:"update"})}}}}(e,t)}),[e,t]),r=n.initialState,i=n.reducers,o=n.actions,a=He(i,r),s=(0,d.Z)(a,2),c=s[0],u=s[1];return t.current=u,{state:c,dispatch:t.current,actions:o}}(e.runner);return(0,v.jsxs)("fieldset",{role:"group",children:[(0,v.jsx)("button",{className:"flex-0",onClick:function(){return t.actions.frame()},"data-tooltip":"Step","data-placement":"bottom",children:"\u27a1\ufe0f"}),(0,v.jsx)("button",{className:"flex-0",onClick:function(){return t.state.running?t.actions.stop():t.actions.start()},"data-tooltip":t.state.running?"Pause":"Play","data-placement":"bottom",children:t.state.running?"\u23f8":"\ufe0f\u23e9"}),(0,v.jsx)("button",{className:"flex-0",onClick:function(){return t.actions.reset()},"data-tooltip":"Reset","data-placement":"bottom",children:"\u23ee"}),(0,v.jsx)("select",{className:"flex-1",name:"speed",value:t.state.speed,onChange:function(e){var n,r;t.dispatch({action:"setSpeed",payload:Number(null!==(n=null===(r=e.target)||void 0===r?void 0:r.value)&&void 0!==n?n:t.state.speed)})},disabled:t.state.running,children:[[1e3,"Slow"],[500,"Fast"],[16,"Faster"]].map((function(e){var t=(0,d.Z)(e,2),n=t[0],r=t[1];return(0,v.jsx)("option",{value:n,children:r},n)}))}),(0,v.jsx)("select",{className:"flex-1",name:"steps",value:t.state.steps,onChange:function(e){var n,r;t.dispatch({action:"setSteps",payload:Number(null!==(n=null===(r=e.target)||void 0===r?void 0:r.value)&&void 0!==n?n:t.state.steps)})},disabled:t.state.running,children:[[1,"1 Step"],[500,"500"],[1e3,"1000"],[2e3,"2000"]].map((function(e){var t=(0,d.Z)(e,2),n=t[0],r=t[1];return(0,v.jsx)("option",{value:n,children:r},n)}))}),e.children]})},ft=n(8365),pt=n(8090),ht=n(9647),vt=n(7538),mt=n(4649),gt=n(2648),xt=n(3943),bt=qe.S.get(),jt=new WeakMap,yt=new WeakMap,kt=new WeakMap,Ct=new WeakMap,Zt=function(){function e(){var t=this;(0,r.Z)(this,e),(0,mt.Z)(this,"steps",1),(0,mt.Z)(this,"speed",1e3),(0,vt.Z)(this,jt,{writable:!0,value:!1}),(0,vt.Z)(this,yt,{writable:!0,value:0}),(0,vt.Z)(this,kt,{writable:!0,value:0}),(0,vt.Z)(this,Ct,{writable:!0,value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){var n,r,i,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,xt.Z)(t,jt)){e.next=2;break}return e.abrupt("return");case 2:if(n=Date.now(),r=n-(0,xt.Z)(t,kt),(0,gt.Z)(t,kt,n),(0,gt.Z)(t,yt,(0,xt.Z)(t,yt)+r),!((0,xt.Z)(t,yt)>t.speed)){e.next=19;break}i=!1,o=0;case 9:if(!(o<Math.min(t.steps,1e3))||i){e.next=16;break}return e.next=12,t.tick();case 12:i=e.sent;case 13:o++,e.next=9;break;case 16:t.finishFrame(),i&&t.stop(),(0,gt.Z)(t,yt,(0,xt.Z)(t,yt)-t.speed);case 19:requestAnimationFrame((0,xt.Z)(t,Ct));case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()})}return(0,i.Z)(e,[{key:"frame",value:function(){this.tick(),this.finishFrame()}},{key:"finishFrame",value:function(){bt.frame()}},{key:"running",get:function(){return(0,xt.Z)(this,jt)}},{key:"start",value:function(){(0,gt.Z)(this,jt,!0),(0,gt.Z)(this,kt,Date.now()-this.speed),(0,xt.Z)(this,Ct).call(this),this.toggle()}},{key:"stop",value:function(){(0,gt.Z)(this,jt,!1),this.toggle()}}]),e}(),wt=n(8016),Pt=n(659),St=n(9422);var Ft=n(7536),Nt=n(1510),Ot=function(e){var t,n,r=e.error;return null!==r&&void 0!==r&&r.failed()?(0,v.jsxs)("details",{className:"ErrorPanel",open:!0,children:[(0,v.jsx)("summary",{role:"button",className:"secondary",children:(0,v.jsx)(f.cC,{id:"Parse Error"})}),(0,v.jsx)("pre",{children:(0,v.jsx)("code",{children:null!==(t=null!==(n=null===r||void 0===r?void 0:r.message)&&void 0!==n?n:null===r||void 0===r?void 0:r.shortMessage)&&void 0!==t?t:Nt.eP})})]}):(0,v.jsx)(v.Fragment,{})},At=function(e){var t=e.value,n=e.onChange,r=e.language,i=e.disabled,o=void 0!==i&&i,a=(0,p.useState)(t),s=(0,d.Z)(a,2),c=s[0],u=s[1];return(0,v.jsx)("textarea",{"data-testid":"editor-".concat(r),disabled:o,value:c,onChange:function(e){var t,r=null===(t=e.target)||void 0===t?void 0:t.value;u(r),n(r)}})},Et=function(e){var t=e.value,n=e.onChange,r=e.language,i=e.error,o=e.disabled,a=void 0!==o&&o,s=e.highlight,c=(0,p.useContext)(wt.Il).theme,u=(0,Ft.Ik)(),l=(0,p.useRef)(),d=(0,p.useRef)([]),f=(0,p.useRef)(void 0),h=(0,p.useCallback)((function(){return("system"===c?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"===c)?"vs-dark":"vs"}),[c]),m=(0,p.useCallback)((function(){var e;d.current=function(e,t,n,r){if(!t||!n)return r;var i=t.getModel();if(!i)return r;var o=i.getPositionAt(n.start),a=i.getPositionAt(n.end),s=null===e||void 0===e?void 0:e.Range.fromPositions(o,a),c=[];return s&&(c.push({range:s,options:{inlineClassName:"highlight"}}),t.revealRangeInCenter(s)),t.deltaDecorations(r,c)}(u,l.current,null!==(e=f.current)&&void 0!==e?e:{start:0,end:0},d.current)}),[d,u,l,f]);(0,p.useEffect)((function(){f.current=s,m()}),[s]);var g=(0,p.useCallback)((function(e){var t;l.current=e,null===(t=l.current)||void 0===t||t.updateOptions({fontFamily:'"JetBrains Mono", source-code-pro, Menlo, Monaco,\n      Consolas, "Roboto Mono", "Ubuntu Monospace", "Noto Mono", "Oxygen Mono",\n      "Liberation Mono", monospace, "Apple Color Emoji", "Segoe UI Emoji",\n      "Segoe UI Symbol", "Noto Color Emoji"',fontSize:16,minimap:{enabled:!1},theme:h(),scrollBeyondLastLine:!1}),m()}),[h]);return(0,p.useEffect)((function(){void 0!==l.current&&l.current.updateOptions({theme:h()})}),[l,h]),(0,p.useEffect)((function(){void 0!==l.current&&l.current.updateOptions({readOnly:a})}),[l,a]),(0,p.useEffect)((function(){var e,t,n,o,a;if(void 0!==l.current&&null!==u){var s=l.current.getModel();if(null!==s)if(void 0===i||i.succeeded())u.editor.setModelMarkers(s,r,[]);else{var c=null!==(e=null===(t=(0,St.Z)(/Line (\d+), col (\d+): (.*)/,{line:1,column:2,message:3}).exec(null!==(n=i.shortMessage)&&void 0!==n?n:""))||void 0===t?void 0:t.groups)&&void 0!==e?e:{line:1,column:1,message:"could not parse error"},d=c.line,f=c.column,p=c.message,h=Number(d),v=h,m=Number(f),g=m+(null!==(o=null===(a=s.getLineContent(h).substring(m-1).match(/([^\s]+)/))||void 0===a?void 0:a[0].length)&&void 0!==o?o:1);g<=m&&(g=m+1),u.editor.setModelMarkers(s,r,[{message:p,startColumn:m,startLineNumber:h,endColumn:g,endLineNumber:v,severity:8}])}}}),[i,l,u,r]),(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(Ft.ZP,{value:t,onChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return n(e)},language:r,onMount:g})})},It=function(e){var t=e.className,n=void 0===t?"":t,r=e.style,i=void 0===r?{}:r,o=e.disabled,a=void 0!==o&&o,s=e.value,c=e.onChange,u=e.grammar,l=e.language,f=e.highlight,h=(0,p.useState)(),m=(0,d.Z)(h,2),g=m[0],x=m[1],b=(0,p.useContext)(wt.Il).monaco,j=(0,p.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=u.match(e);x(t.failed()?t:void 0)}),[x,u]);(0,p.useEffect)((function(){return j(s)}),[j,s]);var y=(0,p.useMemo)((function(){return function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;return function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return clearTimeout(t),t=setTimeout((function(){return clearTimeout(t),e.apply(void 0,i)}),n)}}(j,500)}),[j]),k=(0,p.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";c(e),y(e)}),[y,c]);return(0,v.jsx)("div",{className:"Editor ".concat(n),style:i,children:b.canUse&&b.wants?(0,v.jsx)(Et,{value:s,onChange:k,language:l,error:g,disabled:a,highlight:f}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(At,{value:s,onChange:k,language:l,disabled:a}),(0,v.jsx)(Ot,{error:g})]})})},Mt=function(e){var t;return(0,v.jsxs)("article",{className:["panel",null!==(t=e.className)&&void 0!==t?t:""].join(" "),children:[e.header&&(0,v.jsx)("header",{children:e.header}),(0,v.jsx)("main",{children:e.children}),e.footer&&(0,v.jsx)("footer",{children:e.footer})]})},Tt=function(e){var t;return(0,v.jsxs)("details",{className:null!==(t=e.className)&&void 0!==t?t:"",open:e.open,style:e.style,children:[(0,v.jsx)("summary",{children:(0,v.jsx)("div",{className:"flex row align-baseline",children:e.summary})}),e.children]})},Rt=n(726),Dt=n(4625),Ht=n(691),_t=n(1277),Lt=n(3389),Ut=n(8698),zt=[["01","Project 1"],["02","Project 2"],["03","Project 3"],["05","Project 5"]];function Bt(e){return"CHIP ".concat(e," {\n  IN in;\n  OUT out;\n  PARTS:\n}")}function Kt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{clocked:e.clocked,inPins:st(e.ins),outPins:st(e.outs),internalPins:st(e.pins),chip:[e],pending:t,invalid:n}}var Vt=qe.S.get();function Wt(e,t,n,r){var i=function(e){var t,n,r=null!==(t=e["/chip/project"])&&void 0!==t?t:"01",i=_t.CHIP_PROJECTS[r];return{project:r,chips:i,chipName:null!==(n=e["/chip/chip"])&&void 0!==n?n:i[0]}}(n),o=i.project,a=i.chipName,s=i.chips,c=new j.P9,f=new Lt.l1,p=!1,v={setFiles:function(e,t){var n=t.hdl,r=void 0===n?e.files.hdl:n,i=t.tst,o=void 0===i?e.files.tst:i,a=t.cmp,s=void 0===a?e.files.cmp:a,c=t.out,u=void 0===c?"":c;e.files.hdl=r,e.files.tst=o,e.files.cmp=s,e.files.out=u},updateChip:function(e,t){var n,r,i,o,s,u;e.sim=Kt(c,null!==(n=null===t||void 0===t?void 0:t.pending)&&void 0!==n?n:e.sim.pending,null!==(r=null===t||void 0===t?void 0:t.invalid)&&void 0!==r?r:e.sim.invalid),e.controls.error=e.sim.invalid?null!==(i=null===t||void 0===t?void 0:t.error)&&void 0!==i?i:e.controls.error:"",e.controls.chips=_t.CHIP_PROJECTS[e.controls.project],e.controls.chipName=e.sim.invalid?null!==(o=null===t||void 0===t?void 0:t.chipName)&&void 0!==o?o:a:null!==(s=null!==(u=c.name)&&void 0!==u?u:null===t||void 0===t?void 0:t.chipName)&&void 0!==s?s:a,e.controls.chips.includes(e.controls.chipName)||(e.controls.chips=[].concat((0,h.Z)(e.controls.chips),[e.controls.chipName]))},setProject:function(e,t){var n=_t.CHIP_PROJECTS[t],r=e.controls.chipName&&n.includes(e.controls.chipName)?e.controls.chipName:n[0];e.controls.project=t,e.controls.chips=n,this.setChip(e,r)},setChip:function(e,t){e.controls.chipName=t,e.controls.hasBuiltin=g.zZ.has(t)},testRunning:function(e){e.controls.runningTest=!0},testFinished:function(e){e.controls.runningTest=!1;var n=e.files.out.trim()===e.files.cmp.trim();t(n?"Simulation successful: The output file is identical to the compare file":"Simulation error: The output file differs from the compare file")},updateTestStep:function(e){var t,n,r,i;if(e.files.out=null!==(t=null===(n=f)||void 0===n?void 0:n.log())&&void 0!==t?t:"",null!==(r=f)&&void 0!==r&&null!==(i=r.currentStep)&&void 0!==i&&i.span)e.controls.span=f.currentStep.span;else if(f.done){var o=e.files.tst.length;e.controls.span={start:o-1,end:o}}this.updateChip(e,{pending:e.sim.pending,invalid:e.sim.invalid})}},m={setProject:function(e){o=n["/chip/project"]=e,r.current({action:"setProject",payload:o}),this.setChip(_t.CHIP_PROJECTS[o][0])},setChip:function(e){var t=arguments,i=this;return(0,l.Z)((0,u.Z)().mark((function o(){var s,c;return(0,u.Z)().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return c=t.length>1&&void 0!==t[1]?t[1]:null!==(s=n["/chip/project"])&&void 0!==s?s:"01",a=n["/chip/chip"]=e,r.current({action:"setChip",payload:a}),o.next=5,i.loadChip(c,a);case 5:p&&i.useBuiltin();case 6:case"end":return o.stop()}}),o)})))()},reset:function(){qe.S.get().reset(),c.reset(),f.reset(),r.current({action:"setFiles",payload:{}}),r.current({action:"updateChip"})},updateFiles:function(e){var n=this;return(0,l.Z)((0,u.Z)().mark((function i(){var o,a,s;return(0,u.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(o=e.hdl,a=e.tst,s=e.cmp,r.current({action:"setFiles",payload:{hdl:o,tst:a,cmp:s}}),i.prev=2,!o){i.next=6;break}return i.next=6,n.compileChip(o);case 6:a&&n.compileTest(a),i.next=12;break;case 9:i.prev=9,i.t0=i.catch(2),t((0,$e.j)(i.t0));case 12:case"end":return i.stop()}}),i,null,[[2,9]])})))()},compileChip:function(e){var n=this;return(0,l.Z)((0,u.Z)().mark((function i(){var o,a,s;return(0,u.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(c.remove(),o=pt.Gq.parse(e),!(0,Dt.dZ)(o)){i.next=6;break}return t("Failed to parse chip"),r.current({action:"updateChip",payload:{invalid:!0,error:(0,$e.j)((0,Dt.UG)(o))}}),i.abrupt("return");case 6:return i.next=8,(0,Ht.J_)((0,Dt.Ok)(o));case 8:if(a=i.sent,!(0,Dt.dZ)(a)){i.next=14;break}return s=(0,$e.j)((0,Dt.UG)(a)),t(s),r.current({action:"updateChip",payload:{invalid:!0,error:s}}),i.abrupt("return");case 14:t("Compiled ".concat(c.name)),n.replaceChip((0,Dt.Ok)(a));case 16:case"end":return i.stop()}}),i)})))()},replaceChip:function(e){var t,n=c.ins,i=(0,Rt.Z)(n);try{for(i.s();!(t=i.n()).done;){var o=(0,d.Z)(t.value,2),a=o[0],s=o[1].busVoltage,u=e.ins.get(a);u&&(u.busVoltage=s)}}catch(l){i.e(l)}finally{i.f()}Vt.reset(),e.eval(),(c=e).reset(),f=f.with(c).reset(),r.current({action:"updateChip",payload:{invalid:!1}}),r.current({action:"updateTestStep"})},loadChip:function(t,i){var o=this;return(0,l.Z)((0,u.Z)().mark((function a(){var s,c,l,f,p,h;return(0,u.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n["/chip/chip"]=i,s=function(e){return"/projects/".concat(t,"/").concat(i,"/").concat(i,".").concat(e)},a.next=4,Promise.all([e.readFile(s("hdl")).catch((function(){return Bt(i)})),e.readFile(s("tst")).catch((function(e){return console.log(e),"repeat 10 {\n  tick,\n  tock;\n}"})),e.readFile(s("cmp")).catch((function(){return"| in|out|"}))]);case 4:return c=a.sent,l=(0,d.Z)(c,3),f=l[0],p=l[1],h=l[2],r.current({action:"setFiles",payload:{hdl:f,tst:p,cmp:h}}),a.next=12,o.compileChip(f);case 12:o.compileTest(p);case 13:case"end":return a.stop()}}),a)})))()},saveChip:function(n){var i=arguments;return(0,l.Z)((0,u.Z)().mark((function s(){var c,l,d;return(0,u.Z)().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return c=i.length>1&&void 0!==i[1]?i[1]:o,l=i.length>2&&void 0!==i[2]?i[2]:a,r.current({action:"setFiles",payload:{hdl:n}}),d="/projects/".concat(c,"/").concat(l,"/").concat(l,".hdl"),s.next=6,e.writeFile(d,n);case 6:t("Saved ".concat(d));case 7:case"end":return s.stop()}}),s)})))()},toggle:function(e,t){void 0!==t?e.busVoltage=e.busVoltage^1<<t:1===e.width?e.toggle():e.busVoltage+=1,r.current({action:"updateChip",payload:{pending:!0}})},eval:function(){c.eval(),r.current({action:"updateChip",payload:{pending:!1}})},clock:function(){Vt.toggle(),Vt.isLow&&Vt.frame(),r.current({action:"updateChip"})},useBuiltin:function(){var e=arguments,n=this;return(0,l.Z)((0,u.Z)().mark((function i(){var s,l,d,f,h,v,m;return(0,u.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(l=!(e.length>0&&void 0!==e[0])||e[0],d=e.length>1?e[1]:void 0,l){i.next=7;break}return p=!1,i.next=6,n.loadChip(o,a);case 6:return i.abrupt("return");case 7:if(p=!0,f=null!==(s=c.name)&&void 0!==s?s:a,h=(0,g.cT)(f),!(0,Dt.dZ)(h)){i.next=13;break}return t("Failed to load builtin ".concat(f,": ").concat((0,$e.j)((0,Dt.UG)(h)))),i.abrupt("return");case 13:if(!d){i.next=16;break}return i.next=16,n.saveChip(d,o,a);case 16:v=_t.ChipProjects[o].CHIPS[f]["".concat(f,".hdl")],m=v.replace("PARTS:","PARTS:\n    BUILTIN ".concat(f)),r.current({action:"setFiles",payload:{hdl:m}}),n.replaceChip((0,Dt.Ok)(h));case 20:case"end":return i.stop()}}),i)})))()},initialize:function(){var e=this;return(0,l.Z)((0,u.Z)().mark((function t(){return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.loadChip(o,a);case 2:case"end":return t.stop()}}),t)})))()},compileTest:function(n){r.current({action:"setFiles",payload:{tst:n}});var i=ht.qH.parse(n);return(0,Dt.dZ)(i)?(t("Failed to parse test"),!1):(t("Parsed tst"),(f=Lt.l1.from((0,Dt.Ok)(i)).with(c).reset()).setFileSystem(e),r.current({action:"updateTestStep"}),!0)},runTest:function(t){var n=this;return(0,l.Z)((0,u.Z)().mark((function i(){return(0,u.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n.compileTest(t)){i.next=2;break}return i.abrupt("return");case 2:return r.current({action:"testRunning"}),e.pushd("/samples"),i.next=6,f.run();case 6:e.popd(),r.current({action:"updateTestStep"}),r.current({action:"testFinished"});case 9:case"end":return i.stop()}}),i)})))()},tick:function(){return this.stepTest()},stepTest:function(){return(0,l.Z)((0,u.Z)().mark((function e(){var t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,Ge.hu)(f.chipId===c.id,"Test and chip out of sync"),e.next=3,f.step();case 3:return t=e.sent,r.current({action:"updateTestStep"}),t&&r.current({action:"testFinished"}),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})))()}};return{initialState:function(){var e={project:o,chips:s,chipName:a,hasBuiltin:g.zZ.has(a),runningTest:!1,error:""},n=(0,g.cT)(e.chipName);return(0,Dt.dZ)(n)?(t((0,$e.j)((0,Dt.UG)(n))),c=new j.P9):c=(0,Dt.Ok)(n),{controls:e,files:{hdl:"",cmp:"",tst:"",out:""},sim:Kt(c)}}(),reducers:v,actions:m}}var Jt=function(){var e=(0,p.useContext)(Ut.r),t=e.fs,n=e.setStatus,m=(0,p.useContext)(wt.Il),g=m.filePicker,x=m.tracking,b=function(){var e=(0,p.useContext)(Ut.r),t=e.fs,n=e.setStatus,r=e.storage,i=(0,p.useRef)((function(){})),o=(0,p.useMemo)((function(){return Wt(t,n,r,i)}),[t,n,r,i]),a=o.initialState,s=o.reducers,c=o.actions,u=He(s,a),l=(0,d.Z)(u,2),f=l[0],h=l[1];return i.current=h,{state:f,dispatch:i,actions:c}}(),j=b.state,y=b.actions,k=b.dispatch,C=_e(j.files.hdl),Z=(0,d.Z)(C,2),w=Z[0],P=Z[1],S=_e(j.files.tst),F=(0,d.Z)(S,2),N=F[0],O=F[1],A=_e(j.files.cmp),E=(0,d.Z)(A,2),I=E[0],M=E[1],T=_e(j.files.out),R=(0,d.Z)(T,1)[0];(0,p.useEffect)((function(){y.initialize()}),[y]),(0,p.useEffect)((function(){x.trackPage("/chip")}),[x]);(0,p.useEffect)((function(){x.trackEvent("action","setProject",j.controls.project),x.trackEvent("action","setChip",j.controls.chipName)}),[]);var D=(0,p.useCallback)((function(e){y.setProject(e),x.trackEvent("action","setProject",e)}),[y,x]),H=(0,p.useCallback)((function(e){y.setChip(e),x.trackEvent("action","setChip",e)}),[y,x]),_=(0,p.useCallback)((function(){y.eval(),x.trackEvent("action","eval")}),[y,x]),L=(0,p.useRef)((function(){}));L.current=(0,l.Z)((0,u.Z)().mark((function e(){var t,n,r,i=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>0&&void 0!==i[0]?i[0]:{},e.next=3,y.updateFiles({hdl:r.hdl,tst:null!==(t=r.tst)&&void 0!==t?t:N,cmp:null!==(n=r.cmp)&&void 0!==n?n:I});case 3:case"end":return e.stop()}}),e)})));var U=(0,p.useCallback)((0,l.Z)((0,u.Z)().mark((function e(){var r,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.select();case 3:return r=e.sent,e.next=6,t.readFile(r);case 6:return i=e.sent,e.next=9,L.current({tst:i});case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0),n("Failed to load into memory");case 15:case"end":return e.stop()}}),e,null,[[0,11]])}))),[g,n,t,L]),z=(0,p.useRef)();(0,p.useEffect)((function(){return z.current=new(function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"reset",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.current();case 2:return e.next=4,y.reset();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"finishFrame",value:function(){(0,o.Z)((0,a.Z)(n.prototype),"finishFrame",this).call(this),k.current({action:"updateTestStep"})}},{key:"tick",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.stepTest());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"toggle",value:function(){k.current({action:"updateTestStep"})}}]),n}(Zt)),function(){var e;null===(e=z.current)||void 0===e||e.stop()}}),[L,y,k]);var B=(0,p.useMemo)((function(){return{toggle:function(){y.clock(),x.trackEvent("action","toggleClock")},reset:function(){x.trackEvent("action","resetClock"),y.reset()}}}),[y]),K=(0,p.useState)(!1),V=(0,d.Z)(K,2),W=V[0],J=V[1],G=(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)("fieldset",{role:"group",children:[(0,v.jsx)("select",{value:j.controls.project,onChange:function(e){var t=e.target.value;D(t)},"data-testid":"project-picker",children:zt.map((function(e){var t=(0,d.Z)(e,2),n=t[0],r=t[1];return(0,v.jsx)("option",{value:n,children:r},n)}))}),(0,v.jsx)("select",{value:j.controls.chipName,onChange:function(e){var t=e.target.value;H(t)},"data-testid":"chip-picker",children:j.controls.chips.map((function(e){return(0,v.jsx)("option",{value:e,children:e},e)}))}),(0,v.jsx)("button",{className:"flex-0",onClick:function(){y.saveChip(w)},disabled:W,children:(0,v.jsx)(f.cC,{id:"Save"})})]})}),$=(0,v.jsx)(Mt,{className:"_hdl_panel",header:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{tabIndex:0,children:"HDL"}),(0,v.jsx)("fieldset",{children:j.controls.hasBuiltin&&(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"checkbox",role:"switch",checked:W,onChange:function(){W?(J(!1),y.useBuiltin(!1)):(J(!0),y.useBuiltin(!0,w))}}),(0,v.jsx)(f.cC,{id:"Builtin"})]})}),G]}),children:(0,v.jsx)(It,{className:"flex-1",value:w,onChange:function(e){P(e),L.current(W?{}:{hdl:e})},grammar:pt.Gq.parser,language:"hdl",disabled:W})}),q=(0,v.jsxs)("fieldset",{role:"group",children:[(0,v.jsx)("button",{onClick:_,onKeyDown:_,disabled:!j.sim.pending,children:(0,v.jsx)(f.cC,{id:"Eval"})}),(0,v.jsxs)("button",{onClick:B.toggle,style:{maxWidth:"initial"},disabled:!j.sim.clocked,children:[(0,v.jsx)(f.cC,{id:"Clock"}),":","\xa0",(0,v.jsx)(Ye,{})]}),(0,v.jsx)("button",{onClick:B.reset,style:{maxWidth:"initial"},disabled:!j.sim.clocked,children:(0,v.jsx)(f.cC,{id:"Reset"})})]}),X=function(e){return(0,h.Z)(e.parts).map((function(e,t){return["".concat(e.id,"_").concat(t),rt(e)]})).filter((function(e){var t=(0,d.Z)(e,2);return t[0],void 0!==t[1]}))}({parts:j.sim.chip}),Y=(0,v.jsx)(Mt,{className:"_parts_panel",header:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{children:(0,v.jsx)(f.cC,{id:"Chip"})}),q]}),children:j.sim.invalid?(0,v.jsx)(f.cC,{id:"Invalid Chip"}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(ct,{sim:j.sim,toggle:y.toggle}),X.length>0&&(0,v.jsx)(Tt,{summary:(0,v.jsx)(f.cC,{id:"Visualization"}),open:!0,children:(0,v.jsx)("main",{children:X.map((function(e){var t=(0,d.Z)(e,2);t[0];return t[1]}))})})]})}),Q=(0,p.useState)("tst"),ee=(0,d.Z)(Q,2),te=ee[0],ne=ee[1],re=(0,p.useCallback)((function(e){ne(e),x.trackEvent("tab","change",e)}),[x]),ie=(0,v.jsx)(Mt,{className:"_test_panel",header:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"flex-1",children:(0,v.jsx)(f.cC,{id:"Test"})}),(0,v.jsx)("div",{className:"flex-2",children:z.current&&(0,v.jsx)(dt,{runner:z.current})}),(0,v.jsx)("div",{children:(0,v.jsxs)("button",{onClick:U,children:[(0,v.jsx)(Pt.J,{name:"upload_file"})," "]})})]}),children:(0,v.jsxs)("div",{role:"tablist",style:{"--tab-count":"3"},children:[(0,v.jsx)("div",{role:"tab",id:"test-tab-tst","aria-controls":"test-tabpanel-tst","aria-selected":"tst"===te,children:(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-tst",value:"tst",checked:"tst"===te,onChange:function(){return re("tst")}}),"Test Script"]})}),(0,v.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-tst",id:"test-tabpanel-tst",children:(0,v.jsx)(It,{value:N,onChange:O,grammar:ht.qH.parser,language:"tst",highlight:j.controls.span})}),(0,v.jsx)("div",{role:"tab",id:"test-tab-cmp","aria-controls":"test-tablpanel-cmp","aria-selected":"cmp"===te,children:(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-cmp",value:"cmp",checked:"cmp"===te,onChange:function(){return re("cmp")}}),"Compare File"]})}),(0,v.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-cmp",id:"test-tabpanel-cmp",style:{position:"relative"},children:(0,v.jsx)(It,{value:I,onChange:M,grammar:ft.lA.parser,language:"cmp"})}),(0,v.jsx)("div",{role:"tab",id:"test-tab-out","aria-controls":"test-tabpanel-out","aria-selected":"out"===te,children:(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-out",value:"out",checked:"out"===te,onChange:function(){return re("out")}}),"Output File"]})}),(0,v.jsx)("div",{role:"tabpanel",id:"test-tabpanel-out","aria-labelledby":"test-tab-out",children:(0,v.jsx)(it.M,{cmp:I,out:R})})]})});return(0,v.jsxs)("div",{className:"ChipPage grid",children:[$,Y,ie]})},Gt=Jt}}]);
//# sourceMappingURL=605.689f71b8.chunk.js.map