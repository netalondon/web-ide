"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[495],{2657:(t,e,s)=>{s.r(e),s.d(e,{Chip:()=>pe,default:()=>ge});var i=s(5072),n=s(1058),r=s(6845),a=s(864),o=s(2369),l=s(2201),c=s(9415),u=s(5150),h=s(5524),d=s(7239);class p extends h.tI{width;_memory;_nextData=0;_address=0;get memory(){return this._memory}get address(){return this._address}constructor(t,e){super(["in[16]","load",`address[${t}]`],["out[16]"],e),this.width=t,this._memory=new l.zp(Math.pow(2,this.width))}tick(){const t=this.in("load").voltage();this._address=this.in("address").busVoltage,t&&(this._nextData=this.in().busVoltage,this._memory.set(this._address,this._nextData))}tock(){this.out().busVoltage=this._memory?.get(this._address)??0}eval(){const t=this.in("address").busVoltage;this.out().busVoltage=this._memory?.get(t)??0}at(t){return(0,d.hu)(t<this._memory.size,(()=>`Request out of bounds (${t} >= ${this._memory.size})`)),new g(`${this.name}[${t}]`,t,this._memory)}get(t,e){return t===this.name?this.at(e??0):super.get(t)}reset(){this._memory.reset(),super.reset()}}class g extends h.Gc{index;ram;constructor(t,e,s){super(t),this.index=e,this.ram=s}get busVoltage(){return this.ram.get(this.index)}set busVoltage(t){this.ram.set(this.index,t)}}class m extends p{constructor(){super(3,"RAM8")}}class f extends p{constructor(){super(14,"RAM16K")}}class b extends p{constructor(){super(16,"ROM")}async load(t,e){try{(await(0,c.zD)(t,e)).map(((t,e)=>this.at(e).busVoltage=t))}catch(s){throw new Error(`ROM32K Failed to load file ${e}`)}}}class x extends p{static SIZE=l.yJ;static OFFSET=l.GD;constructor(){super(13,"Screen")}}class v extends h.Af{static OFFSET=l.eu;constructor(){super([],["out[16]"],"Keyboard")}getKey(){return this.out().busVoltage}setKey(t){this.out().busVoltage=65535&t}clearKey(){this.out().busVoltage=0}get(t){return t===this.name?new h.qP(this.name,this.getKey()):super.get(t)}}class y extends h.tI{ram=new f;screen=new x;keyboard=new v;address=0;constructor(){super(["in[16]","load","address[15])"],["out[16]"],"Memory"),this.parts.add(this.keyboard),this.parts.add(this.screen),this.parts.add(this.ram)}tick(){const t=this.in("load").voltage();if(this.address=this.in("address").busVoltage,t){const t=this.in().busVoltage;this.address>=v.OFFSET||(this.address>=x.OFFSET?this.screen.at(this.address-x.OFFSET).busVoltage=t:this.ram.at(this.address).busVoltage=t)}}tock(){this.eval()}eval(){if(!this.ram)return;this.address=this.in("address").busVoltage;let t=0;t=this.address>=v.OFFSET?this.keyboard?.out().busVoltage??0:this.address>=x.OFFSET?this.screen?.at(this.address-x.OFFSET).busVoltage??0:this.ram?.at(this.address).busVoltage??0,this.out().busVoltage=t}in(t){if(t?.startsWith("RAM16K")){const e=(0,u.o5)(t.match(/\[(?<idx>\d+)]/)?.groups?.idx??"0");return this.ram.at(e)}if(t?.startsWith("Screen")){const e=(0,u.o5)(t.match(/\[(?<idx>\d+)]/)?.groups?.idx??"0");return this.screen.at(e)}return super.in(t)}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.startsWith("RAM16K")?this.at(16383&e):t.startsWith("Screen")?this.at(e&8191+x.OFFSET):t.startsWith("Keyboard")?this.at(v.OFFSET):t.startsWith("Memory")?this.at(e):super.get(t,e)}at(t){return t>=v.OFFSET?this.keyboard.out():t>=x.OFFSET?this.screen.at(t-x.OFFSET):this.ram.at(t)}reset(){this.address=0,this.ram.reset(),this.screen.reset(),super.reset()}}class j extends h.Gc{cpu;constructor(t,e){super(t),this.cpu=e}get busVoltage(){return this.cpu.D}set busVoltage(t){this.cpu.D=t}}class w extends h.Gc{cpu;constructor(t,e){super(t),this.cpu=e}get busVoltage(){return this.cpu.A}set busVoltage(t){this.cpu.A=t}}class C extends h.Gc{cpu;constructor(t,e){super(t),this.cpu=e}get busVoltage(){return this.cpu.PC}set busVoltage(t){this.cpu.PC=t}}class P extends h.tI{_state=(0,o.Zu)();get state(){return this._state}constructor(){super(["inM[16]","instruction[16]","reset"],["outM[16]","writeM","addressM[15]","pc[15]"])}tick(){const[t,e]=(0,o.aL)(this.cpuInput(),this._state);this._state=t,this.out("writeM").pull(e?h.lj:h.yE),this.out("outM").busVoltage=this._state.ALU??0}tock(){if(!this._state)return;const[t,e]=(0,o.Ff)(this.cpuInput(),this._state);this._state=e,this.out("addressM").busVoltage=t.addressM??0,this.out("outM").busVoltage=t.outM??0,this.out("writeM").pull(t.writeM?h.lj:h.yE),this.out("pc").busVoltage=this._state?.PC??0}cpuInput(){return{inM:this.in("inM").busVoltage,instruction:this.in("instruction").busVoltage,reset:1===this.in("reset").busVoltage}}get(t,e){return t?.startsWith("ARegister")?new w("ARegister",this._state):t?.startsWith("DRegister")?new j("DRegister",this._state):t?.startsWith("PC")?new C("PC",this._state):super.get(t,e)}reset(){this._state=(0,o.Zu)(),this._state.PC=-1,super.reset()}}class V extends h.Af{#t=new P;#e=new y;#s=new b;constructor(){super(["reset"],[]),this.wire(this.#t,[{from:{name:"reset",start:0},to:{name:"reset",start:0}},{from:{name:"instruction",start:0},to:{name:"instruction",start:0}},{from:{name:"oldOutM",start:0},to:{name:"inM",start:0}},{from:{name:"writeM",start:0},to:{name:"writeM",start:0}},{from:{name:"addressM",start:0},to:{name:"addressM",start:0}},{from:{name:"newInM",start:0},to:{name:"outM",start:0}},{from:{name:"pc",start:0},to:{name:"pc",start:0}}]),this.wire(this.#s,[{from:{name:"pc",start:0},to:{name:"address",start:0}},{from:{name:"instruction",start:0},to:{name:"out",start:0}}]),this.wire(this.#e,[{from:{name:"newInM",start:0},to:{name:"in",start:0}},{from:{name:"writeM",start:0},to:{name:"load",start:0}},{from:{name:"addressM",start:0},to:{name:"address",start:0}},{from:{name:"oldOutM",start:0},to:{name:"out",start:0}}])}eval(){super.eval()}get(t,e){return t.startsWith("PC")||t.startsWith("ARegister")||t.startsWith("DRegister")?this.#t.get(t):t.startsWith("RAM16K")?this.#e.get(t,e):super.get(t,e)}async load(t,e){return await this.#s.load(t,e)}}var k=s(7054);class S extends h.Af{constructor(){super(["a","b"],["out"])}eval(){const t=this.in("a").voltage(),e=this.in("b").voltage(),[s]=function(t,e){return[1===t&&1===e?h.lj:h.yE]}(t,e);this.out().pull(s)}}class A extends h.Af{constructor(){super(["a[16]","b[16]"],["out[16]"])}eval(){const t=this.in("a").busVoltage,e=this.in("b").busVoltage,[s]=function(t,e){return[t&e&65535]}(t,e);this.out().busVoltage=s}}class I extends h.Af{constructor(){super(["in","sel"],["a","b"])}eval(){const t=this.in("in").voltage(),e=this.in("sel").voltage(),[s,i]=function(t,e){return[e===h.yE&&t===h.lj?h.lj:h.yE,e===h.lj&&t===h.lj?h.lj:h.yE]}(t,e);this.out("a").pull(s),this.out("b").pull(i)}}class E extends h.Af{constructor(){super(["in","sel[2]"],["a","b","c","d"])}eval(){const t=this.in("in").voltage(),e=this.in("sel").busVoltage,[s,i,n,r]=function(t,e){return[0===e&&t===h.lj?h.lj:h.yE,1===e&&t===h.lj?h.lj:h.yE,2===e&&t===h.lj?h.lj:h.yE,3===e&&t===h.lj?h.lj:h.yE]}(t,e);this.out("a").pull(s),this.out("b").pull(i),this.out("c").pull(n),this.out("d").pull(r)}}class O extends h.Af{constructor(){super(["in","sel[3]"],["a","b","c","d","e","f","g","h"])}eval(){const t=this.in("in").voltage(),e=this.in("sel").busVoltage,[s,i,n,r,a,o,l,c]=function(t,e){return[0===e&&t===h.lj?h.lj:h.yE,1===e&&t===h.lj?h.lj:h.yE,2===e&&t===h.lj?h.lj:h.yE,3===e&&t===h.lj?h.lj:h.yE,4===e&&t===h.lj?h.lj:h.yE,5===e&&t===h.lj?h.lj:h.yE,6===e&&t===h.lj?h.lj:h.yE,7===e&&t===h.lj?h.lj:h.yE]}(t,e);this.out("a").pull(s),this.out("b").pull(i),this.out("c").pull(n),this.out("d").pull(r),this.out("e").pull(a),this.out("f").pull(o),this.out("g").pull(l),this.out("h").pull(c)}}function M(t,e,s){return[s===h.yE?t:e]}function F(t,e,s,i,n){const r=1&n;return 0===(2&n)?M(t,e,r):M(s,i,r)}class R extends h.Af{constructor(){super(["a","b","sel"],["out"])}eval(){const t=this.in("a").voltage(),e=this.in("b").voltage(),s=this.in("sel").voltage(),[i]=function(t,e,s){return[s===h.yE?t:e]}(t,e,s);this.out().pull(i)}}class U extends h.Af{constructor(){super(["a[16]","b[16]","sel"],["out[16]"])}eval(){const t=this.in("a").busVoltage,e=this.in("b").busVoltage,s=this.in("sel").voltage(),[i]=M(t,e,s);this.out().busVoltage=i}}class $ extends h.Af{constructor(){super(["a[16]","b[16]","c[16]","d[16]","sel[2]"],["out[16]"])}eval(){const t=this.in("a").busVoltage,e=this.in("b").busVoltage,s=this.in("c").busVoltage,i=this.in("d").busVoltage,n=this.in("sel").busVoltage,[r]=F(t,e,s,i,n);this.out().busVoltage=r}}class W extends h.Af{constructor(){super(["a[16]","b[16]","c[16]","d[16]","e[16]","f[16]","g[16]","h[16]","sel[3]"],["out[16]"])}eval(){const t=this.in("a").busVoltage,e=this.in("b").busVoltage,s=this.in("c").busVoltage,i=this.in("d").busVoltage,n=this.in("e").busVoltage,r=this.in("f").busVoltage,a=this.in("g").busVoltage,o=this.in("h").busVoltage,l=this.in("sel").busVoltage,[c]=function(t,e,s,i,n,r,a,o,l){const c=3&l;return 0===(4&l)?F(t,e,s,i,c):F(n,r,a,o,c)}(t,e,s,i,n,r,a,o,l);this.out().busVoltage=c}}class T extends h.Af{constructor(){super(["a","b"],["out"])}eval(){const t=this.in("a").voltage(),e=this.in("b").voltage(),[s]=function(t,e){return[1===t&&1===e?h.yE:h.lj]}(t,e);this.out().pull(s)}}class N extends h.Af{constructor(){super(["a[16]","b[16]"],["out[16]"])}eval(){const t=this.in("a").busVoltage,e=this.in("b").busVoltage;this.out().busVoltage=(0,u.C2)(t,e)}}class _ extends h.Af{constructor(){super(["in"],["out"])}eval(){const t=this.in("in").voltage(),[e]=[t===h.yE?h.lj:h.yE];this.out().pull(e)}}class L extends h.Af{constructor(){super(["in[16]"],["out[16]"])}eval(){const[t]=[65535&~this.in().busVoltage];this.out().busVoltage=t}}function D(t,e){return[1===t||1===e?h.lj:h.yE]}class B extends h.Af{constructor(){super(["a","b"],["out"])}eval(){const t=this.in("a").voltage(),e=this.in("b").voltage(),[s]=D(t,e);this.out().pull(s)}}class G extends h.Af{constructor(){super(["a[16]","b[16]"],["out[16]"])}eval(){const t=this.in("a").busVoltage,e=this.in("b").busVoltage,[s]=function(t,e){return[65535&(t|e)]}(t,e);this.out().busVoltage=s}}class z extends h.Af{constructor(){super(["in[8]"],["out"],"Or8way")}eval(){const t=this.in().busVoltage,[e]=[0===(255&t)?h.yE:h.lj];this.out().pull(e)}}class Z extends h.Af{constructor(){super(["a","b"],["out"])}eval(){const t=this.in("a").voltage(),e=this.in("b").voltage(),[s]=function(t,e){return[t===h.lj&&e===h.yE||t===h.yE&&e===h.lj?h.lj:h.yE]}(t,e);this.out().pull(s)}}class H extends h.Af{constructor(){super(["a[16]","b[16]"],["out[16]"])}eval(){const t=this.in("a").busVoltage,e=this.in("b").busVoltage,[s]=function(t,e){return[65535&(t^e)]}(t,e);this.out().busVoltage=s}}function K(t,e){return[t+e&65535]}class J extends h.Af{constructor(){super(["a[16]","b[16]"],["out[16]"],"Add16")}eval(){const t=this.in("a").busVoltage,e=this.in("b").busVoltage,[s]=K(t,e);this.out().busVoltage=s}}var q=s(137);class X extends h.Af{constructor(){super(["x[16]","y[16]","zx","nx","zy","ny","f","no"],["out[16]"],"ALU")}eval(){const t=this.in("x").busVoltage,e=this.in("y").busVoltage,s=(this.in("zx").busVoltage<<5)+(this.in("nx").busVoltage<<4)+(this.in("zy").busVoltage<<3)+(this.in("ny").busVoltage<<2)+(this.in("f").busVoltage<<1)+(this.in("no").busVoltage<<0),[i]=(0,q.Bb)(s,t,e);this.out().busVoltage=i}}class Y extends h.Af{constructor(){super(["x[16]","y[16]","zx","nx","zy","ny","f","no"],["out[16]","zr","ng"],"ALU")}eval(){const t=this.in("x").busVoltage,e=this.in("y").busVoltage,s=(this.in("zx").busVoltage<<5)+(this.in("nx").busVoltage<<4)+(this.in("zy").busVoltage<<3)+(this.in("ny").busVoltage<<2)+(this.in("f").busVoltage<<1)+(this.in("no").busVoltage<<0),[i,n]=(0,q.Bb)(s,t,e),r=n===q.vU.Negative?h.lj:h.yE,a=n===q.vU.Zero?h.lj:h.yE;this.out("out").busVoltage=i,this.out("ng").pull(r),this.out("zr").pull(a)}op(){return(this.in("zx").busVoltage<<5)+(this.in("nx").busVoltage<<4)+(this.in("zy").busVoltage<<3)+(this.in("ny").busVoltage<<2)+(this.in("f").busVoltage<<1)+(this.in("no").busVoltage<<0)}}function Q(t,e){return[1===t&&0===e||0===t&&1===e?h.lj:h.yE,1===t&&1===e?h.lj:h.yE]}class tt extends h.Af{constructor(){super(["a","b"],["sum","carry"])}eval(){const t=this.in("a").voltage(),e=this.in("b").voltage(),[s,i]=Q(t,e);this.out("sum").pull(s),this.out("carry").pull(i)}}class et extends h.Af{constructor(){super(["a","b","c"],["sum","carry"])}eval(){const t=this.in("a").voltage(),e=this.in("b").voltage(),s=this.in("c").voltage(),[i,n]=function(t,e,s){const[i,n]=Q(t,e),[r,a]=Q(i,s),[o]=D(n,a);return[r,o]}(t,e,s);this.out("sum").pull(i),this.out("carry").pull(n)}}class st extends h.Af{constructor(){super(["in[16]"],["out[16]"],"Inc16")}eval(){const t=this.in().busVoltage,[e]=K(t,1);this.out().busVoltage=e}}class it extends h.tI{bit=h.yE;constructor(t){super(["in","load"],["out"],t)}tick(){this.in("load").voltage()===h.lj&&(this.bit=this.in().voltage())}tock(){this.out().pull(this.bit??0)}reset(){this.bit=h.yE,super.reset()}}class nt extends h.Gc{register;constructor(t,e){super(t),this.register=e}get busVoltage(){return 65535&this.register.bits}set busVoltage(t){this.register.bits=65535&t}}class rt extends h.tI{bits=0;constructor(t){super(["in[16]","load"],["out[16]"],t)}tick(){this.in("load").voltage()===h.lj&&(this.bits=65535&this.in().busVoltage)}tock(){this.out().busVoltage=65535&this.bits}get(t,e){return t===this.name?new nt(this.name,this):super.get(t,e)}reset(){this.bits=0,super.reset()}}class at extends rt{}class ot extends h.tI{bits=0;constructor(t){super(["in[16]","load","inc","reset"],["out[16]"],t)}tick(){this.in("reset").voltage()===h.lj?this.bits=0:this.in("load").voltage()===h.lj?this.bits=65535&this.in().busVoltage:this.in("inc").voltage()===h.lj&&(this.bits+=1)}tock(){this.out().busVoltage=65535&this.bits}get(t,e){return t===this.name?new nt(this.name,this):super.get(t,e)}reset(){this.bits=0,super.reset()}}class lt extends h.tI{constructor(t){super(["in"],["out"],t,["t"])}tick(){const t=this.in().voltage();this.pin("t").pull(t)}tock(){const t=this.pin("t").voltage();this.out().pull(t)}}const ct=new Map([["Nand",T],["Nand16",N],["Not",_],["Not16",L],["And",S],["And16",A],["Or",B],["Or16",G],["Or8Way",z],["XOr",Z],["XOr16",H],["Xor",Z],["Xor16",H],["Mux",R],["Mux16",U],["Mux4Way16",$],["Mux8Way16",W],["DMux",I],["DMux4Way",E],["DMux8Way",O],["HalfAdder",tt],["FullAdder",et],["Add16",J],["Inc16",st],["ALU",Y],["ALUNoStat",X],["DFF",lt],["Bit",it],["Register",rt],["ARegister",rt],["DRegister",rt],["PC",ot],["RAM8",m],["RAM64",class extends p{constructor(){super(6,"RAM64")}}],["RAM512",class extends p{constructor(){super(9,"RAM512")}}],["RAM4K",class extends p{constructor(){super(12,"RAM4K")}}],["RAM16K",f],["ROM32K",b],["Screen",x],["Keyboard",v],["CPU",P],["Computer",V],["Memory",y],["ARegister",at],["DRegister",at]].map((t=>{let[e,s]=t;return[e,()=>{const t=new s;return t.name=e,t}]})));function ut(t){const e=ct.get(t);return e?(0,k.Ok)(e()):(0,k.UG)(new Error(`Chip ${t} not in builtin registry`))}const ht=t=>{let{A:e,op:s,D:i,out:n,flag:r}=t;return(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"ALU"}),(0,a.jsx)("svg",{width:"250",height:"250",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsxs)("g",{children:[(0,a.jsx)("rect",{x:"1",y:"20",height:"85",width:"70",fill:"black"}),(0,a.jsx)("rect",{x:"1",y:"145",height:"85",width:"70",fill:"black"}),(0,a.jsx)("rect",{x:"180",y:"95",height:"60",width:"70",fill:"black"}),(0,a.jsx)("polygon",{points:"70,10 180,85 180,165 70,240 70,135 90,125 70,115",stroke:"#000",fill:"#6D97AB"}),(0,a.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",fontFamily:"Noto Sans JP",fontSize:"14",strokeWidth:"0",id:"svg_9",y:"63",x:"35",stroke:"white",fill:"#ffffff",children:e}),(0,a.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",fontFamily:"Noto Sans JP",fontSize:"14",id:"svg_10",y:"188",x:"35",strokeWidth:"0",stroke:"white",fill:"#ffffff",children:i}),(0,a.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",fontFamily:"Noto Sans JP",fontSize:"14",id:"svg_11",y:"125",x:"215",strokeWidth:"0",stroke:"white",fill:"#ffffff",children:n}),(0,a.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",fontFamily:"Noto Sans JP",fontSize:"14",id:"svg_13",y:"125",x:"135",strokeWidth:"0",stroke:"white",fill:"#ffffff",children:q.NM.op[s]??"(??)"})]})})]})};var dt=s(3478),pt=s(3577),gt=s(2869),mt=s(8963);function ft(t,e){if(t instanceof Y)return(0,a.jsx)(ht,{A:t.in("x").busVoltage,op:t.op(),D:t.in("y").busVoltage,out:t.out().busVoltage,flag:t.out("zr").voltage()===h.lj?q.vU.Zero:t.out("ng").voltage()===h.lj?q.vU.Negative:q.vU.Positive});if(t instanceof rt)return(0,a.jsx)(gt.y,{name:t.name??`Chip ${t.id}`,bits:t.bits});if(t instanceof ot)return(0,a.jsx)(gt.y,{name:"PC",bits:t.bits});if(t instanceof v)return(0,a.jsx)(dt.N,{keyboard:t,update:e});if(t instanceof x)return(0,a.jsx)(mt.l,{memory:t.memory});if(t instanceof p)return(0,a.jsx)(pt.zp,{name:t.name,memory:t.memory,format:t instanceof b?"asm":"dec",highlight:t.address});if(t instanceof m)return(0,a.jsxs)("span",{children:["RAM ",t.width]});if(t instanceof P){const e=(0,o.Jx)(t.in("instruction").busVoltage);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(gt.y,{name:"A",bits:t.state.A}),(0,a.jsx)(gt.y,{name:"D",bits:t.state.D}),(0,a.jsx)(gt.y,{name:"PC",bits:t.state.PC}),(0,a.jsx)(ht,{A:e.am?t.in("inM").busVoltage:t.state.A,D:t.state.D,out:t.state.ALU,op:e.op,flag:t.state.flag})]})}const s=[...t.parts].map((t=>ft(t,e))).filter((t=>void 0!==t));return s.length>0?(0,a.jsx)(a.Fragment,{children:s}):void 0}var bt=s(5554),xt=s(8177);class vt{signBehaviors=new Map;constructor(t,e){if(ct.has(t)){const s=ut(t);if((0,k.IY)(s)){const t=Array.from((0,k.Ok)(s).ins.entries()).concat(Array.from((0,k.Ok)(s).outs.entries()));for(const s of t)this.signBehaviors.set(s.name,!e||!e.includes(s.name))}}}isSigned(t){return this.signBehaviors.get(t)}}const yt=new Map([["Mux4Way16",["sel"]],["Mux8Way16",["sel"]],["DMux4Way",["sel"]],["DMux8Way",["sel"]],["RAM8",["address"]],["RAM64",["address"]],["RAM512",["address"]],["RAM4K",["address"]],["RAM16K",["address"]],["Screen",["address"]],["Memory",["address"]],["CPU",["addressM","pc"]]]),jt=(0,r.createContext)({});function wt(t){return{pin:t,bits:(0,xt.w)(0,t.width).map((e=>[e,t.voltage(e)])).reverse()}}function Ct(t){return[...t.entries()].map(wt)}const Pt=t=>{const{inPins:e,outPins:s,internalPins:i}=t.sim,n=(r=t.sim.chip[0].name??"",new vt(r,yt.get(r)));var r;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("style",{children:"\n        table.pinout th {\n          font-weight: bold;\n        }\n\n        table.pinout tbody td:first-child {\n          text-align: right;\n          --font-size: 1rem;\n          width: 0;\n          white-space: nowrap;\n          border-right: var(--border-width) solid var(--table-border-color);\n        }\n\n        table.pinout tbody button {\n          --font-size: 0.875em;\n          font-family: var(--font-family-monospace);\n          max-width: 2em;\n        }\n        "}),(0,a.jsx)("table",{className:"pinout",children:(0,a.jsxs)("tbody",{children:[(0,a.jsx)(Vt,{pins:e,header:"Input pins",toggle:t.toggle,setInputValid:t.setInputValid,displayInfo:n}),(0,a.jsx)(Vt,{pins:s,header:"Output pins",disabled:t.sim.pending,enableEdit:!1,displayInfo:n}),!t.hideInternal&&(0,a.jsx)(Vt,{pins:i,header:"Internal pins",disabled:t.sim.pending,enableEdit:!1,displayInfo:n})]})})]})},Vt=t=>(0,a.jsxs)(a.Fragment,{children:[t.pins.length>0&&(0,a.jsx)("tr",{children:(0,a.jsx)("th",{colSpan:2,children:t.header})}),[...t.pins].map((e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.pin.name}),(0,a.jsx)("td",{children:(0,a.jsx)(kt,{pin:e,toggle:t.toggle,disabled:t.disabled,enableEdit:t.enableEdit,signed:t.displayInfo.isSigned(e.pin.name),setInputValid:t.setInputValid,internal:"Internal pins"===t.header})})]},e.pin.name)))]}),kt=t=>{let{pin:e,toggle:s,disabled:i=!1,enableEdit:n=!0,signed:o=!0,setInputValid:l,internal:c=!1}=t;const[u,h]=(0,r.useState)(!0);let d=!0;const[p,g]=(0,r.useState)(""),m=(0,r.useContext)(jt);m instanceof St&&m.registerCallback((()=>{h(!0)}));const f=t=>{d=t,l?.(t)},b=t=>{for(let i=0;i<e.bits.length;i++)e.bits[e.bits.length-i-1][1]!==(t>>i&1)&&s?.(e.pin,i)};return(0,r.useEffect)((()=>{if(!u&&d){let t=0;if(o&&e.bits[0][1]){for(const[s,i]of e.bits)s<e.bits.length-1&&!i&&(t+=2**s);t=-t-1}else{const s=o?e.bits.length-1:e.bits.length;for(const[i,n]of e.bits)i<s&&n&&(t+=2**i)}g(t.toString())}}),[e,u]),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,a.jsx)("fieldset",{role:"group",style:{width:`${e.bits.length}rem`},children:u?e.bits.map((t=>{let[n,r]=t;return(0,a.jsx)("button",{disabled:i,style:c?{backgroundColor:"grey"}:{},onClick:()=>s?.(e.pin,n),"data-testid":`pin-${n}`,children:r},n)})):(0,a.jsx)("input",{className:"colored",value:p,onChange:t=>{(t=>{const s=t.replace(/[^\d]/g,""),i=o&&"-"===t[0]?`-${s}`:s;if(g(i),isNaN(parseInt(i)))f(!1);else{const t=parseInt(i);!o&&t>=Math.pow(2,e.bits.length)||o&&(t>=Math.pow(2,e.bits.length-1)||t<-Math.pow(2,e.bits.length-1))?f(!1):(b(t),f(!0))}})(t.target.value)},disabled:!n})}),e.bits.length>1&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{width:"1em"}}),(0,a.jsx)("button",{style:{maxWidth:"3em",margin:0},onClick:()=>{h(!u)},children:u?"dec":"bin"})]})]})};class St{callbacks=[];registerCallback(t){this.callbacks.push(t)}reset(){for(const t of this.callbacks)t()}}var At=s(6604),It=s(5692),Et=s(554),Ot=s(6663),Mt=s(9814),Ft=s(3484);const Rt='\nHdl <: Base{\n  Root := Chip\n  Chip = "CHIP" Name OpenBrace ChipBody CloseBrace\n  ChipBody = InList? OutList? PartList ClockedList?\n  InList = "IN" PinList Semi\n  OutList = "OUT" PinList Semi\n  PartList = BuiltinPart | Parts\n  PinList = List<PinDecl, Comma>\n  PinDecl = Name PinWidth?\n  PinWidth = OpenSquare decNumber CloseSquare\n  BuiltinPart = "BUILTIN" Semi\n  Parts = "PARTS:" Part*\n  Part = Name "(" Wires ")" Semi\n  Wires = List<Wire, Comma>\n  Wire = WireSide Equal (WireSide | True | False) \n  WireSide = Name SubBus? \n  SubBus = OpenSquare decNumber subBusRest? CloseSquare\n  subBusRest = ".." decNumber\n  ClockedList = "CLOCKED" SimplePinList Semi\n  SimplePinList = List<Name, Comma>\n}',Ut=Mt.Z.grammar(Rt,Ft.y1),$t=Ut.extendSemantics(Ft.rJ);$t.addAttribute("SubBus",{SubBus(t,e,s,i){const n=e.value;return{start:n,end:s.child(0)?.child(1)?.value??n}}}),$t.addAttribute("WireSide",{WireSide(t,e){let{name:s}=t;const{start:i,end:n}=e.child(0)?.SubBus??{start:void 0,end:void 0};return{pin:s,start:i,end:n,span:(0,Ft.yP)(this.source)}}}),$t.addAttribute("Wire",{Wire(t,e,s){const i=s.isTerminal()?{pin:s.sourceString}:s.WireSide;return{lhs:t.WireSide,rhs:i}}}),$t.addAttribute("Wires",{Wires:t=>t.asIteration().children.map((t=>t.Wire))}),$t.addAttribute("Part",{Part(t,e,s,i,n){let{name:r}=t,{Wires:a}=s;return{name:r,wires:a,span:(0,Ft.yP)(this.source)}}}),$t.addAttribute("Parts",{Parts:(t,e)=>e.children.map((t=>t.Part)),BuiltinPart:(t,e)=>"BUILTIN"}),$t.addAttribute("PartList",{PartList:t=>t.Parts}),$t.addAttribute("Clocked",{ClockedList:(t,e,s)=>e.asIteration().children.map((t=>{let{sourceString:e}=t;return e}))??[]}),$t.addAttribute("PinDecl",{PinDecl(t,e){let{name:s}=t;return{pin:s,width:e.child(0)?.child(1)?.value??1}}}),$t.addAttribute("PinList",{PinList:t=>t.asIteration().children.map((t=>t.PinDecl))}),$t.addAttribute("Chip",{Chip:(t,e,s,i,n)=>({name:{value:e.sourceString,span:(0,Ft.yP)(e.source)},ins:i.child(0).child(0)?.child(1)?.PinList??[],outs:i.child(1).child(0)?.child(1)?.PinList??[],parts:i.child(2).PartList??[],clocked:i.child(3).child(0)?.Clocked})}),$t.addAttribute("Root",{Root:t=>t.child(0)?.Chip});const Wt={parser:Ut,grammar:Rt,semantics:$t,parse:(0,Ft.Pz)(Ut,$t,(t=>t.Chip))};var Tt=s(3583);function Nt(t,e){if(void 0!==e){if(e>=t)return e-t+1;if(t>0&&0===e)return 1;throw new Error(`Bus specification has start > end (${t} > ${e})`)}}async function _t(t,e){if(function(t){return ct.has(t)}(t)||void 0===e)return ut(t);try{const s=await e.readFile(`${t}.hdl`),i=Wt.parse(s);let n;if((0,k.IY)(i)){const t=await Lt((0,k.Ok)(i),e);n=(0,k.dZ)(t)?(0,k.UG)(new Error((0,k.UG)(t).message)):t}else n=(0,k.UG)(new Error("HDL Was not parsed"));return n}catch(s){return(0,k.UG)(new Error(`Could not load chip ${t}.hdl`))}}async function Lt(t,e,s){return await new Kt(t,e,s).build()}function Dt(t){return"false"===t||"true"===t||"0"===t||"1"===t}function Bt(t){if(void 0!=t.start&&void 0!=t.end)return t.end-t.start+1}function Gt(t){return void 0!=t.start&&void 0!=t.end?`${t.pin}[${t.start}..${t.end}]`:t.pin}function zt(t,e){return{to:{name:t.pin.toString(),start:t.start??0,width:Nt(t.start??0,t.end)},from:{name:e.pin.toString(),start:e.start??0,width:Nt(e.start??0,e.end)}}}function Zt(t){if(void 0!=t.start&&void 0!=t.end){const e=[];for(let s=t.start;s<=t.end;s++)e.push(s);return e}return[-1]}function Ht(t,e){let s;const i=e.get(t.pin);if(i)if(i.has(-1))s=t.start??-1;else if(void 0!==t.start&&void 0!==t.end)for(const n of Zt(t))i.has(n)&&(s=n),i.add(n);else i.add(-1);else e.set(t.pin,new Set(Zt(t)));return void 0!=s?(0,k.UG)({message:`Cannot write to pin ${t.pin}${-1!=s?`[${s}]`:""} multiple times`,span:t.span}):(0,k.Ok)()}class Kt{parts;fs;expectedName;chip;internalPins=new Map;inPins=new Map;outPins=new Map;wires=[];constructor(t,e,s){this.parts=t,this.expectedName=s,this.fs=e,this.chip=new h.Af(t.ins.map((t=>{let{pin:e,width:s}=t;return{pin:e.toString(),width:s}})),t.outs.map((t=>{let{pin:e,width:s}=t;return{pin:e.toString(),width:s}})),t.name.value,[],t.clocked)}async build(){if(this.expectedName&&this.parts.name.value!=this.expectedName)return(0,k.UG)({message:"Wrong chip name",span:this.parts.name.span});if("BUILTIN"===this.parts.parts)return ut(this.parts.name.value);const t=await this.wireParts();return(0,k.dZ)(t)?t:(0,k.Ok)(this.chip)}async wireParts(){if("BUILTIN"===this.parts.parts)return(0,k.Ok)();for(const e of this.parts.parts){const t=await _t(e.name,this.fs);if((0,k.dZ)(t))return(0,k.UG)({message:`Undefined chip name: ${e.name}`,span:e.span});const s=(0,k.Ok)(t);if(s.name==this.chip.name)return(0,k.UG)({message:`Cannot use chip ${s.name} to implement itself`,span:e.span});const i=this.wirePart(e,s);if((0,k.dZ)(i))return i}let t=this.validateInternalPins();return(0,k.dZ)(t)?t:(t=this.validateWireWidths(),(0,k.dZ)(t)?t:(0,k.Ok)())}wirePart(t,e){const s=[];this.inPins.clear();for(const{lhs:n,rhs:r}of t.wires){const t=this.validateWire(e,n,r);if((0,k.dZ)(t))return t;s.push(zt(n,r))}try{return this.chip.wire(e,s),(0,k.Ok)()}catch(i){return(0,k.UG)(i)}}validateWire(t,e,s){if(t.isInPin(e.pin)){const t=this.validateInputWire(e,s);if((0,k.dZ)(t))return t}else{if(!t.isOutPin(e.pin))return(0,k.UG)({message:`Undefined input/output pin name: ${e.pin}`,span:e.span});{const i=this.validateOutputWire(t,e,s);if((0,k.dZ)(i))return i}}return Dt(s.pin)||this.wires.push({chip:t,lhs:e,rhs:s}),(0,k.Ok)()}isInternal(t){return!(this.chip.isInPin(t)||this.chip.isOutPin(t)||Dt(t))}validateInputWire(t,e){let s=this.validateInputSource(e);if((0,k.dZ)(s))return s;if(s=Ht(t,this.inPins),(0,k.dZ)(s))return s;if(this.isInternal(e.pin)){const t=this.internalPins.get(e.pin);void 0==t?this.internalPins.set(e.pin,{isDefined:!1,firstUse:e.span}):t.firstUse=t.firstUse.start<e.span.start?t.firstUse:e.span}return(0,k.Ok)()}validateOutputWire(t,e,s){let i=this.validateWriteTarget(s);if((0,k.dZ)(i))return i;if(this.chip.isOutPin(s.pin)){if(i=Ht(s,this.outPins),(0,k.dZ)(i))return i}else{if(void 0!==s.start||void 0!==s.end)return(0,k.UG)({message:`Cannot write to sub bus of internal pin ${s.pin}`,span:s.span});const i=this.internalPins.get(s.pin),n=Bt(e)??t.get(e.pin)?.width;if(void 0==i)this.internalPins.set(s.pin,{isDefined:!0,firstUse:s.span,width:n});else{if(i.isDefined)return(0,k.UG)({message:`Internal pin ${s.pin} already defined`,span:s.span});i.isDefined=!0,i.width=n}}return(0,k.Ok)()}validateWriteTarget(t){return this.chip.isInPin(t.pin)?(0,k.UG)({message:`Cannot write to input pin ${t.pin}`,span:t.span}):Dt(t.pin)?(0,k.UG)({message:`Illegal internal pin name: ${t.pin}`,span:t.span}):(0,k.Ok)()}validateInputSource(t){return this.chip.isOutPin(t.pin)?(0,k.UG)({message:"Cannot use output pin as input",span:t.span}):this.chip.isInPin(t.pin)||void 0==t.start?(0,k.Ok)():(0,k.UG)({message:Dt(t.pin)?"Cannot use sub bus of constant bus":`Cannot use sub bus of internal pin ${t.pin} as input`,span:t.span})}validateInternalPins(){for(const[t,e]of this.internalPins)if(!e.isDefined)return(0,k.UG)({message:"true"==t.toLowerCase()||"false"==t.toLowerCase()?`The constants ${t.toLowerCase()} must be in lower-case`:`Undefined internal pin name: ${t}`,span:e.firstUse});return(0,k.Ok)()}validateWireWidths(){for(const t of this.wires){const e=Bt(t.lhs)??t.chip.get(t.lhs.pin)?.width,s=Bt(t.rhs)??this.chip.get(t.rhs.pin)?.width??this.internalPins.get(t.rhs.pin)?.width;if(e!=s)return(0,k.UG)({message:`Different bus widths: ${Gt(t.lhs)}(${e}) and ${Gt(t.rhs)}(${s})`,span:t.lhs.span})}return(0,k.Ok)()}}var Jt=s(5424),qt=s(4430),Xt=s(2836),Yt=s(4913);const Qt=[["01","Project 1"],["02","Project 2"],["03","Project 3"],["05","Project 5"]];function te(t){return t in Ot.CHIP_ORDER?Ot.CHIP_ORDER[t]:Ot.BUILTIN_CHIP_PROJECTS[t].concat(Ot.CHIP_PROJECTS[t])}function ee(t){return Object.values(Ot.BUILTIN_CHIP_PROJECTS).flat().includes(t)}function se(t,e){const s=function(t,e){return ee(e)?Ot.ChipProjects[t].BUILTIN_CHIPS[e]:Ot.ChipProjects[t].CHIPS[e][`${e}.hdl`]}(t,e);if(ee(e))return s;const i="//// Replace this comment with your code.",n=`BUILTIN ${e};`;return s.includes(i)?s.replace(i,n):s.replace("PARTS:",`PARTS:\n    ${n}`)}function ie(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{clocked:t.clocked,inPins:Ct(t.ins),outPins:Ct(t.outs),internalPins:Ct(t.pins),chip:[t],pending:e,invalid:s}}const ne=Jt.S.get();function re(t,e,s,i){const n=function(t){const e=t["/chip/project"]??"01";return{project:e,chips:te(e),chipName:t["/chip/chip"]??Ot.CHIP_PROJECTS[e][0]}}(s);let{project:r,chipName:a}=n;const{chips:o}=n;let l=new h.P9,c=new Xt.l1,u=!1,p=!1,g=!1;const m={setFiles(t,e){let{hdl:s=t.files.hdl,tst:i=t.files.tst,cmp:n=t.files.cmp,out:r=""}=e;t.files.hdl=s,t.files.tst=i,t.files.cmp=n,t.files.out=r},updateChip(t,e){t.sim=ie(l,e?.pending??t.sim.pending,e?.invalid??t.sim.invalid),t.controls.error=t.sim.invalid?e?.error??t.controls.error:void 0},setProject(t,e){const s=te(e),i=t.controls.chipName&&s.includes(t.controls.chipName)?t.controls.chipName:s[0];t.controls.project=e,t.controls.chips=s,this.setChip(t,i)},setChip(t,e){t.controls.chipName=e,t.controls.hasBuiltin=ct.has(e),t.controls.builtinOnly=ee(e)},testRunning(t){t.controls.runningTest=!0},testFinished(t){t.controls.runningTest=!1;const s=(0,Yt.q)(t.files.cmp.trim(),t.files.out.trim());e(s?"Simulation successful: The output file is identical to the compare file":"Simulation error: The output file differs from the compare file")},updateTestStep(t){if(t.files.out=c?.log()??"",c?.currentStep?.span)t.controls.span=c.currentStep.span;else if(c.done){const e=t.files.tst.length;t.controls.span={start:e-1,end:e,line:t.files.tst.split("\n").length}}this.updateChip(t,{pending:t.sim.pending,invalid:t.sim.invalid})}},f={setProject(t){r=s["/chip/project"]=t,i.current({action:"setProject",payload:r}),this.setChip(Ot.CHIP_PROJECTS[r][0])},async setChip(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s["/chip/project"]??"01";if(a=s["/chip/chip"]=t,i.current({action:"setChip",payload:a}),p=ee(a),p)return i.current({action:"setFiles",payload:{hdl:"",tst:"",cmp:""}}),void this.useBuiltin();await this.loadChip(e,a),u&&this.useBuiltin()},reset(){Jt.S.get().reset(),l.reset(),c.reset(),i.current({action:"setFiles",payload:{}}),i.current({action:"updateChip"})},async updateFiles(t){let{hdl:s,tst:n,cmp:r}=t;g=!1,i.current({action:"setFiles",payload:{hdl:s,tst:n,cmp:r}});try{s&&await this.compileChip(s),n&&this.compileTest(n)}catch(a){e((0,Et.j)(a))}i.current({action:"updateChip",payload:{invalid:g}}),g||e("HDL code: No syntax errors")},async compileChip(t){l.remove();const s=await async function(t,e){const s=Wt.parse(t.toString());return(0,k.dZ)(s)?(0,k.UG)((0,Tt.m)((0,k.UG)(s))):Lt((0,k.Ok)(s),void 0,e)}(t,a);if((0,k.dZ)(s)){const t=(0,k.UG)(s);return e(`${void 0!=t.span?.line?`Line ${t.span.line}: `:""}${(0,k.UG)(s).message}`),g=!0,void i.current({action:"updateChip",payload:{invalid:!0,error:t}})}this.replaceChip((0,k.Ok)(s))},replaceChip(t){const e=l.ins;for(const[s,{busVoltage:i}]of e){const e=t.ins.get(s);e&&(e.busVoltage=i)}ne.reset(),t.eval(),l=t,l.reset(),c=c.with(l).reset(),i.current({action:"updateChip",payload:{invalid:!1}}),i.current({action:"updateTestStep"})},async loadChip(e,n){s["/chip/chip"]=n;const r=t=>`/projects/${e}/${n}/${n}.${t}`,[a,o,l]=await Promise.all([t.readFile(r("hdl")).catch((()=>function(t){return`CHIP ${t} {\n  IN in;\n  OUT out;\n  PARTS:\n}`}(n))),t.readFile(r("tst")).catch((t=>"repeat 10 {\n  tick,\n  tock;\n}")),t.readFile(r("cmp")).catch((()=>"| in|out|"))]);i.current({action:"setFiles",payload:{hdl:a,tst:o,cmp:l}}),await this.compileChip(a),this.compileTest(o)},async saveChip(s){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a;i.current({action:"setFiles",payload:{hdl:s}});const l=`/projects/${n}/${o}/${o}.hdl`;await t.writeFile(l,s),e(`Saved ${l}`)},toggle(t,e){void 0!==e?t.busVoltage=t.busVoltage^1<<e:1===t.width?t.toggle():t.busVoltage+=1,i.current({action:"updateChip",payload:{pending:!0}})},eval(){l.eval(),i.current({action:"updateChip",payload:{pending:!1}})},clock(){ne.toggle(),ne.isLow&&ne.frame(),i.current({action:"updateChip"})},async useBuiltin(){let t=arguments.length>1?arguments[1]:void 0;if(!(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]))return p||(u=!1),void await this.loadChip(r,a);p||(u=!0);const s=a,n=ut(s);if((0,k.dZ)(n))return void e(`Failed to load builtin ${s}: ${(0,Et.j)((0,k.UG)(n))}`);t&&await this.saveChip(t,r,a);const o=se(r,s);i.current({action:"setFiles",payload:{hdl:o}}),this.replaceChip((0,k.Ok)(n))},async initialize(){await this.setChip(a,r)},compileTest(s){i.current({action:"setFiles",payload:{tst:s}});const n=qt.qH.parse(s);return(0,k.dZ)(n)?(e(`Failed to parse test ${(0,k.UG)(n).message}`),g=!0,!1):(c=Xt.l1.from((0,k.Ok)(n),e).with(l).reset(),c.setFileSystem(t),i.current({action:"updateTestStep"}),!0)},async runTest(e){this.compileTest(e)&&(i.current({action:"testRunning"}),t.pushd("/samples"),await c.run(),t.popd(),i.current({action:"updateTestStep"}),i.current({action:"testFinished"}))},tick(){return this.stepTest()},async stepTest(){(0,d.hu)(c.chipId===l.id,"Test and chip out of sync");const t=await c.step();return i.current({action:"updateTestStep"}),t&&i.current({action:"testFinished"}),t},resetFile(){const t=Ot.ChipProjects[r].CHIPS[a][`${a}.hdl`];i.current({action:"setFiles",payload:{hdl:t}})},getProjectFiles:async()=>await Promise.all(Ot.CHIP_PROJECTS[r].map((e=>({name:`${e}.hdl`,content:t.readFile(`/projects/${r}/${e}/${e}.hdl`)}))))};return{initialState:(()=>{const t={project:r,chips:o,chipName:a,hasBuiltin:ct.has(a),builtinOnly:ee(a),runningTest:!1,error:void 0},s=ut(t.chipName);(0,k.dZ)(s)?(e((0,Et.j)((0,k.UG)(s))),l=new h.P9):l=(0,k.Ok)(s);return{controls:t,files:{hdl:"",cmp:"",tst:"",out:""},sim:ie(l)}})(),reducers:m,actions:f}}var ae=s(4619),oe=s(2539),le=s.n(oe),ce=s(558),ue=s(8722),he=s(9200),de=s(8398);const pe=()=>{const{setStatus:t}=(0,r.useContext)(It.r),{tracking:e}=(0,r.useContext)(ue.Il),{state:s,actions:o,dispatch:l}=function(){const{fs:t,setStatus:e,storage:s}=(0,r.useContext)(It.r),i=(0,r.useRef)((()=>{})),{initialState:n,reducers:a,actions:o}=(0,r.useMemo)((()=>re(t,e,s,i)),[t,e,s,i]),[l,c]=(0,At.C)(a,n);return i.current=c,{state:l,dispatch:i,actions:o}}(),[c,u]=(0,At.i)(s.files.hdl),[h,d]=(0,At.i)(s.files.tst),[p,g]=(0,At.i)(s.files.cmp),[m,f]=(0,At.i)(s.files.out);(0,r.useEffect)((()=>{o.initialize()}),[o]),(0,r.useEffect)((()=>{e.trackPage("/chip")}),[e]),(0,r.useEffect)((()=>{e.trackEvent("action","setProject",s.controls.project),e.trackEvent("action","setChip",s.controls.chipName)}),[]);const b=(0,r.useCallback)((t=>{o.setProject(t),e.trackEvent("action","setProject",t)}),[o,e]),x=(0,r.useCallback)((t=>{o.setChip(t),e.trackEvent("action","setChip",t),U.reset()}),[o,e]),v=(0,r.useCallback)((()=>{o.eval(),e.trackEvent("action","eval")}),[o,e]),y=(0,r.useRef)((()=>{}));y.current=async function(){var t,e;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await o.updateFiles({hdl:s.hdl,tst:null!==(t=s.tst)&&void 0!==t?t:h,cmp:null!==(e=s.cmp)&&void 0!==e?e:p})},(0,r.useEffect)((()=>{y.current({tst:h,cmp:p}),o.reset()}),[h,p]);const j=(0,r.useRef)();(0,r.useEffect)((()=>(j.current=new class extends ae.B{async reset(){await y.current(),await o.reset()}finishFrame(){super.finishFrame(),l.current({action:"updateTestStep"})}async tick(){return await o.stepTest()}toggle(){l.current({action:"updateTestStep"})}},()=>{var t;null===(t=j.current)||void 0===t||t.stop()})),[y,o,l]);const w=(0,r.useMemo)((()=>({toggle(){o.clock(),e.trackEvent("action","toggleClock")},reset(){e.trackEvent("action","resetClock"),o.reset()}})),[o]),C=(0,r.useRef)(null),[P,V]=(0,r.useState)(!1),k=(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("fieldset",{role:"group",children:[(0,a.jsx)("select",{value:s.controls.project,onChange:t=>{let{target:{value:e}}=t;b(e)},"data-testid":"project-picker",children:Qt.map((t=>{let[e,s]=t;return(0,a.jsx)("option",{value:e,children:s},e)}))}),(0,a.jsx)("select",{value:s.controls.chipName,onChange:t=>{let{target:{value:e}}=t;x(e)},"data-testid":"chip-picker",children:s.controls.chips.map((t=>(0,a.jsx)("option",{value:t,style:ee(t)?{color:"rgb(170, 170, 170)"}:{},children:`${t} ${ee(t)?"(given)":""}`},t)))}),(0,a.jsx)("a",{ref:C,style:{display:"none"}}),!P&&!s.controls.builtinOnly&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{className:"flex-0",onClick:o.resetFile,children:(0,a.jsx)(i.cC,{id:"Reset"})}),(0,a.jsx)("button",{className:"flex-0",onClick:async()=>{if(!C.current)return;const t=await o.getProjectFiles(),e=new(le());for(const s of t)e.file(s.name,s.content);const i=await e.generateAsync({type:"blob"}),n=URL.createObjectURL(i);C.current.href=n,C.current.download=`Project${s.controls.project}`,C.current.click(),URL.revokeObjectURL(n)},children:(0,a.jsx)(i.cC,{id:"Download"})})]})]})}),S=(0,a.jsx)(de.s,{className:"_hdl_panel",header:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{tabIndex:0,children:"HDL"}),(0,a.jsx)("fieldset",{children:s.controls.hasBuiltin&&!s.controls.builtinOnly&&(0,a.jsxs)("label",{children:[(0,a.jsx)("input",{type:"checkbox",role:"switch",checked:P,onChange:()=>{P?(V(!1),o.useBuiltin(!1)):(V(!0),o.useBuiltin(!0,c)),U.reset()}}),(0,a.jsx)(i.cC,{id:"Builtin"})]})}),k]}),children:(0,a.jsx)(he.M,{className:"flex-1",value:c,error:s.controls.error,onChange:async t=>{u(t),P||await o.saveChip(t),y.current(P||s.controls.builtinOnly?{}:{hdl:t})},grammar:Wt.parser,language:"hdl",disabled:P||s.controls.builtinOnly})}),[A,I]=(0,r.useState)(!0),E=()=>{t(n.ag._("Cannot test a chip that has syntax errors"))},O=()=>{y.current(P||s.controls.builtinOnly?{}:{hdl:c})},M=()=>{s.sim.invalid?E():v()},F=(0,a.jsxs)("fieldset",{role:"group",children:[(0,a.jsx)("button",{onClick:M,onKeyDown:M,onBlur:O,disabled:!s.sim.pending||!A,children:(0,a.jsx)(i.cC,{id:"Eval"})}),(0,a.jsxs)("button",{onClick:()=>{s.sim.invalid?E():w.toggle()},onBlur:O,style:{maxWidth:"initial"},disabled:!s.sim.clocked,children:[(0,a.jsx)(i.cC,{id:"Clock"}),":","\xa0",(0,a.jsx)(bt.uY,{})]}),(0,a.jsx)("button",{onClick:()=>{s.sim.invalid?E():w.reset()},onBlur:O,style:{maxWidth:"initial"},disabled:!s.sim.clocked,children:(0,a.jsx)(i.cC,{id:"Reset"})})]}),R=function(t,e){return[...t.parts].map(((t,s)=>[`${t.id}_${s}`,ft(t,e)])).filter((t=>{let[e,s]=t;return void 0!==s}))}({parts:s.sim.chip},(()=>{l.current({action:"updateChip"})})),U=new St,$=(0,a.jsx)(de.s,{className:"_parts_panel",header:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(i.cC,{id:"Chip"})," ",s.controls.chipName]}),F]}),children:s.sim.invalid?(0,a.jsx)(i.cC,{id:"Syntax errors in the HDL code or test"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(jt.Provider,{value:U,children:(0,a.jsx)(Pt,{sim:s.sim,toggle:o.toggle,setInputValid:I,hideInternal:s.controls.builtinOnly||P})}),R.length>0&&(0,a.jsx)(de.G,{summary:(0,a.jsx)(i.cC,{id:"Visualization"}),open:!0,children:(0,a.jsx)("main",{children:R.map((t=>{let[e,s]=t;return s}))})})]})}),W=(0,a.jsx)(ce.F,{runner:j,disabled:s.sim.invalid,tst:[h,d,s.controls.span],cmp:[p,g],out:[m,f]});return(0,a.jsxs)("div",{className:"Page ChipPage grid",children:[S,$,W]})},ge=pe},3583:(t,e,s)=>{s.d(e,{m:()=>i});function i(t){if(!t.message)return{message:"HDL statement has a syntax error",span:t.span};const e=t.message.match(/Line \d+, col \d+: (?<message>.*)/);return void 0!==e?.groups?.message?{message:e.groups.message,span:t.span}:{message:t.message,span:t.span}}}}]);