"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[604],{4604:(e,t,s)=>{s.r(t),s.d(t,{Asm:()=>C,default:()=>j});var n=s(8061),i=s(258),r=s(4625),a=s(5838),o=s(1845),l=s(326),c=s(6167),u=s(7559),d=s(8698);class h{asm=null;current=-1;done=!1;symbols=[];hiddenSymbols=new Map;result="";load(e){this.symbols=[["R0","0"],["R1","1"],["R2","2"],["...",""],["R15","15"],["SCREEN",a.GD.toString()],["KBD",a.eu.toString()]],this.hiddenSymbols.clear(),this.asm=e,(0,o.$o)(e,((e,t,s)=>{s?this.hiddenSymbols.set(t,[e,!1]):this.symbols.push([e,t.toString()])})),e.instructions=e.instructions.filter((e=>"L"!==e.type)),this.reset()}step(e){if(null===this.asm||this.current>=this.asm.instructions.length-1)return;this.current++;const t=this.asm.instructions[this.current];if("A"===t.type||"C"===t.type){e.sourceHighlight=t.span;const s=(0,o.Y_)(this.asm.instructions[this.current]);if(void 0===s)return;if(this.result+=`${(0,l.Ly)(s)}\n`,e.resultHighlight={start:17*this.current,end:17*(this.current+1)},e.highlightMap.set(t.span,e.resultHighlight),"A"===t.type&&(0,o.w_)(t)){const e=this.hiddenSymbols.get(t.value);void 0==e||e[1]||(console.log("value",t.value,"name",e[0]),this.symbols.push([e[0],t.value.toString()]),console.log(this.symbols),this.hiddenSymbols.set(t.value,[e[0],!0]))}this.current===this.asm.instructions.length-1&&(this.done=!0)}}resetSymbols(){const e=new Set;for(const[t,s]of this.hiddenSymbols)e.add(s[0]),this.hiddenSymbols.set(t,[s[0],!1]);this.symbols=this.symbols.filter((t=>!e.has(t[0])))}reset(){this.current=-1,this.result="",this.done=!1,this.resetSymbols()}}function g(){const{setStatus:e}=(0,c.useContext)(d.r),t=(0,c.useRef)((()=>{})),{initialState:s,reducers:n,actions:i}=(0,c.useMemo)((()=>function(e,t){const s=new h,n={resultHighlight:void 0,sourceHighlight:void 0,highlightMap:new Map},i={setAsm(e,t){let{asm:s}=t;e.asm=s},setCmp(t,s){let{cmp:n}=s;t.compare=n,e("Loaded compare file")},update(e){e.current=s.current,e.result=s.result,e.symbols=Array.from(s.symbols),e.sourceHighlight=n.sourceHighlight,e.resultHighlight=n.resultHighlight},compare(t){t.result===t.compare?e("Comparison successful"):e("Comparison failed")}},a={loadAsm(n){t.current({action:"setAsm",payload:{asm:n}});const i=o.Ww.parse(n);(0,r.dZ)(i)?e(`Error parsing asm file - ${(0,r.UG)(i).message}`):(s.load((0,r.Ok)(i)),t.current({action:"update"}),e("Loaded asm file"))},step:()=>(s.step(n),t.current({action:"update"}),s.done&&e("Translation done."),s.done),updateHighlight(e,s){for(const[t,i]of n.highlightMap)(s&&t.start<=e&&e<=t.end||!s&&i.start<=e&&e<=i.end)&&(n.sourceHighlight=t,n.resultHighlight=i);t.current({action:"update"})},resetHighlightInfo(){n.sourceHighlight=void 0,n.resultHighlight=void 0,n.highlightMap.clear()},reset(){s.reset(),this.resetHighlightInfo(),t.current({action:"update"})}};return{initialState:{asm:"",current:-1,resultHighlight:void 0,sourceHighlight:void 0,symbols:[],result:"",compare:""},reducers:i,actions:a}}(e,t)),[e,t]),[a,l]=(0,u.C)(n,s);return t.current=l,{state:a,dispatch:t,actions:i}}var m=s(7878),p=s(8039);const f=e=>{let{values:t=[],highlight:s=-1,onClick:n}=e;return(0,m.jsx)("div",{children:t.map(((e,t)=>(0,m.jsx)(v,{identifier:e[0],value:e[1],highlight:t===s,onClick:()=>n?.(e[0],e[1])},t)))})},v=e=>{let{identifier:t,value:s,highlight:n=!1,onClick:i}=e;return(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center"},onClick:i,children:[t.length>0&&(0,m.jsx)("code",{style:{flex:"1",...(0,p.eP)("none"),...n?{background:"var(--mark-background-color)"}:{},whiteSpace:"pre",padding:"3px"},children:t}),s.length>0&&(0,m.jsx)("code",{style:{flex:"1",textAlign:"right",color:"black",padding:"3px",...(0,p.eP)("none"),...n?{background:"var(--mark-background-color)"}:{}},children:s})]})};var x=s(8923),b=s(1539),y=s(1124);const C=()=>{const{state:e,actions:t,dispatch:s}=g(),[r,a]=(0,c.useState)(""),[l,u]=(0,c.useState)(""),h=(0,c.useRef)(0),p=(0,c.useRef)(0),v=(0,c.useRef)(),[C,j]=(0,c.useState)(!1);(0,c.useEffect)((()=>(v.current=new class extends x.B{tick(){return h.current=0,p.current=0,t.step()}reset(){t.reset()}toggle(){}},j(!0),()=>{var e;null===(e=v.current)||void 0===e||e.stop()})),[t,s]);const k=(0,c.useRef)(null),S=(0,c.useRef)(null);let M="asm";const{setStatus:H}=(0,c.useContext)(d.r);return(0,m.jsxs)("div",{className:"AsmPage grid",children:[(0,m.jsx)(y.s,{className:"source",header:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{children:[(0,m.jsx)(n.cC,{id:"Source"}),r&&`: ${r}`]}),(0,m.jsx)("input",{type:"file",style:{display:"none"},ref:k,onChange:async e=>{var n;if(null===(n=e.target.files)||void 0===n||!n.length)return void H("No file selected");const i=e.target.files[0],r=await i.text();if("asm"===M){if(!i.name.endsWith(".asm"))return void H("File must be .asm file");t.loadAsm(r),a(i.name)}else{if(!i.name.endsWith(".hack"))return void H("File must be .hack file");s.current({action:"setCmp",payload:{cmp:r}}),u(i.name)}}}),(0,m.jsx)("div",{className:"flex-1",children:C&&v.current&&(0,m.jsx)(i.D,{runner:v.current,prefix:(0,m.jsx)("button",{className:"flex-0",onClick:()=>{var e;M="asm",null===(e=k.current)||void 0===e||e.click()},"data-tooltip":"Load file","data-placement":"bottom",children:"\ud83d\udcc2"}),overrideTooltips:["Translate","Translate all"]})})]}),children:(0,m.jsx)(b.M,{value:e.asm,onChange:e=>{},onCursorPositionChange:e=>{e!=h.current&&(h.current=e,t.updateHighlight(e,!0))},grammar:o.Ww.parser,language:"asm",highlight:e.sourceHighlight,disabled:!0})}),(0,m.jsxs)(y.s,{className:"result",header:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{children:(0,m.jsx)(n.cC,{id:"Binary Code"})}),(0,m.jsx)("div",{children:(0,m.jsxs)("fieldset",{role:"group",children:[(0,m.jsx)("a",{ref:S,style:{display:"none"}}),(0,m.jsx)("button",{onClick:()=>{const t=new Blob([e.result],{type:"text/plain"}),s=URL.createObjectURL(t);S.current&&(S.current.href=s,S.current.download=r.replace(".asm",".hack"),S.current.click(),URL.revokeObjectURL(s))},children:"Download"})]})})]}),children:[(0,m.jsx)(b.M,{value:e.result,highlight:e.resultHighlight,disabled:!0,onChange:function(e){},onCursorPositionChange:e=>{e!=p.current&&(p.current=e,t.updateHighlight(e,!1))},grammar:void 0,language:"",dynamicHeight:!0}),e.symbols.length>0&&"Symbol Table",(0,m.jsx)(f,{values:e.symbols})]}),(0,m.jsx)(y.s,{className:"compare",header:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{children:[(0,m.jsx)(n.cC,{id:"Compare"}),l&&`: ${l}`]}),(0,m.jsx)("div",{children:(0,m.jsxs)("fieldset",{role:"group",children:[(0,m.jsx)("button",{onClick:()=>{s.current({action:"compare"})},children:"Compare"}),(0,m.jsx)("button",{onClick:()=>{var e;M="cmp",null===(e=k.current)||void 0===e||e.click()},"data-tooltip":"Load file","data-placement":"left",children:"\ud83d\udcc2"})]})})]}),children:(0,m.jsx)(b.M,{value:e.compare,highlight:e.resultHighlight,disabled:!0,onChange:function(e){},onCursorPositionChange:e=>{e!=p.current&&(p.current=e,t.updateHighlight(e,!1))},language:""})})]})},j=C},1539:(e,t,s)=>{s.d(t,{M:()=>g});var n=s(8061),i=s(9659),r=s(7536),a=s(6167),o=s(8016),l=s(1510),c=s(7878);const u=e=>{var t,s;let{error:i}=e;return null!==i&&void 0!==i&&i.failed()?(0,c.jsxs)("details",{className:"ErrorPanel",open:!0,children:[(0,c.jsx)("summary",{role:"button",className:"secondary",children:(0,c.jsx)(n.cC,{id:"Parse Error"})}),(0,c.jsx)("pre",{children:(0,c.jsx)("code",{children:null!==(t=null!==(s=null===i||void 0===i?void 0:i.message)&&void 0!==s?s:null===i||void 0===i?void 0:i.shortMessage)&&void 0!==t?t:l.eP})})]}):(0,c.jsx)(c.Fragment,{})},d=e=>{let{value:t,onChange:s,language:n,disabled:i=!1}=e;const[r,o]=(0,a.useState)(t);return(0,c.jsx)("textarea",{"data-testid":`editor-${n}`,disabled:i,value:r,onChange:e=>{var t;const n=null===(t=e.target)||void 0===t?void 0:t.value;o(n),s(n)}})},h=e=>{let{value:t,onChange:s,onCursorPositionChange:n,language:i,error:l,disabled:u=!1,highlight:d,dynamicHeight:h=!1}=e;const{theme:g}=(0,a.useContext)(o.Il),m=(0,r.Ik)(),[p,f]=(0,a.useState)(0),v=(0,a.useRef)(),x=(0,a.useRef)([]),b=(0,a.useRef)(void 0),y=(0,a.useCallback)((()=>("system"===g?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"===g)?"vs-dark":"vs"),[g]),C=(0,a.useCallback)((()=>{var e;x.current=((e,t,s,n)=>{if(!t||!s)return n;const i=t.getModel();if(!i)return n;const r=i.getPositionAt(s.start),a=i.getPositionAt(s.end),o=null===e||void 0===e?void 0:e.Range.fromPositions(r,a),l=[];return o&&(l.push({range:o,options:{inlineClassName:"highlight"}}),t.revealRangeInCenter(o)),t.deltaDecorations(n,l)})(m,v.current,null!==(e=b.current)&&void 0!==e?e:{start:0,end:0},x.current)}),[x,m,v,b]),j=()=>{if(h){var e;const t=null===(e=v.current)||void 0===e?void 0:e.getContentHeight();t&&f(t)}};(0,a.useEffect)((()=>{b.current=d,C()}),[d]);const k=(0,a.useCallback)((e=>{var t,s;v.current=e,null===(t=v.current)||void 0===t||t.updateOptions({fontFamily:'"JetBrains Mono", source-code-pro, Menlo, Monaco,\n      Consolas, "Roboto Mono", "Ubuntu Monospace", "Noto Mono", "Oxygen Mono",\n      "Liberation Mono", monospace, "Apple Color Emoji", "Segoe UI Emoji",\n      "Segoe UI Symbol", "Noto Color Emoji"',fontSize:16,minimap:{enabled:!1},theme:y(),scrollBeyondLastLine:!1,readOnly:u}),C(),j(),null===(s=v.current)||void 0===s||s.onDidChangeCursorPosition((e=>{var t,s;const i=null===(t=v.current)||void 0===t||null===(s=t.getModel())||void 0===s?void 0:s.getOffsetAt(e.position);void 0!==i&&(null===n||void 0===n||n(i))}))}),[y]);(0,a.useEffect)((()=>{void 0!==v.current&&v.current.updateOptions({theme:y()})}),[v,y]),(0,a.useEffect)((()=>{void 0!==v.current&&v.current.updateOptions({readOnly:u})}),[v,u]),(0,a.useEffect)((()=>{var e,t,s,n,r;if(void 0===v.current)return;if(null===m)return;const a=v.current.getModel();if(null===a)return;if(void 0===l||l.succeeded())return void m.editor.setModelMarkers(a,i,[]);const{line:o,column:c,message:u}=null!==(e=null===(t=/Line (?<line>\d+), col (?<column>\d+): (?<message>.*)/.exec(null!==(s=l.shortMessage)&&void 0!==s?s:""))||void 0===t?void 0:t.groups)&&void 0!==e?e:{line:1,column:1,message:"could not parse error"},d=Number(o),h=d,g=Number(c);let p=g+(null!==(n=null===(r=a.getLineContent(d).substring(g-1).match(/([^\s]+)/))||void 0===r?void 0:r[0].length)&&void 0!==n?n:1);p<=g&&(p=g+1),m.editor.setModelMarkers(a,i,[{message:u,startColumn:g,startLineNumber:d,endColumn:p,endLineNumber:h,severity:8}])}),[l,v,m,i]);return(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(r.ZP,{value:t,onChange:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";j(),s(e)},language:i,onMount:k,height:h?p:void 0})})},g=e=>{let{className:t="",style:s={},disabled:n=!1,value:r,onChange:l,onCursorPositionChange:g,grammar:m,language:p,highlight:f,dynamicHeight:v=!1}=e;const[x,b]=(0,a.useState)(),{monaco:y}=(0,a.useContext)(o.Il),C=(0,a.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(m){const t=m.match(e);b(t.failed()?t:void 0)}}),[b,m]);(0,a.useEffect)((()=>C(r)),[C,r]);const j=(0,a.useMemo)((()=>(0,i.D)(C,500)),[C]),k=(0,a.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";l(e),j(e)}),[j,l]);return(0,c.jsx)("div",{className:`Editor ${v?"dynamic-height":""} ${t}`,style:s,children:y.canUse&&y.wants?(0,c.jsx)(h,{value:r,onChange:k,onCursorPositionChange:g,language:p,error:x,disabled:n,highlight:f,dynamicHeight:v}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(d,{value:r,onChange:k,language:p,disabled:n}),(0,c.jsx)(u,{error:x})]})})}},1124:(e,t,s)=>{s.d(t,{G:()=>r,s:()=>i});var n=s(7878);const i=e=>{var t;return(0,n.jsxs)("article",{className:["panel",null!==(t=e.className)&&void 0!==t?t:""].join(" "),children:[e.header&&(0,n.jsx)("header",{children:e.header}),(0,n.jsx)("main",{children:e.children}),e.footer&&(0,n.jsx)("footer",{children:e.footer})]})},r=e=>{var t;return(0,n.jsxs)("details",{className:null!==(t=e.className)&&void 0!==t?t:"",open:e.open,style:e.style,children:[(0,n.jsx)("summary",{children:(0,n.jsx)("div",{className:"flex row align-baseline",children:e.summary})}),e.children]})}},7559:(e,t,s)=>{s.d(t,{C:()=>r,i:()=>a});var n=s(1408),i=s(6167);function r(e,t){return(0,i.useReducer)(((t,s)=>(0,n.ZP)(t,(t=>{e[s.action](t,s.payload)}))),t)}function a(e){const[t,s]=(0,i.useState)(e);return(0,i.useEffect)((()=>{s(e)}),[e]),[t,s]}},258:(e,t,s)=>{s.d(t,{D:()=>a});var n=s(7878),i=s(6167),r=s(7559);const a=e=>{const t=function(e){const t=(0,i.useRef)((()=>{})),{initialState:s,reducers:n,actions:a}=(0,i.useMemo)((()=>((e,t)=>{const s={running:e.running,speed:e.speed,steps:e.steps},n=e.finishFrame.bind(e);return e.finishFrame=function(){n(),t.current({action:"update"})},{initialState:s,reducers:{update(t){t.running=e.running,t.speed=e.speed,t.steps=e.steps},setSteps(t,s){t.steps=s,e.steps=s},setSpeed(t,s){t.speed=s,e.speed=s}},actions:{frame(){e.frame()},start(){e.start(),t.current({action:"update"})},stop(){e.stop(),t.current({action:"update"})},reset(){e.reset(),t.current({action:"update"})}}}})(e,t)),[e,t]),[o,l]=(0,r.C)(n,s);return t.current=l,{state:o,dispatch:t.current,actions:a}}(e.runner),[s,a]=(0,i.useState)(0),o={0:[1e3,1],1:[500,1],2:[16,1],3:[16,16666],4:[16,499980]};(0,i.useEffect)((()=>{l()}),[s]);const l=()=>{const[e,n]=o[s];t.dispatch({action:"setSpeed",payload:e}),t.dispatch({action:"setSteps",payload:n})};return(0,n.jsxs)("fieldset",{role:"group",children:[e.prefix,(0,n.jsx)("button",{className:"flex-0",onClick:()=>t.actions.frame(),"data-tooltip":e.overrideTooltips?.[0]??"Step","data-placement":"bottom",children:"\u27a1\ufe0f"}),(0,n.jsx)("button",{className:"flex-0",onClick:()=>t.state.running?t.actions.stop():t.actions.start(),"data-tooltip":t.state.running?e.overrideTooltips?.[2]??"Pause":e.overrideTooltips?.[1]??"Run","data-placement":"bottom",children:t.state.running?"\u23f8":"\ufe0f\u23e9"}),(0,n.jsx)("button",{className:"flex-0",onClick:()=>t.actions.reset(),"data-tooltip":e.overrideTooltips?.[3]??"Reset","data-placement":"bottom",children:"\u23ee"}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:"normal"},children:[(0,n.jsx)("span",{style:{padding:"0.2rem"},children:"Slow"}),(0,n.jsx)("input",{type:"range",min:0,max:4,step:1,value:s,disabled:t.state.running,onChange:e=>{a(Number(e.target.value))},style:{width:"150px",padding:"0.2rem"},"data-tooltip":"Execution speed","data-placement":"bottom"}),(0,n.jsx)("span",{style:{padding:"0.2rem"},children:"Fast"})]}),e.children]})}},8923:(e,t,s)=>{s.d(t,{B:()=>i});const n=s(6531).S.get();class i{frame(){this.tick(),this.finishFrame()}finishFrame(){n.frame()}steps=1;speed=1e3;get running(){return this.#e}#e=!1;#t=0;#s=0;#n=async()=>{if(!this.#e)return;const e=Date.now(),t=e-this.#s;if(this.#s=e,this.#t+=t,this.#t>this.speed){let e=!1,t=this.steps;const s=`Timing ${t} steps`;for(console.time(s);!e&&t--;)e=this.tick();console.timeEnd(s),this.finishFrame(),e&&this.stop(),this.#t-=this.speed}requestAnimationFrame(this.#n)};start(){this.#e=!0,this.#s=Date.now()-this.speed,this.#n(),this.toggle()}stop(){this.#e=!1,this.toggle()}}}}]);
//# sourceMappingURL=604.7b546dce.chunk.js.map