{"version":3,"file":"static/js/885.3d1315a1.chunk.js","mappings":"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","sources":["../../components/src/chips/alu.tsx","../../components/src/chips/visualizations.tsx","../../components/src/pin_display.ts","../../components/src/pinout.tsx","../../components/src/stores/chip.store.ts","../../components/src/compare.ts","pages/chip.tsx"],"sourcesContent":["import {\n  COMMANDS_ALU,\n  COMMANDS_OP,\n  Flags,\n} from \"@nand2tetris/simulator/cpu/alu.js\";\n\nexport const ALUComponent = ({\n  A,\n  op,\n  D,\n  out,\n  flag,\n}: {\n  A: number;\n  op: COMMANDS_OP;\n  D: number;\n  out: number;\n  flag: keyof typeof Flags;\n}) => (\n  <div>\n    <span>ALU</span>\n    <svg width=\"250\" height=\"250\" xmlns=\"http://www.w3.org/2000/svg\">\n      <g>\n        <rect x=\"1\" y=\"20\" height=\"85\" width=\"70\" fill=\"black\" />\n        <rect x=\"1\" y=\"145\" height=\"85\" width=\"70\" fill=\"black\" />\n        <rect x=\"180\" y=\"95\" height=\"60\" width=\"70\" fill=\"black\" />\n        <polygon\n          points=\"70,10 180,85 180,165 70,240 70,135 90,125 70,115\"\n          stroke=\"#000\"\n          fill=\"#6D97AB\"\n        />\n        <text\n          xmlSpace=\"preserve\"\n          textAnchor=\"middle\"\n          fontFamily=\"Noto Sans JP\"\n          fontSize=\"14\"\n          strokeWidth=\"0\"\n          id=\"svg_9\"\n          y=\"63\"\n          x=\"35\"\n          stroke=\"white\"\n          fill=\"#ffffff\"\n        >\n          {A}\n        </text>\n        <text\n          xmlSpace=\"preserve\"\n          textAnchor=\"middle\"\n          fontFamily=\"Noto Sans JP\"\n          fontSize=\"14\"\n          id=\"svg_10\"\n          y=\"188\"\n          x=\"35\"\n          strokeWidth=\"0\"\n          stroke=\"white\"\n          fill=\"#ffffff\"\n        >\n          {D}\n        </text>\n        <text\n          xmlSpace=\"preserve\"\n          textAnchor=\"middle\"\n          fontFamily=\"Noto Sans JP\"\n          fontSize=\"14\"\n          id=\"svg_11\"\n          y=\"125\"\n          x=\"215\"\n          strokeWidth=\"0\"\n          stroke=\"white\"\n          fill=\"#ffffff\"\n        >\n          {out}\n        </text>\n        <text\n          xmlSpace=\"preserve\"\n          textAnchor=\"middle\"\n          fontFamily=\"Noto Sans JP\"\n          fontSize=\"14\"\n          id=\"svg_13\"\n          y=\"125\"\n          x=\"135\"\n          strokeWidth=\"0\"\n          stroke=\"white\"\n          fill=\"#ffffff\"\n        >\n          {COMMANDS_ALU.op[op] ?? \"(??)\"}\n        </text>\n      </g>\n    </svg>\n  </div>\n);\n","import {\n  CPU,\n  Keyboard,\n  ROM32K,\n  Screen,\n} from \"@nand2tetris/simulator/chip/builtins/computer/computer.js\";\nimport { ALU } from \"@nand2tetris/simulator/chip/builtins/index.js\";\nimport {\n  PC,\n  Register,\n} from \"@nand2tetris/simulator/chip/builtins/sequential/bit.js\";\nimport {\n  RAM,\n  RAM8,\n} from \"@nand2tetris/simulator/chip/builtins/sequential/ram.js\";\nimport { Chip, HIGH } from \"@nand2tetris/simulator/chip/chip.js\";\nimport { Flags } from \"@nand2tetris/simulator/cpu/alu.js\";\nimport { decode } from \"@nand2tetris/simulator/cpu/cpu.js\";\nimport { ReactElement } from \"react\";\nimport { ALUComponent } from \"./alu.js\";\nimport { Keyboard as KeyboardComponent } from \"./keyboard.js\";\nimport { Memory as MemoryComponent } from \"./memory.js\";\nimport { RegisterComponent } from \"./register.js\";\nimport { Screen as ScreenComponent } from \"./screen.js\";\n\nexport function getBuiltinVisualization(part: Chip): ReactElement | undefined {\n  switch (part.name) {\n    case \"Register\":\n    case \"ARegister\":\n    case \"DRegister\":\n    case \"PC\":\n    case \"KEYBOARD\":\n    case \"RAM8\":\n    case \"RAM64\":\n    case \"RAM512\":\n    case \"RAM4K\":\n    case \"RAM16K\":\n    case \"ROM32K\":\n    case \"Screen\":\n    case \"Memory\":\n    default:\n      return undefined;\n  }\n}\n\nexport function makeVisualization(\n  chip: Chip,\n  updateAction?: () => void\n): ReactElement | undefined {\n  if (chip instanceof ALU) {\n    return (\n      <ALUComponent\n        A={chip.in(\"x\").busVoltage}\n        op={chip.op()}\n        D={chip.in(\"y\").busVoltage}\n        out={chip.out().busVoltage}\n        flag={\n          (chip.out(\"zr\").voltage() === HIGH\n            ? Flags.Zero\n            : chip.out(\"ng\").voltage() === HIGH\n            ? Flags.Negative\n            : Flags.Positive) as keyof typeof Flags\n        }\n      />\n    );\n  }\n  if (chip instanceof Register) {\n    return (\n      <RegisterComponent\n        name={chip.name ?? `Chip ${chip.id}`}\n        bits={chip.bits}\n      />\n    );\n  }\n  if (chip instanceof PC) {\n    return <RegisterComponent name=\"PC\" bits={chip.bits} />;\n  }\n  if (chip instanceof Keyboard) {\n    return <KeyboardComponent keyboard={chip} update={updateAction} />;\n  }\n  if (chip instanceof Screen) {\n    return <ScreenComponent memory={chip.memory} />;\n  }\n  if (chip instanceof RAM) {\n    return (\n      <MemoryComponent\n        name={chip.name}\n        memory={chip.memory}\n        format={chip instanceof ROM32K ? \"asm\" : \"dec\"}\n        highlight={chip.address}\n      />\n    );\n  }\n  if (chip instanceof RAM8) {\n    return <span>RAM {chip.width}</span>;\n  }\n  if (chip instanceof CPU) {\n    const bits = decode(chip.in(\"instruction\").busVoltage);\n    return (\n      <>\n        <RegisterComponent name={\"A\"} bits={chip.state.A} />\n        <RegisterComponent name={\"D\"} bits={chip.state.D} />\n        <RegisterComponent name={\"PC\"} bits={chip.state.PC} />\n        <ALUComponent\n          A={bits.am ? chip.in(\"inM\").busVoltage : chip.state.A}\n          D={chip.state.D}\n          out={chip.state.ALU}\n          op={bits.op}\n          flag={chip.state.flag as keyof typeof Flags}\n        />\n      </>\n    );\n  }\n\n  const vis = [...chip.parts]\n    .map((chip) => makeVisualization(chip, updateAction))\n    .filter((v) => v !== undefined);\n  return vis.length > 0 ? <>{vis}</> : undefined;\n}\n\nexport function makeVisualizationsWithId(\n  chip: {\n    parts: Chip[];\n  },\n  updateAction?: () => void\n): [string, ReactElement][] {\n  return [...chip.parts]\n    .map((part, i): [string, ReactElement | undefined] => [\n      `${part.id}_${i}`,\n      makeVisualization(part, updateAction),\n    ])\n    .filter(([_, v]) => v !== undefined) as [string, ReactElement][];\n}\n","import { Ok, isOk } from \"@davidsouther/jiffies/lib/esm/result.js\";\nimport {\n  REGISTRY as BUILTIN_REGISTRY,\n  getBuiltinChip,\n} from \"@nand2tetris/simulator/chip/builtins/index.js\";\n\nexport class ChipDisplayInfo {\n  signBehaviors: Map<string, boolean> = new Map();\n\n  public constructor(chipName: string, unsigned?: string[]) {\n    if (BUILTIN_REGISTRY.has(chipName)) {\n      const chip = getBuiltinChip(chipName);\n      if (isOk(chip)) {\n        const pins = Array.from(Ok(chip).ins.entries()).concat(\n          Array.from(Ok(chip).outs.entries())\n        );\n        for (const pin of pins) {\n          this.signBehaviors.set(\n            pin.name,\n            !unsigned || !unsigned.includes(pin.name)\n          );\n        }\n      }\n    }\n  }\n\n  public isSigned(pin: string) {\n    return this.signBehaviors.get(pin);\n  }\n}\n\nconst UNSIGNED_PINS = new Map<string, string[]>([\n  [\"Mux4Way16\", [\"sel\"]],\n  [\"Mux8Way16\", [\"sel\"]],\n  [\"DMux4Way\", [\"sel\"]],\n  [\"DMux8Way\", [\"sel\"]],\n  [\"RAM8\", [\"address\"]],\n  [\"RAM64\", [\"address\"]],\n  [\"RAM512\", [\"address\"]],\n  [\"RAM4K\", [\"address\"]],\n  [\"RAM16K\", [\"address\"]],\n  [\"Screen\", [\"address\"]],\n  [\"Memory\", [\"address\"]],\n  [\"CPU\", [\"addressM\", \"pc\"]],\n]);\n\nexport const getDisplayInfo = (chipName: string) =>\n  new ChipDisplayInfo(chipName, UNSIGNED_PINS.get(chipName));\n","// import { plural, Trans } from \"@lingui/macro\";\nimport {\n  Pin as ChipPin,\n  Pins,\n  Voltage,\n} from \"@nand2tetris/simulator/chip/chip.js\";\nimport { range } from \"@davidsouther/jiffies/lib/esm/range.js\";\nimport { ChipSim } from \"./stores/chip.store.js\";\nimport { createContext, useContext, useEffect, useState } from \"react\";\nimport { ChipDisplayInfo, getDisplayInfo } from \"./pin_display.js\";\n\nexport const PinContext = createContext({});\n\nexport interface ImmPin {\n  bits: [number, Voltage][];\n  pin: ChipPin;\n}\n\nexport function reducePin(pin: ChipPin) {\n  return {\n    pin,\n    bits: range(0, pin.width)\n      .map((i) => [i, pin.voltage(i)] as [number, Voltage])\n      .reverse(),\n  };\n}\n\nexport function reducePins(pins: Pins): ImmPin[] {\n  return [...pins.entries()].map(reducePin);\n}\n\nexport interface PinoutPins {\n  pins: ImmPin[];\n  toggle?: (pin: ChipPin, bit?: number) => void;\n}\n\nexport const FullPinout = (props: {\n  sim: ChipSim;\n  toggle: (pin: ChipPin, i: number | undefined) => void;\n  setInputValid: (pending: boolean) => void;\n  hideInternal?: boolean;\n}) => {\n  const { inPins, outPins, internalPins } = props.sim;\n  const displayInfo = getDisplayInfo(props.sim.chip[0].name ?? \"\");\n  return (\n    <>\n      <style>{`\n        table.pinout th {\n          font-weight: bold;\n        }\n\n        table.pinout tbody td:first-child {\n          text-align: right;\n          --font-size: 1rem;\n          width: 0;\n          white-space: nowrap;\n          border-right: var(--border-width) solid var(--table-border-color);\n        }\n\n        table.pinout tbody button {\n          --font-size: 0.875em;\n          font-family: var(--font-family-monospace);\n          max-width: 2em;\n        }\n        `}</style>\n      <table className=\"pinout\">\n        <tbody>\n          <PinoutBlock\n            pins={inPins}\n            header=\"Input pins\"\n            toggle={props.toggle}\n            setInputValid={props.setInputValid}\n            displayInfo={displayInfo}\n          />\n          <PinoutBlock\n            pins={outPins}\n            header=\"Output pins\"\n            disabled={props.sim.pending}\n            enableEdit={false}\n            displayInfo={displayInfo}\n          />\n          {!props.hideInternal && (\n            <PinoutBlock\n              pins={internalPins}\n              header=\"Internal pins\"\n              disabled={props.sim.pending}\n              enableEdit={false}\n              displayInfo={displayInfo}\n            />\n          )}\n        </tbody>\n      </table>\n    </>\n  );\n};\n\nexport const PinoutBlock = (\n  props: PinoutPins & {\n    header: string;\n    disabled?: boolean;\n    enableEdit?: boolean;\n    setInputValid?: (valid: boolean) => void;\n    displayInfo: ChipDisplayInfo;\n  }\n) => (\n  <>\n    {props.pins.length > 0 && (\n      <tr>\n        <th colSpan={2}>{props.header}</th>\n      </tr>\n    )}\n    {[...props.pins].map((immPin) => (\n      <tr key={immPin.pin.name}>\n        <td>{immPin.pin.name}</td>\n        <td>\n          <Pin\n            pin={immPin}\n            toggle={props.toggle}\n            disabled={props.disabled}\n            enableEdit={props.enableEdit}\n            signed={props.displayInfo.isSigned(immPin.pin.name)}\n            setInputValid={props.setInputValid}\n            internal={props.header === \"Internal pins\" ? true : false}\n          />\n        </td>\n      </tr>\n    ))}\n  </>\n);\n\nexport const Pinout = ({\n  pins,\n  toggle,\n}: {\n  pins: ImmPin[];\n  toggle?: (pin: ChipPin, bit?: number) => void;\n}) => {\n  if (pins.length === 0) {\n    return <>None</>;\n  }\n  return (\n    <table className=\"pinout\">\n      <thead>\n        <tr>\n          <th>Name</th>\n          <th>Value</th>\n        </tr>\n      </thead>\n      <tbody>\n        {[...pins].map((immPin) => (\n          <tr key={immPin.pin.name}>\n            <td>{immPin.pin.name}</td>\n            <td>\n              <Pin pin={immPin} toggle={toggle} internal />\n            </td>\n          </tr>\n        ))}\n      </tbody>\n    </table>\n  );\n};\n\nconst Pin = ({\n  pin,\n  toggle,\n  disabled = false,\n  enableEdit = true,\n  signed = true,\n  setInputValid,\n  internal = false,\n}: {\n  pin: ImmPin;\n  toggle: ((pin: ChipPin, bit?: number) => void) | undefined;\n  disabled?: boolean;\n  enableEdit?: boolean;\n  signed?: boolean;\n  setInputValid?: (valid: boolean) => void;\n  internal: boolean;\n}) => {\n  const [isBin, setIsBin] = useState(true);\n  let inputValid = true;\n  const [decimal, setDecimal] = useState(\"\");\n\n  const toggleBin = () => {\n    setIsBin(!isBin);\n  };\n\n  const resetDispatcher = useContext(PinContext);\n  if (resetDispatcher instanceof PinResetDispatcher) {\n    resetDispatcher.registerCallback(() => {\n      setIsBin(true);\n    });\n  }\n\n  const setInputValidity = (valid: boolean) => {\n    inputValid = valid;\n    setInputValid?.(valid);\n  };\n\n  const handleDecimalChange = (value: string) => {\n    const positive = value.replace(/[^\\d]/g, \"\");\n    const numeric = signed && value[0] === \"-\" ? `-${positive}` : positive;\n\n    setDecimal(numeric);\n    if (isNaN(parseInt(numeric))) {\n      setInputValidity(false);\n    } else {\n      const newValue = parseInt(numeric);\n      if (\n        (!signed && newValue >= Math.pow(2, pin.bits.length)) ||\n        (signed &&\n          (newValue >= Math.pow(2, pin.bits.length - 1) ||\n            newValue < -Math.pow(2, pin.bits.length - 1)))\n      ) {\n        setInputValidity(false);\n      } else {\n        updatePins(newValue);\n        setInputValidity(true);\n      }\n    }\n  };\n\n  const updatePins = (n: number) => {\n    for (let i = 0; i < pin.bits.length; i++) {\n      if (pin.bits[pin.bits.length - i - 1][1] !== ((n >> i) & 1)) {\n        toggle?.(pin.pin, i);\n      }\n    }\n  };\n\n  useEffect(() => {\n    if (!isBin && inputValid) {\n      let value = 0;\n      if (signed && pin.bits[0][1]) {\n        // negative\n        for (const [i, v] of pin.bits) {\n          if (i < pin.bits.length - 1 && !v) {\n            value += 2 ** i;\n          }\n        }\n        value = -value - 1;\n      } else {\n        // positive\n        const limit = signed ? pin.bits.length - 1 : pin.bits.length;\n        for (const [i, v] of pin.bits) {\n          if (i < limit && v) {\n            value += 2 ** i;\n          }\n        }\n      }\n      setDecimal(value.toString());\n    }\n  }, [pin, isBin]);\n\n  return (\n    <div\n      style={{ display: \"flex\", flexDirection: \"row\", alignItems: \"center\" }}\n    >\n      <fieldset role=\"group\" style={{ width: `${pin.bits.length}rem` }}>\n        {isBin ? (\n          pin.bits.map(([i, v]) => (\n            <button\n              key={i}\n              disabled={disabled}\n              style={internal ? { backgroundColor: \"grey\" } : {}}\n              onClick={() => toggle?.(pin.pin, i)}\n              data-testid={`pin-${i}`}\n            >\n              {v}\n            </button>\n          ))\n        ) : (\n          <input\n            className=\"colored\"\n            value={decimal}\n            onChange={(e) => {\n              handleDecimalChange(e.target.value);\n            }}\n            disabled={!enableEdit}\n          />\n        )}\n      </fieldset>\n      {pin.bits.length > 1 && (\n        <>\n          <div style={{ width: \"1em\" }} />\n          <button\n            style={{ maxWidth: \"3em\", margin: 0 }}\n            onClick={() => toggleBin()}\n          >\n            {isBin ? \"dec\" : \"bin\"}\n          </button>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport class PinResetDispatcher {\n  private callbacks: (() => void)[] = [];\n\n  registerCallback(callback: () => void) {\n    this.callbacks.push(callback);\n  }\n\n  reset() {\n    for (const callback of this.callbacks) {\n      callback();\n    }\n  }\n}\n","import { display } from \"@davidsouther/jiffies/lib/esm/display.js\";\nimport { FileSystem } from \"@davidsouther/jiffies/lib/esm/fs.js\";\nimport { Err, isErr, Ok } from \"@davidsouther/jiffies/lib/esm/result.js\";\nimport { Dispatch, MutableRefObject, useContext, useMemo, useRef } from \"react\";\n\nimport { build as buildChip } from \"@nand2tetris/simulator/chip/builder.js\";\nimport {\n  getBuiltinChip,\n  REGISTRY,\n} from \"@nand2tetris/simulator/chip/builtins/index.js\";\nimport {\n  Chip,\n  Chip as SimChip,\n  Low,\n  Pin,\n} from \"@nand2tetris/simulator/chip/chip.js\";\nimport { Clock } from \"@nand2tetris/simulator/chip/clock.js\";\nimport { Span } from \"@nand2tetris/simulator/languages/base.js\";\nimport { HDL } from \"@nand2tetris/simulator/languages/hdl.js\";\nimport { TST } from \"@nand2tetris/simulator/languages/tst.js\";\nimport {\n  BUILTIN_CHIP_PROJECTS,\n  CHIP_ORDER,\n  CHIP_PROJECTS,\n  ChipProjects,\n} from \"@nand2tetris/projects/index.js\";\nimport { ChipTest } from \"@nand2tetris/simulator/tst.js\";\n\nimport { ImmPin, reducePins } from \"../pinout.js\";\nimport { useImmerReducer } from \"../react.js\";\n\nimport { BaseContext } from \"./base.context.js\";\nimport { assert } from \"@davidsouther/jiffies/lib/esm/assert.js\";\nimport { compare } from \"../compare.js\";\n\nexport const PROJECT_NAMES = [\n  [\"01\", `Project 1`],\n  [\"02\", `Project 2`],\n  [\"03\", `Project 3`],\n  [\"05\", `Project 5`],\n];\n\nfunction getChips(project: keyof typeof CHIP_PROJECTS) {\n  return project in CHIP_ORDER\n    ? (CHIP_ORDER as Record<typeof project, string[]>)[project]\n    : BUILTIN_CHIP_PROJECTS[project].concat(CHIP_PROJECTS[project]);\n}\n\nfunction findDropdowns(storage: Record<string, string>) {\n  const project =\n    (storage[\"/chip/project\"] as keyof typeof CHIP_PROJECTS) ?? \"01\";\n  const chips = getChips(project);\n  const chipName = storage[\"/chip/chip\"] ?? CHIP_PROJECTS[project][0];\n  return { project, chips, chipName };\n}\n\nfunction makeHdl(name: string) {\n  return `CHIP ${name} {\n  IN in;\n  OUT out;\n  PARTS:\n}`;\n}\n\nfunction makeTst() {\n  return `repeat 10 {\n  tick,\n  tock;\n}`;\n}\n\nfunction makeCmp() {\n  return `| in|out|`;\n}\n\nexport function isBuiltinOnly(chipName: string) {\n  return Object.values(BUILTIN_CHIP_PROJECTS).flat().includes(chipName);\n}\n\nfunction getTemplate(project: keyof typeof CHIP_PROJECTS, chipName: string) {\n  if (isBuiltinOnly(chipName)) {\n    return (ChipProjects[project].BUILTIN_CHIPS as Record<string, string>)[\n      chipName\n    ];\n  }\n\n  return (\n    ChipProjects[project].CHIPS as Record<string, Record<string, string>>\n  )[chipName][`${chipName}.hdl`] as string;\n}\n\nfunction getBuiltinCode(project: keyof typeof CHIP_PROJECTS, chipName: string) {\n  const template = getTemplate(project, chipName);\n  if (isBuiltinOnly(chipName)) {\n    return template;\n  }\n  const bodyComment = \"//// Replace this comment with your code.\";\n  const builtinLine = `BUILTIN ${chipName};`;\n  const builtinCode = template.includes(bodyComment)\n    ? template.replace(bodyComment, builtinLine)\n    : template.replace(\"PARTS:\", `PARTS:\\n    ${builtinLine}`);\n  return builtinCode;\n}\n\nexport interface ChipPageState {\n  files: Files;\n  sim: ChipSim;\n  controls: ControlsState;\n}\n\nexport interface ChipSim {\n  clocked: boolean;\n  inPins: ImmPin[];\n  outPins: ImmPin[];\n  internalPins: ImmPin[];\n  chip: [Chip];\n  pending: boolean;\n  invalid: boolean;\n}\n\nexport interface Files {\n  hdl: string;\n  cmp: string;\n  tst: string;\n  out: string;\n}\n\nexport interface ControlsState {\n  project: keyof typeof CHIP_PROJECTS;\n  chips: string[];\n  chipName: string;\n  hasBuiltin: boolean;\n  builtinOnly: boolean;\n  runningTest: boolean;\n  span?: Span;\n  error: string;\n}\n\nfunction reduceChip(chip: SimChip, pending = false, invalid = false): ChipSim {\n  return {\n    clocked: chip.clocked,\n    inPins: reducePins(chip.ins),\n    outPins: reducePins(chip.outs),\n    internalPins: reducePins(chip.pins),\n    chip: [chip],\n    pending,\n    invalid,\n  };\n}\n\nconst clock = Clock.get();\n\nexport type ChipStoreDispatch = Dispatch<{\n  action: keyof ReturnType<typeof makeChipStore>[\"reducers\"];\n  payload?: unknown;\n}>;\n\nexport function makeChipStore(\n  fs: FileSystem,\n  setStatus: (status: string) => void,\n  storage: Record<string, string>,\n  dispatch: MutableRefObject<ChipStoreDispatch>\n) {\n  const dropdowns = findDropdowns(storage);\n  let { project, chipName } = dropdowns;\n  const { chips } = dropdowns;\n  let chip = new Low();\n  let test = new ChipTest();\n  let usingBuiltin = false;\n  let builtinOnly = false;\n\n  const reducers = {\n    setFiles(\n      state: ChipPageState,\n      {\n        hdl = state.files.hdl,\n        tst = state.files.tst,\n        cmp = state.files.cmp,\n        out = \"\",\n      }: {\n        hdl?: string;\n        tst?: string;\n        cmp?: string;\n        out?: string;\n      }\n    ) {\n      state.files.hdl = hdl;\n      state.files.tst = tst;\n      state.files.cmp = cmp;\n      state.files.out = out;\n    },\n\n    updateChip(\n      state: ChipPageState,\n      payload?: {\n        pending?: boolean;\n        invalid?: boolean;\n        chipName?: string;\n        error?: string;\n      }\n    ) {\n      state.sim = reduceChip(\n        chip,\n        payload?.pending ?? state.sim.pending,\n        payload?.invalid ?? state.sim.invalid\n      );\n      state.controls.error = state.sim.invalid\n        ? payload?.error ?? state.controls.error\n        : \"\";\n      state.controls.chips = getChips(state.controls.project);\n      state.controls.chipName = state.sim.invalid\n        ? payload?.chipName ?? chipName\n        : chip.name ?? payload?.chipName ?? chipName;\n      if (!state.controls.chips.includes(state.controls.chipName)) {\n        state.controls.chips = [\n          ...state.controls.chips,\n          state.controls.chipName,\n        ];\n      }\n    },\n\n    setProject(state: ChipPageState, project: keyof typeof CHIP_PROJECTS) {\n      const chips = getChips(project);\n      const chipName =\n        state.controls.chipName && chips.includes(state.controls.chipName)\n          ? state.controls.chipName\n          : chips[0];\n      state.controls.project = project;\n      state.controls.chips = chips;\n      this.setChip(state, chipName);\n    },\n\n    setChip(state: ChipPageState, chipName: string) {\n      state.controls.chipName = chipName;\n      state.controls.hasBuiltin = REGISTRY.has(chipName);\n      state.controls.builtinOnly = isBuiltinOnly(chipName);\n    },\n\n    testRunning(state: ChipPageState) {\n      state.controls.runningTest = true;\n    },\n\n    testFinished(state: ChipPageState) {\n      state.controls.runningTest = false;\n      const passed = compare(state.files.cmp.trim(), state.files.out.trim());\n      setStatus(\n        passed\n          ? `Simulation successful: The output file is identical to the compare file`\n          : `Simulation error: The output file differs from the compare file`\n      );\n    },\n\n    updateTestStep(state: ChipPageState) {\n      state.files.out = test?.log() ?? \"\";\n      if (test?.currentStep?.span) {\n        state.controls.span = test.currentStep.span;\n      } else {\n        if (test.done) {\n          const end = state.files.tst.length;\n          state.controls.span = {\n            start: end - 1,\n            end,\n          };\n        }\n      }\n      this.updateChip(state, {\n        pending: state.sim.pending,\n        invalid: state.sim.invalid,\n      });\n    },\n  };\n\n  const actions = {\n    setProject(p: keyof typeof CHIP_PROJECTS) {\n      project = storage[\"/chip/project\"] = p;\n      dispatch.current({ action: \"setProject\", payload: project });\n      this.setChip(CHIP_PROJECTS[project][0]);\n    },\n\n    async setChip(chip: string, project = storage[\"/chip/project\"] ?? \"01\") {\n      chipName = storage[\"/chip/chip\"] = chip;\n      dispatch.current({ action: \"setChip\", payload: chipName });\n      builtinOnly = isBuiltinOnly(chipName);\n\n      if (builtinOnly) {\n        dispatch.current({\n          action: \"setFiles\",\n          payload: { hdl: \"\", tst: \"\", cmp: \"\" },\n        });\n        this.useBuiltin();\n        return;\n      }\n      await this.loadChip(project, chipName);\n      if (usingBuiltin) {\n        this.useBuiltin();\n      }\n    },\n\n    reset() {\n      Clock.get().reset();\n      chip.reset();\n      test.reset();\n      dispatch.current({ action: \"setFiles\", payload: {} });\n      dispatch.current({ action: \"updateChip\" });\n    },\n\n    async updateFiles({\n      hdl,\n      tst,\n      cmp,\n    }: {\n      hdl?: string;\n      tst?: string;\n      cmp: string;\n    }) {\n      dispatch.current({ action: \"setFiles\", payload: { hdl, tst, cmp } });\n      try {\n        if (hdl) {\n          await this.compileChip(hdl);\n        }\n        if (tst) {\n          this.compileTest(tst);\n        }\n      } catch (e) {\n        setStatus(display(e));\n      }\n    },\n\n    async compileChip(hdl: string) {\n      chip.remove();\n      const maybeParsed = HDL.parse(hdl);\n      if (isErr(maybeParsed)) {\n        setStatus(\"Failed to parse chip\");\n        dispatch.current({\n          action: \"updateChip\",\n          payload: { invalid: true, error: display(Err(maybeParsed)) },\n        });\n        return;\n      }\n      const maybeChip = await buildChip(Ok(maybeParsed));\n      if (isErr(maybeChip)) {\n        const error = display(Err(maybeChip));\n        setStatus(error);\n        dispatch.current({\n          action: \"updateChip\",\n          payload: { invalid: true, error },\n        });\n        return;\n      }\n      setStatus(`Compiled ${chip.name}`);\n      this.replaceChip(Ok(maybeChip));\n    },\n\n    replaceChip(nextChip: SimChip) {\n      // Store current inPins\n      const inPins = chip.ins;\n      for (const [pin, { busVoltage }] of inPins) {\n        const nextPin = nextChip.ins.get(pin);\n        if (nextPin) {\n          nextPin.busVoltage = busVoltage;\n        }\n      }\n      clock.reset();\n      nextChip.eval();\n      chip = nextChip;\n      chip.reset();\n      test = test.with(chip).reset();\n      dispatch.current({ action: \"updateChip\", payload: { invalid: false } });\n      dispatch.current({ action: \"updateTestStep\" });\n    },\n\n    async loadChip(project: string, name: string) {\n      storage[\"/chip/chip\"] = name;\n      const fsName = (ext: string) =>\n        `/projects/${project}/${name}/${name}.${ext}`;\n\n      const [hdl, tst, cmp] = await Promise.all([\n        fs.readFile(fsName(\"hdl\")).catch(() => makeHdl(name)),\n        fs.readFile(fsName(\"tst\")).catch((e) => {\n          return makeTst();\n        }),\n        fs.readFile(fsName(\"cmp\")).catch(() => makeCmp()),\n      ]);\n\n      dispatch.current({ action: \"setFiles\", payload: { hdl, tst, cmp } });\n      await this.compileChip(hdl);\n      this.compileTest(tst);\n    },\n\n    async saveChip(hdl: string, prj = project, name = chipName) {\n      dispatch.current({ action: \"setFiles\", payload: { hdl } });\n      const path = `/projects/${prj}/${name}/${name}.hdl`;\n      await fs.writeFile(path, hdl);\n      setStatus(`Saved ${path}`);\n    },\n\n    toggle(pin: Pin, i: number | undefined) {\n      if (i !== undefined) {\n        pin.busVoltage = pin.busVoltage ^ (1 << i);\n      } else {\n        if (pin.width === 1) {\n          pin.toggle();\n        } else {\n          pin.busVoltage += 1;\n        }\n      }\n      dispatch.current({ action: \"updateChip\", payload: { pending: true } });\n    },\n\n    eval() {\n      chip.eval();\n      dispatch.current({ action: \"updateChip\", payload: { pending: false } });\n    },\n\n    clock() {\n      clock.toggle();\n      if (clock.isLow) {\n        clock.frame();\n      }\n      dispatch.current({ action: \"updateChip\" });\n    },\n\n    async useBuiltin(doUseBuiltin = true, oldHdl?: string) {\n      if (!doUseBuiltin) {\n        if (!builtinOnly) {\n          usingBuiltin = false;\n        }\n        await this.loadChip(project, chipName);\n        return;\n      }\n      if (!builtinOnly) {\n        usingBuiltin = true;\n      }\n      const builtinName = chipName;\n      const nextChip = getBuiltinChip(builtinName);\n      if (isErr(nextChip)) {\n        setStatus(\n          `Failed to load builtin ${builtinName}: ${display(Err(nextChip))}`\n        );\n        return;\n      }\n\n      // Save hdl code that will be overwritten by the switch\n      if (oldHdl) {\n        await this.saveChip(oldHdl, project, chipName);\n      }\n\n      const hdl = getBuiltinCode(project, builtinName);\n      dispatch.current({ action: \"setFiles\", payload: { hdl } });\n      this.replaceChip(Ok(nextChip));\n    },\n\n    async initialize() {\n      await this.setChip(chipName, project);\n    },\n\n    compileTest(file: string) {\n      dispatch.current({ action: \"setFiles\", payload: { tst: file } });\n      const tst = TST.parse(file);\n\n      if (isErr(tst)) {\n        setStatus(`Failed to parse test`);\n        return false;\n      }\n      setStatus(`Parsed tst`);\n\n      test = ChipTest.from(Ok(tst)).with(chip).reset();\n      test.setFileSystem(fs);\n      dispatch.current({ action: \"updateTestStep\" });\n      return true;\n    },\n\n    async runTest(file: string) {\n      if (!this.compileTest(file)) {\n        return;\n      }\n      dispatch.current({ action: \"testRunning\" });\n\n      fs.pushd(\"/samples\");\n      await test.run();\n      fs.popd();\n\n      dispatch.current({ action: \"updateTestStep\" });\n      dispatch.current({ action: \"testFinished\" });\n    },\n\n    tick(): boolean {\n      return this.stepTest();\n    },\n\n    stepTest(): boolean {\n      assert(test.chipId === chip.id, \"Test and chip out of sync\");\n      const done = test.step();\n      dispatch.current({ action: \"updateTestStep\" });\n      if (done) {\n        dispatch.current({ action: \"testFinished\" });\n      }\n      return done;\n    },\n  };\n\n  const initialState: ChipPageState = (() => {\n    const controls: ControlsState = {\n      project,\n      chips,\n      chipName,\n      hasBuiltin: REGISTRY.has(chipName),\n      builtinOnly: isBuiltinOnly(chipName),\n      runningTest: false,\n      error: \"\",\n    };\n\n    const maybeChip = getBuiltinChip(controls.chipName);\n    if (isErr(maybeChip)) {\n      setStatus(display(Err(maybeChip)));\n      chip = new Low();\n    } else {\n      chip = Ok(maybeChip);\n    }\n\n    const sim = reduceChip(chip);\n\n    return {\n      controls,\n      files: {\n        hdl: \"\",\n        cmp: \"\",\n        tst: \"\",\n        out: \"\",\n      },\n      sim,\n    };\n  })();\n\n  return { initialState, reducers, actions };\n}\n\nexport function useChipPageStore() {\n  const { fs, setStatus, storage } = useContext(BaseContext);\n\n  const dispatch = useRef<ChipStoreDispatch>(() => undefined);\n\n  const { initialState, reducers, actions } = useMemo(\n    () => makeChipStore(fs, setStatus, storage, dispatch),\n    [fs, setStatus, storage, dispatch]\n  );\n\n  const [state, dispatcher] = useImmerReducer(reducers, initialState);\n  dispatch.current = dispatcher;\n\n  return { state, dispatch, actions };\n}\n","import { isErr, Ok } from \"@davidsouther/jiffies/lib/esm/result.js\";\nimport { CMP } from \"@nand2tetris/simulator/languages/cmp.js\";\n\nexport const compare = (cmp: string, out: string) => {\n  const cmpResult = CMP.parse(cmp);\n  const outResult = CMP.parse(out);\n\n  if (isErr(cmpResult) || isErr(outResult)) {\n    return false;\n  }\n\n  const cmpData = Ok(cmpResult);\n  const outData = Ok(outResult);\n\n  for (let i = 0; i < Math.min(cmpData.length, outData.length); i++) {\n    const cmpI = cmpData[i] ?? [];\n    const outI = outData[i] ?? [];\n\n    for (let j = 0; j < Math.max(cmpI.length, outI.length); j++) {\n      const cmpJ = cmpI[j] ?? \"\";\n      const outJ = outI[j] ?? \"\";\n      if (\n        !(cmpJ?.trim().match(/^\\*+$/) !== null || outJ?.trim() === cmpJ?.trim())\n      ) {\n        return false;\n      }\n    }\n  }\n  return true;\n};\n","import { Trans } from \"@lingui/macro\";\nimport {\n  CSSProperties,\n  ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport \"./chip.scss\";\n\nimport { makeVisualizationsWithId } from \"@nand2tetris/components/chips/visualizations.js\";\nimport { Clockface } from \"@nand2tetris/components/clockface.js\";\nimport { DiffTable } from \"@nand2tetris/components/difftable.js\";\nimport {\n  FullPinout,\n  PinContext,\n  PinResetDispatcher,\n} from \"@nand2tetris/components/pinout.js\";\nimport { useStateInitializer } from \"@nand2tetris/components/react.js\";\nimport { Runbar } from \"@nand2tetris/components/runbar.js\";\nimport { BaseContext } from \"@nand2tetris/components/stores/base.context.js\";\nimport {\n  Files,\n  PROJECT_NAMES,\n  isBuiltinOnly,\n  useChipPageStore,\n} from \"@nand2tetris/components/stores/chip.store.js\";\nimport { CHIP_PROJECTS } from \"@nand2tetris/projects/index.js\";\nimport { CMP } from \"@nand2tetris/simulator/languages/cmp.js\";\nimport { HDL } from \"@nand2tetris/simulator/languages/hdl.js\";\nimport { TST } from \"@nand2tetris/simulator/languages/tst.js\";\nimport { Timer } from \"@nand2tetris/simulator/timer.js\";\nimport { AppContext } from \"../App.context\";\nimport { Icon } from \"../pico/icon\";\nimport { Editor } from \"../shell/editor\";\nimport { Accordian, Panel } from \"../shell/panel\";\n\nexport const Chip = () => {\n  const { fs, setStatus } = useContext(BaseContext);\n  const { filePicker, tracking } = useContext(AppContext);\n  const { state, actions, dispatch } = useChipPageStore();\n\n  const [hdl, setHdl] = useStateInitializer(state.files.hdl);\n  const [tst, setTst] = useStateInitializer(state.files.tst);\n  const [cmp, setCmp] = useStateInitializer(state.files.cmp);\n  const [out] = useStateInitializer(state.files.out);\n\n  useEffect(() => {\n    actions.initialize();\n  }, [actions]);\n\n  useEffect(() => {\n    tracking.trackPage(\"/chip\");\n  }, [tracking]);\n\n  const saveChip = () => {\n    actions.saveChip(hdl);\n  };\n\n  useEffect(() => {\n    tracking.trackEvent(\"action\", \"setProject\", state.controls.project);\n    tracking.trackEvent(\"action\", \"setChip\", state.controls.chipName);\n  }, []);\n\n  const setProject = useCallback(\n    (project: keyof typeof CHIP_PROJECTS) => {\n      actions.setProject(project);\n      tracking.trackEvent(\"action\", \"setProject\", project);\n    },\n    [actions, tracking]\n  );\n\n  const setChip = useCallback(\n    (chip: string) => {\n      actions.setChip(chip);\n      tracking.trackEvent(\"action\", \"setChip\", chip);\n      pinResetDispatcher.reset();\n    },\n    [actions, tracking]\n  );\n\n  const doEval = useCallback(() => {\n    actions.eval();\n    tracking.trackEvent(\"action\", \"eval\");\n  }, [actions, tracking]);\n\n  const compile = useRef<(files?: Partial<Files>) => void>(() => undefined);\n  compile.current = async (files: Partial<Files> = {}) => {\n    await actions.updateFiles({\n      hdl: files.hdl,\n      tst: files.tst ?? tst,\n      cmp: files.cmp ?? cmp,\n    });\n  };\n\n  const loadTest = useCallback(async () => {\n    try {\n      const path = await filePicker.select();\n      const tst = await fs.readFile(path);\n      await compile.current({ tst });\n    } catch (e) {\n      console.error(e);\n      setStatus(`Failed to load into memory`);\n    }\n  }, [filePicker, setStatus, fs, compile]);\n\n  const runner = useRef<Timer>();\n  useEffect(() => {\n    runner.current = new (class ChipTimer extends Timer {\n      async reset(): Promise<void> {\n        await compile.current();\n        await actions.reset();\n      }\n\n      override finishFrame(): void {\n        super.finishFrame();\n        dispatch.current({ action: \"updateTestStep\" });\n      }\n\n      tick(): boolean {\n        return actions.stepTest();\n      }\n\n      toggle(): void {\n        dispatch.current({ action: \"updateTestStep\" });\n      }\n    })();\n\n    return () => {\n      runner.current?.stop();\n    };\n  }, [compile, actions, dispatch]);\n\n  const clockActions = useMemo(\n    () => ({\n      toggle() {\n        actions.clock();\n        tracking.trackEvent(\"action\", \"toggleClock\");\n      },\n      reset() {\n        tracking.trackEvent(\"action\", \"resetClock\");\n        actions.reset();\n      },\n    }),\n    [actions]\n  );\n\n  const [useBuiltin, setUseBuiltin] = useState(false);\n  const toggleUseBuiltin = () => {\n    if (useBuiltin) {\n      setUseBuiltin(false);\n      actions.useBuiltin(false);\n    } else {\n      setUseBuiltin(true);\n      actions.useBuiltin(true, hdl);\n    }\n    pinResetDispatcher.reset();\n  };\n\n  const selectors = (\n    <>\n      <fieldset role=\"group\">\n        <select\n          value={state.controls.project}\n          onChange={({ target: { value } }) => {\n            setProject(value as keyof typeof CHIP_PROJECTS);\n          }}\n          data-testid=\"project-picker\"\n        >\n          {PROJECT_NAMES.map(([number, label]) => (\n            <option key={number} value={number}>\n              {label}\n            </option>\n          ))}\n        </select>\n        <select\n          value={state.controls.chipName}\n          onChange={({ target: { value } }) => {\n            setChip(value);\n          }}\n          data-testid=\"chip-picker\"\n        >\n          {state.controls.chips.map((chip) => (\n            <option\n              key={chip}\n              value={chip}\n              style={isBuiltinOnly(chip) ? { color: \"rgb(170, 170, 170)\" } : {}}\n            >\n              {`${chip} ${isBuiltinOnly(chip) ? \"(given)\" : \"\"}`}\n            </option>\n          ))}\n        </select>\n        <button className=\"flex-0\" onClick={saveChip} disabled={useBuiltin}>\n          <Trans>Save</Trans>\n        </button>\n      </fieldset>\n    </>\n  );\n  const hdlPanel = (\n    <Panel\n      className=\"_hdl_panel\"\n      header={\n        <>\n          <div tabIndex={0}>HDL</div>\n          <fieldset>\n            {state.controls.hasBuiltin && !state.controls.builtinOnly && (\n              <label>\n                <input\n                  type=\"checkbox\"\n                  role=\"switch\"\n                  checked={useBuiltin}\n                  onChange={toggleUseBuiltin}\n                />\n                <Trans>Builtin</Trans>\n              </label>\n            )}\n          </fieldset>\n          {selectors}\n        </>\n      }\n    >\n      <Editor\n        className=\"flex-1\"\n        value={hdl}\n        onChange={(source) => {\n          setHdl(source);\n          compile.current(\n            useBuiltin || state.controls.builtinOnly ? {} : { hdl: source }\n          );\n        }}\n        grammar={HDL.parser}\n        language={\"hdl\"}\n        disabled={useBuiltin || state.controls.builtinOnly}\n      />\n    </Panel>\n  );\n\n  const [inputValid, setInputValid] = useState(true);\n\n  const chipButtons = (\n    <fieldset role=\"group\">\n      <button\n        onClick={doEval}\n        onKeyDown={doEval}\n        disabled={!state.sim.pending || !inputValid}\n      >\n        <Trans>Eval</Trans>\n      </button>\n      <button\n        onClick={clockActions.toggle}\n        style={{ maxWidth: \"initial\" }}\n        disabled={!state.sim.clocked}\n      >\n        <Trans>Clock</Trans>:{\"\\u00a0\"}\n        <Clockface />\n      </button>\n      <button\n        onClick={clockActions.reset}\n        style={{ maxWidth: \"initial\" }}\n        disabled={!state.sim.clocked}\n      >\n        <Trans>Reset</Trans>\n      </button>\n    </fieldset>\n  );\n\n  const visualizations: [string, ReactNode][] = makeVisualizationsWithId(\n    {\n      parts: state.sim.chip,\n    },\n    () => {\n      dispatch.current({ action: \"updateChip\" });\n    }\n  );\n\n  const pinResetDispatcher = new PinResetDispatcher();\n\n  const pinsPanel = (\n    <Panel\n      className=\"_parts_panel\"\n      header={\n        <>\n          <div>\n            <Trans>Chip</Trans> {state.controls.chipName}\n          </div>\n          {chipButtons}\n        </>\n      }\n    >\n      {state.sim.invalid ? (\n        <Trans>Syntax errors in the HDL code</Trans>\n      ) : (\n        <>\n          <PinContext.Provider value={pinResetDispatcher}>\n            <FullPinout\n              sim={state.sim}\n              toggle={actions.toggle}\n              setInputValid={setInputValid}\n              hideInternal={state.controls.builtinOnly || useBuiltin}\n            />\n          </PinContext.Provider>\n          {visualizations.length > 0 && (\n            <Accordian summary={<Trans>Visualization</Trans>} open={true}>\n              <main>{visualizations.map(([_, v]) => v)}</main>\n            </Accordian>\n          )}\n        </>\n      )}\n    </Panel>\n  );\n\n  const [selectedTestTab, doSetSelectedTestTab] = useState<\n    \"tst\" | \"cmp\" | \"out\"\n  >(\"tst\");\n\n  const setSelectedTestTab = useCallback(\n    (tab: typeof selectedTestTab) => {\n      doSetSelectedTestTab(tab);\n      tracking.trackEvent(\"tab\", \"change\", tab);\n    },\n    [tracking]\n  );\n\n  const testPanel = (\n    <Panel\n      className=\"_test_panel\"\n      header={\n        <>\n          <div className=\"flex-1\">\n            <Trans>Test</Trans>\n          </div>\n          <div className=\"flex-2\">\n            {runner.current && <Runbar runner={runner.current} />}\n          </div>\n          <div>\n            <button onClick={loadTest}>\n              <Icon name=\"upload_file\" />{\" \"}\n            </button>\n          </div>\n        </>\n      }\n    >\n      <div role=\"tablist\" style={{ \"--tab-count\": \"3\" } as CSSProperties}>\n        <div\n          role=\"tab\"\n          id=\"test-tab-tst\"\n          aria-controls=\"test-tabpanel-tst\"\n          aria-selected={selectedTestTab === \"tst\"}\n        >\n          <label>\n            <input\n              type=\"radio\"\n              name=\"test-tabs\"\n              aria-controls=\"test-tabpanel-tst\"\n              value=\"tst\"\n              checked={selectedTestTab === \"tst\"}\n              onChange={() => setSelectedTestTab(\"tst\")}\n            />\n            Test Script\n          </label>\n        </div>\n        <div\n          role=\"tabpanel\"\n          aria-labelledby=\"test-tab-tst\"\n          id=\"test-tabpanel-tst\"\n        >\n          <Editor\n            value={tst}\n            onChange={setTst}\n            grammar={TST.parser}\n            language={\"tst\"}\n            highlight={state.controls.span}\n            disabled={state.controls.builtinOnly}\n          />\n        </div>\n        <div\n          role=\"tab\"\n          id=\"test-tab-cmp\"\n          aria-controls=\"test-tablpanel-cmp\"\n          aria-selected={selectedTestTab === \"cmp\"}\n        >\n          <label>\n            <input\n              type=\"radio\"\n              name=\"test-tabs\"\n              aria-controls=\"test-tabpanel-cmp\"\n              value=\"cmp\"\n              checked={selectedTestTab === \"cmp\"}\n              onChange={() => setSelectedTestTab(\"cmp\")}\n            />\n            Compare File\n          </label>\n        </div>\n        <div\n          role=\"tabpanel\"\n          aria-labelledby=\"test-tab-cmp\"\n          id=\"test-tabpanel-cmp\"\n          style={{ position: \"relative\" }}\n        >\n          <Editor\n            value={cmp}\n            onChange={setCmp}\n            grammar={CMP.parser}\n            language={\"cmp\"}\n            disabled={state.controls.builtinOnly}\n          />\n        </div>\n        <div\n          role=\"tab\"\n          id=\"test-tab-out\"\n          aria-controls=\"test-tabpanel-out\"\n          aria-selected={selectedTestTab === \"out\"}\n        >\n          <label>\n            <input\n              type=\"radio\"\n              name=\"test-tabs\"\n              aria-controls=\"test-tabpanel-out\"\n              value=\"out\"\n              checked={selectedTestTab === \"out\"}\n              onChange={() => setSelectedTestTab(\"out\")}\n            />\n            Output File\n          </label>\n        </div>\n        <div\n          role=\"tabpanel\"\n          id=\"test-tabpanel-out\"\n          aria-labelledby=\"test-tab-out\"\n        >\n          <DiffTable cmp={cmp} out={out} />\n        </div>\n      </div>\n    </Panel>\n  );\n\n  return (\n    <div className=\"ChipPage grid\">\n      {hdlPanel}\n      {pinsPanel}\n      {testPanel}\n    </div>\n  );\n};\n\nexport default Chip;\n"],"names":["ALUComponent","A","op","D","out","flag","_jsxs","children","_jsx","width","height","xmlns","x","y","fill","points","stroke","xmlSpace","textAnchor","fontFamily","fontSize","strokeWidth","id","COMMANDS_ALU","makeVisualization","chip","updateAction","ALU","in","busVoltage","voltage","HIGH","Flags","Register","RegisterComponent","name","bits","PC","Keyboard","KeyboardComponent","keyboard","update","Screen","ScreenComponent","memory","RAM","MemoryComponent","format","ROM32K","highlight","address","RAM8","CPU","decode","state","am","vis","parts","map","filter","v","undefined","length","ChipDisplayInfo","chipName","unsigned","Map","BUILTIN_REGISTRY","getBuiltinChip","isOk","pins","Array","from","Ok","ins","entries","concat","outs","pin","this","signBehaviors","set","includes","isSigned","get","UNSIGNED_PINS","PinContext","createContext","reducePin","range","i","reverse","reducePins","FullPinout","props","sim","inPins","outPins","internalPins","displayInfo","getDisplayInfo","className","PinoutBlock","header","toggle","setInputValid","disabled","pending","enableEdit","hideInternal","colSpan","immPin","Pin","signed","internal","useState","isBin","setIsBin","inputValid","decimal","setDecimal","resetDispatcher","useContext","PinResetDispatcher","registerCallback","setInputValidity","valid","updatePins","n","useEffect","value","limit","toString","style","display","flexDirection","alignItems","role","backgroundColor","onClick","onChange","e","handleDecimalChange","positive","replace","numeric","isNaN","parseInt","newValue","Math","pow","target","maxWidth","margin","toggleBin","callback","callbacks","push","reset","PROJECT_NAMES","getChips","project","CHIP_ORDER","BUILTIN_CHIP_PROJECTS","CHIP_PROJECTS","makeHdl","isBuiltinOnly","Object","values","flat","getBuiltinCode","template","getTemplate","ChipProjects","BUILTIN_CHIPS","CHIPS","bodyComment","builtinLine","reduceChip","invalid","clocked","clock","Clock","makeChipStore","fs","setStatus","storage","dispatch","dropdowns","findDropdowns","chips","Low","test","ChipTest","usingBuiltin","builtinOnly","reducers","setFiles","hdl","files","tst","cmp","updateChip","payload","controls","error","setProject","setChip","hasBuiltin","REGISTRY","testRunning","runningTest","testFinished","passed","compare","cmpResult","CMP","outResult","isErr","cmpData","outData","min","cmpI","outI","j","max","cmpJ","outJ","trim","match","updateTestStep","log","currentStep","span","done","end","start","actions","p","current","action","useBuiltin","loadChip","updateFiles","compileChip","compileTest","remove","maybeParsed","HDL","Err","buildChip","maybeChip","replaceChip","nextChip","nextPin","eval","with","fsName","ext","Promise","all","readFile","catch","saveChip","prj","path","writeFile","isLow","frame","doUseBuiltin","oldHdl","builtinName","initialize","file","TST","setFileSystem","runTest","pushd","run","popd","tick","stepTest","assert","chipId","step","initialState","Chip","BaseContext","AppContext","filePicker","tracking","useChipPageStore","useRef","useMemo","useImmerReducer","dispatcher","useStateInitializer","setHdl","setTst","setCmp","trackPage","trackEvent","useCallback","pinResetDispatcher","doEval","compile","loadTest","select","console","runner","Timer","stop","clockActions","setUseBuiltin","selectors","number","label","color","hdlPanel","tabIndex","type","checked","toggleUseBuiltin","source","grammar","language","chipButtons","onKeyDown","visualizations","makeVisualizationsWithId","part","pinsPanel","Provider","summary","open","selectedTestTab","doSetSelectedTestTab","setSelectedTestTab","tab","testPanel","position"],"sourceRoot":""}