{"version":3,"file":"static/js/604.4baa5a5a.chunk.js","mappings":"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","sources":["../../components/src/stores/asm.store.ts","../../components/src/table.tsx","pages/asm.tsx","shell/editor.tsx","shell/panel.tsx","../../components/src/react.ts","../../components/src/runbar.tsx","../../components/src/timer.tsx","../../simulator/src/timer.ts"],"sourcesContent":["import { Err, Ok, isErr } from \"@davidsouther/jiffies/lib/esm/result.js\";\nimport {\n  KEYBOARD_OFFSET,\n  SCREEN_OFFSET,\n} from \"@nand2tetris/simulator/cpu/memory.js\";\nimport {\n  ASM,\n  Asm,\n  fillLabel,\n  isAValueInstruction,\n  translateInstruction,\n} from \"@nand2tetris/simulator/languages/asm.js\";\nimport { Span } from \"@nand2tetris/simulator/languages/base.js\";\nimport { bin } from \"@nand2tetris/simulator/util/twos.js\";\nimport { Dispatch, MutableRefObject, useContext, useMemo, useRef } from \"react\";\nimport { useImmerReducer } from \"../react.js\";\nimport { BaseContext } from \"./base.context.js\";\n\nfunction defaultSymbols(): [string, string][] {\n  return [\n    [\"R0\", \"0\"],\n    [\"R1\", \"1\"],\n    [\"R2\", \"2\"],\n    [\"...\", \"\"],\n    [\"R15\", \"15\"],\n    [\"SCREEN\", SCREEN_OFFSET.toString()],\n    [\"KBD\", KEYBOARD_OFFSET.toString()],\n  ];\n}\n\ninterface HighlightInfo {\n  resultHighlight: Span | undefined;\n  sourceHighlight: Span | undefined;\n  highlightMap: Map<Span, Span>;\n}\n\nclass Translator {\n  asm: Asm | null = null;\n  current = -1;\n  done = false;\n  symbols: [string, string][] = [];\n  hiddenSymbols: Map<number, [string, boolean]> = new Map();\n  result = \"\";\n  lineNumbers: number[] = [];\n\n  load(asm: Asm, lineNum: number) {\n    this.symbols = defaultSymbols();\n    this.hiddenSymbols.clear();\n    this.asm = asm;\n    fillLabel(asm, (name, value, isVar) => {\n      if (isVar) {\n        this.hiddenSymbols.set(value, [name, false]);\n      } else {\n        this.symbols.push([name, value.toString()]);\n      }\n    });\n    asm.instructions = asm.instructions.filter(\n      (instruction) => instruction.type !== \"L\"\n    );\n\n    this.resolveLineNumbers(lineNum);\n    this.reset();\n  }\n\n  resolveLineNumbers(lineNum: number) {\n    if (this.asm === null) {\n      return;\n    }\n    this.lineNumbers = Array(lineNum);\n    let currentLine = 0;\n    for (const instruction of this.asm.instructions) {\n      if (instruction.type === \"A\" || instruction.type === \"C\") {\n        this.lineNumbers[instruction.lineNum] = currentLine;\n        currentLine++;\n      }\n    }\n  }\n\n  step(highlightInfo: HighlightInfo) {\n    if (this.asm === null || this.current >= this.asm.instructions.length - 1) {\n      return;\n    }\n    this.current++;\n    const instruction = this.asm.instructions[this.current];\n    if (instruction.type === \"A\" || instruction.type === \"C\") {\n      highlightInfo.sourceHighlight = instruction.span;\n      const result = translateInstruction(this.asm.instructions[this.current]);\n      if (result === undefined) {\n        return;\n      }\n      this.result += `${bin(result)}\\n`;\n      highlightInfo.resultHighlight = {\n        start: this.current * 17,\n        end: (this.current + 1) * 17,\n      };\n\n      highlightInfo.highlightMap.set(\n        instruction.span,\n        highlightInfo.resultHighlight\n      );\n\n      if (instruction.type === \"A\" && isAValueInstruction(instruction)) {\n        const variable = this.hiddenSymbols.get(instruction.value);\n        if (variable != undefined && !variable[1]) {\n          this.symbols.push([variable[0], instruction.value.toString()]);\n          this.hiddenSymbols.set(instruction.value, [variable[0], true]);\n        }\n      }\n\n      if (this.current === this.asm.instructions.length - 1) {\n        this.done = true;\n      }\n    }\n  }\n\n  resetSymbols() {\n    const hiddenSymbolNames: Set<string> = new Set();\n    for (const [value, variable] of this.hiddenSymbols) {\n      hiddenSymbolNames.add(variable[0]);\n      this.hiddenSymbols.set(value, [variable[0], false]);\n    }\n\n    this.symbols = this.symbols.filter(\n      (symbol) => !hiddenSymbolNames.has(symbol[0])\n    );\n  }\n\n  reset() {\n    this.current = -1;\n    this.result = \"\";\n    this.done = false;\n    this.resetSymbols();\n  }\n}\n\nexport interface AsmPageState {\n  asm: string;\n  current: number;\n  resultHighlight: Span | undefined;\n  sourceHighlight: Span | undefined;\n  symbols: [string, string][];\n  result: string;\n  compare: string;\n  lineNumbers: number[];\n}\n\nexport type AsmStoreDispatch = Dispatch<{\n  action: keyof ReturnType<typeof makeAsmStore>[\"reducers\"];\n  payload?: unknown;\n}>;\n\nexport function makeAsmStore(\n  setStatus: (status: string) => void,\n  dispatch: MutableRefObject<AsmStoreDispatch>\n) {\n  const translator = new Translator();\n  const highlightInfo = {\n    resultHighlight: undefined,\n    sourceHighlight: undefined,\n    highlightMap: new Map(),\n  };\n  let animate = true;\n\n  const reducers = {\n    setAsm(state: AsmPageState, { asm }: { asm: string }) {\n      state.asm = asm;\n    },\n\n    setCmp(state: AsmPageState, { cmp }: { cmp: string }) {\n      state.compare = cmp;\n      setStatus(\"Loaded compare file\");\n    },\n\n    update(state: AsmPageState) {\n      state.current = translator.current;\n      state.result = translator.result;\n      state.symbols = Array.from(translator.symbols);\n      state.lineNumbers = Array.from(translator.lineNumbers);\n      state.sourceHighlight = highlightInfo.sourceHighlight;\n      state.resultHighlight = highlightInfo.resultHighlight;\n    },\n\n    compare(state: AsmPageState) {\n      const resultLines = state.result.split(\"\\n\");\n      const compareLines = state.compare.split(\"\\n\");\n\n      if (resultLines.length != compareLines.length) {\n        setStatus(\"Comparison failed - different lengths\");\n        return;\n      }\n\n      for (let i = 0; i < compareLines.length; i++) {\n        for (let j = 0; j < compareLines[i].length; j++) {\n          if (resultLines[i][j] !== compareLines[i][j]) {\n            setStatus(`Comparison failed at ${i}:${j}`);\n            state.resultHighlight = {\n              start: i * 17,\n              end: (i + 1) * 17,\n            };\n            return;\n          }\n        }\n      }\n      setStatus(\"Comparison successful\");\n    },\n  };\n\n  const actions = {\n    loadAsm(asm: string) {\n      dispatch.current({ action: \"setAsm\", payload: { asm } });\n\n      const parseResult = ASM.parse(asm);\n      if (isErr(parseResult)) {\n        setStatus(`Error parsing asm file - ${Err(parseResult).message}`);\n        return;\n      }\n\n      translator.load(Ok(parseResult), asm.split(\"\\n\").length);\n      dispatch.current({ action: \"update\" });\n      setStatus(\"Loaded asm file\");\n    },\n\n    setAnimate(value: boolean) {\n      animate = value;\n    },\n\n    step(): boolean {\n      translator.step(highlightInfo);\n      if (animate || translator.done) {\n        dispatch.current({ action: \"update\" });\n      }\n      if (translator.done) {\n        setStatus(\"Translation done.\");\n      }\n      return translator.done;\n    },\n\n    updateHighlight(index: number, fromSource: boolean) {\n      for (const [sourceSpan, resultSpan] of highlightInfo.highlightMap) {\n        if (\n          (fromSource &&\n            sourceSpan.start <= index &&\n            index <= sourceSpan.end) ||\n          (!fromSource && resultSpan.start <= index && index <= resultSpan.end)\n        ) {\n          highlightInfo.sourceHighlight = sourceSpan;\n          highlightInfo.resultHighlight = resultSpan;\n        }\n      }\n      dispatch.current({ action: \"update\" });\n    },\n\n    resetHighlightInfo() {\n      highlightInfo.sourceHighlight = undefined;\n      highlightInfo.resultHighlight = undefined;\n      highlightInfo.highlightMap.clear();\n    },\n\n    reset() {\n      translator.reset();\n      this.resetHighlightInfo();\n      dispatch.current({ action: \"update\" });\n    },\n  };\n\n  const initialState = {\n    asm: \"\",\n    current: -1,\n    resultHighlight: undefined,\n    sourceHighlight: undefined,\n    symbols: [],\n    result: \"\",\n    compare: \"\",\n    lineNumbers: [],\n  };\n\n  return { initialState, reducers, actions };\n}\n\nexport function useAsmPageStore() {\n  const { setStatus } = useContext(BaseContext);\n\n  const dispatch = useRef<AsmStoreDispatch>(() => undefined);\n\n  const { initialState, reducers, actions } = useMemo(\n    () => makeAsmStore(setStatus, dispatch),\n    [setStatus, dispatch]\n  );\n\n  const [state, dispatcher] = useImmerReducer(reducers, initialState);\n  dispatch.current = dispatcher;\n\n  return { state, dispatch, actions };\n}\n","import { rounded } from \"@davidsouther/jiffies/lib/esm/dom/css/border.js\";\n\nexport const Table = ({\n  values = [],\n  highlight = -1,\n  onClick,\n}: {\n  values?: [string, string][];\n  highlight?: number;\n  onClick?: (id: string, value: string) => void;\n}) => {\n  return (\n    <div>\n      {values.map((entry, i) => (\n        <TableRow\n          key={i}\n          identifier={entry[0]}\n          value={entry[1]}\n          highlight={i === highlight}\n          onClick={() => onClick?.(entry[0], entry[1])}\n        />\n      ))}\n    </div>\n  );\n};\n\nconst TableRow = ({\n  identifier,\n  value,\n  highlight = false,\n  onClick,\n}: {\n  identifier: string;\n  value: string;\n  highlight?: boolean;\n  onClick?: () => void;\n}) => {\n  return (\n    <div style={{ display: \"flex\", alignItems: \"center\" }} onClick={onClick}>\n      {identifier.length > 0 && (\n        <code\n          style={{\n            flex: \"1\",\n            ...rounded(\"none\"),\n            ...(highlight\n              ? { background: \"var(--mark-background-color)\" }\n              : {}),\n            whiteSpace: \"pre\",\n            padding: \"3px\",\n          }}\n        >\n          {identifier}\n        </code>\n      )}\n      {value.length > 0 && (\n        <code\n          style={{\n            flex: \"1\",\n            textAlign: \"right\",\n            color: \"black\",\n            padding: \"3px\",\n            ...rounded(\"none\"),\n            ...(highlight\n              ? { background: \"var(--mark-background-color)\" }\n              : {}),\n          }}\n        >\n          {value}\n        </code>\n      )}\n    </div>\n  );\n};\n","import { Trans } from \"@lingui/macro\";\nimport { Runbar } from \"@nand2tetris/components/runbar\";\nimport { useAsmPageStore } from \"@nand2tetris/components/stores/asm.store\";\nimport { BaseContext } from \"@nand2tetris/components/stores/base.context\";\nimport { Table } from \"@nand2tetris/components/table\";\nimport { ASM } from \"@nand2tetris/simulator/languages/asm.js\";\nimport { Timer } from \"@nand2tetris/simulator/timer\";\nimport { ChangeEvent, useContext, useEffect, useRef, useState } from \"react\";\nimport { Editor } from \"../shell/editor\";\nimport { Panel } from \"../shell/panel\";\n\nimport \"./asm.scss\";\n\nexport const Asm = () => {\n  const { state, actions, dispatch } = useAsmPageStore();\n\n  const [asm, setAsm] = useState(\"\");\n  const [cmp, setCmp] = useState(\"\");\n  const sourceCursorPos = useRef(0);\n  const resultCursorPos = useRef(0);\n\n  const runner = useRef<Timer>();\n  const [runnerAssigned, setRunnerAssigned] = useState(false);\n\n  useEffect(() => {\n    runner.current = new (class AsmRunner extends Timer {\n      override tick(): boolean {\n        sourceCursorPos.current = 0;\n        resultCursorPos.current = 0;\n        return actions.step();\n      }\n      override reset(): void {\n        actions.reset();\n      }\n      override toggle(): void {\n        return;\n      }\n    })();\n    setRunnerAssigned(true);\n\n    return () => {\n      runner.current?.stop();\n    };\n  }, [actions, dispatch]);\n\n  const fileUploadRef = useRef<HTMLInputElement>(null);\n  const fileDownloadRef = useRef<HTMLAnchorElement>(null);\n  let fileType: \"asm\" | \"cmp\" = \"asm\";\n\n  const loadAsm = () => {\n    fileType = \"asm\";\n    fileUploadRef.current?.click();\n  };\n\n  const loadCompare = () => {\n    fileType = \"cmp\";\n    fileUploadRef.current?.click();\n  };\n\n  const { setStatus } = useContext(BaseContext);\n  const uploadFile = async (event: ChangeEvent<HTMLInputElement>) => {\n    if (!event.target.files?.length) {\n      setStatus(\"No file selected\");\n      return;\n    }\n    const file = event.target.files[0];\n    const source = await file.text();\n    if (fileType === \"asm\") {\n      if (!file.name.endsWith(\".asm\")) {\n        setStatus(\"File must be .asm file\");\n        return;\n      }\n      actions.loadAsm(source);\n      setAsm(file.name);\n    } else {\n      if (!file.name.endsWith(\".hack\")) {\n        setStatus(\"File must be .hack file\");\n        return;\n      }\n      dispatch.current({ action: \"setCmp\", payload: { cmp: source } });\n      setCmp(file.name);\n    }\n  };\n\n  const download = () => {\n    const blob = new Blob([state.result], { type: \"text/plain\" });\n    const url = URL.createObjectURL(blob);\n\n    if (!fileDownloadRef.current) {\n      return;\n    }\n    fileDownloadRef.current.href = url;\n    fileDownloadRef.current.download = asm.replace(\".asm\", \".hack\");\n    fileDownloadRef.current.click();\n\n    URL.revokeObjectURL(url);\n  };\n\n  const compare = () => {\n    dispatch.current({ action: \"compare\" });\n  };\n\n  const onSpeedChange = (speed: number) => {\n    actions.setAnimate(speed <= 2);\n  };\n\n  return (\n    <div className=\"AsmPage grid\">\n      <Panel\n        className=\"source\"\n        header={\n          <>\n            <div>\n              <Trans>Source</Trans>\n              {asm && `: ${asm}`}\n            </div>\n            <input\n              type=\"file\"\n              style={{ display: \"none\" }}\n              ref={fileUploadRef}\n              onChange={uploadFile}\n            />\n            <div className=\"flex-1\">\n              {runnerAssigned && runner.current && (\n                <Runbar\n                  runner={runner.current}\n                  prefix={\n                    <button\n                      className=\"flex-0\"\n                      onClick={loadAsm}\n                      data-tooltip=\"Load file\"\n                      data-placement=\"bottom\"\n                    >\n                      📂\n                    </button>\n                  }\n                  overrideTooltips={[\"Translate\", \"Translate all\"]}\n                  onSpeedChange={onSpeedChange}\n                />\n              )}\n            </div>\n          </>\n        }\n      >\n        <Editor\n          value={state.asm}\n          onChange={(source: string) => {\n            return;\n          }}\n          onCursorPositionChange={(index) => {\n            if (index == sourceCursorPos.current) {\n              return;\n            }\n            sourceCursorPos.current = index;\n            actions.updateHighlight(index, true);\n          }}\n          grammar={ASM.parser}\n          language={\"asm\"}\n          highlight={state.sourceHighlight}\n          disabled={true}\n          lineNumberTransform={(n) => {\n            const num = state.lineNumbers[n] as number | undefined;\n            return (num === undefined ? \"\" : num).toString();\n          }}\n        />\n      </Panel>\n      <Panel\n        className=\"result\"\n        header={\n          <>\n            <div>\n              <Trans>Binary Code</Trans>\n            </div>\n            <div>\n              <fieldset role=\"group\">\n                <a ref={fileDownloadRef} style={{ display: \"none\" }} />\n                <button onClick={download}>Download</button>\n              </fieldset>\n            </div>\n          </>\n        }\n      >\n        <Editor\n          value={state.result}\n          highlight={state.resultHighlight}\n          disabled={true}\n          onChange={function (source: string): void {\n            return;\n          }}\n          onCursorPositionChange={(index) => {\n            if (index == resultCursorPos.current) {\n              return;\n            }\n            resultCursorPos.current = index;\n            actions.updateHighlight(index, false);\n          }}\n          grammar={undefined}\n          language={\"\"}\n          dynamicHeight={true}\n          lineNumberTransform={(n) => (n - 1).toString()}\n        />\n        {state.symbols.length > 0 && \"Symbol Table\"}\n        <Table values={state.symbols} />\n      </Panel>\n      <Panel\n        className=\"compare\"\n        header={\n          <>\n            <div>\n              <Trans>Compare</Trans>\n              {cmp && `: ${cmp}`}\n            </div>\n            <div>\n              <fieldset role=\"group\">\n                <button onClick={compare}>Compare</button>\n                <button\n                  onClick={loadCompare}\n                  data-tooltip=\"Load file\"\n                  data-placement=\"left\"\n                >\n                  📂\n                </button>\n              </fieldset>\n            </div>\n          </>\n        }\n      >\n        <Editor\n          value={state.compare}\n          highlight={state.resultHighlight}\n          disabled={true}\n          onChange={function (source: string): void {\n            return;\n          }}\n          onCursorPositionChange={(index) => {\n            if (index == resultCursorPos.current) {\n              return;\n            }\n            resultCursorPos.current = index;\n            actions.updateHighlight(index, false);\n          }}\n          language={\"\"}\n          lineNumberTransform={(n) => (n - 1).toString()}\n        />\n      </Panel>\n    </div>\n  );\n};\n\nexport default Asm;\n","import { debounce } from \"@davidsouther/jiffies/lib/esm/debounce\";\nimport { Trans } from \"@lingui/macro\";\nimport MonacoEditor, { OnMount, useMonaco } from \"@monaco-editor/react\";\nimport type * as monacoT from \"monaco-editor/esm/vs/editor/editor.api\";\nimport ohm from \"ohm-js\";\nimport {\n  CSSProperties,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { AppContext } from \"../App.context\";\n\nimport {\n  Span,\n  UNKNOWN_PARSE_ERROR,\n} from \"@nand2tetris/simulator/languages/base.js\";\n\nimport \"./editor.scss\";\n\nexport const ErrorPanel = ({ error }: { error?: ohm.MatchResult }) => {\n  return error?.failed() ? (\n    <details className=\"ErrorPanel\" open>\n      <summary role=\"button\" className=\"secondary\">\n        <Trans>Parse Error</Trans>\n      </summary>\n      <pre>\n        <code>\n          {error?.message ?? error?.shortMessage ?? UNKNOWN_PARSE_ERROR}\n        </code>\n      </pre>\n    </details>\n  ) : (\n    <></>\n  );\n};\n\nconst Textarea = ({\n  value,\n  onChange,\n  language,\n  disabled = false,\n}: {\n  value: string;\n  onChange: (value: string) => void;\n  language: string;\n  disabled?: boolean;\n}) => {\n  const [text, setText] = useState(value);\n  return (\n    <textarea\n      data-testid={`editor-${language}`}\n      disabled={disabled}\n      value={text}\n      onChange={(e) => {\n        const value = e.target?.value;\n        setText(value);\n        onChange(value);\n      }}\n    />\n  );\n};\n\nconst MONACO_LIGHT_THEME = \"vs\";\nconst MONACO_DARK_THEME = \"vs-dark\";\n\nconst makeHighlight = (\n  monaco: typeof monacoT | null,\n  editor: monacoT.editor.IStandaloneCodeEditor | undefined,\n  highlight: Span | undefined,\n  decorations: string[]\n): string[] => {\n  if (!(editor && highlight)) return decorations;\n  const model = editor.getModel();\n  if (!model) return decorations;\n  const start = model.getPositionAt(highlight.start);\n  const end = model.getPositionAt(highlight.end);\n  const range = monaco?.Range.fromPositions(start, end);\n  const nextDecoration: monacoT.editor.IModelDeltaDecoration[] = [];\n  if (range) {\n    nextDecoration.push({\n      range,\n      options: { inlineClassName: \"highlight\" },\n    });\n    editor.revealRangeInCenter(range);\n  }\n  return editor.deltaDecorations(decorations, nextDecoration);\n};\n\nconst Monaco = ({\n  value,\n  onChange,\n  onCursorPositionChange,\n  language,\n  error,\n  disabled = false,\n  highlight: currentHighlight,\n  dynamicHeight = false,\n  lineNumberTransform,\n}: {\n  value: string;\n  onChange: (value: string) => void;\n  onCursorPositionChange?: (index: number) => void;\n  language: string;\n  error?: ohm.MatchResult | undefined;\n  disabled?: boolean;\n  highlight?: Span;\n  dynamicHeight?: boolean;\n  lineNumberTransform?: (n: number) => string;\n}) => {\n  const { theme } = useContext(AppContext);\n  const monaco = useMonaco();\n  const [height, setHeight] = useState(0);\n\n  const editor = useRef<monacoT.editor.IStandaloneCodeEditor>();\n  const decorations = useRef<string[]>([]);\n  const highlight = useRef<Span | undefined>(undefined);\n\n  const codeTheme = useCallback(() => {\n    const isDark =\n      theme === \"system\"\n        ? window.matchMedia(\"(prefers-color-scheme: dark)\").matches\n        : theme === \"dark\";\n    return isDark ? MONACO_DARK_THEME : MONACO_LIGHT_THEME;\n  }, [theme]);\n\n  const doHighlight = useCallback(() => {\n    decorations.current = makeHighlight(\n      monaco,\n      editor.current,\n      // I'm not sure why this makes things work, but it is load bearing.\n      // Removing the empty span will cause the initial first-statement\n      // highlight in the test view to not show. Setting it to [0, 1] will\n      // cause a 1-character highlight in the editor view, so don't do that\n      // either.\n      highlight.current ?? { start: 0, end: 0 },\n      decorations.current\n    );\n  }, [decorations, monaco, editor, highlight]);\n\n  const calculateHeight = () => {\n    if (dynamicHeight) {\n      const contentHeight = editor.current?.getContentHeight();\n      if (contentHeight) {\n        setHeight(contentHeight);\n      }\n    }\n  };\n\n  // Mark and center highlighted spans\n  useEffect(() => {\n    highlight.current = currentHighlight;\n    doHighlight();\n  }, [currentHighlight]);\n\n  // Set options when mounting\n  const onMount: OnMount = useCallback(\n    (ed) => {\n      editor.current = ed;\n      editor.current?.updateOptions({\n        fontFamily: `\"JetBrains Mono\", source-code-pro, Menlo, Monaco,\n      Consolas, \"Roboto Mono\", \"Ubuntu Monospace\", \"Noto Mono\", \"Oxygen Mono\",\n      \"Liberation Mono\", monospace, \"Apple Color Emoji\", \"Segoe UI Emoji\",\n      \"Segoe UI Symbol\", \"Noto Color Emoji\"`,\n        fontSize: 16,\n        minimap: {\n          enabled: false,\n        },\n        theme: codeTheme(),\n        scrollBeyondLastLine: false,\n        readOnly: disabled,\n        lineNumbers: lineNumberTransform ?? \"on\",\n        folding: false,\n      });\n      doHighlight();\n      calculateHeight();\n      editor.current?.onDidChangeCursorPosition((e) => {\n        const index = editor.current?.getModel()?.getOffsetAt(e.position);\n        if (index !== undefined) {\n          onCursorPositionChange?.(index);\n        }\n      });\n    },\n    [codeTheme]\n  );\n\n  useEffect(() => {\n    if (editor.current === undefined) return;\n    editor.current.updateOptions({ lineNumbers: lineNumberTransform ?? \"on\" });\n  }, [lineNumberTransform]);\n\n  // Set themes\n  useEffect(() => {\n    if (editor.current === undefined) return;\n    editor.current.updateOptions({ theme: codeTheme() });\n  }, [editor, codeTheme]);\n\n  // Prevent editing disabled editors\n  useEffect(() => {\n    if (editor.current === undefined) return;\n    editor.current.updateOptions({ readOnly: disabled });\n  }, [editor, disabled]);\n\n  // Add error markers on parse failure\n  useEffect(() => {\n    if (editor.current === undefined) return;\n    if (monaco === null) return;\n    const model = editor.current.getModel();\n    if (model === null) return;\n    if (error === undefined || error.succeeded()) {\n      monaco.editor.setModelMarkers(model, language, []);\n      return;\n    }\n    // Line 7, col 5:\n    const { line, column, message } =\n      /Line (?<line>\\d+), col (?<column>\\d+): (?<message>.*)/.exec(\n        error.shortMessage ?? \"\"\n      )?.groups ?? { line: 1, column: 1, message: \"could not parse error\" };\n    const startLineNumber = Number(line);\n    const endLineNumber = startLineNumber;\n    const startColumn = Number(column);\n    const restOfLine = model\n      .getLineContent(startLineNumber)\n      .substring(startColumn - 1);\n    let endColumn =\n      startColumn + (restOfLine.match(/([^\\s]+)/)?.[0].length ?? 1);\n    if (endColumn <= startColumn) {\n      endColumn = startColumn + 1;\n    }\n\n    monaco.editor.setModelMarkers(model, language, [\n      {\n        message,\n        startColumn,\n        startLineNumber,\n        endColumn,\n        endLineNumber,\n        severity: 8, // monacoT.MarkerSeverity.Error,\n      },\n    ]);\n  }, [error, editor, monaco, language]);\n\n  const onValueChange = (v = \"\") => {\n    calculateHeight();\n    onChange(v);\n  };\n\n  return (\n    <>\n      <MonacoEditor\n        value={value}\n        onChange={onValueChange}\n        language={language}\n        onMount={onMount}\n        height={dynamicHeight ? height : undefined}\n      />\n    </>\n  );\n};\n\nexport const Editor = ({\n  className = \"\",\n  style = {},\n  disabled = false,\n  value,\n  onChange,\n  onCursorPositionChange,\n  grammar,\n  language,\n  highlight,\n  dynamicHeight = false,\n  lineNumberTransform,\n}: {\n  className?: string;\n  style?: CSSProperties;\n  disabled?: boolean;\n  value: string;\n  onChange: (source: string) => void;\n  onCursorPositionChange?: (index: number) => void;\n  grammar?: ohm.Grammar;\n  language: string;\n  highlight?: Span;\n  dynamicHeight?: boolean;\n  lineNumberTransform?: (n: number) => string;\n}) => {\n  const [error, setError] = useState<ohm.MatchResult>();\n  const { monaco } = useContext(AppContext);\n\n  const parse = useCallback(\n    (text = \"\") => {\n      if (grammar) {\n        const parsed = grammar.match(text);\n        setError(parsed.failed() ? parsed : undefined);\n      }\n    },\n    [setError, grammar]\n  );\n\n  useEffect(() => parse(value), [parse, value]);\n  const doParse = useMemo(() => debounce(parse, 500), [parse]);\n\n  const onChangeCB = useCallback(\n    (text = \"\") => {\n      onChange(text);\n      doParse(text);\n    },\n    [doParse, onChange]\n  );\n\n  return (\n    <div\n      className={`Editor ${dynamicHeight ? \"dynamic-height\" : \"\"} ${className}`}\n      style={style}\n    >\n      {monaco.canUse && monaco.wants ? (\n        <Monaco\n          value={value}\n          onChange={onChangeCB}\n          onCursorPositionChange={onCursorPositionChange}\n          language={language}\n          error={error}\n          disabled={disabled}\n          highlight={highlight}\n          dynamicHeight={dynamicHeight}\n          lineNumberTransform={lineNumberTransform}\n        />\n      ) : (\n        <>\n          <Textarea\n            value={value}\n            onChange={onChangeCB}\n            language={language}\n            disabled={disabled}\n          />\n          <ErrorPanel error={error} />\n        </>\n      )}\n    </div>\n  );\n};\n","import { CSSProperties, ReactNode } from \"react\";\n\nexport const Panel = (props: {\n  children: ReactNode;\n  header?: ReactNode;\n  footer?: ReactNode;\n  className?: string;\n  style?: CSSProperties;\n}) => {\n  return (\n    <article className={[\"panel\", props.className ?? \"\"].join(\" \")}>\n      {props.header && <header>{props.header}</header>}\n      <main>{props.children}</main>\n      {props.footer && <footer>{props.footer}</footer>}\n    </article>\n  );\n};\n\nexport const Accordian = (props: {\n  children: ReactNode;\n  summary: ReactNode;\n  className?: string;\n  style?: CSSProperties;\n  open?: boolean;\n}) => {\n  return (\n    <details\n      className={props.className ?? \"\"}\n      open={props.open}\n      style={props.style}\n    >\n      <summary>\n        <div className=\"flex row align-baseline\">{props.summary}</div>\n      </summary>\n      {props.children}\n    </details>\n  );\n};\n","import produce from \"immer\";\nimport { Dispatch, useEffect, useReducer, useState } from \"react\";\n\nexport function useImmerReducer<\n  T,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  Reducers extends Record<string, (state: T, action?: any) => T | void>\n>(reducers: Reducers, initialState: T) {\n  return useReducer(\n    (\n      state: T,\n      command: {\n        action: keyof Reducers;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        payload?: any;\n      }\n    ): T =>\n      produce(state, (draft: T) => {\n        reducers[command.action](draft, command.payload);\n      }),\n    initialState\n  );\n}\n\nexport function useStateInitializer<T>(init: T): [T, Dispatch<T>] {\n  const [state, setState] = useState<T>(init);\n  useEffect(() => {\n    setState(init);\n  }, [init]);\n  return [state, setState];\n}\n","import { Timer } from \"@nand2tetris/simulator/timer.js\";\nimport { ChangeEvent, ReactNode, useEffect, useState } from \"react\";\nimport { useTimer } from \"./timer.js\";\n\nexport const Runbar = (props: {\n  runner: Timer;\n  prefix?: ReactNode;\n  children?: ReactNode;\n  overrideTooltips?: (string | undefined)[];\n  onSpeedChange?: (speed: number) => void;\n}) => {\n  const runner = useTimer(props.runner);\n  const [speedValue, setSpeed] = useState(0);\n\n  const speedValues: Record<number, [number, number]> = {\n    0: [1000, 1],\n    1: [500, 1],\n    2: [16, 1],\n    3: [16, 16666],\n    4: [16, 16666 * 30],\n  };\n\n  useEffect(() => {\n    updateSpeed();\n  }, [speedValue]);\n\n  const updateSpeed = () => {\n    const [speed, steps] = speedValues[speedValue];\n    runner.dispatch({ action: \"setSpeed\", payload: speed });\n    runner.dispatch({ action: \"setSteps\", payload: steps });\n  };\n\n  const onChange = (e: ChangeEvent<HTMLInputElement>) => {\n    setSpeed(Number(e.target.value));\n    props.onSpeedChange?.(Number(e.target.value));\n  };\n\n  return (\n    <fieldset role=\"group\">\n      {props.prefix}\n      <button\n        className=\"flex-0\"\n        onClick={() => runner.actions.frame()}\n        data-tooltip={props.overrideTooltips?.[0] ?? `Step`}\n        data-placement=\"bottom\"\n      >\n        {/* <Icon name=\"play_arrow\" /> */}\n        ➡️\n      </button>\n      <button\n        className=\"flex-0\"\n        onClick={() =>\n          runner.state.running ? runner.actions.stop() : runner.actions.start()\n        }\n        data-tooltip={\n          runner.state.running\n            ? props.overrideTooltips?.[2] ?? `Pause`\n            : props.overrideTooltips?.[1] ?? `Run`\n        }\n        data-placement=\"bottom\"\n      >\n        {/* <Icon name={runner.state.running ? \"pause\" : \"fast_forward\"} /> */}\n        {runner.state.running ? \"⏸\" : \"️⏩\"}\n      </button>\n      <button\n        className=\"flex-0\"\n        onClick={() => runner.actions.reset()}\n        data-tooltip={props.overrideTooltips?.[3] ?? `Reset`}\n        data-placement=\"bottom\"\n      >\n        {/* <Icon name=\"fast_rewind\" /> */}⏮\n      </button>\n      <div\n        style={{\n          display: \"flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          fontSize: 16,\n          fontWeight: \"normal\",\n        }}\n      >\n        <span style={{ padding: \"0.2rem\" }}>Slow</span>\n        <input\n          type=\"range\"\n          min={0}\n          max={4}\n          step={1}\n          value={speedValue}\n          disabled={runner.state.running}\n          onChange={onChange}\n          style={{ width: \"150px\", padding: \"0.2rem\" }}\n          data-tooltip={\"Execution speed\"}\n          data-placement={\"bottom\"}\n        />\n        <span style={{ padding: \"0.2rem\" }}>Fast</span>\n      </div>\n      {props.children}\n    </fieldset>\n  );\n};\n","import { Timer } from \"@nand2tetris/simulator/timer.js\";\nimport { useImmerReducer } from \"./react.js\";\n\nexport interface TimerStoreState {\n  steps: number;\n  speed: number;\n  running: boolean;\n}\n\nimport { Dispatch, MutableRefObject, useMemo, useRef } from \"react\";\nexport type TimerStoreDispatch = Dispatch<{\n  action: keyof ReturnType<typeof makeTimerStore>[\"reducers\"];\n  payload?: unknown;\n}>;\n\nconst makeTimerStore = (\n  timer: Timer,\n  dispatch: MutableRefObject<TimerStoreDispatch>\n) => {\n  const initialState: TimerStoreState = {\n    running: timer.running,\n    speed: timer.speed,\n    steps: timer.steps,\n  };\n\n  const finishFrame = timer.finishFrame.bind(timer);\n  timer.finishFrame = function () {\n    finishFrame();\n    dispatch.current({ action: \"update\" });\n  };\n\n  const reducers = {\n    update(state: TimerStoreState) {\n      state.running = timer.running;\n      state.speed = timer.speed;\n      state.steps = timer.steps;\n    },\n    setSteps(state: TimerStoreState, steps: number) {\n      state.steps = steps;\n      timer.steps = steps;\n    },\n    setSpeed(state: TimerStoreState, speed: number) {\n      state.speed = speed;\n      timer.speed = speed;\n    },\n  };\n\n  const actions = {\n    frame() {\n      timer.frame();\n    },\n    start() {\n      timer.start();\n      dispatch.current({ action: \"update\" });\n    },\n    stop() {\n      timer.stop();\n      dispatch.current({ action: \"update\" });\n    },\n    reset() {\n      timer.reset();\n      dispatch.current({ action: \"update\" });\n    },\n  };\n\n  return { initialState, reducers, actions };\n};\n\nexport function useTimer(timer: Timer) {\n  const dispatch = useRef<TimerStoreDispatch>(() => undefined);\n\n  const { initialState, reducers, actions } = useMemo(\n    () => makeTimerStore(timer, dispatch),\n    [timer, dispatch]\n  );\n\n  const [state, dispatcher] = useImmerReducer(reducers, initialState);\n\n  dispatch.current = dispatcher;\n\n  return { state, dispatch: dispatch.current, actions };\n}\n","import { Clock } from \"./chip/clock.js\";\n\nexport const MAX_STEPS = 1000;\n\nconst clock = Clock.get();\n\nexport abstract class Timer {\n  frame() {\n    this.tick();\n    this.finishFrame();\n  }\n\n  /// Update the simulation state, but DO NOT perform any UI changes.\n  abstract tick(): boolean;\n\n  /// UI Updates are allowed in finishFrame.\n  finishFrame() {\n    clock.frame();\n  }\n\n  abstract reset(): void;\n\n  abstract toggle(): void;\n\n  steps = 1; // How many steps to take per update\n  speed = 1000; // how often to update, in ms\n  get running() {\n    return this.#running;\n  }\n\n  #running = false;\n  #sinceLastFrame = 0;\n  #lastUpdate = 0;\n  #run = async () => {\n    if (!this.#running) {\n      return;\n    }\n    const now = Date.now();\n    const delta = now - this.#lastUpdate;\n    this.#lastUpdate = now;\n    this.#sinceLastFrame += delta;\n    if (this.#sinceLastFrame > this.speed) {\n      let done = false;\n      // let steps = Math.min(this.steps, MAX_STEPS);\n      let steps = this.steps;\n      const timingLabel = `Timing ${steps} steps`;\n      console.time(timingLabel);\n      while (!done && steps--) {\n        // done = await this.tick();\n        done = this.tick();\n      }\n      console.timeEnd(timingLabel);\n      this.finishFrame();\n      if (done) {\n        this.stop();\n      }\n      this.#sinceLastFrame -= this.speed;\n    }\n    requestAnimationFrame(this.#run);\n  };\n\n  start() {\n    this.#running = true;\n    this.#lastUpdate = Date.now() - this.speed;\n    this.#run();\n    this.toggle();\n  }\n\n  stop() {\n    this.#running = false;\n    this.toggle();\n  }\n}\n"],"names":["Translator","asm","current","done","symbols","hiddenSymbols","Map","result","lineNumbers","load","lineNum","this","SCREEN_OFFSET","KEYBOARD_OFFSET","clear","fillLabel","name","value","isVar","set","push","toString","instructions","filter","instruction","type","resolveLineNumbers","reset","Array","currentLine","step","highlightInfo","length","sourceHighlight","span","translateInstruction","undefined","bin","resultHighlight","start","end","highlightMap","isAValueInstruction","variable","get","resetSymbols","hiddenSymbolNames","Set","add","symbol","has","useAsmPageStore","setStatus","useContext","BaseContext","dispatch","useRef","initialState","reducers","actions","useMemo","translator","animate","setAsm","state","setCmp","cmp","compare","update","from","resultLines","split","compareLines","i","j","loadAsm","action","payload","parseResult","ASM","isErr","Err","message","Ok","setAnimate","updateHighlight","index","fromSource","sourceSpan","resultSpan","resetHighlightInfo","makeAsmStore","dispatcher","useImmerReducer","Table","values","highlight","onClick","_jsx","children","map","entry","TableRow","identifier","_jsxs","style","display","alignItems","flex","rounded","background","whiteSpace","padding","textAlign","color","Asm","useState","sourceCursorPos","resultCursorPos","runner","runnerAssigned","setRunnerAssigned","useEffect","Timer","tick","toggle","stop","fileUploadRef","fileDownloadRef","fileType","className","header","ref","onChange","async","event","target","files","file","source","text","endsWith","prefix","click","overrideTooltips","onSpeedChange","speed","onCursorPositionChange","grammar","language","disabled","lineNumberTransform","n","num","role","blob","Blob","url","URL","createObjectURL","href","download","replace","revokeObjectURL","dynamicHeight","ErrorPanel","error","failed","open","shortMessage","UNKNOWN_PARSE_ERROR","Textarea","setText","e","Monaco","currentHighlight","theme","AppContext","monaco","useMonaco","height","setHeight","editor","decorations","codeTheme","useCallback","window","matchMedia","matches","doHighlight","model","getModel","getPositionAt","range","Range","fromPositions","nextDecoration","options","inlineClassName","revealRangeInCenter","deltaDecorations","makeHighlight","calculateHeight","contentHeight","getContentHeight","onMount","ed","updateOptions","fontFamily","fontSize","minimap","enabled","scrollBeyondLastLine","readOnly","folding","onDidChangeCursorPosition","getOffsetAt","position","succeeded","setModelMarkers","line","column","exec","groups","startLineNumber","Number","endLineNumber","startColumn","endColumn","getLineContent","substring","match","severity","v","Editor","setError","parse","parsed","doParse","debounce","onChangeCB","canUse","wants","Panel","props","join","footer","Accordian","summary","useReducer","command","produce","draft","useStateInitializer","init","setState","Runbar","timer","running","steps","finishFrame","bind","setSteps","setSpeed","frame","makeTimerStore","useTimer","speedValue","speedValues","updateSpeed","justifyContent","fontWeight","min","max","width","clock","Clock","now","Date","delta","timingLabel","console","time","timeEnd","requestAnimationFrame"],"sourceRoot":""}