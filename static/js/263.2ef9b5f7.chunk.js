"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[263],{4263:function(e,t,n){n.r(t),n.d(t,{Chip:function(){return tn},default:function(){return nn}});var r=n(2951),i=n(1976),a=n(3243),o=n(7597),s=n(7591),c=n(4337),u=n(1092),l=n(7791),d=n(1026),f=n(8061),p=n(6167),h=n(649),v=n(7878),m=n(3300),g=n(3118),x=n(7039),b=n(3116),y=n(6329),j=n(6693),k=n(134),C=function(e){var t,n=e.A,r=e.op,i=e.D,a=e.out;e.flag;return(0,v.jsxs)("div",{children:[(0,v.jsx)("span",{children:"ALU"}),(0,v.jsx)("svg",{width:"250",height:"250",xmlns:"http://www.w3.org/2000/svg",children:(0,v.jsxs)("g",{children:[(0,v.jsx)("rect",{x:"1",y:"20",height:"85",width:"70",fill:"black"}),(0,v.jsx)("rect",{x:"1",y:"145",height:"85",width:"70",fill:"black"}),(0,v.jsx)("rect",{x:"180",y:"95",height:"60",width:"70",fill:"black"}),(0,v.jsx)("polygon",{points:"70,10 180,85 180,165 70,240 70,135 90,125 70,115",stroke:"#000",fill:"#6D97AB"}),(0,v.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",fontFamily:"Noto Sans JP",fontSize:"14",strokeWidth:"0",id:"svg_9",y:"63",x:"35",stroke:"white",fill:"#ffffff",children:n}),(0,v.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",fontFamily:"Noto Sans JP",fontSize:"14",id:"svg_10",y:"188",x:"35",strokeWidth:"0",stroke:"white",fill:"#ffffff",children:i}),(0,v.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",fontFamily:"Noto Sans JP",fontSize:"14",id:"svg_11",y:"125",x:"215",strokeWidth:"0",stroke:"white",fill:"#ffffff",children:a}),(0,v.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",fontFamily:"Noto Sans JP",fontSize:"14",id:"svg_13",y:"125",x:"135",strokeWidth:"0",stroke:"white",fill:"#ffffff",children:null!==(t=j.NM.op[r])&&void 0!==t?t:"(??)"})]})})]})},Z=n(326),w=function(e){var t=e.name,n=e.bits;return(0,v.jsxs)("div",{children:[t,": ",(0,Z.E_)(n)]})},P={Enter:128,Backspace:129,ArrowLeft:130,ArrowUp:131,ArrowRight:132,ArrowDown:133,Home:134,End:135,PageUp:136,PageDown:137,Insert:138,Delete:139,Escape:140,F1:141,F2:142,F3:143,F4:144,F5:145,F6:146,F7:147,F8:148,F9:149,F10:150,F11:151,F12:152};var S=function(e){var t=e.keyboard,n=e.update,r=(0,p.useState)(!1),i=(0,d.Z)(r,2),a=i[0],o=i[1],s=(0,p.useState)(t.out().busVoltage),c=(0,d.Z)(s,2),u=c[0],l=c[1],f=0,h=function(e){0!==e&&(t.setKey(e),l(t.out().busVoltage),f=e)},m=(0,p.useCallback)((function(){o(!0)}),[]);return(0,v.jsxs)("div",{className:"flex row align-baseline",children:[(0,v.jsx)("div",{className:"flex-1",children:(0,v.jsx)(w,{name:"Keyboard",bits:u})}),(0,v.jsx)("div",{className:"flex-1",children:a?(0,v.jsx)("input",{ref:function(e){return null===e||void 0===e?void 0:e.focus()},type:"text",onKeyDown:function(e){e.preventDefault();var t=function(e){var t=P[e.key];if(void 0!==t)return t;if(1===e.key.length){var n=e.key.charCodeAt(0);if(n>=32&&n<=126)return n}return 0}(e);t!==f&&(h(t),null===n||void 0===n||n())},onKeyUp:function(e){f=0,t.clearKey(),null===n||void 0===n||n(),l(t.out().busVoltage)}}):(0,v.jsx)("button",{onClick:m,children:"\u2328\ufe0f"})})]})},F=n(189),N={none:"0px",sm:"0.125rem","":"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},I={"":"",t:"Top",r:"Right",l:"Left",b:"Bottom",tl:"TopLeft",tr:"TopRight",bl:"BottomLeft",br:"BottomRight"},O={"1/4":"25%","1/2":"50%","3/4":"75%",full:"100%"};function M(e){return void 0!==I[e]}function A(e){return N[e]}function E(e){switch(e){case"t":return[].concat((0,h.Z)(E("tl")),(0,h.Z)(E("tr")));case"r":return[].concat((0,h.Z)(E("tr")),(0,h.Z)(E("br")));case"b":return[].concat((0,h.Z)(E("br")),(0,h.Z)(E("bl")));case"l":return[].concat((0,h.Z)(E("tl")),(0,h.Z)(E("bl")));default:return[I[e]]}}function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";M(e)&&(t=e,e="");var n=A(e);return E(t).reduce((function(e,t){return""===t?e.borderRadius=n:e["border".concat(t,"Radius")]=n,e}),{})}var R=n(5838),_=n(7693);function D(e,t){var n;return void 0===e&&void 0!==O[t]&&(e=t),(0,F.Z)((0,F.Z)({},"inline"===t?{display:"inline-block"}:{}),{},{width:null!==(n=O[e])&&void 0!==n?n:"0"})}function H(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+e+(n.length?" "+n.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function z(e){return!!e&&!!e[Se]}function U(e){var t;return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===Fe}(e)||Array.isArray(e)||!!e[Pe]||!!(null===(t=e.constructor)||void 0===t?void 0:t[Pe])||G(e)||$(e))}function B(e,t,n){void 0===n&&(n=!1),0===L(e)?(n?Object.keys:Ne)(e).forEach((function(r){n&&"symbol"==typeof r||t(r,e[r],e)})):e.forEach((function(n,r){return t(r,n,e)}))}function L(e){var t=e[Se];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:G(e)?2:$(e)?3:0}function V(e,t){return 2===L(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function W(e,t){return 2===L(e)?e.get(t):e[t]}function K(e,t,n){var r=L(e);2===r?e.set(t,n):3===r?(e.delete(t),e.add(n)):e[t]=n}function J(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function G(e){return ke&&e instanceof Map}function $(e){return Ce&&e instanceof Set}function q(e){return e.o||e.t}function X(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=Ie(e);delete t[Se];for(var n=Ne(t),r=0;r<n.length;r++){var i=n[r],a=t[i];!1===a.writable&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function Y(e,t){return void 0===t&&(t=!1),ee(e)||z(e)||!U(e)||(L(e)>1&&(e.set=e.add=e.clear=e.delete=Q),Object.freeze(e),t&&B(e,(function(e,t){return Y(t,!0)}),!0)),e}function Q(){H(2)}function ee(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function te(e){var t=Oe[e];return t||H(18,e),t}function ne(){return ye}function re(e,t){t&&(te("Patches"),e.u=[],e.s=[],e.v=t)}function ie(e){ae(e),e.p.forEach(se),e.p=null}function ae(e){e===ye&&(ye=e.l)}function oe(e){return ye={p:[],l:ye,h:e,m:!0,_:0}}function se(e){var t=e[Se];0===t.i||1===t.i?t.j():t.O=!0}function ce(e,t){t._=t.p.length;var n=t.p[0],r=void 0!==e&&e!==n;return t.h.g||te("ES5").S(t,e,r),r?(n[Se].P&&(ie(t),H(4)),U(e)&&(e=ue(t,e),t.l||de(t,e)),t.u&&te("Patches").M(n[Se].t,e,t.u,t.s)):e=ue(t,n,[]),ie(t),t.u&&t.v(t.u,t.s),e!==we?e:void 0}function ue(e,t,n){if(ee(t))return t;var r=t[Se];if(!r)return B(t,(function(i,a){return le(e,r,t,i,a,n)}),!0),t;if(r.A!==e)return t;if(!r.P)return de(e,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var i=4===r.i||5===r.i?r.o=X(r.k):r.o;B(3===r.i?new Set(i):i,(function(t,a){return le(e,r,i,t,a,n)})),de(e,i,!1),n&&e.u&&te("Patches").R(r,n,e.u,e.s)}return r.o}function le(e,t,n,r,i,a){if(z(i)){var o=ue(e,i,a&&t&&3!==t.i&&!V(t.D,r)?a.concat(r):void 0);if(K(n,r,o),!z(o))return;e.m=!1}if(U(i)&&!ee(i)){if(!e.h.F&&e._<1)return;ue(e,i),t&&t.A.l||de(e,i)}}function de(e,t,n){void 0===n&&(n=!1),e.h.F&&e.m&&Y(t,n)}function fe(e,t){var n=e[Se];return(n?q(n):e)[t]}function pe(e,t){if(t in e)for(var n=Object.getPrototypeOf(e);n;){var r=Object.getOwnPropertyDescriptor(n,t);if(r)return r;n=Object.getPrototypeOf(n)}}function he(e){e.P||(e.P=!0,e.l&&he(e.l))}function ve(e){e.o||(e.o=X(e.t))}function me(e,t,n){var r=G(t)?te("MapSet").N(t,n):$(t)?te("MapSet").T(t,n):e.g?function(e,t){var n=Array.isArray(e),r={i:n?1:0,A:t?t.A:ne(),P:!1,I:!1,D:{},l:t,t:e,k:null,o:null,j:null,C:!1},i=r,a=Me;n&&(i=[r],a=Ae);var o=Proxy.revocable(i,a),s=o.revoke,c=o.proxy;return r.k=c,r.j=s,c}(t,n):te("ES5").J(t,n);return(n?n.A:ne()).p.push(r),r}function ge(e){return z(e)||H(22,e),function e(t){if(!U(t))return t;var n,r=t[Se],i=L(t);if(r){if(!r.P&&(r.i<4||!te("ES5").K(r)))return r.t;r.I=!0,n=xe(t,i),r.I=!1}else n=xe(t,i);return B(n,(function(t,i){r&&W(r.t,t)===i||K(n,t,e(i))})),3===i?new Set(n):n}(e)}function xe(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return X(e)}var be,ye,je="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),ke="undefined"!=typeof Map,Ce="undefined"!=typeof Set,Ze="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,we=je?Symbol.for("immer-nothing"):((be={})["immer-nothing"]=!0,be),Pe=je?Symbol.for("immer-draftable"):"__$immer_draftable",Se=je?Symbol.for("immer-state"):"__$immer_state",Fe=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),Ne="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,Ie=Object.getOwnPropertyDescriptors||function(e){var t={};return Ne(e).forEach((function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)})),t},Oe={},Me={get:function(e,t){if(t===Se)return e;var n=q(e);if(!V(n,t))return function(e,t,n){var r,i=pe(t,n);return i?"value"in i?i.value:null===(r=i.get)||void 0===r?void 0:r.call(e.k):void 0}(e,n,t);var r=n[t];return e.I||!U(r)?r:r===fe(e.t,t)?(ve(e),e.o[t]=me(e.A.h,r,e)):r},has:function(e,t){return t in q(e)},ownKeys:function(e){return Reflect.ownKeys(q(e))},set:function(e,t,n){var r=pe(q(e),t);if(null==r?void 0:r.set)return r.set.call(e.k,n),!0;if(!e.P){var i=fe(q(e),t),a=null==i?void 0:i[Se];if(a&&a.t===n)return e.o[t]=n,e.D[t]=!1,!0;if(J(n,i)&&(void 0!==n||V(e.t,t)))return!0;ve(e),he(e)}return e.o[t]===n&&"number"!=typeof n&&(void 0!==n||t in e.o)||(e.o[t]=n,e.D[t]=!0,!0)},deleteProperty:function(e,t){return void 0!==fe(e.t,t)||t in e.t?(e.D[t]=!1,ve(e),he(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var n=q(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty:function(){H(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){H(12)}},Ae={};B(Me,(function(e,t){Ae[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),Ae.deleteProperty=function(e,t){return Ae.set.call(this,e,t,void 0)},Ae.set=function(e,t,n){return Me.set.call(this,e[0],t,n,e[0])};var Ee=function(){function e(e){var t=this;this.g=Ze,this.F=!0,this.produce=function(e,n,r){if("function"==typeof e&&"function"!=typeof n){var i=n;n=e;var a=t;return function(e){var t=this;void 0===e&&(e=i);for(var r=arguments.length,o=Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];return a.produce(e,(function(e){var r;return(r=n).call.apply(r,[t,e].concat(o))}))}}var o;if("function"!=typeof n&&H(6),void 0!==r&&"function"!=typeof r&&H(7),U(e)){var s=oe(t),c=me(t,e,void 0),u=!0;try{o=n(c),u=!1}finally{u?ie(s):ae(s)}return"undefined"!=typeof Promise&&o instanceof Promise?o.then((function(e){return re(s,r),ce(e,s)}),(function(e){throw ie(s),e})):(re(s,r),ce(o,s))}if(!e||"object"!=typeof e){if(void 0===(o=n(e))&&(o=e),o===we&&(o=void 0),t.F&&Y(o,!0),r){var l=[],d=[];te("Patches").M(e,o,l,d),r(l,d)}return o}H(21,e)},this.produceWithPatches=function(e,n){if("function"==typeof e)return function(n){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return t.produceWithPatches(n,(function(t){return e.apply(void 0,[t].concat(i))}))};var r,i,a=t.produce(e,n,(function(e,t){r=e,i=t}));return"undefined"!=typeof Promise&&a instanceof Promise?a.then((function(e){return[e,r,i]})):[a,r,i]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){U(e)||H(8),z(e)&&(e=ge(e));var t=oe(this),n=me(this,e,void 0);return n[Se].C=!0,ae(t),n},t.finishDraft=function(e,t){var n=(e&&e[Se]).A;return re(n,t),ce(void 0,n)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!Ze&&H(20),this.g=e},t.applyPatches=function(e,t){var n;for(n=t.length-1;n>=0;n--){var r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));var i=te("Patches").$;return z(e)?i(e,t):this.produce(e,(function(e){return i(e,t)}))},e}(),Te=new Ee,Re=Te.produce,_e=(Te.produceWithPatches.bind(Te),Te.setAutoFreeze.bind(Te),Te.setUseProxies.bind(Te),Te.applyPatches.bind(Te),Te.createDraft.bind(Te),Te.finishDraft.bind(Te),Re);function De(e,t){return(0,p.useReducer)((function(t,n){return _e(t,(function(t){e[n.action](t,n.payload)}))}),t)}function He(e){var t=(0,p.useState)(e),n=(0,d.Z)(t,2),r=n[0],i=n[1];return(0,p.useEffect)((function(){i(e)}),[e]),[r,i]}var ze=0,Ue=1,Be=function(e){var t,n=(0,p.useState)(null!==(t=e.mode)&&void 0!==t?t:ze),r=(0,d.Z)(n,2),i=r[0],a=r[1],o=He(e.value),s=(0,d.Z)(o,2),c=s[0],u=s[1],l=function(){return(0,v.jsx)("span",{style:(0,F.Z)({cursor:"text"},D("full","inline")),onClick:function(){a(Ue)},children:c})},f=(0,p.useCallback)((function(e){return null===e||void 0===e?void 0:e.select()}),[]),h=(0,p.useCallback)((function(t){var n,r;a(ze),u(null!==(n=t.value)&&void 0!==n?n:""),e.onChange(null!==(r=t.value)&&void 0!==r?r:"")}),[e,a,u]),m=function(){var e=(0,v.jsx)("span",{style:{display:"block",position:"relative"},children:(0,v.jsx)("input",{ref:f,style:{zIndex:"10",position:"absolute",left:"0",marginTop:"-0.375rem"},onBlur:function(e){var t=e.target;return h(t)},onKeyPress:function(e){var t=e.key,n=e.target;"Enter"===t&&h(n)},type:"text",defaultValue:c})});return e};return function(){switch(i){case Ue:return m();case ze:return l();default:return(0,v.jsx)("span",{})}}()};function Le(e,t,n){var r=t.totalHeight,i=t.toleranceHeight,a=t.bufferedItems,o=t.settings,s=o.itemHeight,c=o.minIndex,u=o.maxIndex,l=c+Math.floor((e-i)/s),d=function(e,t,n,r,i){var a=Math.max(0,e,n),o=i(a,Math.min(t,n+r-1)-a);return(0,h.Z)(o)}(c,u,l,a,n),f=Math.max((l-c)*s,0);return{scrollTop:e,topPaddingHeight:f,bottomPaddingHeight:Math.max(r-(f+d.length*s),0),data:d}}var Ve=function(e){var t,n=(0,p.useRef)(null),r=(0,p.useMemo)((function(){var t,n=function(e){var t=e.minIndex,n=void 0===t?0:t,r=e.maxIndex,i=void 0===r?Number.MAX_SAFE_INTEGER:r,a=e.startIndex,o=void 0===a?0:a,s=e.itemHeight,c=void 0===s?20:s,u=e.count,l=void 0===u?Math.max(i-n,1):u,d=e.tolerance;return{minIndex:n,maxIndex:i,startIndex:o,itemHeight:c,count:l,tolerance:void 0===d?l:d}}(null!==(t=e.settings)&&void 0!==t?t:{}),r=function(e,t){var n=e.minIndex,r=e.maxIndex,i=e.startIndex,a=e.itemHeight,o=e.count,s=e.tolerance,c=o+2*s,u=o*a,l=(r-n)*a,d=s*a,f=Math.max(0,i-s-n)*a,p={scrollTop:0,settings:e,viewportHeight:u,totalHeight:l,toleranceHeight:d,bufferedItems:c,topPaddingHeight:f,bottomPaddingHeight:l-(f+(u+2*d)),data:[]};return(0,F.Z)((0,F.Z)({},p),Le(f+d,p,t))}(n,e.get),i=function(e){return function(t,n){return(0,F.Z)((0,F.Z)({},t),Le(n,t,e))}}(e.get);return{settings:n,reducer:i,startState:r}}),[e.settings,e.get]),i=r.settings,a=r.startState,o=r.reducer,s=(0,p.useReducer)(o,a),c=(0,d.Z)(s,2),u=c[0],l=c[1];(0,p.useEffect)((function(){null!==n.current&&l(n.current.scrollTop)}),[i,e.row]);var f=(0,p.useCallback)((function(e){e&&(e.scrollTop=n.current?n.current.scrollTop:i.startIndex*i.itemHeight),n.current=e}),[n,i.startIndex,i.itemHeight]),h=u.data.map((function(t){return(0,v.jsx)("div",{style:{height:"".concat(i.itemHeight,"px")},children:e.row(t)},e.rowKey(t))}));return(0,v.jsxs)("div",{ref:f,style:{height:"".concat(u.viewportHeight,"px"),overflowY:"scroll",overflowAnchor:"none"},className:null!==(t=e.className)&&void 0!==t?t:"",onScroll:function(e){return l(e.target.scrollTop)},children:[(0,v.jsx)("div",{style:{height:"".concat(u.topPaddingHeight,"px")}}),h,(0,v.jsx)("div",{style:{height:"".concat(u.bottomPaddingHeight,"px")}})]})},We=n(4408),Ke=n(6531);function Je(e){(0,p.useEffect)((function(){var t=Ke.S.get().reset$.subscribe((function(){e()}));return function(){return t.unsubscribe()}}),[e])}function Ge(){return(0,We.j)(Ke.S.get())}var $e=function(){var e=function(){var e=(0,p.useState)(Ge()),t=(0,d.Z)(e,2),n=t[0],r=t[1];return(0,p.useEffect)((function(){var e=Ke.S.get().$.subscribe((function(){r(Ge())}));return function(){return e.unsubscribe()}}),[]),n}();return(0,v.jsx)("span",{style:{whiteSpace:"nowrap"},children:e})},qe=function(e){var t=e.memory,n=e.jmp,r=void 0===n?{value:0}:n,i=e.highlight,a=void 0===i?-1:i,o=e.editable,s=void 0!==o&&o,c=e.format,u=void 0===c?Z.E_:c,l=e.onChange,f=void 0===l?function(){}:l,h=(0,p.useMemo)((function(){return{count:Math.min(t.size,20),maxIndex:t.size,itemHeight:34,startIndex:r.value}}),[t.size,r]),m=(0,p.useCallback)((function(e,n){return t.range(e,e+n).map((function(t,n){return[n+e,t]}))}),[t]),g=(0,p.useCallback)((function(e){var t=(0,d.Z)(e,2),n=t[0],r=t[1];return(0,v.jsx)(Xe,{index:n,value:u(r),editable:s,highlight:n===a,onChange:f})}),[u,s,a,f]);return(0,v.jsx)(Ve,{settings:h,get:m,row:g,rowKey:function(e){return(0,d.Z)(e,1)[0]}})},Xe=function(e){var t=e.index,n=e.value,r=e.highlight,i=void 0!==r&&r,a=e.editable,o=void 0!==a&&a,s=e.onChange,c=void 0===s?function(){}:s;return(0,v.jsxs)("div",{style:{display:"flex",height:"100%"},children:[(0,v.jsx)("code",{style:(0,F.Z)((0,F.Z)({},T("none")),i?{background:"var(--code-kbd-background-color)"}:{}),children:(0,Z.$v)(t)}),(0,v.jsx)("code",{style:(0,F.Z)((0,F.Z)({flex:"1",textAlign:"right"},T("none")),i?{background:"var(--code-kbd-background-color)"}:{}),children:o?(0,v.jsx)(Be,{value:n,onChange:function(e){return c(t,e,Number(n))}}):(0,v.jsx)("span",{children:n})})]})},Ye=function(e){var t=e.name,n=void 0===t?"Memory":t,r=e.highlight,i=void 0===r?-1:r,a=e.editable,o=void 0===a||a,s=e.memory,c=e.format,u=void 0===c?"dec":c,l=(0,p.useState)(u),f=(0,d.Z)(l,2),h=f[0],m=f[1],g=(0,p.useState)(""),x=(0,d.Z)(g,2),b=x[0],y=x[1],j=(0,p.useState)({value:0}),k=(0,d.Z)(j,2),C=k[0],w=k[1],P=function(){w({value:!isNaN(parseInt(b))&&isFinite(parseInt(b))?Number(b):0})},S=(0,p.useCallback)((function(e,t){s.update(e,t,null!==h&&void 0!==h?h:"dec")}),[s,h]);return Je((function(){y(""),w({value:0})})),(0,v.jsxs)("article",{className:"panel",children:[(0,v.jsxs)("header",{children:[(0,v.jsx)("div",{children:n}),(0,v.jsxs)("fieldset",{role:"group",children:[(0,v.jsx)("button",{onClick:function(){},className:"flex-0",children:"\ud83d\udcc2"}),(0,v.jsx)("input",{style:{width:"4em",height:"100%"},placeholder:"Goto",value:b,onKeyDown:function(e){return"Enter"===e.key&&P()},onChange:function(e){var t=e.target.value;return y(t)}}),(0,v.jsx)("button",{onClick:P,className:"flex-0",children:"\u2935\ufe0f"}),R.I2.map((function(e){return(0,v.jsxs)("label",{className:"flex-0",role:"button","aria-current":e===h,children:[(0,v.jsx)("input",{type:"radio",name:n,value:e,checked:e===h,onChange:function(){return m(e)}}),e]},e)}))]})]}),(0,v.jsx)(qe,{jmp:C,memory:s,highlight:i,editable:o,format:function(e){return function(e,t){switch(e){case"bin":return(0,Z.Ly)(t);case"hex":return(0,Z.$v)(t);case"asm":return(0,_.a)(t);default:return(0,Z.E_)(t)}}(h,e)},onChange:S})]})};var Qe=n(5541),et="white";function tt(e,t,n){return 0===(e.get(32*n+(t/16|0))&1<<t%16)?et:"black"}function nt(e,t,n,r){var i=4*(512*n+t),a=r===et?255:0;e[i]=a,e[i+1]=a,e[i+2]=a,e[i+3]=255}var rt=function(e){var t,n=e.memory,r=(0,p.useRef)(),i=(0,p.useCallback)((function(){var e,t,i=null!==(e=null===(t=r.current)||void 0===t?void 0:t.getContext("2d"))&&void 0!==e?e:void 0;i&&function(e,t){for(var n=(0,Qe.kP)(e.getImageData(0,0,512,256),"Failed to create Context2d"),r=0;r<512;r++)for(var i=0;i<256;i++){var a=tt(t,r,i);nt(n.data,r,i,a)}e.putImageData(n,0,0)}(i,n)}),[n]),a=(0,p.useCallback)((function(e){r.current=null!==e&&void 0!==e?e:void 0,i()}),[r,i]);return t=i,(0,p.useEffect)((function(){var e=Ke.S.get().frame$.subscribe((function(){t()}));return function(){return e.unsubscribe()}}),[t]),Je((function(){var e,t;null===(e=r.current)||void 0===e||null===(t=e.getContext("2d"))||void 0===t||t.clearRect(0,0,r.current.width,r.current.height)})),(0,v.jsxs)("article",{className:"panel",children:[(0,v.jsx)("header",{children:"Screen"}),(0,v.jsx)("main",{children:(0,v.jsx)("figure",{style:{width:"100%",maxWidth:"512px",boxSizing:"content-box",marginInline:"auto",margin:"0",borderTop:"2px solid gray",borderLeft:"2px solid gray",borderBottom:"2px solid lightgray",borderRight:"2px solid lightgray"},children:(0,v.jsx)("canvas",{ref:a,width:512,height:256})})})]})};function it(e,t){if(e instanceof g.JU)return(0,v.jsx)(C,{A:e.in("x").busVoltage,op:e.op(),D:e.in("y").busVoltage,out:e.out().busVoltage,flag:e.out("zr").voltage()===y.lj?j.vU.Zero:e.out("ng").voltage()===y.lj?j.vU.Negative:j.vU.Positive});var n;if(e instanceof x.aX)return(0,v.jsx)(w,{name:null!==(n=e.name)&&void 0!==n?n:"Chip ".concat(e.id),bits:e.bits});if(e instanceof x.PC)return(0,v.jsx)(w,{name:"PC",bits:e.bits});if(e instanceof m.N1)return(0,v.jsx)(S,{keyboard:e,update:t});if(e instanceof m.lL)return(0,v.jsx)(rt,{memory:e.memory});if(e instanceof b.FH)return(0,v.jsx)(Ye,{name:e.name,memory:e.memory,format:"dec",highlight:e.address});if(e instanceof b.HX)return(0,v.jsxs)("span",{children:["RAM ",e.width]});if(e instanceof k.Z9){var r=(0,k.Jx)(e.in("instruction").busVoltage);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(w,{name:"A",bits:e.state.A}),(0,v.jsx)(w,{name:"D",bits:e.state.D}),(0,v.jsx)(w,{name:"PC",bits:e.state.PC}),(0,v.jsx)(C,{A:r.am?e.in("inM").busVoltage:e.state.A,D:e.state.D,out:e.state.ALU,op:r.op,flag:e.state.flag})]})}var i=(0,h.Z)(e.parts).map((function(e){return it(e,t)})).filter((function(e){return void 0!==e}));return i.length>0?(0,v.jsx)(v.Fragment,{children:i}):void 0}var at=n(8582),ot=n(4649),st=n(726),ct=n(1585),ut=n(4625),lt=function(){function e(t,n){if((0,r.Z)(this,e),(0,ot.Z)(this,"signBehaviors",new Map),g.zZ.has(t)){var i=(0,g.cT)(t);if((0,ut.IY)(i)){var a,o=Array.from((0,ut.Ok)(i).ins.entries()).concat(Array.from((0,ut.Ok)(i).outs.entries())),s=(0,st.Z)(o);try{for(s.s();!(a=s.n()).done;){var c=a.value;this.signBehaviors.set(c.name,!n||!n.includes(c.name))}}catch(u){s.e(u)}finally{s.f()}}}}return(0,i.Z)(e,[{key:"isSigned",value:function(e){return this.signBehaviors.get(e)}}]),e}(),dt=new Map([["Mux4Way16",["sel"]],["Mux8Way16",["sel"]],["DMux4Way",["sel"]],["DMux8Way",["sel"]],["RAM8",["address"]],["RAM64",["address"]],["RAM512",["address"]],["RAM4K",["address"]],["RAM16K",["address"]],["Screen",["address"]],["Memory",["address"]],["CPU",["addressM","pc"]]]),ft=(0,p.createContext)({});function pt(e){return{pin:e,bits:(0,ct.w)(0,e.width).map((function(t){return[t,e.voltage(t)]})).reverse()}}function ht(e){return(0,h.Z)(e.entries()).map(pt)}var vt=function(e){var t,n,r=e.sim,i=r.inPins,a=r.outPins,o=r.internalPins,s=(n=null!==(t=e.sim.chip[0].name)&&void 0!==t?t:"",new lt(n,dt.get(n)));return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("style",{children:"\n        table.pinout th {\n          font-weight: bold;\n        }\n\n        table.pinout tbody td:first-child {\n          text-align: right;\n          --font-size: 1rem;\n          width: 0;\n          white-space: nowrap;\n          border-right: var(--border-width) solid var(--table-border-color);\n        }\n\n        table.pinout tbody button {\n          --font-size: 0.875em;\n          font-family: var(--font-family-monospace);\n          max-width: 2em;\n        }\n        "}),(0,v.jsx)("table",{className:"pinout",children:(0,v.jsxs)("tbody",{children:[(0,v.jsx)(mt,{pins:i,header:"Input pins",toggle:e.toggle,setInputValid:e.setInputValid,displayInfo:s}),(0,v.jsx)(mt,{pins:a,header:"Output pins",disabled:e.sim.pending,enableEdit:!1,displayInfo:s}),!e.hideInternal&&(0,v.jsx)(mt,{pins:o,header:"Internal pins",disabled:e.sim.pending,enableEdit:!1,displayInfo:s})]})})]})},mt=function(e){return(0,v.jsxs)(v.Fragment,{children:[e.pins.length>0&&(0,v.jsx)("tr",{children:(0,v.jsx)("th",{colSpan:2,children:e.header})}),(0,h.Z)(e.pins).map((function(t){return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:t.pin.name}),(0,v.jsx)("td",{children:(0,v.jsx)(gt,{pin:t,toggle:e.toggle,disabled:e.disabled,enableEdit:e.enableEdit,signed:e.displayInfo.isSigned(t.pin.name),setInputValid:e.setInputValid,internal:"Internal pins"===e.header})})]},t.pin.name)}))]})},gt=function(e){var t=e.pin,n=e.toggle,r=e.disabled,i=void 0!==r&&r,a=e.enableEdit,o=void 0===a||a,s=e.signed,c=void 0===s||s,u=e.setInputValid,l=e.internal,f=void 0!==l&&l,h=(0,p.useState)(!0),m=(0,d.Z)(h,2),g=m[0],x=m[1],b=!0,y=(0,p.useState)(""),j=(0,d.Z)(y,2),k=j[0],C=j[1],Z=(0,p.useContext)(ft);Z instanceof xt&&Z.registerCallback((function(){x(!0)}));var w=function(e){b=e,null===u||void 0===u||u(e)},P=function(e){for(var r=0;r<t.bits.length;r++)t.bits[t.bits.length-r-1][1]!==(e>>r&1)&&(null===n||void 0===n||n(t.pin,r))};return(0,p.useEffect)((function(){if(!g&&b){var e=0;if(c&&t.bits[0][1]){var n,r=(0,st.Z)(t.bits);try{for(r.s();!(n=r.n()).done;){var i=(0,d.Z)(n.value,2),a=i[0],o=i[1];a<t.bits.length-1&&!o&&(e+=Math.pow(2,a))}}catch(v){r.e(v)}finally{r.f()}e=-e-1}else{var s,u=c?t.bits.length-1:t.bits.length,l=(0,st.Z)(t.bits);try{for(l.s();!(s=l.n()).done;){var f=(0,d.Z)(s.value,2),p=f[0],h=f[1];p<u&&h&&(e+=Math.pow(2,p))}}catch(v){l.e(v)}finally{l.f()}}C(e.toString())}}),[t,g]),(0,v.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,v.jsx)("fieldset",{role:"group",style:{width:"".concat(t.bits.length,"rem")},children:g?t.bits.map((function(e){var r=(0,d.Z)(e,2),a=r[0],o=r[1];return(0,v.jsx)("button",{disabled:i,style:f?{backgroundColor:"grey"}:{},onClick:function(){return null===n||void 0===n?void 0:n(t.pin,a)},"data-testid":"pin-".concat(a),children:o},a)})):(0,v.jsx)("input",{className:"colored",value:k,onChange:function(e){!function(e){var n=e.replace(/[^\d]/g,""),r=c&&"-"===e[0]?"-".concat(n):n;if(C(r),isNaN(parseInt(r)))w(!1);else{var i=parseInt(r);!c&&i>=Math.pow(2,t.bits.length)||c&&(i>=Math.pow(2,t.bits.length-1)||i<-Math.pow(2,t.bits.length-1))?w(!1):(P(i),w(!0))}}(e.target.value)},disabled:!o})}),t.bits.length>1&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{style:{width:"1em"}}),(0,v.jsx)("button",{style:{maxWidth:"3em",margin:0},onClick:function(){x(!g)},children:g?"dec":"bin"})]})]})},xt=function(){function e(){(0,r.Z)(this,e),(0,ot.Z)(this,"callbacks",[])}return(0,i.Z)(e,[{key:"registerCallback",value:function(e){this.callbacks.push(e)}},{key:"reset",value:function(){var e,t=(0,st.Z)(this.callbacks);try{for(t.s();!(e=t.n()).done;){(0,e.value)()}}catch(n){t.e(n)}finally{t.f()}}}]),e}();var bt=function(e){var t=function(e){var t=(0,p.useRef)((function(){})),n=(0,p.useMemo)((function(){return function(e,t){var n={running:e.running,speed:e.speed,steps:e.steps},r=e.finishFrame.bind(e);return e.finishFrame=function(){r(),t.current({action:"update"})},{initialState:n,reducers:{update:function(t){t.running=e.running,t.speed=e.speed,t.steps=e.steps},setSteps:function(t,n){t.steps=n,e.steps=n},setSpeed:function(t,n){t.speed=n,e.speed=n}},actions:{frame:function(){e.frame()},start:function(){e.start(),t.current({action:"update"})},stop:function(){e.stop(),t.current({action:"update"})},reset:function(){e.reset(),t.current({action:"update"})}}}}(e,t)}),[e,t]),r=n.initialState,i=n.reducers,a=n.actions,o=De(i,r),s=(0,d.Z)(o,2),c=s[0],u=s[1];return t.current=u,{state:c,dispatch:t.current,actions:a}}(e.runner);return(0,v.jsxs)("fieldset",{role:"group",children:[(0,v.jsx)("button",{className:"flex-0",onClick:function(){return t.actions.frame()},"data-tooltip":"Step","data-placement":"bottom",children:"\u27a1\ufe0f"}),(0,v.jsx)("button",{className:"flex-0",onClick:function(){return t.state.running?t.actions.stop():t.actions.start()},"data-tooltip":t.state.running?"Pause":"Play","data-placement":"bottom",children:t.state.running?"\u23f8":"\ufe0f\u23e9"}),(0,v.jsx)("button",{className:"flex-0",onClick:function(){return t.actions.reset()},"data-tooltip":"Reset","data-placement":"bottom",children:"\u23ee"}),(0,v.jsx)("select",{className:"flex-1",name:"speed",value:t.state.speed,onChange:function(e){var n,r;t.dispatch({action:"setSpeed",payload:Number(null!==(n=null===(r=e.target)||void 0===r?void 0:r.value)&&void 0!==n?n:t.state.speed)})},disabled:t.state.running,children:[[1e3,"Slow"],[500,"Fast"],[16,"Faster"]].map((function(e){var t=(0,d.Z)(e,2),n=t[0],r=t[1];return(0,v.jsx)("option",{value:n,children:r},n)}))}),(0,v.jsx)("select",{className:"flex-1",name:"steps",value:t.state.steps,onChange:function(e){var n,r;t.dispatch({action:"setSteps",payload:Number(null!==(n=null===(r=e.target)||void 0===r?void 0:r.value)&&void 0!==n?n:t.state.steps)})},disabled:t.state.running,children:[[1,"1 Step"],[500,"500"],[1e3,"1000"],[2e3,"2000"]].map((function(e){var t=(0,d.Z)(e,2),n=t[0],r=t[1];return(0,v.jsx)("option",{value:n,children:r},n)}))}),e.children]})},yt=n(8698),jt=n(691),kt=n(8090),Ct=n(9647),Zt=n(7662),wt=n(3389),Pt=[["01","Project 1"],["02","Project 2"],["03","Project 3"],["05","Project 5"]];function St(e){return e in Zt.CHIP_ORDER?Zt.CHIP_ORDER[e]:Zt.BUILTIN_CHIP_PROJECTS[e].concat(Zt.CHIP_PROJECTS[e])}function Ft(e){return"CHIP ".concat(e," {\n  IN in;\n  OUT out;\n  PARTS:\n}")}function Nt(e){return Object.values(Zt.BUILTIN_CHIP_PROJECTS).flat().includes(e)}function It(e,t){var n=function(e,t){return Nt(t)?Zt.ChipProjects[e].BUILTIN_CHIPS[t]:Zt.ChipProjects[e].CHIPS[t]["".concat(t,".hdl")]}(e,t);if(Nt(t))return n;var r="//// Replace this comment with your code.",i="BUILTIN ".concat(t,";");return n.includes(r)?n.replace(r,i):n.replace("PARTS:","PARTS:\n    ".concat(i))}function Ot(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{clocked:e.clocked,inPins:ht(e.ins),outPins:ht(e.outs),internalPins:ht(e.pins),chip:[e],pending:t,invalid:n}}var Mt=Ke.S.get();function At(e,t,n,r){var i=function(e){var t,n,r=null!==(t=e["/chip/project"])&&void 0!==t?t:"01";return{project:r,chips:St(r),chipName:null!==(n=e["/chip/chip"])&&void 0!==n?n:Zt.CHIP_PROJECTS[r][0]}}(n),a=i.project,o=i.chipName,s=i.chips,c=new y.P9,f=new wt.l1,p=!1,v=!1,m={setFiles:function(e,t){var n=t.hdl,r=void 0===n?e.files.hdl:n,i=t.tst,a=void 0===i?e.files.tst:i,o=t.cmp,s=void 0===o?e.files.cmp:o,c=t.out,u=void 0===c?"":c;e.files.hdl=r,e.files.tst=a,e.files.cmp=s,e.files.out=u},updateChip:function(e,t){var n,r,i,a,s,u;e.sim=Ot(c,null!==(n=null===t||void 0===t?void 0:t.pending)&&void 0!==n?n:e.sim.pending,null!==(r=null===t||void 0===t?void 0:t.invalid)&&void 0!==r?r:e.sim.invalid),e.controls.error=e.sim.invalid?null!==(i=null===t||void 0===t?void 0:t.error)&&void 0!==i?i:e.controls.error:"",e.controls.chips=St(e.controls.project),e.controls.chipName=e.sim.invalid?null!==(a=null===t||void 0===t?void 0:t.chipName)&&void 0!==a?a:o:null!==(s=null!==(u=c.name)&&void 0!==u?u:null===t||void 0===t?void 0:t.chipName)&&void 0!==s?s:o,e.controls.chips.includes(e.controls.chipName)||(e.controls.chips=[].concat((0,h.Z)(e.controls.chips),[e.controls.chipName]))},setProject:function(e,t){var n=St(t),r=e.controls.chipName&&n.includes(e.controls.chipName)?e.controls.chipName:n[0];e.controls.project=t,e.controls.chips=n,this.setChip(e,r)},setChip:function(e,t){e.controls.chipName=t,e.controls.hasBuiltin=g.zZ.has(t),e.controls.builtinOnly=Nt(t)},testRunning:function(e){e.controls.runningTest=!0},testFinished:function(e){e.controls.runningTest=!1;var n=e.files.out.trim()===e.files.cmp.trim();t(n?"Simulation successful: The output file is identical to the compare file":"Simulation error: The output file differs from the compare file")},updateTestStep:function(e){var t,n,r,i;if(e.files.out=null!==(t=null===(n=f)||void 0===n?void 0:n.log())&&void 0!==t?t:"",null!==(r=f)&&void 0!==r&&null!==(i=r.currentStep)&&void 0!==i&&i.span)e.controls.span=f.currentStep.span;else if(f.done){var a=e.files.tst.length;e.controls.span={start:a-1,end:a}}this.updateChip(e,{pending:e.sim.pending,invalid:e.sim.invalid})}},x={setProject:function(e){a=n["/chip/project"]=e,r.current({action:"setProject",payload:a}),this.setChip(Zt.CHIP_PROJECTS[a][0])},setChip:function(e){var t=arguments,i=this;return(0,l.Z)((0,u.Z)().mark((function a(){var s,c;return(0,u.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(c=t.length>1&&void 0!==t[1]?t[1]:null!==(s=n["/chip/project"])&&void 0!==s?s:"01",o=n["/chip/chip"]=e,r.current({action:"setChip",payload:o}),!(v=Nt(o))){a.next=8;break}return r.current({action:"setFiles",payload:{hdl:"",tst:"",cmp:""}}),i.useBuiltin(),a.abrupt("return");case 8:return a.next=10,i.loadChip(c,o);case 10:p&&i.useBuiltin();case 11:case"end":return a.stop()}}),a)})))()},reset:function(){Ke.S.get().reset(),c.reset(),f.reset(),r.current({action:"setFiles",payload:{}}),r.current({action:"updateChip"})},updateFiles:function(e){var n=this;return(0,l.Z)((0,u.Z)().mark((function i(){var a,o,s;return(0,u.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=e.hdl,o=e.tst,s=e.cmp,r.current({action:"setFiles",payload:{hdl:a,tst:o,cmp:s}}),i.prev=2,!a){i.next=6;break}return i.next=6,n.compileChip(a);case 6:o&&n.compileTest(o),i.next=12;break;case 9:i.prev=9,i.t0=i.catch(2),t((0,We.j)(i.t0));case 12:case"end":return i.stop()}}),i,null,[[2,9]])})))()},compileChip:function(e){var n=this;return(0,l.Z)((0,u.Z)().mark((function i(){var a,o,s;return(0,u.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(c.remove(),a=kt.Gq.parse(e),!(0,ut.dZ)(a)){i.next=6;break}return t("Failed to parse chip"),r.current({action:"updateChip",payload:{invalid:!0,error:(0,We.j)((0,ut.UG)(a))}}),i.abrupt("return");case 6:return i.next=8,(0,jt.J_)((0,ut.Ok)(a));case 8:if(o=i.sent,!(0,ut.dZ)(o)){i.next=14;break}return s=(0,We.j)((0,ut.UG)(o)),t(s),r.current({action:"updateChip",payload:{invalid:!0,error:s}}),i.abrupt("return");case 14:t("Compiled ".concat(c.name)),n.replaceChip((0,ut.Ok)(o));case 16:case"end":return i.stop()}}),i)})))()},replaceChip:function(e){var t,n=c.ins,i=(0,st.Z)(n);try{for(i.s();!(t=i.n()).done;){var a=(0,d.Z)(t.value,2),o=a[0],s=a[1].busVoltage,u=e.ins.get(o);u&&(u.busVoltage=s)}}catch(l){i.e(l)}finally{i.f()}Mt.reset(),e.eval(),(c=e).reset(),f=f.with(c).reset(),r.current({action:"updateChip",payload:{invalid:!1}}),r.current({action:"updateTestStep"})},loadChip:function(t,i){var a=this;return(0,l.Z)((0,u.Z)().mark((function o(){var s,c,l,f,p,h;return(0,u.Z)().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return n["/chip/chip"]=i,s=function(e){return"/projects/".concat(t,"/").concat(i,"/").concat(i,".").concat(e)},o.next=4,Promise.all([e.readFile(s("hdl")).catch((function(){return Ft(i)})),e.readFile(s("tst")).catch((function(e){return"repeat 10 {\n  tick,\n  tock;\n}"})),e.readFile(s("cmp")).catch((function(){return"| in|out|"}))]);case 4:return c=o.sent,l=(0,d.Z)(c,3),f=l[0],p=l[1],h=l[2],r.current({action:"setFiles",payload:{hdl:f,tst:p,cmp:h}}),o.next=12,a.compileChip(f);case 12:a.compileTest(p);case 13:case"end":return o.stop()}}),o)})))()},saveChip:function(n){var i=arguments;return(0,l.Z)((0,u.Z)().mark((function s(){var c,l,d;return(0,u.Z)().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return c=i.length>1&&void 0!==i[1]?i[1]:a,l=i.length>2&&void 0!==i[2]?i[2]:o,r.current({action:"setFiles",payload:{hdl:n}}),d="/projects/".concat(c,"/").concat(l,"/").concat(l,".hdl"),s.next=6,e.writeFile(d,n);case 6:t("Saved ".concat(d));case 7:case"end":return s.stop()}}),s)})))()},toggle:function(e,t){void 0!==t?e.busVoltage=e.busVoltage^1<<t:1===e.width?e.toggle():e.busVoltage+=1,r.current({action:"updateChip",payload:{pending:!0}})},eval:function(){c.eval(),r.current({action:"updateChip",payload:{pending:!1}})},clock:function(){Mt.toggle(),Mt.isLow&&Mt.frame(),r.current({action:"updateChip"})},useBuiltin:function(){var e=arguments,n=this;return(0,l.Z)((0,u.Z)().mark((function i(){var s,c,l,d,f;return(0,u.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s=!(e.length>0&&void 0!==e[0])||e[0],c=e.length>1?e[1]:void 0,s){i.next=7;break}return v||(p=!1),i.next=6,n.loadChip(a,o);case 6:return i.abrupt("return");case 7:if(v||(p=!0),l=o,d=(0,g.cT)(l),!(0,ut.dZ)(d)){i.next=13;break}return t("Failed to load builtin ".concat(l,": ").concat((0,We.j)((0,ut.UG)(d)))),i.abrupt("return");case 13:if(!c){i.next=16;break}return i.next=16,n.saveChip(c,a,o);case 16:f=It(a,l),r.current({action:"setFiles",payload:{hdl:f}}),n.replaceChip((0,ut.Ok)(d));case 19:case"end":return i.stop()}}),i)})))()},initialize:function(){var e=this;return(0,l.Z)((0,u.Z)().mark((function t(){return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setChip(o,a);case 2:case"end":return t.stop()}}),t)})))()},compileTest:function(n){r.current({action:"setFiles",payload:{tst:n}});var i=Ct.qH.parse(n);return(0,ut.dZ)(i)?(t("Failed to parse test"),!1):(t("Parsed tst"),(f=wt.l1.from((0,ut.Ok)(i)).with(c).reset()).setFileSystem(e),r.current({action:"updateTestStep"}),!0)},runTest:function(t){var n=this;return(0,l.Z)((0,u.Z)().mark((function i(){return(0,u.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n.compileTest(t)){i.next=2;break}return i.abrupt("return");case 2:return r.current({action:"testRunning"}),e.pushd("/samples"),i.next=6,f.run();case 6:e.popd(),r.current({action:"updateTestStep"}),r.current({action:"testFinished"});case 9:case"end":return i.stop()}}),i)})))()},tick:function(){return this.stepTest()},stepTest:function(){return(0,l.Z)((0,u.Z)().mark((function e(){var t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,Qe.hu)(f.chipId===c.id,"Test and chip out of sync"),e.next=3,f.step();case 3:return t=e.sent,r.current({action:"updateTestStep"}),t&&r.current({action:"testFinished"}),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})))()}};return{initialState:function(){var e={project:a,chips:s,chipName:o,hasBuiltin:g.zZ.has(o),builtinOnly:Nt(o),runningTest:!1,error:""},n=(0,g.cT)(e.chipName);return(0,ut.dZ)(n)?(t((0,We.j)((0,ut.UG)(n))),c=new y.P9):c=(0,ut.Ok)(n),{controls:e,files:{hdl:"",cmp:"",tst:"",out:""},sim:Ot(c)}}(),reducers:m,actions:x}}var Et=n(8365),Tt=n(7538),Rt=n(2648),_t=n(3943),Dt=Ke.S.get(),Ht=new WeakMap,zt=new WeakMap,Ut=new WeakMap,Bt=new WeakMap,Lt=function(){function e(){var t=this;(0,r.Z)(this,e),(0,ot.Z)(this,"steps",1),(0,ot.Z)(this,"speed",1e3),(0,Tt.Z)(this,Ht,{writable:!0,value:!1}),(0,Tt.Z)(this,zt,{writable:!0,value:0}),(0,Tt.Z)(this,Ut,{writable:!0,value:0}),(0,Tt.Z)(this,Bt,{writable:!0,value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){var n,r,i,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,_t.Z)(t,Ht)){e.next=2;break}return e.abrupt("return");case 2:if(n=Date.now(),r=n-(0,_t.Z)(t,Ut),(0,Rt.Z)(t,Ut,n),(0,Rt.Z)(t,zt,(0,_t.Z)(t,zt)+r),!((0,_t.Z)(t,zt)>t.speed)){e.next=19;break}i=!1,a=0;case 9:if(!(a<Math.min(t.steps,1e3))||i){e.next=16;break}return e.next=12,t.tick();case 12:i=e.sent;case 13:a++,e.next=9;break;case 16:t.finishFrame(),i&&t.stop(),(0,Rt.Z)(t,zt,(0,_t.Z)(t,zt)-t.speed);case 19:requestAnimationFrame((0,_t.Z)(t,Bt));case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()})}return(0,i.Z)(e,[{key:"frame",value:function(){this.tick(),this.finishFrame()}},{key:"finishFrame",value:function(){Dt.frame()}},{key:"running",get:function(){return(0,_t.Z)(this,Ht)}},{key:"start",value:function(){(0,Rt.Z)(this,Ht,!0),(0,Rt.Z)(this,Ut,Date.now()-this.speed),(0,_t.Z)(this,Bt).call(this),this.toggle()}},{key:"stop",value:function(){(0,Rt.Z)(this,Ht,!1),this.toggle()}}]),e}(),Vt=n(8016),Wt=n(659),Kt=n(9422);var Jt=n(7536),Gt=n(1510),$t=function(e){var t,n,r=e.error;return null!==r&&void 0!==r&&r.failed()?(0,v.jsxs)("details",{className:"ErrorPanel",open:!0,children:[(0,v.jsx)("summary",{role:"button",className:"secondary",children:(0,v.jsx)(f.cC,{id:"Parse Error"})}),(0,v.jsx)("pre",{children:(0,v.jsx)("code",{children:null!==(t=null!==(n=null===r||void 0===r?void 0:r.message)&&void 0!==n?n:null===r||void 0===r?void 0:r.shortMessage)&&void 0!==t?t:Gt.eP})})]}):(0,v.jsx)(v.Fragment,{})},qt=function(e){var t=e.value,n=e.onChange,r=e.language,i=e.disabled,a=void 0!==i&&i,o=(0,p.useState)(t),s=(0,d.Z)(o,2),c=s[0],u=s[1];return(0,v.jsx)("textarea",{"data-testid":"editor-".concat(r),disabled:a,value:c,onChange:function(e){var t,r=null===(t=e.target)||void 0===t?void 0:t.value;u(r),n(r)}})},Xt=function(e){var t=e.value,n=e.onChange,r=e.language,i=e.error,a=e.disabled,o=void 0!==a&&a,s=e.highlight,c=(0,p.useContext)(Vt.Il).theme,u=(0,Jt.Ik)(),l=(0,p.useRef)(),d=(0,p.useRef)([]),f=(0,p.useRef)(void 0),h=(0,p.useCallback)((function(){return("system"===c?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"===c)?"vs-dark":"vs"}),[c]),m=(0,p.useCallback)((function(){var e;d.current=function(e,t,n,r){if(!t||!n)return r;var i=t.getModel();if(!i)return r;var a=i.getPositionAt(n.start),o=i.getPositionAt(n.end),s=null===e||void 0===e?void 0:e.Range.fromPositions(a,o),c=[];return s&&(c.push({range:s,options:{inlineClassName:"highlight"}}),t.revealRangeInCenter(s)),t.deltaDecorations(r,c)}(u,l.current,null!==(e=f.current)&&void 0!==e?e:{start:0,end:0},d.current)}),[d,u,l,f]);(0,p.useEffect)((function(){f.current=s,m()}),[s]);var g=(0,p.useCallback)((function(e){var t;l.current=e,null===(t=l.current)||void 0===t||t.updateOptions({fontFamily:'"JetBrains Mono", source-code-pro, Menlo, Monaco,\n      Consolas, "Roboto Mono", "Ubuntu Monospace", "Noto Mono", "Oxygen Mono",\n      "Liberation Mono", monospace, "Apple Color Emoji", "Segoe UI Emoji",\n      "Segoe UI Symbol", "Noto Color Emoji"',fontSize:16,minimap:{enabled:!1},theme:h(),scrollBeyondLastLine:!1,readOnly:o}),m()}),[h]);return(0,p.useEffect)((function(){void 0!==l.current&&l.current.updateOptions({theme:h()})}),[l,h]),(0,p.useEffect)((function(){void 0!==l.current&&l.current.updateOptions({readOnly:o})}),[l,o]),(0,p.useEffect)((function(){var e,t,n,a,o;if(void 0!==l.current&&null!==u){var s=l.current.getModel();if(null!==s)if(void 0===i||i.succeeded())u.editor.setModelMarkers(s,r,[]);else{var c=null!==(e=null===(t=(0,Kt.Z)(/Line (\d+), col (\d+): (.*)/,{line:1,column:2,message:3}).exec(null!==(n=i.shortMessage)&&void 0!==n?n:""))||void 0===t?void 0:t.groups)&&void 0!==e?e:{line:1,column:1,message:"could not parse error"},d=c.line,f=c.column,p=c.message,h=Number(d),v=h,m=Number(f),g=m+(null!==(a=null===(o=s.getLineContent(h).substring(m-1).match(/([^\s]+)/))||void 0===o?void 0:o[0].length)&&void 0!==a?a:1);g<=m&&(g=m+1),u.editor.setModelMarkers(s,r,[{message:p,startColumn:m,startLineNumber:h,endColumn:g,endLineNumber:v,severity:8}])}}}),[i,l,u,r]),(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(Jt.ZP,{value:t,onChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return n(e)},language:r,onMount:g})})},Yt=function(e){var t=e.className,n=void 0===t?"":t,r=e.style,i=void 0===r?{}:r,a=e.disabled,o=void 0!==a&&a,s=e.value,c=e.onChange,u=e.grammar,l=e.language,f=e.highlight,h=(0,p.useState)(),m=(0,d.Z)(h,2),g=m[0],x=m[1],b=(0,p.useContext)(Vt.Il).monaco,y=(0,p.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=u.match(e);x(t.failed()?t:void 0)}),[x,u]);(0,p.useEffect)((function(){return y(s)}),[y,s]);var j=(0,p.useMemo)((function(){return function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;return function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return clearTimeout(t),t=setTimeout((function(){return clearTimeout(t),e.apply(void 0,i)}),n)}}(y,500)}),[y]),k=(0,p.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";c(e),j(e)}),[j,c]);return(0,v.jsx)("div",{className:"Editor ".concat(n),style:i,children:b.canUse&&b.wants?(0,v.jsx)(Xt,{value:s,onChange:k,language:l,error:g,disabled:o,highlight:f}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(qt,{value:s,onChange:k,language:l,disabled:o}),(0,v.jsx)($t,{error:g})]})})},Qt=function(e){var t;return(0,v.jsxs)("article",{className:["panel",null!==(t=e.className)&&void 0!==t?t:""].join(" "),children:[e.header&&(0,v.jsx)("header",{children:e.header}),(0,v.jsx)("main",{children:e.children}),e.footer&&(0,v.jsx)("footer",{children:e.footer})]})},en=function(e){var t;return(0,v.jsxs)("details",{className:null!==(t=e.className)&&void 0!==t?t:"",open:e.open,style:e.style,children:[(0,v.jsx)("summary",{children:(0,v.jsx)("div",{className:"flex row align-baseline",children:e.summary})}),e.children]})},tn=function(){var e=(0,p.useContext)(yt.r),t=e.fs,n=e.setStatus,m=(0,p.useContext)(Vt.Il),g=m.filePicker,x=m.tracking,b=function(){var e=(0,p.useContext)(yt.r),t=e.fs,n=e.setStatus,r=e.storage,i=(0,p.useRef)((function(){})),a=(0,p.useMemo)((function(){return At(t,n,r,i)}),[t,n,r,i]),o=a.initialState,s=a.reducers,c=a.actions,u=De(s,o),l=(0,d.Z)(u,2),f=l[0],h=l[1];return i.current=h,{state:f,dispatch:i,actions:c}}(),y=b.state,j=b.actions,k=b.dispatch,C=He(y.files.hdl),Z=(0,d.Z)(C,2),w=Z[0],P=Z[1],S=He(y.files.tst),F=(0,d.Z)(S,2),N=F[0],I=F[1],O=He(y.files.cmp),M=(0,d.Z)(O,2),A=M[0],E=M[1],T=He(y.files.out),R=(0,d.Z)(T,1)[0];(0,p.useEffect)((function(){j.initialize()}),[j]),(0,p.useEffect)((function(){x.trackPage("/chip")}),[x]);(0,p.useEffect)((function(){x.trackEvent("action","setProject",y.controls.project),x.trackEvent("action","setChip",y.controls.chipName)}),[]);var _=(0,p.useCallback)((function(e){j.setProject(e),x.trackEvent("action","setProject",e)}),[j,x]),D=(0,p.useCallback)((function(e){j.setChip(e),x.trackEvent("action","setChip",e),ne.reset()}),[j,x]),H=(0,p.useCallback)((function(){j.eval(),x.trackEvent("action","eval")}),[j,x]),z=(0,p.useRef)((function(){}));z.current=(0,l.Z)((0,u.Z)().mark((function e(){var t,n,r,i=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>0&&void 0!==i[0]?i[0]:{},e.next=3,j.updateFiles({hdl:r.hdl,tst:null!==(t=r.tst)&&void 0!==t?t:N,cmp:null!==(n=r.cmp)&&void 0!==n?n:A});case 3:case"end":return e.stop()}}),e)})));var U=(0,p.useCallback)((0,l.Z)((0,u.Z)().mark((function e(){var r,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.select();case 3:return r=e.sent,e.next=6,t.readFile(r);case 6:return i=e.sent,e.next=9,z.current({tst:i});case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0),n("Failed to load into memory");case 15:case"end":return e.stop()}}),e,null,[[0,11]])}))),[g,n,t,z]),B=(0,p.useRef)();(0,p.useEffect)((function(){return B.current=new(function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"reset",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.current();case 2:return e.next=4,j.reset();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"finishFrame",value:function(){(0,a.Z)((0,o.Z)(n.prototype),"finishFrame",this).call(this),k.current({action:"updateTestStep"})}},{key:"tick",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",j.stepTest());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"toggle",value:function(){k.current({action:"updateTestStep"})}}]),n}(Lt)),function(){var e;null===(e=B.current)||void 0===e||e.stop()}}),[z,j,k]);var L=(0,p.useMemo)((function(){return{toggle:function(){j.clock(),x.trackEvent("action","toggleClock")},reset:function(){x.trackEvent("action","resetClock"),j.reset()}}}),[j]),V=(0,p.useState)(!1),W=(0,d.Z)(V,2),K=W[0],J=W[1],G=(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)("fieldset",{role:"group",children:[(0,v.jsx)("select",{value:y.controls.project,onChange:function(e){var t=e.target.value;_(t)},"data-testid":"project-picker",children:Pt.map((function(e){var t=(0,d.Z)(e,2),n=t[0],r=t[1];return(0,v.jsx)("option",{value:n,children:r},n)}))}),(0,v.jsx)("select",{value:y.controls.chipName,onChange:function(e){var t=e.target.value;D(t)},"data-testid":"chip-picker",children:y.controls.chips.map((function(e){return(0,v.jsx)("option",{value:e,style:Nt(e)?{color:"rgb(170, 170, 170)"}:{},children:"".concat(e," ").concat(Nt(e)?"(given)":"")},e)}))}),(0,v.jsx)("button",{className:"flex-0",onClick:function(){j.saveChip(w)},disabled:K,children:(0,v.jsx)(f.cC,{id:"Save"})})]})}),$=(0,v.jsx)(Qt,{className:"_hdl_panel",header:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{tabIndex:0,children:"HDL"}),(0,v.jsx)("fieldset",{children:y.controls.hasBuiltin&&!y.controls.builtinOnly&&(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"checkbox",role:"switch",checked:K,onChange:function(){K?(J(!1),j.useBuiltin(!1)):(J(!0),j.useBuiltin(!0,w)),ne.reset()}}),(0,v.jsx)(f.cC,{id:"Builtin"})]})}),G]}),children:(0,v.jsx)(Yt,{className:"flex-1",value:w,onChange:function(e){P(e),z.current(K||y.controls.builtinOnly?{}:{hdl:e})},grammar:kt.Gq.parser,language:"hdl",disabled:K||y.controls.builtinOnly})}),q=(0,p.useState)(!0),X=(0,d.Z)(q,2),Y=X[0],Q=X[1],ee=(0,v.jsxs)("fieldset",{role:"group",children:[(0,v.jsx)("button",{onClick:H,onKeyDown:H,disabled:!y.sim.pending||!Y,children:(0,v.jsx)(f.cC,{id:"Eval"})}),(0,v.jsxs)("button",{onClick:L.toggle,style:{maxWidth:"initial"},disabled:!y.sim.clocked,children:[(0,v.jsx)(f.cC,{id:"Clock"}),":","\xa0",(0,v.jsx)($e,{})]}),(0,v.jsx)("button",{onClick:L.reset,style:{maxWidth:"initial"},disabled:!y.sim.clocked,children:(0,v.jsx)(f.cC,{id:"Reset"})})]}),te=function(e,t){return(0,h.Z)(e.parts).map((function(e,n){return["".concat(e.id,"_").concat(n),it(e,t)]})).filter((function(e){var t=(0,d.Z)(e,2);return t[0],void 0!==t[1]}))}({parts:y.sim.chip},(function(){k.current({action:"updateChip"})})),ne=new xt,re=(0,v.jsx)(Qt,{className:"_parts_panel",header:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{children:(0,v.jsx)(f.cC,{id:"Chip"})}),ee]}),children:y.sim.invalid?(0,v.jsx)(f.cC,{id:"Syntax errors in the HDL code"}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(ft.Provider,{value:ne,children:(0,v.jsx)(vt,{sim:y.sim,toggle:j.toggle,setInputValid:Q,hideInternal:y.controls.builtinOnly})}),te.length>0&&(0,v.jsx)(en,{summary:(0,v.jsx)(f.cC,{id:"Visualization"}),open:!0,children:(0,v.jsx)("main",{children:te.map((function(e){var t=(0,d.Z)(e,2);t[0];return t[1]}))})})]})}),ie=(0,p.useState)("tst"),ae=(0,d.Z)(ie,2),oe=ae[0],se=ae[1],ce=(0,p.useCallback)((function(e){se(e),x.trackEvent("tab","change",e)}),[x]),ue=(0,v.jsx)(Qt,{className:"_test_panel",header:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"flex-1",children:(0,v.jsx)(f.cC,{id:"Test"})}),(0,v.jsx)("div",{className:"flex-2",children:B.current&&(0,v.jsx)(bt,{runner:B.current})}),(0,v.jsx)("div",{children:(0,v.jsxs)("button",{onClick:U,children:[(0,v.jsx)(Wt.J,{name:"upload_file"})," "]})})]}),children:(0,v.jsxs)("div",{role:"tablist",style:{"--tab-count":"3"},children:[(0,v.jsx)("div",{role:"tab",id:"test-tab-tst","aria-controls":"test-tabpanel-tst","aria-selected":"tst"===oe,children:(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-tst",value:"tst",checked:"tst"===oe,onChange:function(){return ce("tst")}}),"Test Script"]})}),(0,v.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-tst",id:"test-tabpanel-tst",children:(0,v.jsx)(Yt,{value:N,onChange:I,grammar:Ct.qH.parser,language:"tst",highlight:y.controls.span,disabled:y.controls.builtinOnly})}),(0,v.jsx)("div",{role:"tab",id:"test-tab-cmp","aria-controls":"test-tablpanel-cmp","aria-selected":"cmp"===oe,children:(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-cmp",value:"cmp",checked:"cmp"===oe,onChange:function(){return ce("cmp")}}),"Compare File"]})}),(0,v.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-cmp",id:"test-tabpanel-cmp",style:{position:"relative"},children:(0,v.jsx)(Yt,{value:A,onChange:E,grammar:Et.lA.parser,language:"cmp",disabled:y.controls.builtinOnly})}),(0,v.jsx)("div",{role:"tab",id:"test-tab-out","aria-controls":"test-tabpanel-out","aria-selected":"out"===oe,children:(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-out",value:"out",checked:"out"===oe,onChange:function(){return ce("out")}}),"Output File"]})}),(0,v.jsx)("div",{role:"tabpanel",id:"test-tabpanel-out","aria-labelledby":"test-tab-out",children:(0,v.jsx)(at.M,{cmp:A,out:R})})]})});return(0,v.jsxs)("div",{className:"ChipPage grid",children:[$,re,ue]})},nn=tn}}]);
//# sourceMappingURL=263.2ef9b5f7.chunk.js.map