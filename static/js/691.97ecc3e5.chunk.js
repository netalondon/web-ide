"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[691],{691:(t,s,e)=>{e.d(s,{J_:()=>l});var i=e(4625),r=e(8090),n=e(3118),a=e(6329);function o(t,s){if(void 0!==s){if(s>=t)return s-t+1;if(t>0&&0===s)return 1;throw new Error(`Bus specification has start > end (${t} > ${s})`)}}async function u(t,s){if((0,n._c)(t)||void 0===s)return(0,n.cT)(t);try{const e=await s.readFile(`${t}.hdl`),n=r.Gq.parse(e);return(0,i.IY)(n)?l((0,i.Ok)(n),s):(0,i.UG)(new Error("HDL Was not parsed"))}catch(e){return(0,i.UG)(new Error(`Could not load chip ${t}.hdl`))}}async function l(t,s){if("BUILTIN"===t.parts)return(0,n.cT)(t.name.toString());const e=new a.Af(t.ins.map((t=>{let{pin:s,width:e}=t;return{pin:s.toString(),width:e}})),t.outs.map((t=>{let{pin:s,width:e}=t;return{pin:s.toString(),width:e}})),t.name.toString(),[],t.clocked);for(const n of t.parts){const t=await u(n.name.toString(),s);if((0,i.dZ)(t))return t;const a=(0,i.Ok)(t),l=n.wires.map((t=>{let{lhs:s,rhs:e}=t;return{to:{name:s.pin.toString(),start:s.start??0,width:o(s.start??0,s.end)},from:{name:e.pin.toString(),start:e.start??0,width:o(e.start??0,e.end)}}}));try{e.wire(a,l)}catch(r){return(0,i.UG)(r)}}return(0,i.Ok)(e)}},3300:(t,s,e)=>{e.d(s,{N1:()=>c,Z9:()=>b,ar:()=>g,lL:()=>h,m1:()=>l,zp:()=>d});var i=e(6329),r=e(3116),n=e(134),a=e(326),o=e(7930),u=e(5838);class l extends r.FH{constructor(){super(16,"ROM")}async load(t,s){try{(await(0,o.zD)(t,s)).map(((t,s)=>this.at(s).busVoltage=t))}catch(e){throw new Error(`ROM32K Failed to load file ${s}`)}}}class h extends r.FH{static SIZE=u.yJ;static OFFSET=u.GD;constructor(){super(13,"Screen")}}class c extends i.Af{static OFFSET=u.eu;constructor(){super([],["out[16]"],"Keyboard")}getKey(){return this.out().busVoltage}setKey(t){this.out().busVoltage=65535&t}clearKey(){this.out().busVoltage=0}}class d extends i.tI{ram=new r.xs;screen=new h;keyboard=new c;address=0;constructor(){super(["in[16]","load","address[15])"],["out[16]"],"Memory"),this.parts.add(this.keyboard),this.parts.add(this.screen),this.parts.add(this.ram)}tick(){const t=this.in("load").voltage();if(this.address=this.in("address").busVoltage,t){const t=this.in().busVoltage;this.address>=c.OFFSET||(this.address>=h.OFFSET?this.screen.at(this.address-h.OFFSET).busVoltage=t:this.ram.at(this.address).busVoltage=t)}}tock(){this.eval()}eval(){if(!this.ram)return;this.address=this.in("address").busVoltage;let t=0;t=this.address>=c.OFFSET?this.keyboard?.out().busVoltage??0:this.address>=h.OFFSET?this.screen?.at(this.address-h.OFFSET).busVoltage??0:this.ram?.at(this.address).busVoltage??0,this.out().busVoltage=t}in(t){if(t?.startsWith("RAM16K")){const s=(0,a.o5)(t.match(/\[(?<idx>\d+)]/)?.groups?.idx??"0");return this.ram.at(s)}if(t?.startsWith("Screen")){const s=(0,a.o5)(t.match(/\[(?<idx>\d+)]/)?.groups?.idx??"0");return this.screen.at(s)}return super.in(t)}get(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.startsWith("RAM16K")?this.at(16383&s):t.startsWith("Screen")?this.at(s&8191+h.OFFSET):t.startsWith("Keyboard")?this.at(c.OFFSET):t.startsWith("Memory")?this.at(s):super.get(t,s)}at(t){return t>=c.OFFSET?this.keyboard.out():t>=h.OFFSET?this.screen.at(t-h.OFFSET):this.ram.at(t)}reset(){this.address=0,this.ram.reset(),this.screen.reset(),super.reset()}}class b extends i.tI{_state=(0,n.Zu)();get state(){return this._state}constructor(){super(["inM[16]","instruction[16]","reset"],["outM[16]","writeM","addressM[15]","pc[15]"])}tick(){const[t,s]=(0,n.aL)(this.cpuInput(),this._state);this._state=t,this.out("writeM").pull(s?i.lj:i.yE),this.out("outM").busVoltage=this._state.ALU??0}tock(){if(!this._state)return;const[t,s]=(0,n.Ff)(this.cpuInput(),this._state);this._state=s,this.out("addressM").busVoltage=t.addressM??0,this.out("outM").busVoltage=t.outM??0,this.out("writeM").pull(t.writeM?i.lj:i.yE),this.out("pc").busVoltage=this._state?.PC??0}cpuInput(){return{inM:this.in("inM").busVoltage,instruction:this.in("instruction").busVoltage,reset:1===this.in("reset").busVoltage}}get(t,s){return t?.startsWith("ARegister")?new i.qP("ARegister",this._state.A):t?.startsWith("DRegister")?new i.qP("DRegister",this._state.D):t?.startsWith("PC")?new i.qP("PC",this._state.PC):super.get(t,s)}reset(){this._state=(0,n.Zu)(),this._state.PC=-1,super.reset()}}class g extends i.Af{#t=new d;#s=new l;#e=new b;constructor(){super(["reset"],[]),this.wire(this.#e,[{from:{name:"reset",start:0},to:{name:"reset",start:0}},{from:{name:"instruction",start:0},to:{name:"instruction",start:0}},{from:{name:"outM",start:0},to:{name:"inM",start:0}},{from:{name:"writeM",start:0},to:{name:"writeM",start:0}},{from:{name:"addressM",start:0},to:{name:"addressM",start:0}}]),this.wire(this.#s,[{from:{name:"pc",start:0},to:{name:"address",start:0}},{from:{name:"instruction",start:0},to:{name:"out",start:0}}]),this.wire(this.#t,[{from:{name:"inM",start:0},to:{name:"in",start:0}},{from:{name:"writeM",start:0},to:{name:"load",start:0}},{from:{name:"addressM",start:0},to:{name:"address",start:0}},{from:{name:"outM",start:0},to:{name:"out",start:0}}])}eval(){super.eval()}get(t,s){return t.startsWith("PC")||t.startsWith("ARegister")||t.startsWith("DRegister")?this.#e.get(t):t.startsWith("RAM16K")?this.#t.get(t,s):super.get(t,s)}load(t,s){return this.#s.load(t,s)}}},3118:(t,s,e)=>{e.d(s,{JU:()=>W,zZ:()=>D,cT:()=>N,_c:()=>z});var i=e(4625),r=e(6329);class n extends r.Af{constructor(){super(["a","b"],["out"])}eval(){const t=this.in("a").voltage(),s=this.in("b").voltage(),[e]=function(t,s){return[1===t&&1===s?r.lj:r.yE]}(t,s);this.out().pull(e)}}class a extends r.Af{constructor(){super(["a[16]","b[16]"],["out[16]"])}eval(){const t=this.in("a").busVoltage,s=this.in("b").busVoltage,[e]=function(t,s){return[t&s&65535]}(t,s);this.out().busVoltage=e}}class o extends r.Af{constructor(){super(["in","sel"],["a","b"])}eval(){const t=this.in("in").voltage(),s=this.in("sel").voltage(),[e,i]=function(t,s){return[s===r.yE&&t===r.lj?r.lj:r.yE,s===r.lj&&t===r.lj?r.lj:r.yE]}(t,s);this.out("a").pull(e),this.out("b").pull(i)}}class u extends r.Af{constructor(){super(["in","sel[2]"],["a","b","c","d"])}eval(){const t=this.in("in").voltage(),s=this.in("sel").busVoltage,[e,i,n,a]=function(t,s){return[0===s&&t===r.lj?r.lj:r.yE,1===s&&t===r.lj?r.lj:r.yE,2===s&&t===r.lj?r.lj:r.yE,3===s&&t===r.lj?r.lj:r.yE]}(t,s);this.out("a").pull(e),this.out("b").pull(i),this.out("c").pull(n),this.out("d").pull(a)}}class l extends r.Af{constructor(){super(["in","sel[3]"],["a","b","c","d","e","f","g","h"])}eval(){const t=this.in("in").voltage(),s=this.in("sel").busVoltage,[e,i,n,a,o,u,l,h]=function(t,s){return[0===s&&t===r.lj?r.lj:r.yE,1===s&&t===r.lj?r.lj:r.yE,2===s&&t===r.lj?r.lj:r.yE,3===s&&t===r.lj?r.lj:r.yE,4===s&&t===r.lj?r.lj:r.yE,5===s&&t===r.lj?r.lj:r.yE,6===s&&t===r.lj?r.lj:r.yE,7===s&&t===r.lj?r.lj:r.yE]}(t,s);this.out("a").pull(e),this.out("b").pull(i),this.out("c").pull(n),this.out("d").pull(a),this.out("e").pull(o),this.out("f").pull(u),this.out("g").pull(l),this.out("h").pull(h)}}function h(t,s,e){return[e===r.yE?t:s]}function c(t,s,e,i,r){const n=1&r;return 0===(2&r)?h(t,s,n):h(e,i,n)}class d extends r.Af{constructor(){super(["a","b","sel"],["out"])}eval(){const t=this.in("a").voltage(),s=this.in("b").voltage(),e=this.in("sel").voltage(),[i]=function(t,s,e){return[e===r.yE?t:s]}(t,s,e);this.out().pull(i)}}class b extends r.Af{constructor(){super(["a[16]","b[16]","sel"],["out[16]"])}eval(){const t=this.in("a").busVoltage,s=this.in("b").busVoltage,e=this.in("sel").voltage(),[i]=h(t,s,e);this.out().busVoltage=i}}class g extends r.Af{constructor(){super(["a[16]","b[16]","c[16]","d[16]","sel[2]"],["out[16]"])}eval(){const t=this.in("a").busVoltage,s=this.in("b").busVoltage,e=this.in("c").busVoltage,i=this.in("d").busVoltage,r=this.in("sel").busVoltage,[n]=c(t,s,e,i,r);this.out().busVoltage=n}}class p extends r.Af{constructor(){super(["a[16]","b[16]","c[16]","d[16]","e[16]","f[16]","g[16]","h[16]","sel[3]"],["out[16]"])}eval(){const t=this.in("a").busVoltage,s=this.in("b").busVoltage,e=this.in("c").busVoltage,i=this.in("d").busVoltage,r=this.in("e").busVoltage,n=this.in("f").busVoltage,a=this.in("g").busVoltage,o=this.in("h").busVoltage,u=this.in("sel").busVoltage,[l]=function(t,s,e,i,r,n,a,o,u){const l=3&u;return 0===(4&u)?c(t,s,e,i,l):c(r,n,a,o,l)}(t,s,e,i,r,n,a,o,u);this.out().busVoltage=l}}var m=e(326);class V extends r.Af{constructor(){super(["a","b"],["out"])}eval(){const t=this.in("a").voltage(),s=this.in("b").voltage(),[e]=function(t,s){return[1===t&&1===s?r.yE:r.lj]}(t,s);this.out().pull(e)}}class y extends r.Af{constructor(){super(["a[16]","b[16]"],["out[16]"])}eval(){const t=this.in("a").busVoltage,s=this.in("b").busVoltage;this.out().busVoltage=(0,m.C2)(t,s)}}class f extends r.Af{constructor(){super(["in"],["out"])}eval(){const t=this.in("in").voltage(),[s]=[t===r.yE?r.lj:r.yE];this.out().pull(s)}}class v extends r.Af{constructor(){super(["in[16]"],["out[16]"])}eval(){const[t]=[65535&~this.in().busVoltage];this.out().busVoltage=t}}function x(t,s){return[1===t||1===s?r.lj:r.yE]}class A extends r.Af{constructor(){super(["a","b"],["out"])}eval(){const t=this.in("a").voltage(),s=this.in("b").voltage(),[e]=x(t,s);this.out().pull(e)}}class E extends r.Af{constructor(){super(["a[16]","b[16]"],["out[16]"])}eval(){const t=this.in("a").busVoltage,s=this.in("b").busVoltage,[e]=function(t,s){return[65535&(t|s)]}(t,s);this.out().busVoltage=e}}class S extends r.Af{constructor(){super(["in[8]"],["out"],"Or8way")}eval(){const t=this.in().busVoltage,[s]=[0===(255&t)?r.yE:r.lj];this.out().pull(s)}}class w extends r.Af{constructor(){super(["a","b"],["out"])}eval(){const t=this.in("a").voltage(),s=this.in("b").voltage(),[e]=function(t,s){return[t===r.lj&&s===r.yE||t===r.yE&&s===r.lj?r.lj:r.yE]}(t,s);this.out().pull(e)}}class P extends r.Af{constructor(){super(["a[16]","b[16]"],["out[16]"])}eval(){const t=this.in("a").busVoltage,s=this.in("b").busVoltage,[e]=function(t,s){return[65535&(t^s)]}(t,s);this.out().busVoltage=e}}function j(t,s){return[t+s&65535]}class M extends r.Af{constructor(){super(["a[16]","b[16]"],["out[16]"],"Add16")}eval(){const t=this.in("a").busVoltage,s=this.in("b").busVoltage,[e]=j(t,s);this.out().busVoltage=e}}var _=e(6693);class C extends r.Af{constructor(){super(["x[16]","y[16]","zx","nx","zy","ny","f","no"],["out[16]"],"ALU")}eval(){const t=this.in("x").busVoltage,s=this.in("y").busVoltage,e=(this.in("zx").busVoltage<<5)+(this.in("nx").busVoltage<<4)+(this.in("zy").busVoltage<<3)+(this.in("ny").busVoltage<<2)+(this.in("f").busVoltage<<1)+(this.in("no").busVoltage<<0),[i]=(0,_.Bb)(e,t,s);this.out().busVoltage=i}}class W extends r.Af{constructor(){super(["x[16]","y[16]","zx","nx","zy","ny","f","no"],["out[16]","zr","ng"],"ALU")}eval(){const t=this.in("x").busVoltage,s=this.in("y").busVoltage,e=(this.in("zx").busVoltage<<5)+(this.in("nx").busVoltage<<4)+(this.in("zy").busVoltage<<3)+(this.in("ny").busVoltage<<2)+(this.in("f").busVoltage<<1)+(this.in("no").busVoltage<<0),[i,n]=(0,_.Bb)(e,t,s),a=n===_.vU.Negative?r.lj:r.yE,o=n===_.vU.Zero?r.lj:r.yE;this.out("out").busVoltage=i,this.out("ng").pull(a),this.out("zr").pull(o)}op(){return(this.in("zx").busVoltage<<5)+(this.in("nx").busVoltage<<4)+(this.in("zy").busVoltage<<3)+(this.in("ny").busVoltage<<2)+(this.in("f").busVoltage<<1)+(this.in("no").busVoltage<<0)}}function L(t,s){return[1===t&&0===s||0===t&&1===s?r.lj:r.yE,1===t&&1===s?r.lj:r.yE]}class F extends r.Af{constructor(){super(["a","b"],["sum","carry"])}eval(){const t=this.in("a").voltage(),s=this.in("b").voltage(),[e,i]=L(t,s);this.out("sum").pull(e),this.out("carry").pull(i)}}class O extends r.Af{constructor(){super(["a","b","c"],["sum","carry"])}eval(){const t=this.in("a").voltage(),s=this.in("b").voltage(),e=this.in("c").voltage(),[i,r]=function(t,s,e){const[i,r]=L(t,s),[n,a]=L(i,e),[o]=x(r,a);return[n,o]}(t,s,e);this.out("sum").pull(i),this.out("carry").pull(r)}}class k extends r.Af{constructor(){super(["in[16]"],["out[16]"],"Inc16")}eval(){const t=this.in().busVoltage,[s]=j(t,1);this.out().busVoltage=s}}var I=e(3300),R=e(7039);class B extends r.tI{constructor(t){super(["in"],["out"],t,["t"])}tick(){const t=this.in().voltage();this.pin("t").pull(t)}tock(){const t=this.pin("t").voltage();this.out().pull(t)}}var T=e(3116);const D=new Map([["Nand",V],["Nand16",y],["Not",f],["Not16",v],["And",n],["And16",a],["Or",A],["Or16",E],["Or8Way",S],["XOr",w],["XOr16",P],["Xor",w],["Xor16",P],["Mux",d],["Mux16",b],["Mux4Way16",g],["Mux8Way16",p],["DMux",o],["DMux4Way",u],["DMux8Way",l],["HalfAdder",F],["FullAdder",O],["Add16",M],["Inc16",k],["ALU",W],["ALUNoStat",C],["DFF",B],["Bit",R.sU],["Register",R.aX],["ARegister",R.aX],["DRegister",R.aX],["PC",R.PC],["RAM8",T.HX],["RAM64",T.IH],["RAM512",T.OB],["RAM4K",T.rS],["RAM16K",T.xs],["ROM32K",I.m1],["Screen",I.lL],["Keyboard",I.N1],["CPU",I.Z9],["Computer",I.ar],["Memory",I.zp],["ARegister",R.l0],["DRegister",R.l0]].map((t=>{let[s,e]=t;return[s,()=>{const t=new e;return t.name=s,t}]})));function z(t){return D.has(t)}function N(t){const s=D.get(t);return s?(0,i.Ok)(s()):(0,i.UG)(new Error(`Chip ${t} not in builtin registry`))}},7039:(t,s,e)=>{e.d(s,{PC:()=>o,aX:()=>n,l0:()=>a,sU:()=>r});var i=e(6329);class r extends i.tI{bit=i.yE;constructor(t){super(["in","load"],["out"],t)}tick(){this.in("load").voltage()===i.lj&&(this.bit=this.in().voltage())}tock(){this.out().pull(this.bit??0)}reset(){this.bit=i.yE,super.reset()}}class n extends i.tI{bits=0;constructor(t){super(["in[16]","load"],["out[16]"],t)}tick(){this.in("load").voltage()===i.lj&&(this.bits=65535&this.in().busVoltage)}tock(){this.out().busVoltage=65535&this.bits}get(t,s){return t===this.name?this.out():super.get(t,s)}reset(){this.bits=0,super.reset()}}class a extends n{}class o extends i.tI{bits=0;constructor(t){super(["in[16]","load","inc","reset"],["out[16]"],t)}tick(){this.in("reset").voltage()===i.lj?this.bits=0:this.in("load").voltage()===i.lj?this.bits=65535&this.in().busVoltage:this.in("inc").voltage()===i.lj&&(this.bits+=1)}tock(){this.out().busVoltage=65535&this.bits}get(t,s){return t===this.name?this.out():super.get(t,s)}reset(){this.bits=0,super.reset()}}},3116:(t,s,e)=>{e.d(s,{FH:()=>a,HX:()=>u,IH:()=>l,OB:()=>h,rS:()=>c,xs:()=>d});var i=e(6329),r=e(5541),n=e(5838);class a extends i.tI{width;_memory;_nextData=0;_address=0;get memory(){return this._memory}get address(){return this._address}constructor(t,s){super(["in[16]","load",`address[${t}]`],["out[16]"],s),this.width=t,this._memory=new n.zp(Math.pow(2,this.width))}tick(){const t=this.in("load").voltage();this._address=this.in("address").busVoltage,t&&(this._nextData=this.in().busVoltage,this._memory.set(this._address,this._nextData))}tock(){this.out().busVoltage=this._memory?.get(this._address)??0}eval(){const t=this.in("address").busVoltage;this.out().busVoltage=this._memory?.get(t)??0}at(t){return(0,r.hu)(t<this._memory.size,(()=>`Request out of bounds (${t} >= ${this._memory.size})`)),new o(`${this.name}[${t}]`,t,this._memory)}reset(){console.log("ram reset"),this._memory.reset(),super.reset()}}class o extends i.Gc{index;ram;constructor(t,s,e){super(t),this.index=s,this.ram=e}get busVoltage(){return this.ram.get(this.index)}set busVoltage(t){this.ram.set(this.index,t)}}class u extends a{constructor(t){super(3,t)}}class l extends a{constructor(t){super(6,t)}}class h extends a{constructor(t){super(9,t)}}class c extends a{constructor(t){super(12,t)}}class d extends a{constructor(t){super(14,t)}}},8090:(t,s,e)=>{e.d(s,{Gq:()=>u});var i=e(5640),r=e(1510);const n='\nHdl <: Base{\n  Root := Chip\n  Chip = "CHIP" Name OpenBrace ChipBody CloseBrace\n  ChipBody = InList? OutList? PartList ClockedList?\n  InList = "IN" PinList Semi\n  OutList = "OUT" PinList Semi\n  PartList = BuiltinPart | Parts\n  PinList = List<PinDecl, Comma>\n  PinDecl = Name PinWidth?\n  PinWidth = OpenSquare decNumber CloseSquare\n  BuiltinPart = "BUILTIN" Semi\n  Parts = "PARTS:" Part*\n  Part = Name "(" Wires ")" Semi\n  Wires = List<Wire, Comma>\n  Wire = WireSide Equal (WireSide | True | False) \n  WireSide = Name SubBus? \n  SubBus = OpenSquare decNumber subBusRest? CloseSquare\n  subBusRest = ".." decNumber\n  ClockedList = "CLOCKED" SimplePinList Semi\n  SimplePinList = List<Name, Comma>\n}',a=i.Z.grammar(n,r.y1),o=a.extendSemantics(r.rJ);o.addAttribute("SubBus",{SubBus(t,s,e,i){const r=s.value;return{start:r,end:e.child(0)?.child(1)?.value??r}}}),o.addAttribute("WireSide",{WireSide(t,s){let{name:e}=t;const{start:i,end:r}=s.child(0)?.SubBus??{start:void 0,end:void 0};return{pin:e,start:i,end:r}}}),o.addAttribute("Wire",{Wire(t,s,e){const i=e.isTerminal()?{pin:e.sourceString}:e.WireSide;return{lhs:t.WireSide,rhs:i}}}),o.addAttribute("Wires",{Wires:t=>t.asIteration().children.map((t=>t.Wire))}),o.addAttribute("Part",{Part(t,s,e,i,r){let{name:n}=t,{Wires:a}=e;return{name:n,wires:a}}}),o.addAttribute("Parts",{Parts:(t,s)=>s.children.map((t=>t.Part)),BuiltinPart:(t,s)=>"BUILTIN"}),o.addAttribute("PartList",{PartList:t=>t.Parts}),o.addAttribute("Clocked",{ClockedList:(t,s,e)=>s.asIteration().children.map((t=>{let{sourceString:s}=t;return s}))??[]}),o.addAttribute("PinDecl",{PinDecl(t,s){let{name:e}=t;return{pin:e,width:s.child(0)?.child(1)?.value??1}}}),o.addAttribute("PinList",{PinList:t=>t.asIteration().children.map((t=>t.PinDecl))}),o.addAttribute("Chip",{Chip(t,s,e,i,r){let{name:n}=s;return{name:n,ins:i.child(0).child(0)?.child(1)?.PinList??[],outs:i.child(1).child(0)?.child(1)?.PinList??[],parts:i.child(2).PartList??[],clocked:i.child(3).child(0)?.Clocked}}}),o.addAttribute("Root",{Root:t=>t.child(0)?.Chip});const u={parser:a,grammar:n,semantics:o,parse:(0,r.Pz)(a,o,(t=>t.Chip))}}}]);
//# sourceMappingURL=691.97ecc3e5.chunk.js.map