"use strict";(globalThis.webpackChunk_nand2tetris_web=globalThis.webpackChunk_nand2tetris_web||[]).push([[880],{8215:(t,e,s)=>{s.r(e),s.d(e,{CPU:()=>v,default:()=>M});var n=s(4621),r=s(1091),a=s(7437),c=s(4171),i=s(4668),u=s(5874),o=s(7076),d=s(6554),l=s(6418);const p=new Int16Array([2,55944,0,64528,15,54018,1,64528,2,61584,54024,0,64648,2,55943,15,55943]);var m=s(8878),h=s(7365),f=s(8177),S=s(3761),g=s(4256);function x(t,e){const s=new g.X(t.cpu.RAM,e),n=new g.X(t.cpu.ROM,e),r=new g.X(t.cpu.Screen,e),a=new o.PC(new g.X(t.cpu.RAM,e));return{A:t.cpu.A,D:t.cpu.D,PC:t.cpu.PC,RAM:s,ROM:n,Screen:r,Keyboard:a}}function y(){const{fs:t,setStatus:e,storage:s}=(0,m.useContext)(S.L),n=(0,m.useRef)((()=>{})),{initialState:r,reducers:a,actions:c}=(0,m.useMemo)((()=>function(t,e,s,n){let r=new l.b(new o.n9(p)),a=!0,c=!0;const i={update(t){t.sim=x(r,n),t.test.highlight=r.currentStep?.span,t.test.valid=c},setTest(t,{tst:e,cmp:s}){t.test.tst=e??t.test.tst,t.test.cmp=s??t.test.cmp,t.test.out=""},testStep(t){t.test.out=r.log(),this.update(t)},testFinished(t){if(""===t.test.cmp.trim())return;const s=(0,h.U)(t.test.cmp.trim(),r.log().trim());e(s?"Simulation successful: The output file is identical to the compare file":"Simulation error: The output file differs from the compare file")}},m={tick(){r.cpu.tick()},setAnimate(t){a=t},async testStep(){const t=await r.step();return(a||t)&&n.current({action:"testStep"}),t&&n.current({action:"testFinished"}),t},resetRAM(){r.cpu.RAM.loadBytes([]),n.current({action:"update"}),e("Reset RAM")},toggleUseTest(){n.current({action:"update"})},reset(){r.reset(),n.current({action:"setTest",payload:{}}),n.current({action:"update"})},compileTest(t,s){n.current({action:"setTest",payload:{tst:t,cmp:s}});const a=d.uG.parse(t);return(0,u.ys)(a)?(e(`Failed to parse test - ${(0,u._)(a).message}`),c=!1,n.current({action:"update"}),!1):(c=!0,e("Parsed tst"),r=l.b.from((0,u.Ok)(a),r.cpu.ROM),n.current({action:"update"}),!0)}};return{initialState:{sim:x(r,n),test:{highlight:r.currentStep?.span,tst:"repeat {\n  ticktock;\n}",cmp:"",out:"",valid:!0}},reducers:i,actions:m}}(0,e,0,n)),[t,e,s,n]),[i,g]=(0,f.A)(a,r);return n.current=g,{state:i,dispatch:n,actions:c}}var b=s(7022),j=s(8029),R=s(4280),w=s(9267),A=s(782);const v=()=>{const{state:t,actions:e,dispatch:s}=y(),{toolStates:u}=(0,m.useContext)(j.BR),[o,d]=(0,f.b)(t.test.tst),[l,p]=(0,f.b)(t.test.out),[h,S]=(0,f.b)(t.test.cmp),[g,x]=(0,m.useState)(),[v,M]=(0,m.useState)("asm"),[k,C]=(0,m.useState)(!0),[O,T]=(0,m.useState)(0);(0,m.useEffect)((()=>{u.cpuState.rom&&(t.sim.ROM.loadBytes(u.cpuState.rom),u.cpuState.name&&(x(u.cpuState.name),u.cpuState.name.endsWith(".hack")&&M("bin")))}),[]),(0,m.useEffect)((()=>{u.setCpuState(g,Array.from(t.sim.ROM.map(((t,e)=>e))))}),[t]),(0,m.useEffect)((()=>{e.compileTest(o,h),e.reset()}),[o,h]);const P=(0,m.useRef)(),E=(0,m.useRef)(),[N,F]=(0,m.useState)(!1);(0,m.useEffect)((()=>(P.current=new class extends r.M{async tick(){return e.tick(),!1}finishFrame(){s.current({action:"update"})}reset(){e.reset()}toggle(){s.current({action:"update"})}},E.current=new class extends r.M{async tick(){return e.testStep()}finishFrame(){s.current({action:"update"})}reset(){e.reset()}toggle(){s.current({action:"update"})}},F(!0),()=>{var t,e;null===(t=P.current)||void 0===t||t.stop(),null===(e=E.current)||void 0===e||e.stop()})),[e,s]);const[U,D]=(0,m.useState)(1);return(0,A.jsxs)("div",{className:"Page CpuPage grid "+(2==U?"large-screen":"normal"),children:[(0,A.jsx)(c.Ay,{name:"ROM",displayEnabled:k,memory:t.sim.ROM,highlight:t.sim.PC,format:v,onUpload:t=>{x(t),e.reset()}}),(0,A.jsx)(c.Ay,{name:"RAM",displayEnabled:k,memory:t.sim.RAM,format:"hex",onChange:()=>{T(O+1)}}),(0,A.jsxs)(R.Z,{className:"IO",header:(0,A.jsxs)(A.Fragment,{children:[g&&(0,A.jsx)("div",{className:"flex-0",children:g}),(0,A.jsx)("div",{className:"flex-1",children:N&&P.current&&(0,A.jsx)(b.T,{runner:P.current})})]}),children:[(0,A.jsx)(i.f,{memory:t.sim.Screen,showScaleControls:!0,onScale:t=>{D(t)}},O),(0,A.jsx)(a.s,{update:()=>{s.current({action:"update"})},keyboard:t.sim.Keyboard}),(0,A.jsxs)("label",{children:[(0,A.jsx)("input",{type:"checkbox",role:"switch",checked:k,onChange:()=>{C(!k)}}),(0,A.jsx)(n.x6,{id:"{0}",values:{0:k?"Disable display":"Enable display"}})]}),k&&(0,A.jsx)("div",{children:(0,A.jsxs)("dl",{children:[(0,A.jsx)("dt",{children:"PC"}),(0,A.jsx)("dd",{children:t.sim.PC}),(0,A.jsx)("dt",{children:"A"}),(0,A.jsx)("dd",{children:t.sim.A}),(0,A.jsx)("dt",{children:"D"}),(0,A.jsx)("dd",{children:t.sim.D})]})})]}),N&&(0,A.jsx)(w.B,{runner:E,tst:[o,d,t.test.highlight],out:[l,p],cmp:[h,S],disabled:!t.test.valid,onSpeedChange:t=>{e.setAnimate(t<=2)}})]})},M=v},4256:(t,e,s)=>{s.d(e,{X:()=>r});var n=s(7076);class r extends n.qN{dispatch;constructor(t,e){super(t,t.size,0),this.dispatch=e}async load(t,e){await super.load(t,e),this.dispatch.current({action:"update"})}}},4641:(t,e,s)=>{s.d(e,{V:()=>n});const n=t=>{if((t=>"function"===typeof t?.toString||"string"===typeof t)(t)){const e=t.toString();return"[object Object]"===e?JSON.stringify(t):e}return JSON.stringify(t)}},3376:(t,e,s)=>{s.d(e,{V:()=>r});var n=s(8281);function r(t,e){return void 0===t&&void 0!==n.UL[e]&&(t=e),{..."inline"===e?{display:"inline-block"}:{},width:n.UL[t]??"0"}}}}]);