"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[885],{1185:function(t,e,n){n.r(e),n.d(e,{Chip:function(){return vt},default:function(){return mt}});var i=n(2951),r=n(1976),a=n(3243),s=n(7597),c=n(7591),o=n(4337),l=n(1092),u=n(7791),d=n(1026),p=n(8061),h=n(6167),f=n(649),v=n(7878),m=n(3300),x=n(3118),g=n(7039),b=n(3116),j=n(6329),y=n(6693),C=n(134),k=function(t){var e,n=t.A,i=t.op,r=t.D,a=t.out;t.flag;return(0,v.jsxs)("div",{children:[(0,v.jsx)("span",{children:"ALU"}),(0,v.jsx)("svg",{width:"250",height:"250",xmlns:"http://www.w3.org/2000/svg",children:(0,v.jsxs)("g",{children:[(0,v.jsx)("rect",{x:"1",y:"20",height:"85",width:"70",fill:"black"}),(0,v.jsx)("rect",{x:"1",y:"145",height:"85",width:"70",fill:"black"}),(0,v.jsx)("rect",{x:"180",y:"95",height:"60",width:"70",fill:"black"}),(0,v.jsx)("polygon",{points:"70,10 180,85 180,165 70,240 70,135 90,125 70,115",stroke:"#000",fill:"#6D97AB"}),(0,v.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",fontFamily:"Noto Sans JP",fontSize:"14",strokeWidth:"0",id:"svg_9",y:"63",x:"35",stroke:"white",fill:"#ffffff",children:n}),(0,v.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",fontFamily:"Noto Sans JP",fontSize:"14",id:"svg_10",y:"188",x:"35",strokeWidth:"0",stroke:"white",fill:"#ffffff",children:r}),(0,v.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",fontFamily:"Noto Sans JP",fontSize:"14",id:"svg_11",y:"125",x:"215",strokeWidth:"0",stroke:"white",fill:"#ffffff",children:a}),(0,v.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",fontFamily:"Noto Sans JP",fontSize:"14",id:"svg_13",y:"125",x:"135",strokeWidth:"0",stroke:"white",fill:"#ffffff",children:null!==(e=y.NM.op[i])&&void 0!==e?e:"(??)"})]})})]})},Z=n(2277),w=n(3052),P=n(6830),S=n(9613);function F(t,e){if(t instanceof x.JU)return(0,v.jsx)(k,{A:t.in("x").busVoltage,op:t.op(),D:t.in("y").busVoltage,out:t.out().busVoltage,flag:t.out("zr").voltage()===j.lj?y.vU.Zero:t.out("ng").voltage()===j.lj?y.vU.Negative:y.vU.Positive});var n;if(t instanceof g.aX)return(0,v.jsx)(P.y,{name:null!==(n=t.name)&&void 0!==n?n:"Chip ".concat(t.id),bits:t.bits});if(t instanceof g.PC)return(0,v.jsx)(P.y,{name:"PC",bits:t.bits});if(t instanceof m.N1)return(0,v.jsx)(Z.N,{keyboard:t,update:e});if(t instanceof m.lL)return(0,v.jsx)(S.l,{memory:t.memory});if(t instanceof b.FH)return(0,v.jsx)(w.zp,{name:t.name,memory:t.memory,format:t instanceof m.m1?"asm":"dec",highlight:t.address});if(t instanceof b.HX)return(0,v.jsxs)("span",{children:["RAM ",t.width]});if(t instanceof m.Z9){var i=(0,C.Jx)(t.in("instruction").busVoltage);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(P.y,{name:"A",bits:t.state.A}),(0,v.jsx)(P.y,{name:"D",bits:t.state.D}),(0,v.jsx)(P.y,{name:"PC",bits:t.state.PC}),(0,v.jsx)(k,{A:i.am?t.in("inM").busVoltage:t.state.A,D:t.state.D,out:t.state.ALU,op:i.op,flag:t.state.flag})]})}var r=(0,f.Z)(t.parts).map((function(t){return F(t,e)})).filter((function(t){return void 0!==t}));return r.length>0?(0,v.jsx)(v.Fragment,{children:r}):void 0}var I=n(7030),N=n(8582),T=n(4649),M=n(726),O=n(1585),A=n(4625),_=function(){function t(e,n){if((0,i.Z)(this,t),(0,T.Z)(this,"signBehaviors",new Map),x.zZ.has(e)){var r=(0,x.cT)(e);if((0,A.IY)(r)){var a,s=Array.from((0,A.Ok)(r).ins.entries()).concat(Array.from((0,A.Ok)(r).outs.entries())),c=(0,M.Z)(s);try{for(c.s();!(a=c.n()).done;){var o=a.value;this.signBehaviors.set(o.name,!n||!n.includes(o.name))}}catch(l){c.e(l)}finally{c.f()}}}}return(0,r.Z)(t,[{key:"isSigned",value:function(t){return this.signBehaviors.get(t)}}]),t}(),E=new Map([["Mux4Way16",["sel"]],["Mux8Way16",["sel"]],["DMux4Way",["sel"]],["DMux8Way",["sel"]],["RAM8",["address"]],["RAM64",["address"]],["RAM512",["address"]],["RAM4K",["address"]],["RAM16K",["address"]],["Screen",["address"]],["Memory",["address"]],["CPU",["addressM","pc"]]]),R=(0,h.createContext)({});function B(t){return{pin:t,bits:(0,O.w)(0,t.width).map((function(e){return[e,t.voltage(e)]})).reverse()}}function V(t){return(0,f.Z)(t.entries()).map(B)}var D=function(t){var e,n,i=t.sim,r=i.inPins,a=i.outPins,s=i.internalPins,c=(n=null!==(e=t.sim.chip[0].name)&&void 0!==e?e:"",new _(n,E.get(n)));return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("style",{children:"\n        table.pinout th {\n          font-weight: bold;\n        }\n\n        table.pinout tbody td:first-child {\n          text-align: right;\n          --font-size: 1rem;\n          width: 0;\n          white-space: nowrap;\n          border-right: var(--border-width) solid var(--table-border-color);\n        }\n\n        table.pinout tbody button {\n          --font-size: 0.875em;\n          font-family: var(--font-family-monospace);\n          max-width: 2em;\n        }\n        "}),(0,v.jsx)("table",{className:"pinout",children:(0,v.jsxs)("tbody",{children:[(0,v.jsx)(H,{pins:r,header:"Input pins",toggle:t.toggle,setInputValid:t.setInputValid,displayInfo:c}),(0,v.jsx)(H,{pins:a,header:"Output pins",disabled:t.sim.pending,enableEdit:!1,displayInfo:c}),!t.hideInternal&&(0,v.jsx)(H,{pins:s,header:"Internal pins",disabled:t.sim.pending,enableEdit:!1,displayInfo:c})]})})]})},H=function(t){return(0,v.jsxs)(v.Fragment,{children:[t.pins.length>0&&(0,v.jsx)("tr",{children:(0,v.jsx)("th",{colSpan:2,children:t.header})}),(0,f.Z)(t.pins).map((function(e){return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:e.pin.name}),(0,v.jsx)("td",{children:(0,v.jsx)(U,{pin:e,toggle:t.toggle,disabled:t.disabled,enableEdit:t.enableEdit,signed:t.displayInfo.isSigned(e.pin.name),setInputValid:t.setInputValid,internal:"Internal pins"===t.header})})]},e.pin.name)}))]})},U=function(t){var e=t.pin,n=t.toggle,i=t.disabled,r=void 0!==i&&i,a=t.enableEdit,s=void 0===a||a,c=t.signed,o=void 0===c||c,l=t.setInputValid,u=t.internal,p=void 0!==u&&u,f=(0,h.useState)(!0),m=(0,d.Z)(f,2),x=m[0],g=m[1],b=!0,j=(0,h.useState)(""),y=(0,d.Z)(j,2),C=y[0],k=y[1],Z=(0,h.useContext)(R);Z instanceof z&&Z.registerCallback((function(){g(!0)}));var w=function(t){b=t,null===l||void 0===l||l(t)},P=function(t){for(var i=0;i<e.bits.length;i++)e.bits[e.bits.length-i-1][1]!==(t>>i&1)&&(null===n||void 0===n||n(e.pin,i))};return(0,h.useEffect)((function(){if(!x&&b){var t=0;if(o&&e.bits[0][1]){var n,i=(0,M.Z)(e.bits);try{for(i.s();!(n=i.n()).done;){var r=(0,d.Z)(n.value,2),a=r[0],s=r[1];a<e.bits.length-1&&!s&&(t+=Math.pow(2,a))}}catch(v){i.e(v)}finally{i.f()}t=-t-1}else{var c,l=o?e.bits.length-1:e.bits.length,u=(0,M.Z)(e.bits);try{for(u.s();!(c=u.n()).done;){var p=(0,d.Z)(c.value,2),h=p[0],f=p[1];h<l&&f&&(t+=Math.pow(2,h))}}catch(v){u.e(v)}finally{u.f()}}k(t.toString())}}),[e,x]),(0,v.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,v.jsx)("fieldset",{role:"group",style:{width:"".concat(e.bits.length,"rem")},children:x?e.bits.map((function(t){var i=(0,d.Z)(t,2),a=i[0],s=i[1];return(0,v.jsx)("button",{disabled:r,style:p?{backgroundColor:"grey"}:{},onClick:function(){return null===n||void 0===n?void 0:n(e.pin,a)},"data-testid":"pin-".concat(a),children:s},a)})):(0,v.jsx)("input",{className:"colored",value:C,onChange:function(t){!function(t){var n=t.replace(/[^\d]/g,""),i=o&&"-"===t[0]?"-".concat(n):n;if(k(i),isNaN(parseInt(i)))w(!1);else{var r=parseInt(i);!o&&r>=Math.pow(2,e.bits.length)||o&&(r>=Math.pow(2,e.bits.length-1)||r<-Math.pow(2,e.bits.length-1))?w(!1):(P(r),w(!0))}}(t.target.value)},disabled:!s})}),e.bits.length>1&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{style:{width:"1em"}}),(0,v.jsx)("button",{style:{maxWidth:"3em",margin:0},onClick:function(){g(!x)},children:x?"dec":"bin"})]})]})},z=function(){function t(){(0,i.Z)(this,t),(0,T.Z)(this,"callbacks",[])}return(0,r.Z)(t,[{key:"registerCallback",value:function(t){this.callbacks.push(t)}},{key:"reset",value:function(){var t,e=(0,M.Z)(this.callbacks);try{for(e.s();!(t=e.n()).done;){(0,t.value)()}}catch(n){e.e(n)}finally{e.f()}}}]),t}(),J=n(7559),W=n(258),L=n(8698),G=n(4408),q=n(691),K=n(6531),X=n(8090),Y=n(9647),$=n(7662),Q=n(3389),tt=n(5541),et=n(8365),nt=[["01","Project 1"],["02","Project 2"],["03","Project 3"],["05","Project 5"]];function it(t){return t in $.CHIP_ORDER?$.CHIP_ORDER[t]:$.BUILTIN_CHIP_PROJECTS[t].concat($.CHIP_PROJECTS[t])}function rt(t){return"CHIP ".concat(t," {\n  IN in;\n  OUT out;\n  PARTS:\n}")}function at(t){return Object.values($.BUILTIN_CHIP_PROJECTS).flat().includes(t)}function st(t,e){var n=function(t,e){return at(e)?$.ChipProjects[t].BUILTIN_CHIPS[e]:$.ChipProjects[t].CHIPS[e]["".concat(e,".hdl")]}(t,e);if(at(e))return n;var i="//// Replace this comment with your code.",r="BUILTIN ".concat(e,";");return n.includes(i)?n.replace(i,r):n.replace("PARTS:","PARTS:\n    ".concat(r))}function ct(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{clocked:t.clocked,inPins:V(t.ins),outPins:V(t.outs),internalPins:V(t.pins),chip:[t],pending:e,invalid:n}}var ot=K.S.get();function lt(t,e,n,i){var r=function(t){var e,n,i=null!==(e=t["/chip/project"])&&void 0!==e?e:"01";return{project:i,chips:it(i),chipName:null!==(n=t["/chip/chip"])&&void 0!==n?n:$.CHIP_PROJECTS[i][0]}}(n),a=r.project,s=r.chipName,c=r.chips,o=new j.P9,p=new Q.l1,h=!1,v=!1,m={setFiles:function(t,e){var n=e.hdl,i=void 0===n?t.files.hdl:n,r=e.tst,a=void 0===r?t.files.tst:r,s=e.cmp,c=void 0===s?t.files.cmp:s,o=e.out,l=void 0===o?"":o;t.files.hdl=i,t.files.tst=a,t.files.cmp=c,t.files.out=l},updateChip:function(t,e){var n,i,r,a,c,l;t.sim=ct(o,null!==(n=null===e||void 0===e?void 0:e.pending)&&void 0!==n?n:t.sim.pending,null!==(i=null===e||void 0===e?void 0:e.invalid)&&void 0!==i?i:t.sim.invalid),t.controls.error=t.sim.invalid?null!==(r=null===e||void 0===e?void 0:e.error)&&void 0!==r?r:t.controls.error:"",t.controls.chips=it(t.controls.project),t.controls.chipName=t.sim.invalid?null!==(a=null===e||void 0===e?void 0:e.chipName)&&void 0!==a?a:s:null!==(c=null!==(l=o.name)&&void 0!==l?l:null===e||void 0===e?void 0:e.chipName)&&void 0!==c?c:s,t.controls.chips.includes(t.controls.chipName)||(t.controls.chips=[].concat((0,f.Z)(t.controls.chips),[t.controls.chipName]))},setProject:function(t,e){var n=it(e),i=t.controls.chipName&&n.includes(t.controls.chipName)?t.controls.chipName:n[0];t.controls.project=e,t.controls.chips=n,this.setChip(t,i)},setChip:function(t,e){t.controls.chipName=e,t.controls.hasBuiltin=x.zZ.has(e),t.controls.builtinOnly=at(e)},testRunning:function(t){t.controls.runningTest=!0},testFinished:function(t){t.controls.runningTest=!1;var n=function(t,e){var n=et.lA.parse(t),i=et.lA.parse(e);if((0,A.dZ)(n)||(0,A.dZ)(i))return!1;for(var r=(0,A.Ok)(n),a=(0,A.Ok)(i),s=0;s<Math.min(r.length,a.length);s++)for(var c,o,l=null!==(c=r[s])&&void 0!==c?c:[],u=null!==(o=a[s])&&void 0!==o?o:[],d=0;d<Math.max(l.length,u.length);d++){var p,h,f=null!==(p=l[d])&&void 0!==p?p:"",v=null!==(h=u[d])&&void 0!==h?h:"";if(null===(null===f||void 0===f?void 0:f.trim().match(/^\*+$/))&&(null===v||void 0===v?void 0:v.trim())!==(null===f||void 0===f?void 0:f.trim()))return!1}return!0}(t.files.cmp.trim(),t.files.out.trim());e(n?"Simulation successful: The output file is identical to the compare file":"Simulation error: The output file differs from the compare file")},updateTestStep:function(t){var e,n,i,r;if(t.files.out=null!==(e=null===(n=p)||void 0===n?void 0:n.log())&&void 0!==e?e:"",null!==(i=p)&&void 0!==i&&null!==(r=i.currentStep)&&void 0!==r&&r.span)t.controls.span=p.currentStep.span;else if(p.done){var a=t.files.tst.length;t.controls.span={start:a-1,end:a}}this.updateChip(t,{pending:t.sim.pending,invalid:t.sim.invalid})}},g={setProject:function(t){a=n["/chip/project"]=t,i.current({action:"setProject",payload:a}),this.setChip($.CHIP_PROJECTS[a][0])},setChip:function(t){var e=arguments,r=this;return(0,u.Z)((0,l.Z)().mark((function a(){var c,o;return(0,l.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o=e.length>1&&void 0!==e[1]?e[1]:null!==(c=n["/chip/project"])&&void 0!==c?c:"01",s=n["/chip/chip"]=t,i.current({action:"setChip",payload:s}),!(v=at(s))){a.next=8;break}return i.current({action:"setFiles",payload:{hdl:"",tst:"",cmp:""}}),r.useBuiltin(),a.abrupt("return");case 8:return a.next=10,r.loadChip(o,s);case 10:h&&r.useBuiltin();case 11:case"end":return a.stop()}}),a)})))()},reset:function(){K.S.get().reset(),o.reset(),p.reset(),i.current({action:"setFiles",payload:{}}),i.current({action:"updateChip"})},updateFiles:function(t){var n=this;return(0,u.Z)((0,l.Z)().mark((function r(){var a,s,c;return(0,l.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=t.hdl,s=t.tst,c=t.cmp,i.current({action:"setFiles",payload:{hdl:a,tst:s,cmp:c}}),r.prev=2,!a){r.next=6;break}return r.next=6,n.compileChip(a);case 6:s&&n.compileTest(s),r.next=12;break;case 9:r.prev=9,r.t0=r.catch(2),e((0,G.j)(r.t0));case 12:case"end":return r.stop()}}),r,null,[[2,9]])})))()},compileChip:function(t){var n=this;return(0,u.Z)((0,l.Z)().mark((function r(){var a,s,c;return(0,l.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o.remove(),a=X.Gq.parse(t),!(0,A.dZ)(a)){r.next=6;break}return e("Failed to parse chip"),i.current({action:"updateChip",payload:{invalid:!0,error:(0,G.j)((0,A.UG)(a))}}),r.abrupt("return");case 6:return r.next=8,(0,q.J_)((0,A.Ok)(a));case 8:if(s=r.sent,!(0,A.dZ)(s)){r.next=14;break}return c=(0,G.j)((0,A.UG)(s)),e(c),i.current({action:"updateChip",payload:{invalid:!0,error:c}}),r.abrupt("return");case 14:e("Compiled ".concat(o.name)),n.replaceChip((0,A.Ok)(s));case 16:case"end":return r.stop()}}),r)})))()},replaceChip:function(t){var e,n=o.ins,r=(0,M.Z)(n);try{for(r.s();!(e=r.n()).done;){var a=(0,d.Z)(e.value,2),s=a[0],c=a[1].busVoltage,l=t.ins.get(s);l&&(l.busVoltage=c)}}catch(u){r.e(u)}finally{r.f()}ot.reset(),t.eval(),(o=t).reset(),p=p.with(o).reset(),i.current({action:"updateChip",payload:{invalid:!1}}),i.current({action:"updateTestStep"})},loadChip:function(e,r){var a=this;return(0,u.Z)((0,l.Z)().mark((function s(){var c,o,u,p,h,f;return(0,l.Z)().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return n["/chip/chip"]=r,c=function(t){return"/projects/".concat(e,"/").concat(r,"/").concat(r,".").concat(t)},s.next=4,Promise.all([t.readFile(c("hdl")).catch((function(){return rt(r)})),t.readFile(c("tst")).catch((function(t){return"repeat 10 {\n  tick,\n  tock;\n}"})),t.readFile(c("cmp")).catch((function(){return"| in|out|"}))]);case 4:return o=s.sent,u=(0,d.Z)(o,3),p=u[0],h=u[1],f=u[2],i.current({action:"setFiles",payload:{hdl:p,tst:h,cmp:f}}),s.next=12,a.compileChip(p);case 12:a.compileTest(h);case 13:case"end":return s.stop()}}),s)})))()},saveChip:function(n){var r=arguments;return(0,u.Z)((0,l.Z)().mark((function c(){var o,u,d;return(0,l.Z)().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return o=r.length>1&&void 0!==r[1]?r[1]:a,u=r.length>2&&void 0!==r[2]?r[2]:s,i.current({action:"setFiles",payload:{hdl:n}}),d="/projects/".concat(o,"/").concat(u,"/").concat(u,".hdl"),c.next=6,t.writeFile(d,n);case 6:e("Saved ".concat(d));case 7:case"end":return c.stop()}}),c)})))()},toggle:function(t,e){void 0!==e?t.busVoltage=t.busVoltage^1<<e:1===t.width?t.toggle():t.busVoltage+=1,i.current({action:"updateChip",payload:{pending:!0}})},eval:function(){o.eval(),i.current({action:"updateChip",payload:{pending:!1}})},clock:function(){ot.toggle(),ot.isLow&&ot.frame(),i.current({action:"updateChip"})},useBuiltin:function(){var t=arguments,n=this;return(0,u.Z)((0,l.Z)().mark((function r(){var c,o,u,d,p;return(0,l.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(c=!(t.length>0&&void 0!==t[0])||t[0],o=t.length>1?t[1]:void 0,c){r.next=7;break}return v||(h=!1),r.next=6,n.loadChip(a,s);case 6:return r.abrupt("return");case 7:if(v||(h=!0),u=s,d=(0,x.cT)(u),!(0,A.dZ)(d)){r.next=13;break}return e("Failed to load builtin ".concat(u,": ").concat((0,G.j)((0,A.UG)(d)))),r.abrupt("return");case 13:if(!o){r.next=16;break}return r.next=16,n.saveChip(o,a,s);case 16:p=st(a,u),i.current({action:"setFiles",payload:{hdl:p}}),n.replaceChip((0,A.Ok)(d));case 19:case"end":return r.stop()}}),r)})))()},initialize:function(){var t=this;return(0,u.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.setChip(s,a);case 2:case"end":return e.stop()}}),e)})))()},compileTest:function(n){i.current({action:"setFiles",payload:{tst:n}});var r=Y.qH.parse(n);return(0,A.dZ)(r)?(e("Failed to parse test"),!1):(e("Parsed tst"),(p=Q.l1.from((0,A.Ok)(r)).with(o).reset()).setFileSystem(t),i.current({action:"updateTestStep"}),!0)},runTest:function(e){var n=this;return(0,u.Z)((0,l.Z)().mark((function r(){return(0,l.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n.compileTest(e)){r.next=2;break}return r.abrupt("return");case 2:return i.current({action:"testRunning"}),t.pushd("/samples"),r.next=6,p.run();case 6:t.popd(),i.current({action:"updateTestStep"}),i.current({action:"testFinished"});case 9:case"end":return r.stop()}}),r)})))()},tick:function(){return this.stepTest()},stepTest:function(){(0,tt.hu)(p.chipId===o.id,"Test and chip out of sync");var t=p.step();return i.current({action:"updateTestStep"}),t&&i.current({action:"testFinished"}),t}};return{initialState:function(){var t={project:a,chips:c,chipName:s,hasBuiltin:x.zZ.has(s),builtinOnly:at(s),runningTest:!1,error:""},n=(0,x.cT)(t.chipName);return(0,A.dZ)(n)?(e((0,G.j)((0,A.UG)(n))),o=new j.P9):o=(0,A.Ok)(n),{controls:t,files:{hdl:"",cmp:"",tst:"",out:""},sim:ct(o)}}(),reducers:m,actions:g}}var ut=n(8923),dt=n(8016),pt=n(659),ht=n(1539),ft=n(1124),vt=function(){var t=(0,h.useContext)(L.r),e=t.fs,n=t.setStatus,m=(0,h.useContext)(dt.Il),x=m.filePicker,g=m.tracking,b=function(){var t=(0,h.useContext)(L.r),e=t.fs,n=t.setStatus,i=t.storage,r=(0,h.useRef)((function(){})),a=(0,h.useMemo)((function(){return lt(e,n,i,r)}),[e,n,i,r]),s=a.initialState,c=a.reducers,o=a.actions,l=(0,J.C)(c,s),u=(0,d.Z)(l,2),p=u[0],f=u[1];return r.current=f,{state:p,dispatch:r,actions:o}}(),j=b.state,y=b.actions,C=b.dispatch,k=(0,J.i)(j.files.hdl),Z=(0,d.Z)(k,2),w=Z[0],P=Z[1],S=(0,J.i)(j.files.tst),T=(0,d.Z)(S,2),M=T[0],O=T[1],A=(0,J.i)(j.files.cmp),_=(0,d.Z)(A,2),E=_[0],B=_[1],V=(0,J.i)(j.files.out),H=(0,d.Z)(V,1)[0];(0,h.useEffect)((function(){y.initialize()}),[y]),(0,h.useEffect)((function(){g.trackPage("/chip")}),[g]);(0,h.useEffect)((function(){g.trackEvent("action","setProject",j.controls.project),g.trackEvent("action","setChip",j.controls.chipName)}),[]);var U=(0,h.useCallback)((function(t){y.setProject(t),g.trackEvent("action","setProject",t)}),[y,g]),G=(0,h.useCallback)((function(t){y.setChip(t),g.trackEvent("action","setChip",t),Ct.reset()}),[y,g]),q=(0,h.useCallback)((function(){y.eval(),g.trackEvent("action","eval")}),[y,g]),K=(0,h.useRef)((function(){}));K.current=(0,u.Z)((0,l.Z)().mark((function t(){var e,n,i,r=arguments;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=r.length>0&&void 0!==r[0]?r[0]:{},t.next=3,y.updateFiles({hdl:i.hdl,tst:null!==(e=i.tst)&&void 0!==e?e:M,cmp:null!==(n=i.cmp)&&void 0!==n?n:E});case 3:case"end":return t.stop()}}),t)})));var $=(0,h.useCallback)((0,u.Z)((0,l.Z)().mark((function t(){var i,r;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,x.select();case 3:return i=t.sent,t.next=6,e.readFile(i);case 6:return r=t.sent,t.next=9,K.current({tst:r});case 9:t.next=15;break;case 11:t.prev=11,t.t0=t.catch(0),console.error(t.t0),n("Failed to load into memory");case 15:case"end":return t.stop()}}),t,null,[[0,11]])}))),[x,n,e,K]),Q=(0,h.useRef)();(0,h.useEffect)((function(){return Q.current=new(function(t){(0,c.Z)(n,t);var e=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),e.apply(this,arguments)}return(0,r.Z)(n,[{key:"reset",value:function(){var t=(0,u.Z)((0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,K.current();case 2:return t.next=4,y.reset();case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"finishFrame",value:function(){(0,a.Z)((0,s.Z)(n.prototype),"finishFrame",this).call(this),C.current({action:"updateTestStep"})}},{key:"tick",value:function(){return y.stepTest()}},{key:"toggle",value:function(){C.current({action:"updateTestStep"})}}]),n}(ut.B)),function(){var t;null===(t=Q.current)||void 0===t||t.stop()}}),[K,y,C]);var tt=(0,h.useMemo)((function(){return{toggle:function(){y.clock(),g.trackEvent("action","toggleClock")},reset:function(){g.trackEvent("action","resetClock"),y.reset()}}}),[y]),it=(0,h.useState)(!1),rt=(0,d.Z)(it,2),st=rt[0],ct=rt[1],ot=(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)("fieldset",{role:"group",children:[(0,v.jsx)("select",{value:j.controls.project,onChange:function(t){var e=t.target.value;U(e)},"data-testid":"project-picker",children:nt.map((function(t){var e=(0,d.Z)(t,2),n=e[0],i=e[1];return(0,v.jsx)("option",{value:n,children:i},n)}))}),(0,v.jsx)("select",{value:j.controls.chipName,onChange:function(t){var e=t.target.value;G(e)},"data-testid":"chip-picker",children:j.controls.chips.map((function(t){return(0,v.jsx)("option",{value:t,style:at(t)?{color:"rgb(170, 170, 170)"}:{},children:"".concat(t," ").concat(at(t)?"(given)":"")},t)}))}),(0,v.jsx)("button",{className:"flex-0",onClick:function(){y.saveChip(w)},disabled:st,children:(0,v.jsx)(p.cC,{id:"Save"})})]})}),vt=(0,v.jsx)(ft.s,{className:"_hdl_panel",header:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{tabIndex:0,children:"HDL"}),(0,v.jsx)("fieldset",{children:j.controls.hasBuiltin&&!j.controls.builtinOnly&&(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"checkbox",role:"switch",checked:st,onChange:function(){st?(ct(!1),y.useBuiltin(!1)):(ct(!0),y.useBuiltin(!0,w)),Ct.reset()}}),(0,v.jsx)(p.cC,{id:"Builtin"})]})}),ot]}),children:(0,v.jsx)(ht.M,{className:"flex-1",value:w,onChange:function(t){P(t),K.current(st||j.controls.builtinOnly?{}:{hdl:t})},grammar:X.Gq.parser,language:"hdl",disabled:st||j.controls.builtinOnly})}),mt=(0,h.useState)(!0),xt=(0,d.Z)(mt,2),gt=xt[0],bt=xt[1],jt=(0,v.jsxs)("fieldset",{role:"group",children:[(0,v.jsx)("button",{onClick:q,onKeyDown:q,disabled:!j.sim.pending||!gt,children:(0,v.jsx)(p.cC,{id:"Eval"})}),(0,v.jsxs)("button",{onClick:tt.toggle,style:{maxWidth:"initial"},disabled:!j.sim.clocked,children:[(0,v.jsx)(p.cC,{id:"Clock"}),":","\xa0",(0,v.jsx)(I.uY,{})]}),(0,v.jsx)("button",{onClick:tt.reset,style:{maxWidth:"initial"},disabled:!j.sim.clocked,children:(0,v.jsx)(p.cC,{id:"Reset"})})]}),yt=function(t,e){return(0,f.Z)(t.parts).map((function(t,n){return["".concat(t.id,"_").concat(n),F(t,e)]})).filter((function(t){var e=(0,d.Z)(t,2);return e[0],void 0!==e[1]}))}({parts:j.sim.chip},(function(){C.current({action:"updateChip"})})),Ct=new z,kt=(0,v.jsx)(ft.s,{className:"_parts_panel",header:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{children:[(0,v.jsx)(p.cC,{id:"Chip"})," ",j.controls.chipName]}),jt]}),children:j.sim.invalid?(0,v.jsx)(p.cC,{id:"Syntax errors in the HDL code"}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(R.Provider,{value:Ct,children:(0,v.jsx)(D,{sim:j.sim,toggle:y.toggle,setInputValid:bt,hideInternal:j.controls.builtinOnly||st})}),yt.length>0&&(0,v.jsx)(ft.G,{summary:(0,v.jsx)(p.cC,{id:"Visualization"}),open:!0,children:(0,v.jsx)("main",{children:yt.map((function(t){var e=(0,d.Z)(t,2);e[0];return e[1]}))})})]})}),Zt=(0,h.useState)("tst"),wt=(0,d.Z)(Zt,2),Pt=wt[0],St=wt[1],Ft=(0,h.useCallback)((function(t){St(t),g.trackEvent("tab","change",t)}),[g]),It=(0,v.jsx)(ft.s,{className:"_test_panel",header:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"flex-1",children:(0,v.jsx)(p.cC,{id:"Test"})}),(0,v.jsx)("div",{className:"flex-2",children:Q.current&&(0,v.jsx)(W.D,{runner:Q.current})}),(0,v.jsx)("div",{children:(0,v.jsxs)("button",{onClick:$,children:[(0,v.jsx)(pt.J,{name:"upload_file"})," "]})})]}),children:(0,v.jsxs)("div",{role:"tablist",style:{"--tab-count":"3"},children:[(0,v.jsx)("div",{role:"tab",id:"test-tab-tst","aria-controls":"test-tabpanel-tst","aria-selected":"tst"===Pt,children:(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-tst",value:"tst",checked:"tst"===Pt,onChange:function(){return Ft("tst")}}),"Test Script"]})}),(0,v.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-tst",id:"test-tabpanel-tst",children:(0,v.jsx)(ht.M,{value:M,onChange:O,grammar:Y.qH.parser,language:"tst",highlight:j.controls.span,disabled:j.controls.builtinOnly})}),(0,v.jsx)("div",{role:"tab",id:"test-tab-cmp","aria-controls":"test-tablpanel-cmp","aria-selected":"cmp"===Pt,children:(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-cmp",value:"cmp",checked:"cmp"===Pt,onChange:function(){return Ft("cmp")}}),"Compare File"]})}),(0,v.jsx)("div",{role:"tabpanel","aria-labelledby":"test-tab-cmp",id:"test-tabpanel-cmp",style:{position:"relative"},children:(0,v.jsx)(ht.M,{value:E,onChange:B,grammar:et.lA.parser,language:"cmp",disabled:j.controls.builtinOnly})}),(0,v.jsx)("div",{role:"tab",id:"test-tab-out","aria-controls":"test-tabpanel-out","aria-selected":"out"===Pt,children:(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{type:"radio",name:"test-tabs","aria-controls":"test-tabpanel-out",value:"out",checked:"out"===Pt,onChange:function(){return Ft("out")}}),"Output File"]})}),(0,v.jsx)("div",{role:"tabpanel",id:"test-tabpanel-out","aria-labelledby":"test-tab-out",children:(0,v.jsx)(N.M,{cmp:E,out:H})})]})});return(0,v.jsxs)("div",{className:"ChipPage grid",children:[vt,kt,It]})},mt=vt}}]);
//# sourceMappingURL=885.1ede3f56.chunk.js.map