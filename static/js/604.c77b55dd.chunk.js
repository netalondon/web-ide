"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[604],{4604:(e,t,n)=>{n.r(t),n.d(t,{Asm:()=>b,default:()=>y});var s=n(8061),r=n(258),i=n(4625),a=n(1845),o=n(8786),l=n(326),c=n(6167),u=n(7559),d=n(8698);function h(){const{setStatus:e}=(0,c.useContext)(d.r),t=(0,c.useRef)((()=>{})),{initialState:n,reducers:s,actions:r}=(0,c.useMemo)((()=>function(e,t){let n=null,s=!1,r=new Map;const c={setAsm(t,s){let{asm:r}=s;t.asm=r;const o=a.Ww.parse(r);(0,i.dZ)(o)?e(`Error parsing asm file - ${(0,i.UG)(o).message}`):(t.symbols=[],n=(0,i.Ok)(o),(0,a.$o)(n,((e,n)=>{t.symbols.push([e,n])})),n.instructions=n.instructions.filter((e=>"L"!==e.type)),this.reset(t),e("Loaded asm file"))},setCmp(t,n){let{cmp:s}=n;t.compare=(0,o.uH)(s).map((e=>(0,l.Ly)(e))),e("Loaded compare file")},step(t){if(!n||t.current>=n.instructions.length-1)return;t.current++;const i=n.instructions[t.current];if("A"===i.type||"C"===i.type){t.highlight=i.span;const o=(0,a.Y_)(n.instructions[t.current]);if(void 0===o)return;t.result.push((0,l.Ly)(o)),r.set(i,t.current),t.current===n.instructions.length-1&&(e("Translation done."),s=!0)}},reset(e){e.result=[],e.current=-1,e.highlight=void 0,s=!1,r=new Map},updateHighlightByTextOffset(e,t){let{index:s}=t;if(n)for(const i of n.instructions)if(("A"===i.type||"C"===i.type)&&i.span.start<=s&&s<=i.span.end){e.highlight=i.span;const t=r.get(i);void 0!==t&&(e.current=t)}},updateHighlightByResult(e,t){let{index:n}=t;e.current=n;for(const[s,i]of r)if(i===n)return void(e.highlight=s.span)},compare(t){if(t.result.length===t.compare.length){for(let n=0;n<t.result.length;n++)if(t.result[n]!==t.compare[n])return void e(`Comparison failed - line ${n} is different`);e("Comparison successful")}else e("Comparison failed - different lengths")}};return{initialState:{asm:"",current:-1,highlight:void 0,symbols:[],result:[],compare:[]},reducers:c,actions:{step:()=>(t.current({action:"step"}),s)}}}(e,t)),[e,t]),[h,g]=(0,u.C)(s,n);return t.current=g,{state:h,dispatch:t,actions:r}}var g=n(7878),m=n(8039);const p=e=>{let{values:t=[],highlight:n=-1,onClick:s}=e;return(0,g.jsx)("div",{children:t.map(((e,t)=>(0,g.jsx)(v,{identifier:e[0],value:e[1],highlight:t===n,onClick:()=>s?.(e[0],e[1])},t)))})},f=e=>{let{values:t=[],highlight:n=-1,onClick:s}=e;const r=e=>t.length?(0,l.E_)(e).padStart(Math.ceil(Math.log10(e))," "):(0,l.E_)(e);return(0,g.jsx)(p,{values:t.map(((e,t)=>[r(t),e])),highlight:n,onClick:(e,t)=>s?.(Number(e))})},v=e=>{let{identifier:t,value:n,highlight:s=!1,onClick:r}=e;return(0,g.jsxs)("div",{style:{display:"flex",height:"100%"},onClick:r,children:[(0,g.jsx)("code",{style:{...(0,m.eP)("none"),...s?{background:"var(--mark-background-color)"}:{},whiteSpace:"pre"},children:t}),(0,g.jsx)("code",{style:{flex:"1",textAlign:"right",color:"black",...(0,m.eP)("none"),...s?{background:"var(--mark-background-color)"}:{}},children:(0,g.jsx)("span",{style:{color:"black"},children:n})})]})};var x=n(8923),C=n(1539),j=n(1124);const b=()=>{const{state:e,actions:t,dispatch:n}=h(),[i,o]=(0,c.useState)(""),[l,u]=(0,c.useState)(""),m=(0,c.useRef)(),[v,b]=(0,c.useState)(!1);(0,c.useEffect)((()=>(m.current=new class extends x.B{tick(){return t.step()}reset(){n.current({action:"reset"})}toggle(){}},b(!0),()=>{var e;null===(e=m.current)||void 0===e||e.stop()})),[t,n]);const y=(0,c.useRef)(null);let k="asm";const{setStatus:S}=(0,c.useContext)(d.r);return(0,g.jsxs)("div",{className:"AsmPage grid",children:[(0,g.jsx)(j.s,{className:"source",header:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{children:[(0,g.jsx)(s.cC,{id:"Source"}),i&&`: ${i}`]}),(0,g.jsx)("div",{className:"flex-1",children:v&&m.current&&(0,g.jsx)(r.D,{runner:m.current})}),(0,g.jsx)("div",{children:(0,g.jsxs)("fieldset",{role:"group",children:[(0,g.jsx)("input",{type:"file",style:{display:"none"},ref:y,onChange:async e=>{var t;if(null===(t=e.target.files)||void 0===t||!t.length)return void S("No file selected");const s=e.target.files[0],r=await s.text();if("asm"===k){if(!s.name.endsWith(".asm"))return void S("File must be .asm file");n.current({action:"setAsm",payload:{asm:r}}),o(s.name)}else{if(!s.name.endsWith(".hack"))return void S("File must be .hack file");n.current({action:"setCmp",payload:{cmp:r}}),u(s.name)}}}),(0,g.jsx)("button",{onClick:()=>{var e;k="asm",null===(e=y.current)||void 0===e||e.click()},children:"\ud83d\udcc2"})]})})]}),children:(0,g.jsx)(C.M,{value:e.asm,onChange:e=>{},onCursorPositionChange:e=>{n.current({action:"updateHighlightByTextOffset",payload:{index:e}})},grammar:a.Ww.parser,language:"asm",highlight:e.highlight,disabled:!0})}),(0,g.jsxs)(j.s,{className:"result",header:(0,g.jsx)("div",{children:(0,g.jsx)(s.cC,{id:"Result"})}),children:[(0,g.jsx)(f,{values:e.result,highlight:e.current,onClick:e=>{n.current({action:"updateHighlightByResult",payload:{index:e}})}}),e.symbols.length>0&&"Symbol Table",(0,g.jsx)(p,{values:e.symbols})]}),(0,g.jsx)(j.s,{className:"compare",header:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{children:[(0,g.jsx)(s.cC,{id:"Compare"}),l&&`: ${l}`]}),(0,g.jsx)("div",{children:(0,g.jsxs)("fieldset",{role:"group",children:[(0,g.jsx)("button",{onClick:()=>{n.current({action:"compare"})},children:"Compare"}),(0,g.jsx)("button",{onClick:()=>{var e;k="cmp",null===(e=y.current)||void 0===e||e.click()},children:"\ud83d\udcc2"})]})})]}),children:(0,g.jsx)(f,{values:e.compare})})]})},y=b},1539:(e,t,n)=>{n.d(t,{M:()=>g});var s=n(8061),r=n(9659),i=n(7536),a=n(6167),o=n(8016),l=n(1510),c=n(7878);const u=e=>{var t,n;let{error:r}=e;return null!==r&&void 0!==r&&r.failed()?(0,c.jsxs)("details",{className:"ErrorPanel",open:!0,children:[(0,c.jsx)("summary",{role:"button",className:"secondary",children:(0,c.jsx)(s.cC,{id:"Parse Error"})}),(0,c.jsx)("pre",{children:(0,c.jsx)("code",{children:null!==(t=null!==(n=null===r||void 0===r?void 0:r.message)&&void 0!==n?n:null===r||void 0===r?void 0:r.shortMessage)&&void 0!==t?t:l.eP})})]}):(0,c.jsx)(c.Fragment,{})},d=e=>{let{value:t,onChange:n,language:s,disabled:r=!1}=e;const[i,o]=(0,a.useState)(t);return(0,c.jsx)("textarea",{"data-testid":`editor-${s}`,disabled:r,value:i,onChange:e=>{var t;const s=null===(t=e.target)||void 0===t?void 0:t.value;o(s),n(s)}})},h=e=>{let{value:t,onChange:n,onCursorPositionChange:s,language:r,error:l,disabled:u=!1,highlight:d}=e;const{theme:h}=(0,a.useContext)(o.Il),g=(0,i.Ik)(),m=(0,a.useRef)(),p=(0,a.useRef)([]),f=(0,a.useRef)(void 0),v=(0,a.useCallback)((()=>("system"===h?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"===h)?"vs-dark":"vs"),[h]),x=(0,a.useCallback)((()=>{var e;p.current=((e,t,n,s)=>{if(!t||!n)return s;const r=t.getModel();if(!r)return s;const i=r.getPositionAt(n.start),a=r.getPositionAt(n.end),o=null===e||void 0===e?void 0:e.Range.fromPositions(i,a),l=[];return o&&(l.push({range:o,options:{inlineClassName:"highlight"}}),t.revealRangeInCenter(o)),t.deltaDecorations(s,l)})(g,m.current,null!==(e=f.current)&&void 0!==e?e:{start:0,end:0},p.current)}),[p,g,m,f]);(0,a.useEffect)((()=>{f.current=d,x()}),[d]);const C=(0,a.useCallback)((e=>{var t,n;m.current=e,null===(t=m.current)||void 0===t||t.updateOptions({fontFamily:'"JetBrains Mono", source-code-pro, Menlo, Monaco,\n      Consolas, "Roboto Mono", "Ubuntu Monospace", "Noto Mono", "Oxygen Mono",\n      "Liberation Mono", monospace, "Apple Color Emoji", "Segoe UI Emoji",\n      "Segoe UI Symbol", "Noto Color Emoji"',fontSize:16,minimap:{enabled:!1},theme:v(),scrollBeyondLastLine:!1,readOnly:u}),x(),null===(n=m.current)||void 0===n||n.onDidChangeCursorPosition((e=>{var t,n;const r=null===(t=m.current)||void 0===t||null===(n=t.getModel())||void 0===n?void 0:n.getOffsetAt(e.position);void 0!==r&&(null===s||void 0===s||s(r))}))}),[v]);return(0,a.useEffect)((()=>{void 0!==m.current&&m.current.updateOptions({theme:v()})}),[m,v]),(0,a.useEffect)((()=>{void 0!==m.current&&m.current.updateOptions({readOnly:u})}),[m,u]),(0,a.useEffect)((()=>{var e,t,n,s,i;if(void 0===m.current)return;if(null===g)return;const a=m.current.getModel();if(null===a)return;if(void 0===l||l.succeeded())return void g.editor.setModelMarkers(a,r,[]);const{line:o,column:c,message:u}=null!==(e=null===(t=/Line (?<line>\d+), col (?<column>\d+): (?<message>.*)/.exec(null!==(n=l.shortMessage)&&void 0!==n?n:""))||void 0===t?void 0:t.groups)&&void 0!==e?e:{line:1,column:1,message:"could not parse error"},d=Number(o),h=d,p=Number(c);let f=p+(null!==(s=null===(i=a.getLineContent(d).substring(p-1).match(/([^\s]+)/))||void 0===i?void 0:i[0].length)&&void 0!==s?s:1);f<=p&&(f=p+1),g.editor.setModelMarkers(a,r,[{message:u,startColumn:p,startLineNumber:d,endColumn:f,endLineNumber:h,severity:8}])}),[l,m,g,r]),(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(i.ZP,{value:t,onChange:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return n(e)},language:r,onMount:C})})},g=e=>{let{className:t="",style:n={},disabled:s=!1,value:i,onChange:l,onCursorPositionChange:g,grammar:m,language:p,highlight:f}=e;const[v,x]=(0,a.useState)(),{monaco:C}=(0,a.useContext)(o.Il),j=(0,a.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=m.match(e);x(t.failed()?t:void 0)}),[x,m]);(0,a.useEffect)((()=>j(i)),[j,i]);const b=(0,a.useMemo)((()=>(0,r.D)(j,500)),[j]),y=(0,a.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";l(e),b(e)}),[b,l]);return(0,c.jsx)("div",{className:`Editor ${t}`,style:n,children:C.canUse&&C.wants?(0,c.jsx)(h,{value:i,onChange:y,onCursorPositionChange:g,language:p,error:v,disabled:s,highlight:f}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(d,{value:i,onChange:y,language:p,disabled:s}),(0,c.jsx)(u,{error:v})]})})}},1124:(e,t,n)=>{n.d(t,{G:()=>i,s:()=>r});var s=n(7878);const r=e=>{var t;return(0,s.jsxs)("article",{className:["panel",null!==(t=e.className)&&void 0!==t?t:""].join(" "),children:[e.header&&(0,s.jsx)("header",{children:e.header}),(0,s.jsx)("main",{children:e.children}),e.footer&&(0,s.jsx)("footer",{children:e.footer})]})},i=e=>{var t;return(0,s.jsxs)("details",{className:null!==(t=e.className)&&void 0!==t?t:"",open:e.open,style:e.style,children:[(0,s.jsx)("summary",{children:(0,s.jsx)("div",{className:"flex row align-baseline",children:e.summary})}),e.children]})}},7559:(e,t,n)=>{n.d(t,{C:()=>i,i:()=>a});var s=n(1408),r=n(6167);function i(e,t){return(0,r.useReducer)(((t,n)=>(0,s.ZP)(t,(t=>{e[n.action](t,n.payload)}))),t)}function a(e){const[t,n]=(0,r.useState)(e);return(0,r.useEffect)((()=>{n(e)}),[e]),[t,n]}},258:(e,t,n)=>{n.d(t,{D:()=>a});var s=n(7878),r=n(6167),i=n(7559);const a=e=>{const t=function(e){const t=(0,r.useRef)((()=>{})),{initialState:n,reducers:s,actions:a}=(0,r.useMemo)((()=>((e,t)=>{const n={running:e.running,speed:e.speed,steps:e.steps},s=e.finishFrame.bind(e);return e.finishFrame=function(){s(),t.current({action:"update"})},{initialState:n,reducers:{update(t){t.running=e.running,t.speed=e.speed,t.steps=e.steps},setSteps(t,n){t.steps=n,e.steps=n},setSpeed(t,n){t.speed=n,e.speed=n}},actions:{frame(){e.frame()},start(){e.start(),t.current({action:"update"})},stop(){e.stop(),t.current({action:"update"})},reset(){e.reset(),t.current({action:"update"})}}}})(e,t)),[e,t]),[o,l]=(0,i.C)(s,n);return t.current=l,{state:o,dispatch:t.current,actions:a}}(e.runner),[n,a]=(0,r.useState)(0),o={0:[1e3,1],1:[500,1],2:[16,1],3:[16,16666],4:[16,499980]};(0,r.useEffect)((()=>{l()}),[n]);const l=()=>{const[e,s]=o[n];t.dispatch({action:"setSpeed",payload:e}),t.dispatch({action:"setSteps",payload:s})};return(0,s.jsxs)("fieldset",{role:"group",children:[(0,s.jsx)("button",{className:"flex-0",onClick:()=>t.actions.frame(),"data-tooltip":"Step","data-placement":"bottom",children:"\u27a1\ufe0f"}),(0,s.jsx)("button",{className:"flex-0",onClick:()=>t.state.running?t.actions.stop():t.actions.start(),"data-tooltip":t.state.running?"Pause":"Run","data-placement":"bottom",children:t.state.running?"\u23f8":"\ufe0f\u23e9"}),(0,s.jsx)("button",{className:"flex-0",onClick:()=>t.actions.reset(),"data-tooltip":"Reset","data-placement":"bottom",children:"\u23ee"}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:"normal"},children:[(0,s.jsx)("span",{style:{padding:"0.2rem"},children:"Slow"}),(0,s.jsx)("input",{type:"range",min:0,max:4,step:1,value:n,disabled:t.state.running,onChange:e=>{a(Number(e.target.value))},style:{width:"150px",padding:"0.2rem"},"data-tooltip":"Execution speed","data-placement":"bottom"}),(0,s.jsx)("span",{style:{padding:"0.2rem"},children:"Fast"})]}),e.children]})}},8923:(e,t,n)=>{n.d(t,{B:()=>r});const s=n(6531).S.get();class r{frame(){this.tick(),this.finishFrame()}finishFrame(){s.frame()}steps=1;speed=1e3;get running(){return this.#e}#e=!1;#t=0;#n=0;#s=async()=>{if(!this.#e)return;const e=Date.now(),t=e-this.#n;if(this.#n=e,this.#t+=t,this.#t>this.speed){let e=!1,t=this.steps;const n=`Timing ${t} steps`;for(console.time(n);!e&&t--;)e=this.tick();console.timeEnd(n),this.finishFrame(),e&&(console.log("done"),this.stop()),this.#t-=this.speed}requestAnimationFrame(this.#s)};start(){this.#e=!0,this.#n=Date.now()-this.speed,this.#s(),this.toggle()}stop(){this.#e=!1,this.toggle()}}}}]);
//# sourceMappingURL=604.c77b55dd.chunk.js.map