{"version":3,"file":"static/js/604.b43db795.chunk.js","mappings":"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","sources":["../../components/src/stores/asm.store.ts","../../components/src/table.tsx","pages/asm.tsx","shell/editor.tsx","shell/panel.tsx","../../components/src/react.ts","../../components/src/runbar.tsx","../../components/src/timer.tsx","../../simulator/src/timer.ts"],"sourcesContent":["import { Err, Ok, isErr } from \"@davidsouther/jiffies/lib/esm/result.js\";\nimport {\n  ASM,\n  Asm,\n  AsmAInstruction,\n  AsmCInstruction,\n  fillLabel,\n  translateInstruction,\n} from \"@nand2tetris/simulator/languages/asm.js\";\nimport { Span } from \"@nand2tetris/simulator/languages/base.js\";\nimport { loadHackSync } from \"@nand2tetris/simulator/loader.js\";\nimport { bin } from \"@nand2tetris/simulator/util/twos.js\";\nimport { Dispatch, MutableRefObject, useContext, useMemo, useRef } from \"react\";\nimport { useImmerReducer } from \"../react.js\";\nimport { BaseContext } from \"./base.context.js\";\n\nexport interface AsmPageState {\n  asm: string;\n  current: number;\n  resultHighlight: number;\n  sourceHighlight: Span | undefined;\n  symbols: [string, number][];\n  result: string[];\n  compare: string[];\n}\n\nexport type AsmStoreDispatch = Dispatch<{\n  action: keyof ReturnType<typeof makeAsmStore>[\"reducers\"];\n  payload?: unknown;\n}>;\n\nexport function makeAsmStore(\n  setStatus: (status: string) => void,\n  dispatch: MutableRefObject<AsmStoreDispatch>\n) {\n  let asmInstructions: Asm | null = null;\n  let done = false;\n\n  let instructionToIndex: Map<AsmAInstruction | AsmCInstruction, number> =\n    new Map();\n\n  const reducers = {\n    setAsm(state: AsmPageState, { asm }: { asm: string }) {\n      state.asm = asm;\n      const parseResult = ASM.parse(asm);\n      if (isErr(parseResult)) {\n        setStatus(`Error parsing asm file - ${Err(parseResult).message}`);\n        return;\n      }\n      state.symbols = [];\n      asmInstructions = Ok(parseResult);\n      fillLabel(asmInstructions, (name, value) => {\n        state.symbols.push([name, value]);\n      });\n      asmInstructions.instructions = asmInstructions.instructions.filter(\n        (instruction) => instruction.type !== \"L\"\n      );\n      this.reset(state);\n      setStatus(\"Loaded asm file\");\n    },\n\n    setCmp(state: AsmPageState, { cmp }: { cmp: string }) {\n      state.compare = loadHackSync(cmp).map((n) => bin(n));\n      setStatus(\"Loaded compare file\");\n    },\n\n    step(state: AsmPageState) {\n      if (\n        !asmInstructions ||\n        state.current >= asmInstructions.instructions.length - 1\n      ) {\n        return;\n      }\n      state.current++;\n      state.resultHighlight = state.current;\n      const instruction = asmInstructions.instructions[state.current];\n      if (instruction.type === \"A\" || instruction.type === \"C\") {\n        state.sourceHighlight = instruction.span;\n        const result = translateInstruction(\n          asmInstructions.instructions[state.current]\n        );\n        if (result === undefined) {\n          return;\n        }\n        state.result.push(bin(result));\n        instructionToIndex.set(instruction, state.current);\n        if (state.current === asmInstructions.instructions.length - 1) {\n          setStatus(\"Translation done.\");\n          done = true;\n        }\n      }\n    },\n\n    reset(state: AsmPageState) {\n      state.result = [];\n      state.current = -1;\n      state.sourceHighlight = undefined;\n      done = false;\n      instructionToIndex = new Map();\n    },\n\n    updateHighlightByTextOffset(\n      state: AsmPageState,\n      { index }: { index: number }\n    ) {\n      if (!asmInstructions) {\n        return;\n      }\n      for (const instruction of asmInstructions.instructions) {\n        if (instruction.type === \"A\" || instruction.type === \"C\") {\n          if (\n            instruction.span.start <= index &&\n            index <= instruction.span.end\n          ) {\n            state.sourceHighlight = instruction.span;\n            const current = instructionToIndex.get(instruction);\n            if (current !== undefined) {\n              state.resultHighlight = current;\n            }\n          }\n        }\n      }\n    },\n\n    updateHighlightByResult(state: AsmPageState, { index }: { index: number }) {\n      state.resultHighlight = index;\n      for (const [instruction, i] of instructionToIndex) {\n        if (i === index) {\n          state.sourceHighlight = instruction.span;\n          return;\n        }\n      }\n    },\n\n    compare(state: AsmPageState) {\n      if (state.result.length !== state.compare.length) {\n        setStatus(\"Comparison failed - different lengths\");\n        return;\n      }\n      for (let i = 0; i < state.result.length; i++) {\n        if (state.result[i] !== state.compare[i]) {\n          setStatus(`Comparison failed - line ${i} is different`);\n          return;\n        }\n      }\n      setStatus(\"Comparison successful\");\n    },\n  };\n\n  const actions = {\n    step(): boolean {\n      dispatch.current({ action: \"step\" });\n      return done;\n    },\n  };\n\n  const initialState = {\n    asm: \"\",\n    current: -1,\n    resultHighlight: -1,\n    sourceHighlight: undefined,\n    symbols: [],\n    result: [],\n    compare: [],\n  };\n\n  return { initialState, reducers, actions };\n}\n\nexport function useAsmPageStore() {\n  const { setStatus } = useContext(BaseContext);\n\n  const dispatch = useRef<AsmStoreDispatch>(() => undefined);\n\n  const { initialState, reducers, actions } = useMemo(\n    () => makeAsmStore(setStatus, dispatch),\n    [setStatus, dispatch]\n  );\n\n  const [state, dispatcher] = useImmerReducer(reducers, initialState);\n  dispatch.current = dispatcher;\n\n  return { state, dispatch, actions };\n}\n","import { rounded } from \"@davidsouther/jiffies/lib/esm/dom/css/border.js\";\nimport { dec } from \"@nand2tetris/simulator/util/twos.js\";\n\nexport const Table = ({\n  values = [],\n  highlight = -1,\n  onClick,\n}: {\n  values?: [string, string][];\n  highlight?: number;\n  onClick?: (id: string, value: string) => void;\n}) => {\n  return (\n    <div>\n      {values.map((entry, i) => (\n        <TableRow\n          key={i}\n          identifier={entry[0]}\n          value={entry[1]}\n          highlight={i === highlight}\n          onClick={() => onClick?.(entry[0], entry[1])}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport const NumberedTable = ({\n  values = [],\n  highlight = -1,\n  onClick,\n}: {\n  values?: string[];\n  highlight?: number;\n  onClick?: (index: number) => void;\n}) => {\n  const getIndexString = (i: number) =>\n    values.length ? dec(i).padStart(Math.ceil(Math.log10(i)), \" \") : dec(i);\n\n  return (\n    <Table\n      values={values.map((v, i) => [getIndexString(i), v])}\n      highlight={highlight}\n      onClick={(id, value) => onClick?.(Number(id))}\n    />\n  );\n};\n\nconst TableRow = ({\n  identifier,\n  value,\n  highlight = false,\n  onClick,\n}: {\n  identifier: string;\n  value: string;\n  highlight?: boolean;\n  onClick?: () => void;\n}) => {\n  return (\n    <div style={{ display: \"flex\", height: \"100%\" }} onClick={onClick}>\n      <code\n        style={{\n          ...rounded(\"none\"),\n          ...(highlight ? { background: \"var(--mark-background-color)\" } : {}),\n          whiteSpace: \"pre\",\n        }}\n      >\n        {identifier}\n      </code>\n      <code\n        style={{\n          flex: \"1\",\n          textAlign: \"right\",\n          color: \"black\",\n          ...rounded(\"none\"),\n          ...(highlight ? { background: \"var(--mark-background-color)\" } : {}),\n        }}\n      >\n        <span style={{ color: \"black\" }}>{value}</span>\n      </code>\n    </div>\n  );\n};\n","import { Trans } from \"@lingui/macro\";\nimport { Runbar } from \"@nand2tetris/components/runbar\";\nimport { useAsmPageStore } from \"@nand2tetris/components/stores/asm.store\";\nimport { BaseContext } from \"@nand2tetris/components/stores/base.context\";\nimport { NumberedTable, Table } from \"@nand2tetris/components/table\";\nimport { ASM } from \"@nand2tetris/simulator/languages/asm.js\";\nimport { Timer } from \"@nand2tetris/simulator/timer\";\nimport { ChangeEvent, useContext, useEffect, useRef, useState } from \"react\";\nimport { Editor } from \"../shell/editor\";\nimport { Panel } from \"../shell/panel\";\n\nimport \"./asm.scss\";\n\nexport const Asm = () => {\n  const { state, actions, dispatch } = useAsmPageStore();\n\n  const [asm, setAsm] = useState(\"\");\n  const [cmp, setCmp] = useState(\"\");\n\n  const runner = useRef<Timer>();\n  const [runnerAssigned, setRunnerAssigned] = useState(false);\n\n  useEffect(() => {\n    runner.current = new (class AsmRunner extends Timer {\n      override tick(): boolean {\n        return actions.step();\n      }\n      override reset(): void {\n        dispatch.current({ action: \"reset\" });\n      }\n      override toggle(): void {\n        return;\n      }\n    })();\n    setRunnerAssigned(true);\n\n    return () => {\n      runner.current?.stop();\n    };\n  }, [actions, dispatch]);\n\n  const fileUploadRef = useRef<HTMLInputElement>(null);\n  let fileType: \"asm\" | \"cmp\" = \"asm\";\n\n  const loadAsm = () => {\n    fileType = \"asm\";\n    fileUploadRef.current?.click();\n  };\n\n  const loadCompare = () => {\n    fileType = \"cmp\";\n    fileUploadRef.current?.click();\n  };\n\n  const { setStatus } = useContext(BaseContext);\n  const uploadFile = async (event: ChangeEvent<HTMLInputElement>) => {\n    if (!event.target.files?.length) {\n      setStatus(\"No file selected\");\n      return;\n    }\n    const file = event.target.files[0];\n    const source = await file.text();\n    if (fileType === \"asm\") {\n      if (!file.name.endsWith(\".asm\")) {\n        setStatus(\"File must be .asm file\");\n        return;\n      }\n      dispatch.current({ action: \"setAsm\", payload: { asm: source } });\n      setAsm(file.name);\n    } else {\n      if (!file.name.endsWith(\".hack\")) {\n        setStatus(\"File must be .hack file\");\n        return;\n      }\n      dispatch.current({ action: \"setCmp\", payload: { cmp: source } });\n      setCmp(file.name);\n    }\n  };\n\n  const compare = () => {\n    dispatch.current({ action: \"compare\" });\n  };\n\n  return (\n    <div className=\"AsmPage grid\">\n      <Panel\n        className=\"source\"\n        header={\n          <>\n            <div>\n              <Trans>Source</Trans>\n              {asm && `: ${asm}`}\n            </div>\n            <div className=\"flex-1\">\n              {runnerAssigned && runner.current && (\n                <Runbar runner={runner.current} />\n              )}\n            </div>\n            <div>\n              <fieldset role=\"group\">\n                <input\n                  type=\"file\"\n                  style={{ display: \"none\" }}\n                  ref={fileUploadRef}\n                  onChange={uploadFile}\n                />\n                <button onClick={loadAsm}>📂</button>\n              </fieldset>\n            </div>\n          </>\n        }\n      >\n        <Editor\n          value={state.asm}\n          onChange={(source: string) => {\n            return;\n          }}\n          onCursorPositionChange={(index) => {\n            dispatch.current({\n              action: \"updateHighlightByTextOffset\",\n              payload: { index },\n            });\n          }}\n          grammar={ASM.parser}\n          language={\"asm\"}\n          highlight={state.sourceHighlight}\n          disabled={true}\n        />\n      </Panel>\n      <Panel\n        className=\"result\"\n        header={\n          <div>\n            <Trans>Result</Trans>\n          </div>\n        }\n      >\n        <NumberedTable\n          values={state.result}\n          highlight={state.resultHighlight}\n          onClick={(i: number) => {\n            dispatch.current({\n              action: \"updateHighlightByResult\",\n              payload: { index: i },\n            });\n          }}\n        />\n        {state.symbols.length > 0 && \"Symbol Table\"}\n        <Table values={state.symbols} />\n      </Panel>\n      <Panel\n        className=\"compare\"\n        header={\n          <>\n            <div>\n              <Trans>Compare</Trans>\n              {cmp && `: ${cmp}`}\n            </div>\n            <div>\n              <fieldset role=\"group\">\n                <button onClick={compare}>Compare</button>\n                <button onClick={loadCompare}>📂</button>\n              </fieldset>\n            </div>\n          </>\n        }\n      >\n        <NumberedTable values={state.compare} />\n      </Panel>\n    </div>\n  );\n};\n\nexport default Asm;\n","import { debounce } from \"@davidsouther/jiffies/lib/esm/debounce\";\nimport { Trans } from \"@lingui/macro\";\nimport MonacoEditor, { OnMount, useMonaco } from \"@monaco-editor/react\";\nimport type * as monacoT from \"monaco-editor/esm/vs/editor/editor.api\";\nimport ohm from \"ohm-js\";\nimport {\n  CSSProperties,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { AppContext } from \"../App.context\";\n\nimport {\n  Span,\n  UNKNOWN_PARSE_ERROR,\n} from \"@nand2tetris/simulator/languages/base.js\";\n\nimport \"./editor.scss\";\n\nexport const ErrorPanel = ({ error }: { error?: ohm.MatchResult }) => {\n  return error?.failed() ? (\n    <details className=\"ErrorPanel\" open>\n      <summary role=\"button\" className=\"secondary\">\n        <Trans>Parse Error</Trans>\n      </summary>\n      <pre>\n        <code>\n          {error?.message ?? error?.shortMessage ?? UNKNOWN_PARSE_ERROR}\n        </code>\n      </pre>\n    </details>\n  ) : (\n    <></>\n  );\n};\n\nconst Textarea = ({\n  value,\n  onChange,\n  language,\n  disabled = false,\n}: {\n  value: string;\n  onChange: (value: string) => void;\n  language: string;\n  disabled?: boolean;\n}) => {\n  const [text, setText] = useState(value);\n  return (\n    <textarea\n      data-testid={`editor-${language}`}\n      disabled={disabled}\n      value={text}\n      onChange={(e) => {\n        const value = e.target?.value;\n        setText(value);\n        onChange(value);\n      }}\n    />\n  );\n};\n\nconst MONACO_LIGHT_THEME = \"vs\";\nconst MONACO_DARK_THEME = \"vs-dark\";\n\nconst makeHighlight = (\n  monaco: typeof monacoT | null,\n  editor: monacoT.editor.IStandaloneCodeEditor | undefined,\n  highlight: Span | undefined,\n  decorations: string[]\n): string[] => {\n  if (!(editor && highlight)) return decorations;\n  const model = editor.getModel();\n  if (!model) return decorations;\n  const start = model.getPositionAt(highlight.start);\n  const end = model.getPositionAt(highlight.end);\n  const range = monaco?.Range.fromPositions(start, end);\n  const nextDecoration: monacoT.editor.IModelDeltaDecoration[] = [];\n  if (range) {\n    nextDecoration.push({\n      range,\n      options: { inlineClassName: \"highlight\" },\n    });\n    editor.revealRangeInCenter(range);\n  }\n  return editor.deltaDecorations(decorations, nextDecoration);\n};\n\nconst Monaco = ({\n  value,\n  onChange,\n  onCursorPositionChange,\n  language,\n  error,\n  disabled = false,\n  highlight: currentHighlight,\n}: {\n  value: string;\n  onChange: (value: string) => void;\n  onCursorPositionChange?: (index: number) => void;\n  language: string;\n  error?: ohm.MatchResult | undefined;\n  disabled?: boolean;\n  highlight?: Span;\n}) => {\n  const { theme } = useContext(AppContext);\n  const monaco = useMonaco();\n\n  const editor = useRef<monacoT.editor.IStandaloneCodeEditor>();\n  const decorations = useRef<string[]>([]);\n  const highlight = useRef<Span | undefined>(undefined);\n\n  const codeTheme = useCallback(() => {\n    const isDark =\n      theme === \"system\"\n        ? window.matchMedia(\"(prefers-color-scheme: dark)\").matches\n        : theme === \"dark\";\n    return isDark ? MONACO_DARK_THEME : MONACO_LIGHT_THEME;\n  }, [theme]);\n\n  const doHighlight = useCallback(() => {\n    decorations.current = makeHighlight(\n      monaco,\n      editor.current,\n      // I'm not sure why this makes things work, but it is load bearing.\n      // Removing the empty span will cause the initial first-statement\n      // highlight in the test view to not show. Setting it to [0, 1] will\n      // cause a 1-character highlight in the editor view, so don't do that\n      // either.\n      highlight.current ?? { start: 0, end: 0 },\n      decorations.current\n    );\n  }, [decorations, monaco, editor, highlight]);\n\n  // Mark and center highlighted spans\n  useEffect(() => {\n    highlight.current = currentHighlight;\n    doHighlight();\n  }, [currentHighlight]);\n\n  // Set options when mounting\n  const onMount: OnMount = useCallback(\n    (ed) => {\n      editor.current = ed;\n      editor.current?.updateOptions({\n        fontFamily: `\"JetBrains Mono\", source-code-pro, Menlo, Monaco,\n      Consolas, \"Roboto Mono\", \"Ubuntu Monospace\", \"Noto Mono\", \"Oxygen Mono\",\n      \"Liberation Mono\", monospace, \"Apple Color Emoji\", \"Segoe UI Emoji\",\n      \"Segoe UI Symbol\", \"Noto Color Emoji\"`,\n        fontSize: 16,\n        minimap: {\n          enabled: false,\n        },\n        theme: codeTheme(),\n        scrollBeyondLastLine: false,\n        readOnly: disabled,\n      });\n      doHighlight();\n      editor.current?.onDidChangeCursorPosition((e) => {\n        const index = editor.current?.getModel()?.getOffsetAt(e.position);\n        if (index !== undefined) {\n          onCursorPositionChange?.(index);\n        }\n      });\n    },\n    [codeTheme]\n  );\n\n  // Set themes\n  useEffect(() => {\n    if (editor.current === undefined) return;\n    editor.current.updateOptions({ theme: codeTheme() });\n  }, [editor, codeTheme]);\n\n  // Prevent editing disabled editors\n  useEffect(() => {\n    if (editor.current === undefined) return;\n    editor.current.updateOptions({ readOnly: disabled });\n  }, [editor, disabled]);\n\n  // Add error markers on parse failure\n  useEffect(() => {\n    if (editor.current === undefined) return;\n    if (monaco === null) return;\n    const model = editor.current.getModel();\n    if (model === null) return;\n    if (error === undefined || error.succeeded()) {\n      monaco.editor.setModelMarkers(model, language, []);\n      return;\n    }\n    // Line 7, col 5:\n    const { line, column, message } =\n      /Line (?<line>\\d+), col (?<column>\\d+): (?<message>.*)/.exec(\n        error.shortMessage ?? \"\"\n      )?.groups ?? { line: 1, column: 1, message: \"could not parse error\" };\n    const startLineNumber = Number(line);\n    const endLineNumber = startLineNumber;\n    const startColumn = Number(column);\n    const restOfLine = model\n      .getLineContent(startLineNumber)\n      .substring(startColumn - 1);\n    let endColumn =\n      startColumn + (restOfLine.match(/([^\\s]+)/)?.[0].length ?? 1);\n    if (endColumn <= startColumn) {\n      endColumn = startColumn + 1;\n    }\n\n    monaco.editor.setModelMarkers(model, language, [\n      {\n        message,\n        startColumn,\n        startLineNumber,\n        endColumn,\n        endLineNumber,\n        severity: 8, // monacoT.MarkerSeverity.Error,\n      },\n    ]);\n  }, [error, editor, monaco, language]);\n\n  return (\n    <>\n      <MonacoEditor\n        value={value}\n        onChange={(v = \"\") => onChange(v)}\n        language={language}\n        onMount={onMount}\n      />\n    </>\n  );\n};\n\nexport const Editor = ({\n  className = \"\",\n  style = {},\n  disabled = false,\n  value,\n  onChange,\n  onCursorPositionChange,\n  grammar,\n  language,\n  highlight,\n}: {\n  className?: string;\n  style?: CSSProperties;\n  disabled?: boolean;\n  value: string;\n  onChange: (source: string) => void;\n  onCursorPositionChange?: (index: number) => void;\n  grammar: ohm.Grammar;\n  language: string;\n  highlight?: Span;\n}) => {\n  const [error, setError] = useState<ohm.MatchResult>();\n  const { monaco } = useContext(AppContext);\n\n  const parse = useCallback(\n    (text = \"\") => {\n      const parsed = grammar.match(text);\n      setError(parsed.failed() ? parsed : undefined);\n    },\n    [setError, grammar]\n  );\n\n  useEffect(() => parse(value), [parse, value]);\n  const doParse = useMemo(() => debounce(parse, 500), [parse]);\n\n  const onChangeCB = useCallback(\n    (text = \"\") => {\n      onChange(text);\n      doParse(text);\n    },\n    [doParse, onChange]\n  );\n\n  return (\n    <div className={`Editor ${className}`} style={style}>\n      {monaco.canUse && monaco.wants ? (\n        <Monaco\n          value={value}\n          onChange={onChangeCB}\n          onCursorPositionChange={onCursorPositionChange}\n          language={language}\n          error={error}\n          disabled={disabled}\n          highlight={highlight}\n        />\n      ) : (\n        <>\n          <Textarea\n            value={value}\n            onChange={onChangeCB}\n            language={language}\n            disabled={disabled}\n          />\n          <ErrorPanel error={error} />\n        </>\n      )}\n    </div>\n  );\n};\n","import { CSSProperties, ReactNode } from \"react\";\n\nexport const Panel = (props: {\n  children: ReactNode;\n  header?: ReactNode;\n  footer?: ReactNode;\n  className?: string;\n  style?: CSSProperties;\n}) => {\n  return (\n    <article className={[\"panel\", props.className ?? \"\"].join(\" \")}>\n      {props.header && <header>{props.header}</header>}\n      <main>{props.children}</main>\n      {props.footer && <footer>{props.footer}</footer>}\n    </article>\n  );\n};\n\nexport const Accordian = (props: {\n  children: ReactNode;\n  summary: ReactNode;\n  className?: string;\n  style?: CSSProperties;\n  open?: boolean;\n}) => {\n  return (\n    <details\n      className={props.className ?? \"\"}\n      open={props.open}\n      style={props.style}\n    >\n      <summary>\n        <div className=\"flex row align-baseline\">{props.summary}</div>\n      </summary>\n      {props.children}\n    </details>\n  );\n};\n","import produce from \"immer\";\nimport { Dispatch, useEffect, useReducer, useState } from \"react\";\n\nexport function useImmerReducer<\n  T,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  Reducers extends Record<string, (state: T, action?: any) => T | void>\n>(reducers: Reducers, initialState: T) {\n  return useReducer(\n    (\n      state: T,\n      command: {\n        action: keyof Reducers;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        payload?: any;\n      }\n    ): T =>\n      produce(state, (draft: T) => {\n        reducers[command.action](draft, command.payload);\n      }),\n    initialState\n  );\n}\n\nexport function useStateInitializer<T>(init: T): [T, Dispatch<T>] {\n  const [state, setState] = useState<T>(init);\n  useEffect(() => {\n    setState(init);\n  }, [init]);\n  return [state, setState];\n}\n","import { Timer } from \"@nand2tetris/simulator/timer.js\";\nimport { ChangeEvent, ReactNode, useEffect, useState } from \"react\";\nimport { useTimer } from \"./timer.js\";\n\nexport const Runbar = (props: { runner: Timer; children?: ReactNode }) => {\n  const runner = useTimer(props.runner);\n  const [speedValue, setSpeed] = useState(0);\n\n  const speedValues: Record<number, [number, number]> = {\n    0: [1000, 1],\n    1: [500, 1],\n    2: [16, 1],\n    3: [16, 16666],\n    4: [16, 16666 * 30],\n  };\n\n  useEffect(() => {\n    updateSpeed();\n  }, [speedValue]);\n\n  const updateSpeed = () => {\n    const [speed, steps] = speedValues[speedValue];\n    runner.dispatch({ action: \"setSpeed\", payload: speed });\n    runner.dispatch({ action: \"setSteps\", payload: steps });\n  };\n\n  const onChange = (e: ChangeEvent<HTMLInputElement>) => {\n    setSpeed(Number(e.target.value));\n  };\n\n  return (\n    <fieldset role=\"group\">\n      <button\n        className=\"flex-0\"\n        onClick={() => runner.actions.frame()}\n        data-tooltip={`Step`}\n        data-placement=\"bottom\"\n      >\n        {/* <Icon name=\"play_arrow\" /> */}\n        ➡️\n      </button>\n      <button\n        className=\"flex-0\"\n        onClick={() =>\n          runner.state.running ? runner.actions.stop() : runner.actions.start()\n        }\n        data-tooltip={runner.state.running ? `Pause` : `Run`}\n        data-placement=\"bottom\"\n      >\n        {/* <Icon name={runner.state.running ? \"pause\" : \"fast_forward\"} /> */}\n        {runner.state.running ? \"⏸\" : \"️⏩\"}\n      </button>\n      <button\n        className=\"flex-0\"\n        onClick={() => runner.actions.reset()}\n        data-tooltip={`Reset`}\n        data-placement=\"bottom\"\n      >\n        {/* <Icon name=\"fast_rewind\" /> */}⏮\n      </button>\n      <div\n        style={{\n          display: \"flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          fontSize: 16,\n          fontWeight: \"normal\",\n        }}\n      >\n        <span style={{ padding: \"0.2rem\" }}>Slow</span>\n        <input\n          type=\"range\"\n          min={0}\n          max={4}\n          step={1}\n          value={speedValue}\n          disabled={runner.state.running}\n          onChange={onChange}\n          style={{ width: \"150px\", padding: \"0.2rem\" }}\n          data-tooltip={\"Execution speed\"}\n          data-placement={\"bottom\"}\n        />\n        <span style={{ padding: \"0.2rem\" }}>Fast</span>\n      </div>\n      {props.children}\n    </fieldset>\n  );\n};\n","import { Timer } from \"@nand2tetris/simulator/timer.js\";\nimport { useImmerReducer } from \"./react.js\";\n\nexport interface TimerStoreState {\n  steps: number;\n  speed: number;\n  running: boolean;\n}\n\nimport { Dispatch, MutableRefObject, useMemo, useRef } from \"react\";\nexport type TimerStoreDispatch = Dispatch<{\n  action: keyof ReturnType<typeof makeTimerStore>[\"reducers\"];\n  payload?: unknown;\n}>;\n\nconst makeTimerStore = (\n  timer: Timer,\n  dispatch: MutableRefObject<TimerStoreDispatch>\n) => {\n  const initialState: TimerStoreState = {\n    running: timer.running,\n    speed: timer.speed,\n    steps: timer.steps,\n  };\n\n  const finishFrame = timer.finishFrame.bind(timer);\n  timer.finishFrame = function () {\n    finishFrame();\n    dispatch.current({ action: \"update\" });\n  };\n\n  const reducers = {\n    update(state: TimerStoreState) {\n      state.running = timer.running;\n      state.speed = timer.speed;\n      state.steps = timer.steps;\n    },\n    setSteps(state: TimerStoreState, steps: number) {\n      state.steps = steps;\n      timer.steps = steps;\n    },\n    setSpeed(state: TimerStoreState, speed: number) {\n      state.speed = speed;\n      timer.speed = speed;\n    },\n  };\n\n  const actions = {\n    frame() {\n      timer.frame();\n    },\n    start() {\n      timer.start();\n      dispatch.current({ action: \"update\" });\n    },\n    stop() {\n      timer.stop();\n      dispatch.current({ action: \"update\" });\n    },\n    reset() {\n      timer.reset();\n      dispatch.current({ action: \"update\" });\n    },\n  };\n\n  return { initialState, reducers, actions };\n};\n\nexport function useTimer(timer: Timer) {\n  const dispatch = useRef<TimerStoreDispatch>(() => undefined);\n\n  const { initialState, reducers, actions } = useMemo(\n    () => makeTimerStore(timer, dispatch),\n    [timer, dispatch]\n  );\n\n  const [state, dispatcher] = useImmerReducer(reducers, initialState);\n\n  dispatch.current = dispatcher;\n\n  return { state, dispatch: dispatch.current, actions };\n}\n","import { Clock } from \"./chip/clock.js\";\n\nexport const MAX_STEPS = 1000;\n\nconst clock = Clock.get();\n\nexport abstract class Timer {\n  frame() {\n    this.tick();\n    this.finishFrame();\n  }\n\n  /// Update the simulation state, but DO NOT perform any UI changes.\n  abstract tick(): boolean;\n\n  /// UI Updates are allowed in finishFrame.\n  finishFrame() {\n    clock.frame();\n  }\n\n  abstract reset(): void;\n\n  abstract toggle(): void;\n\n  steps = 1; // How many steps to take per update\n  speed = 1000; // how often to update, in ms\n  get running() {\n    return this.#running;\n  }\n\n  #running = false;\n  #sinceLastFrame = 0;\n  #lastUpdate = 0;\n  #run = async () => {\n    if (!this.#running) {\n      return;\n    }\n    const now = Date.now();\n    const delta = now - this.#lastUpdate;\n    this.#lastUpdate = now;\n    this.#sinceLastFrame += delta;\n    if (this.#sinceLastFrame > this.speed) {\n      let done = false;\n      // let steps = Math.min(this.steps, MAX_STEPS);\n      let steps = this.steps;\n      const timingLabel = `Timing ${steps} steps`;\n      console.time(timingLabel);\n      while (!done && steps--) {\n        // done = await this.tick();\n        done = this.tick();\n      }\n      console.timeEnd(timingLabel);\n      this.finishFrame();\n      if (done) {\n        this.stop();\n      }\n      this.#sinceLastFrame -= this.speed;\n    }\n    requestAnimationFrame(this.#run);\n  };\n\n  start() {\n    this.#running = true;\n    this.#lastUpdate = Date.now() - this.speed;\n    this.#run();\n    this.toggle();\n  }\n\n  stop() {\n    this.#running = false;\n    this.toggle();\n  }\n}\n"],"names":["useAsmPageStore","setStatus","useContext","BaseContext","dispatch","useRef","initialState","reducers","actions","useMemo","asmInstructions","done","instructionToIndex","Map","setAsm","state","asm","parseResult","ASM","isErr","Err","message","symbols","Ok","fillLabel","name","value","push","instructions","filter","instruction","type","this","reset","setCmp","cmp","compare","loadHackSync","map","n","bin","step","current","length","resultHighlight","sourceHighlight","span","result","translateInstruction","undefined","set","updateHighlightByTextOffset","index","start","end","get","updateHighlightByResult","i","action","makeAsmStore","dispatcher","useImmerReducer","Table","values","highlight","onClick","_jsx","children","entry","TableRow","identifier","NumberedTable","getIndexString","dec","padStart","Math","ceil","log10","v","id","Number","_jsxs","style","display","height","rounded","background","whiteSpace","flex","textAlign","color","Asm","useState","runner","runnerAssigned","setRunnerAssigned","useEffect","Timer","tick","toggle","stop","fileUploadRef","fileType","className","header","role","ref","onChange","async","event","target","files","file","source","text","endsWith","payload","click","onCursorPositionChange","grammar","language","disabled","ErrorPanel","error","failed","open","shortMessage","UNKNOWN_PARSE_ERROR","Textarea","setText","e","Monaco","currentHighlight","theme","AppContext","monaco","useMonaco","editor","decorations","codeTheme","useCallback","window","matchMedia","matches","doHighlight","model","getModel","getPositionAt","range","Range","fromPositions","nextDecoration","options","inlineClassName","revealRangeInCenter","deltaDecorations","makeHighlight","onMount","ed","updateOptions","fontFamily","fontSize","minimap","enabled","scrollBeyondLastLine","readOnly","onDidChangeCursorPosition","getOffsetAt","position","succeeded","setModelMarkers","line","column","exec","groups","startLineNumber","endLineNumber","startColumn","endColumn","getLineContent","substring","match","severity","Editor","setError","parse","parsed","doParse","debounce","onChangeCB","canUse","wants","Panel","props","join","footer","Accordian","summary","useReducer","command","produce","draft","useStateInitializer","init","setState","Runbar","timer","running","speed","steps","finishFrame","bind","update","setSteps","setSpeed","frame","makeTimerStore","useTimer","speedValue","speedValues","updateSpeed","alignItems","justifyContent","fontWeight","padding","min","max","width","clock","Clock","now","Date","delta","timingLabel","console","time","timeEnd","log","requestAnimationFrame"],"sourceRoot":""}