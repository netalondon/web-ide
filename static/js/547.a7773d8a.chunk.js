"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[547],{8815:(e,t,n)=>{n.r(t),n.d(t,{VMInstructionRow:()=>T,VMStackFrame:()=>C,default:()=>A});var s=n(5072),i=n(3478),r=n(3577),a=n(8963),c=n(6604),l=n(5692),o=n(7054);var d=n(2201),u=n(4430),h=n(8637),m=n(4388),p=n(5920),g=n(6845),f=n(4913),x=n(5969);function j(e,t){const n=new x.j(e.vm.RAM,t),s=new x.j(e.vm.Screen,t),i=new d.qT(new x.j(e.vm.RAM,t)),r=e.vm.derivedLine();return{Keyboard:i,RAM:n,Screen:s,Stack:e.vm.vmStack().reverse(),Prog:e.vm.program,highlight:r}}function b(){const{fs:e,setStatus:t,storage:n}=(0,g.useContext)(l.r),s=(0,g.useRef)((()=>{})),{initialState:i,reducers:r,actions:a}=(0,g.useMemo)((()=>function(e,t,n,s){const i=(0,o.Wg)(h.VM.parse("\nfunction Main.fibonacci 0\npush argument 0\npush constant 2\nlt                     // checks if n<2\nif-goto IF_TRUE\ngoto IF_FALSE\nlabel IF_TRUE          // if n<2, return n\npush argument 0        \nreturn\nlabel IF_FALSE         // if n>=2, returns fib(n-2)+fib(n-1)\npush argument 0\npush constant 2\nsub\ncall Main.fibonacci 1  // computes fib(n-2)\npush argument 0\npush constant 1\nsub\ncall Main.fibonacci 1  // computes fib(n-1)\nadd                    // returns fib(n-1) + fib(n-2)\nreturn\n\nfunction Sys.init 0\npush constant 4\ncall Main.fibonacci 1   // computes the 4'th fibonacci element\nlabel WHILE\ngoto WHILE              // loops infinitely\n"));let r=(0,o.Wg)(p.Vm.build(i.instructions)),a=(new m.w).with(r),c=!1,l=!0;const d={setTst(e,t){let{tst:n,cmp:s}=t;e.files.tst=n,e.files.cmp=s??""},update(e){e.vm=j(a,s),e.test.useTest=c,e.test.highlight=a.currentStep?.span},setAnimate(e,t){e.controls.animate=t},testStep(e){e.files.out=a.log()},testFinished(e){const n=(0,f.q)(e.files.cmp.trim(),e.files.out);t(n?"Simulation successful: The output file is identical to the compare file":"Simulation error: The output file differs from the compare file")}},g={loadVm(e){const n=[];for(const s of e){const e=h.VM.parse(s.content);if((0,o.dZ)(e))return t(`Parse error: ${e.err.message}`),!1;n.push({name:s.name,instructions:(0,o.Wg)(e).instructions})}const i=p.Vm.buildFromFiles(n);return(0,o.dZ)(i)?(t(`Build Error: ${i.err.message}`),!1):(r=(0,o.Wg)(i),a.vm=r,a.reset(),s.current({action:"update"}),!0)},loadTest(e,n){s.current({action:"setTst",payload:{tst:e,cmp:n}});const i=u.qH.parse(e);return(0,o.dZ)(i)?(t("Failed to parse test"),!1):(t("Parsed tst"),r.reset(),a=m.w.from((0,o.Wg)(i)),a.vm=r,s.current({action:"update"}),!0)},setAnimate(e){l=e,s.current({action:"setAnimate",payload:e})},step(){try{let e=!1;if(c)e=a.step(),s.current({action:"testStep"}),e&&s.current({action:"testFinished"});else{const n=r.step();void 0!==n&&(e=!0,t(0==n?"Program halted":`Program exited with error code ${n}${v[n]?`: ${v[n]}`:""}`))}return l&&s.current({action:"update"}),e}catch(e){return t(`Runtime error: ${e.message}`),!0}},reset(){a.reset(),r.reset(),s.current({action:"update"}),t("Reset")},toggleUseTest(){c=!c,s.current({action:"update"})},initialize(){this.loadTest("repeat {\n\tvmstep;\n}",""),s.current({action:"update"})}};return{initialState:{vm:j(a,s),controls:{error:"",runningTest:!1,animate:!0},test:{useTest:c,highlight:void 0},files:{tst:"",cmp:"",out:""}},reducers:d,actions:g}}(0,t,0,s)),[e,t,n,s]),[d,x]=(0,c.C)(r,i);return s.current=x,{state:d,dispatch:s,actions:a}}const v={1:"Duration must be positive (Sys.wait)",2:"Array size must be positive (Array.new)",3:"Division by zero (Math.divide)",4:"Cannot compute square root of a negative number (Math.sqrt)",5:"Allocated memory size must be positive (Memory.alloc)",6:"Heap overflow (Memory.alloc)",7:"Illegal pixel coordinates (Screen.drawPixel)",8:"Illegal line coordinates (Screen.drawLine)",9:"Illegal rectangle coordinates (Screen.drawRectangle)",12:"Illegal center coordinates (Screen.drawCircle)",13:"Illegal radius (Screen.drawCircle)",14:"Maximum length must be non-negative (String.new)",15:"String index out of bounds (String.charAt)",16:"String index out of bounds (String.setCharAt)",17:"String is full (String.appendChar)",18:"String is empty (String.eraseLastChar)",19:"Insufficient string capacity (String.setInt)",20:"Illegal cursor location (Output.moveCursor)"};var S=n(4619),y=n(8722),k=n(8398),w=n(558),M=n(864);const A=()=>{const{state:e,actions:t,dispatch:n}=b(),{toolStates:o}=(0,g.useContext)(y.Il),[d,u]=(0,c.i)(e.files.tst),[h,m]=(0,c.i)(e.files.out),[p,f]=(0,c.i)(e.files.cmp);(0,g.useEffect)((()=>{o.setTool("vm")}),[]),(0,g.useEffect)((()=>{t.initialize()}),[t]);const[x,j]=(0,g.useState)("Stack"),v=(0,g.useRef)(),[A,I]=(0,g.useState)(!1);(0,g.useEffect)((()=>(v.current=new class extends S.B{async tick(){return t.step()}finishFrame(){n.current({action:"update"})}reset(){t.reset()}toggle(){n.current({action:"update"})}},I(!0),()=>{var e;null===(e=v.current)||void 0===e||e.stop()})),[t,n]);const F=(0,g.useRef)(null),{setStatus:R}=(0,g.useContext)(l.r);return(0,M.jsxs)("div",{className:"Page VmPage grid",children:[(0,M.jsx)(k.s,{className:"program",header:(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(s.cC,{id:"Program"}),(0,M.jsx)("input",{type:"file",multiple:!0,style:{display:"none"},ref:F,onChange:async e=>{var n;if(null===(n=e.target.files)||void 0===n||!n.length)return void R("No file selected");R("Loading");const s=[];for(const t of e.target.files)t.name.endsWith(".vm")&&s.push({name:t.name.replace(".vm",""),content:await t.text()});if(0==s.length)return void R("No .vm file was selected");t.loadVm(s)&&R("Loaded vm file")}}),(0,M.jsx)("button",{className:"flex-0",onClick:()=>{var e;null===(e=F.current)||void 0===e||e.click()},"data-tooltip":"Load file","data-placement":"bottom",children:"\ud83d\udcc2"})]}),children:(0,M.jsx)("main",{children:(0,M.jsxs)("table",{children:[(0,M.jsx)("thead",{children:(0,M.jsxs)("tr",{children:[(0,M.jsx)("td",{children:"Inst"}),(0,M.jsx)("td",{children:"Target"}),(0,M.jsx)("td",{children:"Val"})]})}),(0,M.jsx)("tbody",{children:e.vm.Prog.map(((t,n)=>T({inst:t,key:n,highlighted:n===e.vm.highlight})))})]})})}),(0,M.jsxs)(k.s,{className:"IO",children:[(0,M.jsx)("div",{children:(0,M.jsxs)("label",{children:[(0,M.jsx)("input",{type:"checkbox",onChange:t.toggleUseTest,checked:e.test.useTest,role:"switch"}),"Use Test Script"]})}),(0,M.jsx)(a.l,{memory:e.vm.Screen}),(0,M.jsx)(i.N,{keyboard:e.vm.Keyboard}),e.controls.animate?(0,M.jsxs)("div",{role:"tablist",style:{"--tab-count":"2"},children:[(0,M.jsx)("div",{role:"tab",id:"mem-tab-stack","aria-controls":"mem-tabpanel","aria-selected":"Stack"===x,children:(0,M.jsxs)("label",{children:[(0,M.jsx)("input",{type:"radio",name:"mem-tabs","aria-controls":"mem-tabpanel",value:"tst",checked:"Stack"===x,onChange:()=>j("Stack")}),"Stack"]})}),(0,M.jsx)("div",{role:"tabpanel","aria-labelledby":"mem-tab-stack",id:"mem-tabpanel",children:e.vm.Stack.map(((e,t)=>(0,M.jsx)(C,{frame:e},t)))}),(0,M.jsx)("div",{role:"tab",id:"mem-tab-ram","aria-controls":"mem-tabpanel","aria-selected":"RAM"===x,children:(0,M.jsxs)("label",{children:[(0,M.jsx)("input",{type:"radio",name:"mem-tabs","aria-controls":"mem-tabpanel",value:"tst",checked:"RAM"===x,onChange:()=>j("RAM")}),"RAM"]})}),(0,M.jsx)("div",{role:"tabpanel","aria-labelledby":"mem-tab-ram",id:"mem-tabpanel",children:(0,M.jsx)(r.ZP,{memory:e.vm.RAM,format:"hex"})})]}):(0,M.jsx)("p",{children:"Hiding display for high speeds"})]}),A&&(0,M.jsx)(w.F,{runner:v,tst:[d,u,e.test.highlight],out:[h,m],cmp:[p,f],onLoadTest:t.loadTest,onSpeedChange:e=>{t.setAnimate(e<=2)}})]})};function C(e){var t,n;let{frame:s}=e;return(0,M.jsxs)("section",{children:[(0,M.jsx)("header",{children:(0,M.jsxs)("h3",{children:["Function",(0,M.jsx)("code",{children:null!==(t=null===(n=s.fn)||void 0===n?void 0:n.name)&&void 0!==t?t:"Unknown Function"})]})}),(0,M.jsxs)("main",{children:[(0,M.jsxs)("p",{children:[(0,M.jsx)("em",{children:"Args:"}),(0,M.jsxs)("code",{children:["[",s.args.values.join(", "),"]"]})]}),(0,M.jsxs)("p",{children:[(0,M.jsx)("em",{children:"Locals:"}),(0,M.jsxs)("code",{children:["[",s.locals.values.join(", "),"]"]})]}),(0,M.jsxs)("p",{children:[(0,M.jsx)("em",{children:"Stack:"}),(0,M.jsxs)("code",{children:["[",s.stack.values.join(", "),"]"]})]})]})]})}function T(e){let{inst:t,key:n,highlighted:s}=e;switch(t.op){case"add":case"and":case"eq":case"gt":case"lt":case"neg":case"not":case"or":case"sub":case"return":return(0,M.jsxs)("tr",{className:s?"highlight":"",children:[(0,M.jsx)("td",{children:t.op}),(0,M.jsx)("td",{colSpan:2})]},n);case"if-goto":case"label":case"goto":return(0,M.jsxs)("tr",{className:s?"highlight":"",children:[(0,M.jsx)("td",{children:t.op}),(0,M.jsx)("td",{colSpan:2,children:t.label})]},n);case"function":case"call":return(0,M.jsxs)("tr",{className:s?"highlight":"",children:[(0,M.jsx)("td",{children:t.op}),(0,M.jsx)("td",{children:t.name}),(0,M.jsx)("td",{children:"call"===t.op?t.nArgs:t.nVars})]},n);case"pop":case"push":return(0,M.jsxs)("tr",{className:s?"highlight":"",children:[(0,M.jsx)("td",{children:t.op}),(0,M.jsx)("td",{children:t.segment}),(0,M.jsx)("td",{children:t.offset.toString()})]},n);default:return(0,M.jsx)("tr",{className:s?"highlight":"",children:(0,M.jsx)("td",{colSpan:3,children:"Unknown"})},n)}}},5969:(e,t,n)=>{n.d(t,{j:()=>i});var s=n(2201);class i extends s.kG{dispatch;constructor(e,t){super(e,e.size,0),this.dispatch=t}async load(e,t){await super.load(e,t),this.dispatch.current({action:"update"})}}},554:(e,t,n)=>{n.d(t,{j:()=>s});const s=e=>{if((e=>"function"===typeof e?.toString||"string"===typeof e)(e)){const t=e.toString();return"[object Object]"===t?JSON.stringify(e):t}return JSON.stringify(e)}},2936:(e,t,n)=>{n.d(t,{b:()=>i});var s=n(5251);function i(e,t){return void 0===e&&void 0!==s.BM[t]&&(e=t),{..."inline"===t?{display:"inline-block"}:{},width:s.BM[e]??"0"}}}}]);